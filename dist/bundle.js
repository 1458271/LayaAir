parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"mW4A":[function(require,module,exports) {
"use strict";function t(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Const=void 0;var o=function o(){t(this,o)};exports.Const=o,o.NOT_ACTIVE=1,o.ACTIVE_INHIERARCHY=2,o.AWAKED=4,o.NOT_READY=8,o.DISPLAY=16,o.HAS_ZORDER=32,o.HAS_MOUSE=64,o.DISPLAYED_INSTAGE=128,o.DRAWCALL_OPTIMIZE=256;
},{}],"Jkpb":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function o(e,o,t){return o&&n(e.prototype,o),t&&n(e,t),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Pool=void 0;var t=function(){function n(){e(this,n)}return o(n,null,[{key:"getPoolBySign",value:function(e){return n._poolDic[e]||(n._poolDic[e]=[])}},{key:"clearBySign",value:function(e){n._poolDic[e]&&(n._poolDic[e].length=0)}},{key:"recover",value:function(e,o){o[n.POOLSIGN]||(o[n.POOLSIGN]=!0,n.getPoolBySign(e).push(o))}},{key:"recoverByClass",value:function(e){if(e){var o=e.__className||e.constructor._$gid;o&&n.recover(o,e)}}},{key:"_getClassSign",value:function(e){var o=e.__className||e._$gid;return o||(e._$gid=o=n._CLSID+"",n._CLSID++),o}},{key:"createByClass",value:function(e){return n.getItemByClass(n._getClassSign(e),e)}},{key:"getItemByClass",value:function(e,o){if(!n._poolDic[e])return new o;var t=n.getPoolBySign(e);if(t.length){var l=t.pop();l[n.POOLSIGN]=!1}else l=new o;return l}},{key:"getItemByCreateFun",value:function(e,o){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=n.getPoolBySign(e),r=l.length?l.pop():o.call(t);return r[n.POOLSIGN]=!1,r}},{key:"getItem",value:function(e){var o=n.getPoolBySign(e),t=o.length?o.pop():null;return t&&(t[n.POOLSIGN]=!1),t}}]),n}();exports.Pool=t,t._CLSID=0,t.POOLSIGN="__InPool",t._poolDic={};
},{}],"ziZY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Point=void 0;var t=require("../utils/Pool");function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var r=function(){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,n),this.x=t,this.y=i}return i(n,[{key:"setTo",value:function(t,e){return this.x=t,this.y=e,this}},{key:"reset",value:function(){return this.x=this.y=0,this}},{key:"recover",value:function(){t.Pool.recover("Point",this.reset())}},{key:"distance",value:function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))}},{key:"toString",value:function(){return this.x+","+this.y}},{key:"normalize",value:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t>0){var e=1/t;this.x*=e,this.y*=e}}},{key:"copy",value:function(t){return this.setTo(t.x,t.y)}}],[{key:"create",value:function(){return t.Pool.getItemByClass("Point",n)}}]),n}();exports.Point=r,r.TEMP=new r,r.EMPTY=new r;
},{"../utils/Pool":"Jkpb"}],"jK6U":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Event=void 0;var e=require("../maths/Point");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var o=function(){function n(){t(this,n)}return r(n,[{key:"setTo",value:function(e,t,n){return this.type=e,this.currentTarget=t,this.target=n,this}},{key:"stopPropagation",value:function(){this._stoped=!0}},{key:"touches",get:function(){if(!this.nativeEvent)return null;var t=this.nativeEvent.touches;if(t)for(var r=n.gStage,o=0,i=t.length;o<i;o++){var E=t[o],a=e.Point.TEMP;a.setTo(E.clientX,E.clientY),r._canvasTransform.invertTransformPoint(a),r.transform.invertTransformPoint(a),E.stageX=a.x,E.stageY=a.y}return t}},{key:"altKey",get:function(){return this.nativeEvent.altKey}},{key:"ctrlKey",get:function(){return this.nativeEvent.ctrlKey}},{key:"shiftKey",get:function(){return this.nativeEvent.shiftKey}},{key:"charCode",get:function(){return this.nativeEvent.charCode}},{key:"keyLocation",get:function(){return this.nativeEvent.location||this.nativeEvent.keyLocation}},{key:"stageX",get:function(){return n.gStage.mouseX}},{key:"stageY",get:function(){return n.gStage.mouseY}}]),n}();exports.Event=o,o.gStage=null,o.EMPTY=new o,o.MOUSE_DOWN="mousedown",o.MOUSE_UP="mouseup",o.CLICK="click",o.RIGHT_MOUSE_DOWN="rightmousedown",o.RIGHT_MOUSE_UP="rightmouseup",o.RIGHT_CLICK="rightclick",o.MOUSE_MOVE="mousemove",o.MOUSE_OVER="mouseover",o.MOUSE_OUT="mouseout",o.MOUSE_WHEEL="mousewheel",o.ROLL_OVER="mouseover",o.ROLL_OUT="mouseout",o.DOUBLE_CLICK="doubleclick",o.CHANGE="change",o.CHANGED="changed",o.RESIZE="resize",o.ADDED="added",o.REMOVED="removed",o.DISPLAY="display",o.UNDISPLAY="undisplay",o.ERROR="error",o.COMPLETE="complete",o.LOADED="loaded",o.READY="ready",o.PROGRESS="progress",o.INPUT="input",o.RENDER="render",o.OPEN="open",o.MESSAGE="message",o.CLOSE="close",o.KEY_DOWN="keydown",o.KEY_PRESS="keypress",o.KEY_UP="keyup",o.FRAME="enterframe",o.DRAG_START="dragstart",o.DRAG_MOVE="dragmove",o.DRAG_END="dragend",o.ENTER="enter",o.SELECT="select",o.BLUR="blur",o.FOCUS="focus",o.VISIBILITY_CHANGE="visibilitychange",o.FOCUS_CHANGE="focuschange",o.PLAYED="played",o.PAUSED="paused",o.STOPPED="stopped",o.START="start",o.END="end",o.COMPONENT_ADDED="componentadded",o.COMPONENT_REMOVED="componentremoved",o.RELEASED="released",o.LINK="link",o.LABEL="label",o.FULL_SCREEN_CHANGE="fullscreenchange",o.DEVICE_LOST="devicelost",o.TRANSFORM_CHANGED="transformchanged",o.ANIMATION_CHANGED="animationchanged",o.TRAIL_FILTER_CHANGE="trailfilterchange",o.TRIGGER_ENTER="triggerenter",o.TRIGGER_STAY="triggerstay",o.TRIGGER_EXIT="triggerexit";
},{"../maths/Point":"ziZY"}],"FZg7":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var l=e[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function i(t,i,l){return i&&e(t.prototype,i),l&&e(t,l),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Handler=void 0;var l=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t(this,e),this.once=!1,this._id=0,this.setTo(i,l,n,r)}return i(e,[{key:"setTo",value:function(t,i,l,n){return this._id=e._gid++,this.caller=t,this.method=i,this.args=l,this.once=n,this}},{key:"run",value:function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e}},{key:"runWith",value:function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i}},{key:"clear",value:function(){return this.caller=null,this.method=null,this.args=null,this}},{key:"recover",value:function(){this._id>0&&(this._id=0,e._pool.push(this.clear()))}}],[{key:"create",value:function(t,i){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._pool.length?e._pool.pop().setTo(t,i,l,n):new e(t,i,l,n)}}]),e}();exports.Handler=l,l._pool=[],l._gid=1;
},{}],"IA8z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventDispatcher=void 0;var e=require("../utils/Handler");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?r(e):n}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var f=function(){function e(){l(this,e)}return c(e,[{key:"hasListener",value:function(e){return!!(this._events&&this._events[e])}},{key:"event",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this._events||!this._events[e])return!1;var n=this._events[e];if(n.run)n.once&&delete this._events[e],null!=t?n.runWith(t):n.run();else{for(var r=0,o=n.length;r<o;r++){var i=n[r];i&&(null!=t?i.runWith(t):i.run()),i&&!i.once||(n.splice(r,1),r--,o--)}0===n.length&&this._events&&delete this._events[e]}return!0}},{key:"on",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._createListener(e,t,n,r,!1)}},{key:"once",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._createListener(e,t,n,r,!0)}},{key:"_createListener",value:function(e,t,n,r,o){(!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&this.off(e,t,n,o);var i=v.create(t||this,n,r,o);this._events||(this._events={});var u=this._events;return u[e]?u[e].run?u[e]=[u[e],i]:u[e].push(i):u[e]=i,this}},{key:"off",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this._events||!this._events[e])return this;var o=this._events[e];if(null!=o)if(o.run)t&&o.caller!==t||null!=n&&o.method!==n||r&&!o.once||(delete this._events[e],o.recover());else{for(var i=0,u=0,l=o.length;u<l;u++){var s=o[u];s?!s||t&&s.caller!==t||null!=n&&s.method!==n||r&&!s.once||(i++,o[u]=null,s.recover()):i++}i===l&&delete this._events[e]}return this}},{key:"offAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this._events;if(!t)return this;if(e)this._recoverHandlers(t[e]),delete t[e];else{for(var n in t)this._recoverHandlers(t[n]);this._events=null}return this}},{key:"offAllCaller",value:function(e){if(e&&this._events)for(var t in this._events)this.off(t,e,null);return this}},{key:"_recoverHandlers",value:function(e){if(e)if(e.run)e.recover();else for(var t=e.length-1;t>-1;t--)e[t]&&(e[t].recover(),e[t]=null)}},{key:"isMouseEvent",value:function(t){return e.MOUSE_EVENTS[t]||!1}}]),e}();exports.EventDispatcher=f,f.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0};var v=function(t){function r(e,t,i,u){return l(this,r),n(this,o(r).call(this,e,t,i,u))}return i(r,e.Handler),c(r,[{key:"recover",value:function(){this._id>0&&(this._id=0,r._pool.push(this.clear()))}}],[{key:"create",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return r._pool.length?r._pool.pop().setTo(e,t,n,o):new r(e,t,n,o)}}]),r}();v._pool=[];
},{"../utils/Handler":"FZg7"}],"xuKH":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function t(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Stat=void 0;var a=function(){function n(){e(this,n)}return t(n,null,[{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n._StatRender.show(e,t)}},{key:"enable",value:function(){n._StatRender.enable()}},{key:"hide",value:function(){n._StatRender.hide()}},{key:"clear",value:function(){n.trianglesFaces=n.renderBatches=n.savedRenderBatches=n.shaderCall=n.spriteRenderUseCacheCount=n.frustumCulling=n.octreeNodeCulling=n.canvasNormal=n.canvasBitmap=n.canvasReCache=0}},{key:"onclick",set:function(e){n._StatRender.set_onclick(e)}}]),n}();exports.Stat=a,a.FPS=0,a.loopCount=0,a.shaderCall=0,a.renderBatches=0,a.savedRenderBatches=0,a.trianglesFaces=0,a.spriteCount=0,a.spriteRenderUseCacheCount=0,a.frustumCulling=0,a.octreeNodeCulling=0,a.canvasNormal=0,a.canvasBitmap=0,a.canvasReCache=0,a.renderSlow=!1,a._fpsData=[],a._timer=0,a._count=0,a._StatRender=null;
},{}],"9izd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Node=void 0;var e=require("../Const"),t=require("../events/Event"),n=require("../events/EventDispatcher"),i=require("../utils/Pool"),s=require("../utils/Stat");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function a(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(r){function o(){var e;return h(this,o),(e=a(this,_(o).call(this)))._bits=0,e._children=o.ARRAY_EMPTY,e._extUIChild=o.ARRAY_EMPTY,e._parent=null,e._zOrder=0,e.name="",e.destroyed=!1,e.createGLBuffer(),e}return u(o,n.EventDispatcher),c(o,[{key:"createGLBuffer",value:function(){}},{key:"_setBit",value:function(t,n){t===e.Const.DISPLAY&&(this._getBit(t)!=n&&this._updateDisplayedInstage());n?this._bits|=t:this._bits&=~t}},{key:"_getBit",value:function(e){return 0!=(this._bits&e)}},{key:"_setUpNoticeChain",value:function(){this._getBit(e.Const.DISPLAY)&&this._setBitUp(e.Const.DISPLAY)}},{key:"_setBitUp",value:function(e){var t=this;for(t._setBit(e,!0),t=t._parent;t;){if(t._getBit(e))return;t._setBit(e,!0),t=t._parent}}},{key:"on",value:function(n,i,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return n!==t.Event.DISPLAY&&n!==t.Event.UNDISPLAY||this._getBit(e.Const.DISPLAY)||this._setBitUp(e.Const.DISPLAY),this._createListener(n,i,s,r,!1)}},{key:"once",value:function(n,i,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return n!==t.Event.DISPLAY&&n!==t.Event.UNDISPLAY||this._getBit(e.Const.DISPLAY)||this._setBitUp(e.Const.DISPLAY),this._createListener(n,i,s,r,!0)}},{key:"destroy",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed=!0,this._destroyAllComponent(),this._parent&&this._parent.removeChild(this),this._children&&(e?this.destroyChildren():this.removeChildren()),this.onDestroy(),this._children=null,this.offAll()}},{key:"onDestroy",value:function(){}},{key:"destroyChildren",value:function(){if(this._children)for(var e=0,t=this._children.length;e<t;e++)this._children[0].destroy(!0)}},{key:"addChild",value:function(t){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(e.Const.HAS_ZORDER,!0),t._parent===this){var n=this.getChildIndex(t);n!==this._children.length-1&&(this._children.splice(n,1),this._children.push(t),this._childChanged())}else t._parent&&t._parent.removeChild(t),this._children===o.ARRAY_EMPTY&&(this._children=[]),this._children.push(t),t._setParent(this),this._childChanged();return t}},{key:"addInputChild",value:function(e){if(this._extUIChild==o.ARRAY_EMPTY)this._extUIChild=[e];else{if(this._extUIChild.indexOf(e)>=0)return null;this._extUIChild.push(e)}return null}},{key:"removeInputChild",value:function(e){var t=this._extUIChild.indexOf(e);t>=0&&this._extUIChild.splice(t,1)}},{key:"addChildren",value:function(){for(var e=0,t=arguments.length;e<t;){var n;this.addChild((n=e++)<0||arguments.length<=n?void 0:arguments[n])}}},{key:"addChildAt",value:function(t,n){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(e.Const.HAS_ZORDER,!0),n>=0&&n<=this._children.length){if(t._parent===this){var i=this.getChildIndex(t);this._children.splice(i,1),this._children.splice(n,0,t),this._childChanged()}else t._parent&&t._parent.removeChild(t),this._children===o.ARRAY_EMPTY&&(this._children=[]),this._children.splice(n,0,t),t._setParent(this);return t}throw new Error("appendChildAt:The index is out of bounds")}},{key:"getChildIndex",value:function(e){return this._children.indexOf(e)}},{key:"getChildByName",value:function(e){var t=this._children;if(t)for(var n=0,i=t.length;n<i;n++){var s=t[n];if(s.name===e)return s}return null}},{key:"getChildAt",value:function(e){return this._children[e]||null}},{key:"setChildIndex",value:function(e,t){var n=this._children;if(t<0||t>=n.length)throw new Error("setChildIndex:The index is out of bounds.");var i=this.getChildIndex(e);if(i<0)throw new Error("setChildIndex:node is must child of this object.");return n.splice(i,1),n.splice(t,0,e),this._childChanged(),e}},{key:"_childChanged",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"removeChild",value:function(e){if(!this._children)return e;var t=this._children.indexOf(e);return this.removeChildAt(t)}},{key:"removeSelf",value:function(){return this._parent&&this._parent.removeChild(this),this}},{key:"removeChildByName",value:function(e){var t=this.getChildByName(e);return t&&this.removeChild(t),t}},{key:"removeChildAt",value:function(e){var t=this.getChildAt(e);return t&&(this._children.splice(e,1),t._setParent(null)),t}},{key:"removeChildren",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2147483647;if(this._children&&this._children.length>0){var n=this._children;if(0===e&&t>=n.length-1){var i=n;this._children=o.ARRAY_EMPTY}else i=n.splice(e,t-e);for(var s=0,r=i.length;s<r;s++)i[s]._setParent(null)}return this}},{key:"replaceChild",value:function(e,t){var n=this._children.indexOf(t);return n>-1?(this._children.splice(n,1,e),t._setParent(null),e._setParent(this),e):null}},{key:"_setParent",value:function(n){this._parent!==n&&(n?(this._parent=n,this._onAdded(),this.event(t.Event.ADDED),this._getBit(e.Const.DISPLAY)&&(this._setUpNoticeChain(),n.displayedInStage&&this._displayChild(this,!0)),n._childChanged(this)):(this._onRemoved(),this.event(t.Event.REMOVED),this._parent._childChanged(),this._getBit(e.Const.DISPLAY)&&this._displayChild(this,!1),this._parent=n))}},{key:"_updateDisplayedInstage",value:function(){var t;t=this;for(var n=o.gStage,i=!1;t;){if(t._getBit(e.Const.DISPLAY)){i=t._getBit(e.Const.DISPLAYED_INSTAGE);break}if(t===n||t._getBit(e.Const.DISPLAYED_INSTAGE)){i=!0;break}t=t._parent}this._setBit(e.Const.DISPLAYED_INSTAGE,i)}},{key:"_setDisplay",value:function(n){this._getBit(e.Const.DISPLAYED_INSTAGE)!==n&&(this._setBit(e.Const.DISPLAYED_INSTAGE,n),n?this.event(t.Event.DISPLAY):this.event(t.Event.UNDISPLAY))}},{key:"_displayChild",value:function(t,n){var i=t._children;if(i)for(var s=0,r=i.length;s<r;s++){var h=i[s];h._getBit(e.Const.DISPLAY)&&(h._children.length>0?this._displayChild(h,n):h._setDisplay(n))}t._setDisplay(n)}},{key:"contains",value:function(e){if(e===this)return!0;for(;e;){if(e._parent===this)return!0;e=e._parent}return!1}},{key:"timerLoop",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(this.scene?this.scene.timer:o.gTimer).loop(e,t,n,i,s,r)}},{key:"timerOnce",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(this.scene?this.scene.timer:o.gTimer)._create(!1,!1,e,t,n,i,s)}},{key:"frameLoop",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(this.scene?this.scene.timer:o.gTimer)._create(!0,!0,e,t,n,i,s)}},{key:"frameOnce",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(this.scene?this.scene.timer:o.gTimer)._create(!0,!1,e,t,n,i,s)}},{key:"clearTimer",value:function(e,t){(this.scene?this.scene.timer:o.gTimer).clear(e,t)}},{key:"callLater",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(this.scene?this.scene.timer:o.gTimer).callLater(this,e,t)}},{key:"runCallLater",value:function(e){(this.scene?this.scene.timer:o.gTimer).runCallLater(this,e)}},{key:"_onActive",value:function(){s.Stat.spriteCount++}},{key:"_onInActive",value:function(){s.Stat.spriteCount--}},{key:"_onActiveInScene",value:function(){}},{key:"_onInActiveInScene",value:function(){}},{key:"_parse",value:function(e,t){}},{key:"_setBelongScene",value:function(e){if(!this._scene){if(this._scene=e,this._components)for(var t=0,n=this._components.length;t<n;t++)this._components[t]._setActiveInScene(!0);for(this._onActiveInScene(),t=0,n=this._children.length;t<n;t++)this._children[t]._setBelongScene(e)}}},{key:"_setUnBelongScene",value:function(){if(this._scene!==this){if(this._onInActiveInScene(),this._components)for(var e=0,t=this._components.length;e<t;e++)this._components[e]._setActiveInScene(!1);for(this._scene=null,e=0,t=this._children.length;e<t;e++)this._children[e]._setUnBelongScene()}}},{key:"onAwake",value:function(){}},{key:"onEnable",value:function(){}},{key:"_processActive",value:function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._activeHierarchy(this._activeChangeScripts),this._activeScripts()}},{key:"_activeHierarchy",value:function(t){if(this._setBit(e.Const.ACTIVE_INHIERARCHY,!0),this._components)for(var n=0,i=this._components.length;n<i;n++){var s=this._components[n];s._setActive(!0),s._isScript()&&s._enabled&&t.push(s)}for(this._onActive(),n=0,i=this._children.length;n<i;n++){var r=this._children[n];!r._getBit(e.Const.NOT_ACTIVE)&&r._activeHierarchy(t)}this._getBit(e.Const.AWAKED)||(this._setBit(e.Const.AWAKED,!0),this.onAwake()),this.onEnable()}},{key:"_activeScripts",value:function(){for(var e=0,t=this._activeChangeScripts.length;e<t;e++)this._activeChangeScripts[e].onEnable();this._activeChangeScripts.length=0}},{key:"_processInActive",value:function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._inActiveHierarchy(this._activeChangeScripts),this._inActiveScripts()}},{key:"_inActiveHierarchy",value:function(t){if(this._onInActive(),this._components)for(var n=0,i=this._components.length;n<i;n++){var s=this._components[n];s._setActive(!1),s._isScript()&&s._enabled&&t.push(s)}for(this._setBit(e.Const.ACTIVE_INHIERARCHY,!1),n=0,i=this._children.length;n<i;n++){var r=this._children[n];r&&!r._getBit(e.Const.NOT_ACTIVE)&&r._inActiveHierarchy(t)}this.onDisable()}},{key:"_inActiveScripts",value:function(){for(var e=0,t=this._activeChangeScripts.length;e<t;e++)this._activeChangeScripts[e].onDisable();this._activeChangeScripts.length=0}},{key:"onDisable",value:function(){}},{key:"_onAdded",value:function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.";var e=this._parent.scene;e&&this._setBelongScene(e),this._parent.activeInHierarchy&&this.active&&this._processActive()}},{key:"_onRemoved",value:function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._parent.activeInHierarchy&&this.active&&this._processInActive(),this._parent.scene&&this._setUnBelongScene()}},{key:"_addComponentInstance",value:function(e){this._components=this._components||[],this._components.push(e),e.owner=this,e._onAdded(),this.activeInHierarchy&&(e._setActive(!0),e._isScript()&&e._enabled&&e.onEnable()),this._scene&&e._setActiveInScene(!0)}},{key:"_destroyComponent",value:function(e){if(this._components)for(var t=0,n=this._components.length;t<n;t++){var i=this._components[t];if(i===e){i._destroy(),this._components.splice(t,1);break}}}},{key:"_destroyAllComponent",value:function(){if(this._components){for(var e=0,t=this._components.length;e<t;e++){this._components[e]._destroy()}this._components.length=0}}},{key:"_cloneTo",value:function(e,t,n){var i=e;if(this._components)for(var s=0,r=this._components.length;s<r;s++){var h=i.addComponent(this._components[s].constructor);this._components[s]._cloneTo(h)}}},{key:"addComponentIntance",value:function(e){if(e.owner)throw"Node:the component has belong to other node.";if(e.isSingleton&&this.getComponent(e.constructor))throw"Node:the component is singleton,can't add the second one.";return this._addComponentInstance(e),e}},{key:"addComponent",value:function(e){var t=i.Pool.createByClass(e);if(t._destroyed=!1,t.isSingleton&&this.getComponent(e))throw"无法实例"+e+"组件，"+e+"组件已存在！";return this._addComponentInstance(t),t}},{key:"getComponent",value:function(e){if(this._components)for(var t=0,n=this._components.length;t<n;t++){var i=this._components[t];if(i instanceof e)return i}return null}},{key:"getComponents",value:function(e){var t;if(this._components)for(var n=0,i=this._components.length;n<i;n++){var s=this._components[n];s instanceof e&&(t=t||[]).push(s)}return t}},{key:"numChildren",get:function(){return this._children.length}},{key:"parent",get:function(){return this._parent}},{key:"displayedInStage",get:function(){return this._getBit(e.Const.DISPLAY)?this._getBit(e.Const.DISPLAYED_INSTAGE):(this._setBitUp(e.Const.DISPLAY),this._getBit(e.Const.DISPLAYED_INSTAGE))}},{key:"scene",get:function(){return this._scene}},{key:"active",get:function(){return!this._getBit(e.Const.NOT_READY)&&!this._getBit(e.Const.NOT_ACTIVE)},set:function(t){if(t=!!t,!this._getBit(e.Const.NOT_ACTIVE)!==t){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw t?"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.":"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._setBit(e.Const.NOT_ACTIVE,!t),this._parent&&this._parent.activeInHierarchy&&(t?this._processActive():this._processInActive())}}},{key:"activeInHierarchy",get:function(){return this._getBit(e.Const.ACTIVE_INHIERARCHY)}},{key:"timer",get:function(){return this.scene?this.scene.timer:o.gTimer}}]),o}();exports.Node=d,d.gTimer=null,d.gStage=null,d.ARRAY_EMPTY=[];
},{"../Const":"mW4A","../events/Event":"jK6U","../events/EventDispatcher":"IA8z","../utils/Pool":"Jkpb","../utils/Stat":"xuKH"}],"3oZi":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SpriteConst=void 0;var e=function e(){t(this,e)};exports.SpriteConst=e,e.ALPHA=1,e.TRANSFORM=2,e.BLEND=4,e.CANVAS=8,e.FILTERS=16,e.MASK=32,e.CLIP=64,e.STYLE=128,e.TEXTURE=256,e.GRAPHICS=512,e.LAYAGL3D=1024,e.CUSTOM=2048,e.ONECHILD=4096,e.CHILDS=8192,e.REPAINT_NONE=0,e.REPAINT_NODE=1,e.REPAINT_CACHE=2,e.REPAINT_ALL=3;
},{}],"cNOx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AlphaCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}var a=function(){function t(){r(this,t)}return n(t,[{key:"recover",value:function(){e.Pool.recover("AlphaCmd",this)}},{key:"run",value:function(e,r,t){e.alpha(this.alpha)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(r){var n=e.Pool.getItemByClass("AlphaCmd",t);return n.alpha=r,n}}]),t}();exports.AlphaCmd=a,a.ID="Alpha";
},{"../../utils/Pool":"Jkpb"}],"DptT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawCircleCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function i(e,r){for(var i=0;i<r.length;i++){var t=r[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function t(e,r,t){return r&&i(e.prototype,r),t&&i(e,t),e}var l=function(){function i(){r(this,i)}return t(i,[{key:"recover",value:function(){this.fillColor=null,this.lineColor=null,e.Pool.recover("DrawCircleCmd",this)}},{key:"run",value:function(e,r,i){e._drawCircle(this.x+r,this.y+i,this.radius,this.fillColor,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return i.ID}}],[{key:"create",value:function(r,t,l,o,n,a,u){var c=e.Pool.getItemByClass("DrawCircleCmd",i);return c.x=r,c.y=t,c.radius=l,c.fillColor=o,c.lineColor=n,c.lineWidth=a,c.vid=u,c}}]),i}();exports.DrawCircleCmd=l,l.ID="DrawCircle";
},{"../../utils/Pool":"Jkpb"}],"Q9+B":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawCurvesCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}var o=function(){function t(){r(this,t)}return n(t,[{key:"recover",value:function(){this.points=null,this.lineColor=null,e.Pool.recover("DrawCurvesCmd",this)}},{key:"run",value:function(e,r,t){e.drawCurves(this.x+r,this.y+t,this.points,this.lineColor,this.lineWidth)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(r,n,o,i,u){var l=e.Pool.getItemByClass("DrawCurvesCmd",t);return l.x=r,l.y=n,l.points=o,l.lineColor=i,l.lineWidth=u,l}}]),t}();exports.DrawCurvesCmd=o,o.ID="DrawCurves";
},{"../../utils/Pool":"Jkpb"}],"xzxk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawImageCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a=function(){function r(){t(this,r)}return n(r,[{key:"recover",value:function(){this.texture._removeReference(),this.texture=null,e.Pool.recover("DrawImageCmd",this)}},{key:"run",value:function(e,t,r){e.drawTexture(this.texture,this.x+t,this.y+r,this.width,this.height)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,n,a,i,o){var u=e.Pool.getItemByClass("DrawImageCmd",r);return u.texture=t,t._addReference(),u.x=n,u.y=a,u.width=i,u.height=o,u}}]),r}();exports.DrawImageCmd=a,a.ID="DrawImage";
},{"../../utils/Pool":"Jkpb"}],"J3Wj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawLineCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}var o=function(){function t(){r(this,t)}return n(t,[{key:"recover",value:function(){e.Pool.recover("DrawLineCmd",this)}},{key:"run",value:function(e,r,t){e._drawLine(r,t,this.fromX,this.fromY,this.toX,this.toY,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(r,n,o,i,a,u,l){var s=e.Pool.getItemByClass("DrawLineCmd",t);return s.fromX=r,s.fromY=n,s.toX=o,s.toY=i,s.lineColor=a,s.lineWidth=u,s.vid=l,s}}]),t}();exports.DrawLineCmd=o,o.ID="DrawLine";
},{"../../utils/Pool":"Jkpb"}],"s56c":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawLinesCmd=void 0;var e=require("../../utils/Pool");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function t(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}var r=function(){function t(){n(this,t)}return i(t,[{key:"recover",value:function(){this.points=null,this.lineColor=null,e.Pool.recover("DrawLinesCmd",this)}},{key:"run",value:function(e,n,t){e._drawLines(this.x+n,this.y+t,this.points,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(n,i,r,o,s,l){var a=e.Pool.getItemByClass("DrawLinesCmd",t);return a.x=n,a.y=i,a.points=r,a.lineColor=o,a.lineWidth=s,a.vid=l,a}}]),t}();exports.DrawLinesCmd=r,r.ID="DrawLines";
},{"../../utils/Pool":"Jkpb"}],"SEdD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawPathCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a=function(){function r(){t(this,r)}return n(r,[{key:"recover",value:function(){this.paths=null,this.brush=null,this.pen=null,e.Pool.recover("DrawPathCmd",this)}},{key:"run",value:function(e,t,r){e._drawPath(this.x+t,this.y+r,this.paths,this.brush,this.pen)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,n,a,o,u){var i=e.Pool.getItemByClass("DrawPathCmd",r);return i.x=t,i.y=n,i.paths=a,i.brush=o,i.pen=u,i}}]),r}();exports.DrawPathCmd=a,a.ID="DrawPath";
},{"../../utils/Pool":"Jkpb"}],"mNeg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawPieCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}var r=function(){function n(){t(this,n)}return i(n,[{key:"recover",value:function(){this.fillColor=null,this.lineColor=null,e.Pool.recover("DrawPieCmd",this)}},{key:"run",value:function(e,t,n){e._drawPie(this.x+t,this.y+n,this.radius,this._startAngle,this._endAngle,this.fillColor,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return n.ID}},{key:"startAngle",get:function(){return 180*this._startAngle/Math.PI},set:function(e){this._startAngle=e*Math.PI/180}},{key:"endAngle",get:function(){return 180*this._endAngle/Math.PI},set:function(e){this._endAngle=e*Math.PI/180}}],[{key:"create",value:function(t,i,r,l,o,a,s,u,c){var h=e.Pool.getItemByClass("DrawPieCmd",n);return h.x=t,h.y=i,h.radius=r,h._startAngle=l,h._endAngle=o,h.fillColor=a,h.lineColor=s,h.lineWidth=u,h.vid=c,h}}]),n}();exports.DrawPieCmd=r,r.ID="DrawPie";
},{"../../utils/Pool":"Jkpb"}],"rhuG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawPolyCmd=void 0;var o=require("../../utils/Pool");function e(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function t(o,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}function n(o,e,n){return e&&t(o.prototype,e),n&&t(o,n),o}var i=function(){function t(){e(this,t)}return n(t,[{key:"recover",value:function(){this.points=null,this.fillColor=null,this.lineColor=null,o.Pool.recover("DrawPolyCmd",this)}},{key:"run",value:function(o,e,t){o._drawPoly(this.x+e,this.y+t,this.points,this.fillColor,this.lineColor,this.lineWidth,this.isConvexPolygon,this.vid)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(e,n,i,r,l,s,u,a){var c=o.Pool.getItemByClass("DrawPolyCmd",t);return c.x=e,c.y=n,c.points=i,c.fillColor=r,c.lineColor=l,c.lineWidth=s,c.isConvexPolygon=u,c.vid=a,c}}]),t}();exports.DrawPolyCmd=i,i.ID="DrawPoly";
},{"../../utils/Pool":"Jkpb"}],"r0FX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawRectCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}var o=function(){function r(){t(this,r)}return i(r,[{key:"recover",value:function(){this.fillColor=null,this.lineColor=null,e.Pool.recover("DrawRectCmd",this)}},{key:"run",value:function(e,t,r){e.drawRect(this.x+t,this.y+r,this.width,this.height,this.fillColor,this.lineColor,this.lineWidth)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,i,o,n,l,a,u){var c=e.Pool.getItemByClass("DrawRectCmd",r);return c.x=t,c.y=i,c.width=o,c.height=n,c.fillColor=l,c.lineColor=a,c.lineWidth=u,c}}]),r}();exports.DrawRectCmd=o,o.ID="DrawRect";
},{"../../utils/Pool":"Jkpb"}],"GG2z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Matrix=void 0;var t=require("../utils/Pool");function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function s(t,i){for(var s=0;s<i.length;s++){var h=i[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function h(t,i,h){return i&&s(t.prototype,i),h&&s(t,h),t}var e=function(){function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(i(this,s),this._bTransform=!1,null!=s._createFun)return s._createFun(t,h,e,n,r,a,c);this.a=t,this.b=h,this.c=e,this.d=n,this.tx=r,this.ty=a,this._checkTransform()}return h(s,[{key:"identity",value:function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this._bTransform=!1,this}},{key:"_checkTransform",value:function(){return this._bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d}},{key:"setTranslate",value:function(t,i){return this.tx=t,this.ty=i,this}},{key:"translate",value:function(t,i){return this.tx+=t,this.ty+=i,this}},{key:"scale",value:function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this._bTransform=!0,this}},{key:"rotate",value:function(t){var i=Math.cos(t),s=Math.sin(t),h=this.a,e=this.c,n=this.tx;return this.a=h*i-this.b*s,this.b=h*s+this.b*i,this.c=e*i-this.d*s,this.d=e*s+this.d*i,this.tx=n*i-this.ty*s,this.ty=n*s+this.ty*i,this._bTransform=!0,this}},{key:"skew",value:function(t,i){var s=Math.tan(t),h=Math.tan(i),e=this.a,n=this.b;return this.a+=h*this.c,this.b+=h*this.d,this.c+=s*e,this.d+=s*n,this}},{key:"invertTransformPoint",value:function(t){var i=this.a,s=this.b,h=this.c,e=this.d,n=this.tx,r=i*e-s*h,a=e/r,c=-s/r,u=-h/r,o=i/r,y=(h*this.ty-e*n)/r,l=-(i*this.ty-s*n)/r;return t.setTo(a*t.x+u*t.y+y,c*t.x+o*t.y+l)}},{key:"transformPoint",value:function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)}},{key:"transformPointN",value:function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)}},{key:"getScaleX",value:function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)}},{key:"getScaleY",value:function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)}},{key:"invert",value:function(){var t=this.a,i=this.b,s=this.c,h=this.d,e=this.tx,n=t*h-i*s;return this.a=h/n,this.b=-i/n,this.c=-s/n,this.d=t/n,this.tx=(s*this.ty-h*e)/n,this.ty=-(t*this.ty-i*e)/n,this}},{key:"setTo",value:function(t,i,s,h,e,n){return this.a=t,this.b=i,this.c=s,this.d=h,this.tx=e,this.ty=n,this}},{key:"concat",value:function(t){var i=this.a,s=this.c,h=this.tx;return this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d,this.tx=h*t.a+this.ty*t.c+t.tx,this.ty=h*t.b+this.ty*t.d+t.ty,this}},{key:"scaleEx",value:function(t,i){var s=this.a,h=this.b,e=this.c,n=this.d;0!==h||0!==e?(this.a=t*s,this.b=t*h,this.c=i*e,this.d=i*n):(this.a=t*s,this.b=0*n,this.c=0*s,this.d=i*n),this._bTransform=!0}},{key:"rotateEx",value:function(t){var i=Math.cos(t),s=Math.sin(t),h=this.a,e=this.b,n=this.c,r=this.d;0!==e||0!==n?(this.a=i*h+s*n,this.b=i*e+s*r,this.c=-s*h+i*n,this.d=-s*e+i*r):(this.a=i*h,this.b=s*r,this.c=-s*h,this.d=i*r),this._bTransform=!0}},{key:"clone",value:function(){var t=s.create();return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t._bTransform=this._bTransform,t}},{key:"copyTo",value:function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t._bTransform=this._bTransform,t}},{key:"toString",value:function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty}},{key:"destroy",value:function(){this.recover()}},{key:"recover",value:function(){t.Pool.recover("Matrix",this.identity())}}],[{key:"mul",value:function(t,i,s){var h=t.a,e=t.b,n=t.c,r=t.d,a=t.tx,c=t.ty,u=i.a,o=i.b,y=i.c,l=i.d,b=i.tx,d=i.ty;return 0!==o||0!==y?(s.a=h*u+e*y,s.b=h*o+e*l,s.c=n*u+r*y,s.d=n*o+r*l,s.tx=u*a+y*c+b,s.ty=o*a+l*c+d):(s.a=h*u,s.b=e*l,s.c=n*u,s.d=r*l,s.tx=u*a+b,s.ty=l*c+d),s}},{key:"mul16",value:function(t,i,s){var h=t.a,e=t.b,n=t.c,r=t.d,a=t.tx,c=t.ty,u=i.a,o=i.b,y=i.c,l=i.d,b=i.tx,d=i.ty;return 0!==o||0!==y?(s[0]=h*u+e*y,s[1]=h*o+e*l,s[4]=n*u+r*y,s[5]=n*o+r*l,s[12]=u*a+y*c+b,s[13]=o*a+l*c+d):(s[0]=h*u,s[1]=e*l,s[4]=n*u,s[5]=r*l,s[12]=u*a+b,s[13]=l*c+d),s}},{key:"create",value:function(){return t.Pool.getItemByClass("Matrix",s)}}]),s}();exports.Matrix=e,e.EMPTY=new e,e.TEMP=new e,e._createFun=null;
},{"../utils/Pool":"Jkpb"}],"iPyf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Rectangle=void 0;var t=require("././Point"),i=require("../utils/Pool");function h(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function e(t,i){for(var h=0;h<i.length;h++){var e=i[h];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function n(t,i,h){return i&&e(t.prototype,i),h&&e(t,h),t}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;h(this,e),this.x=t,this.y=i,this.width=n,this.height=s}return n(e,[{key:"setTo",value:function(t,i,h,e){return this.x=t,this.y=i,this.width=h,this.height=e,this}},{key:"reset",value:function(){return this.x=this.y=this.width=this.height=0,this}},{key:"recover",value:function(){this!=e.TEMP&&this!=e.EMPTY?i.Pool.recover("Rectangle",this.reset()):console.log("recover Temp or Empty:",this)}},{key:"copyFrom",value:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}},{key:"contains",value:function(t,i){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.right&&i>=this.y&&i<this.bottom)}},{key:"intersects",value:function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)}},{key:"intersection",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.intersects(t)?(i||(i=new e),i.x=Math.max(this.x,t.x),i.y=Math.max(this.y,t.y),i.width=Math.min(this.right,t.right)-i.x,i.height=Math.min(this.bottom,t.bottom)-i.y,i):null}},{key:"union",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i||(i=new e),this.clone(i),t.width<=0||t.height<=0?i:(i.addPoint(t.x,t.y),i.addPoint(t.right,t.bottom),this)}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t||(t=new e),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}},{key:"toString",value:function(){return this.x+","+this.y+","+this.width+","+this.height}},{key:"equals",value:function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)}},{key:"addPoint",value:function(t,i){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>i&&(this.height+=this.y-i,this.y=i),this.width<t-this.x&&(this.width=t-this.x),this.height<i-this.y&&(this.height=i-this.y),this}},{key:"_getBoundPoints",value:function(){var t=e._temB;return t.length=0,0==this.width||0==this.height?t:(t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),t)}},{key:"isEmpty",value:function(){return this.width<=0||this.height<=0}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"create",value:function(){return i.Pool.getItemByClass("Rectangle",e)}},{key:"_getBoundPointS",value:function(t,i,h,n){var s=e._temA;return s.length=0,0==h||0==n?s:(s.push(t,i,t+h,i,t,i+n,t+h,i+n),s)}},{key:"_getWrapRec",value:function(i){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!i||i.length<1)return h?h.setTo(0,0,0,0):e.TEMP.setTo(0,0,0,0);h=h||e.create();var n,s,r,o,u,l=i.length,y=t.Point.TEMP;for(r=u=-(s=o=99999),n=0;n<l;n+=2)y.x=i[n],y.y=i[n+1],s=s<y.x?s:y.x,o=o<y.y?o:y.y,r=r>y.x?r:y.x,u=u>y.y?u:y.y;return h.setTo(s,o,r-s,u-o)}}]),e}();exports.Rectangle=s,s.EMPTY=new s,s.TEMP=new s,s._temB=[],s._temA=[];
},{"././Point":"ziZY","../utils/Pool":"Jkpb"}],"UY/S":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function t(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommandEncoder=void 0;var a=function(){function n(t,a,r,i){e(this,n),this._idata=[]}return t(n,[{key:"getArrayData",value:function(){return this._idata}},{key:"getPtrID",value:function(){return 0}},{key:"beginEncoding",value:function(){}},{key:"endEncoding",value:function(){}},{key:"clearEncoding",value:function(){this._idata.length=0}},{key:"getCount",value:function(){return this._idata.length}},{key:"add_ShaderValue",value:function(e){this._idata.push(e)}},{key:"addShaderUniform",value:function(e){this.add_ShaderValue(e)}}]),n}();exports.CommandEncoder=a;
},{}],"ezDE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayaGL=void 0;var e=require("././CommandEncoder");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function t(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}var a=function(){function r(){n(this,r)}return t(r,[{key:"createCommandEncoder",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new e.CommandEncoder(this,n,r,t)}},{key:"beginCommandEncoding",value:function(e){}},{key:"endCommandEncoding",value:function(){}},{key:"matrix4x4Multiply",value:function(e,n,r){}},{key:"evaluateClipDatasRealTime",value:function(e,n,r,t){}}],[{key:"getFrameCount",value:function(){return 0}},{key:"syncBufferToRenderThread",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"createArrayBufferRef",value:function(e,n,r){}},{key:"createArrayBufferRefs",value:function(e,n,r,t){}}]),r}();exports.LayaGL=a,a.EXECUTE_JS_THREAD_BUFFER=0,a.EXECUTE_RENDER_THREAD_BUFFER=1,a.EXECUTE_COPY_TO_RENDER=2,a.EXECUTE_COPY_TO_RENDER3D=3,a.ARRAY_BUFFER_TYPE_DATA=0,a.ARRAY_BUFFER_TYPE_CMD=1,a.ARRAY_BUFFER_REF_REFERENCE=0,a.ARRAY_BUFFER_REF_COPY=1,a.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,a.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1;
},{"././CommandEncoder":"UY/S"}],"vU/V":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.URL=void 0;var n=function(){function e(r){t(this,e),this._url=e.formatURL(r),this._path=e.getPath(r)}return r(e,[{key:"url",get:function(){return this._url}},{key:"path",get:function(){return this._path}}],[{key:"_getUrlPath",value:function(){var t=window.location,r=t.pathname;return r=":"==r.charAt(2)?r.substring(1):r,e.getPath("file:"==t.protocol?r:t.protocol+"//"+t.host+t.pathname)}},{key:"formatURL",value:function(t){if(!t)return"null path";if(t.indexOf(":")>0)return t;if(null!=e.customFormat&&(t=e.customFormat(t)),t.indexOf(":")>0)return t;var r=t.charAt(0);if("."===r)return e._formatRelativePath(e._basePath+t);if("~"===r)return e.rootPath+t.substring(1);if("d"===r){if(0===t.indexOf("data:image"))return t}else if("/"===r)return t;return e._basePath+t}},{key:"_formatRelativePath",value:function(t){for(var e=t.split("/"),r=0,n=e.length;r<n;r++)".."==e[r]&&(e.splice(r-1,2),r-=2);return e.join("/")}},{key:"getPath",value:function(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""}},{key:"getFileName",value:function(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t}},{key:"getAdptedFilePath",value:function(t){if(!e.exportSceneToJson||!t)return t;var r,n,a;for(n=e._adpteTypeList.length,r=0;r<n;r++)a=e._adpteTypeList[r],t=t.replace(a[0],a[1]);return t}},{key:"basePath",set:function(t){e._basePath=e._getUrlPath(),e._basePath=e.formatURL(t)},get:function(){return e._basePath}}]),e}();exports.URL=n,n.version={},n.exportSceneToJson=!1,n._basePath="",n.rootPath="",n.customFormat=function(t){var e=n.version[t];return!window.conch&&e&&(t+="?v="+e),t},n._adpteTypeList=[[".scene3d",".json"],[".scene",".json"],[".taa",".json"],[".prefab",".json"]];
},{}],"M+wd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Resource=void 0;var e=require("../events/EventDispatcher"),r=require("../net/URL");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function u(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function n(e,r,t){return r&&u(e.prototype,r),t&&u(e,t),e}function i(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?s(e):r}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&y(e,r)}function y(e,r){return(y=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}var a=function(t){function u(){var e;return o(this,u),(e=i(this,c(u).call(this)))._id=0,e._url=null,e._cpuMemory=0,e._gpuMemory=0,e._destroyed=!1,e._referenceCount=0,e.lock=!1,e.name=null,e._id=++u._uniqueIDCounter,e._destroyed=!1,e._referenceCount=0,u._idResourcesMap[e.id]=s(e),e.lock=!1,e}return l(u,e.EventDispatcher),n(u,[{key:"_setCPUMemory",value:function(e){var r=e-u._cpuMemory;u._cpuMemory=e,u._addCPUMemory(r)}},{key:"_setGPUMemory",value:function(e){var r=e-u._gpuMemory;u._gpuMemory=e,u._addGPUMemory(r)}},{key:"_setCreateURL",value:function(e){var t;(e=r.URL.formatURL(e),this._url!==e)&&(this._url&&((t=u._urlResourcesMap[this._url]).splice(t.indexOf(this),1),0===t.length&&delete u._urlResourcesMap[this._url]),e&&((t=u._urlResourcesMap[e])||(u._urlResourcesMap[e]=t=[]),t.push(this)),this._url=e)}},{key:"_addReference",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._referenceCount+=e}},{key:"_removeReference",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._referenceCount-=e}},{key:"_clearReference",value:function(){this._referenceCount=0}},{key:"_recoverResource",value:function(){}},{key:"_disposeResource",value:function(){}},{key:"_activeResource",value:function(){}},{key:"destroy",value:function(){var e;this._destroyed||(this._destroyed=!0,this.lock=!1,this._disposeResource(),delete u._idResourcesMap[this.id],this._url&&((e=u._urlResourcesMap[this._url])&&(e.splice(e.indexOf(this),1),0===e.length&&delete u._urlResourcesMap[this._url]),u.gLoader.getRes(this._url)==this&&delete u.gLoader.loadedMap[this._url]))}},{key:"id",get:function(){return this._id}},{key:"url",get:function(){return this._url}},{key:"cpuMemory",get:function(){return u._cpuMemory}},{key:"gpuMemory",get:function(){return u._gpuMemory}},{key:"destroyed",get:function(){return this._destroyed}},{key:"referenceCount",get:function(){return this._referenceCount}}],[{key:"_addCPUMemory",value:function(e){u._cpuMemory+=e}},{key:"_addGPUMemory",value:function(e){u._gpuMemory+=e}},{key:"_addMemory",value:function(e,r){u._cpuMemory+=e,u._gpuMemory+=r}},{key:"getResourceByID",value:function(e){return u._idResourcesMap[e]}},{key:"getResourceByURL",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u._urlResourcesMap[e][r]}},{key:"destroyUnusedResources",value:function(){for(var e in u._idResourcesMap){var r=u._idResourcesMap[e];r.lock||0!==r._referenceCount||r.destroy()}}},{key:"cpuMemory",get:function(){return u._cpuMemory}},{key:"gpuMemory",get:function(){return u._gpuMemory}}]),u}();exports.Resource=a,a.gLoader=null,a._uniqueIDCounter=0,a._idResourcesMap={},a._urlResourcesMap={},a._cpuMemory=0,a._gpuMemory=0;
},{"../events/EventDispatcher":"IA8z","../net/URL":"vU/V"}],"ljsO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bitmap=void 0;var t=require("././Resource");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,r){return!r||"object"!==e(r)&&"function"!=typeof r?n(t):r}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),t}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=function(e){function n(){var t;return r(this,n),(t=o(this,i(n).call(this)))._width=-1,t._height=-1,t}return f(n,t.Resource),c(n,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),c(n,[{key:"_getSource",value:function(){throw"Bitmap: must override it."}}]),n}();exports.Bitmap=a;
},{"././Resource":"M+wd"}],"HmZQ":[function(require,module,exports) {
"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function e(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function t(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PlatformInfo=void 0;var o=function(){function e(){n(this,e)}return t(e,null,[{key:"now",value:function(){return Date.now()}}]),e}();exports.PlatformInfo=o,o.onLayaRuntime=!1,o.window=null;
},{}],"vf9T":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGLContext=void 0;var e=require("../utils/PlatformInfo");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function E(e,n){for(var E=0;E<n.length;E++){var t=n[E];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function t(e,n,t){return n&&E(e.prototype,n),t&&E(e,t),e}var u=function(){function E(){n(this,E)}return t(E,[{key:"getContextAttributes",value:function(){return null}},{key:"isContextLost",value:function(){}},{key:"getSupportedExtensions",value:function(){return null}},{key:"getExtension",value:function(e){return null}},{key:"activeTexture",value:function(e){}},{key:"attachShader",value:function(e,n){}},{key:"bindAttribLocation",value:function(e,n,E){}},{key:"bindBuffer",value:function(e,n){}},{key:"bindFramebuffer",value:function(e,n){}},{key:"bindRenderbuffer",value:function(e,n){}},{key:"bindTexture",value:function(e,n){}},{key:"useTexture",value:function(e){}},{key:"blendColor",value:function(e,n,E,t){}},{key:"blendEquation",value:function(e){}},{key:"blendEquationSeparate",value:function(e,n){}},{key:"blendFunc",value:function(e,n){}},{key:"blendFuncSeparate",value:function(e,n,E,t){}},{key:"bufferData",value:function(e,n,E){}},{key:"bufferSubData",value:function(e,n,E){}},{key:"checkFramebufferStatus",value:function(e){return null}},{key:"clear",value:function(e){}},{key:"clearColor",value:function(e,n,E,t){}},{key:"clearDepth",value:function(e){}},{key:"clearStencil",value:function(e){}},{key:"colorMask",value:function(e,n,E,t){}},{key:"compileShader",value:function(e){}},{key:"copyTexImage2D",value:function(e,n,E,t,u,_,T,r){}},{key:"copyTexSubImage2D",value:function(e,n,E,t,u,_,T,r){}},{key:"createBuffer",value:function(){}},{key:"createFramebuffer",value:function(){}},{key:"createProgram",value:function(){}},{key:"createRenderbuffer",value:function(){}},{key:"createShader",value:function(e){}},{key:"createTexture",value:function(){return null}},{key:"cullFace",value:function(e){}},{key:"deleteBuffer",value:function(e){}},{key:"deleteFramebuffer",value:function(e){}},{key:"deleteProgram",value:function(e){}},{key:"deleteRenderbuffer",value:function(e){}},{key:"deleteShader",value:function(e){}},{key:"deleteTexture",value:function(e){}},{key:"depthFunc",value:function(e){}},{key:"depthMask",value:function(e){}},{key:"depthRange",value:function(e,n){}},{key:"detachShader",value:function(e,n){}},{key:"disable",value:function(e){}},{key:"disableVertexAttribArray",value:function(e){}},{key:"drawArrays",value:function(e,n,E){}},{key:"drawElements",value:function(e,n,E,t){}},{key:"enable",value:function(e){}},{key:"enableVertexAttribArray",value:function(e){}},{key:"finish",value:function(){}},{key:"flush",value:function(){}},{key:"framebufferRenderbuffer",value:function(e,n,E,t){}},{key:"framebufferTexture2D",value:function(e,n,E,t,u){}},{key:"frontFace",value:function(e){return null}},{key:"generateMipmap",value:function(e){return null}},{key:"getActiveAttrib",value:function(e,n){return null}},{key:"getActiveUniform",value:function(e,n){return null}},{key:"getAttribLocation",value:function(e,n){return 0}},{key:"getParameter",value:function(e){return null}},{key:"getBufferParameter",value:function(e,n){return null}},{key:"getError",value:function(){return null}},{key:"getFramebufferAttachmentParameter",value:function(e,n,E){}},{key:"getProgramParameter",value:function(e,n){return 0}},{key:"getProgramInfoLog",value:function(e){return null}},{key:"getRenderbufferParameter",value:function(e,n){return null}},{key:"getShaderPrecisionFormat",value:function(){return null}},{key:"getShaderParameter",value:function(e,n){}},{key:"getShaderInfoLog",value:function(e){return null}},{key:"getShaderSource",value:function(e){return null}},{key:"getTexParameter",value:function(e,n){}},{key:"getUniform",value:function(e,n){}},{key:"getUniformLocation",value:function(e,n){return null}},{key:"getVertexAttrib",value:function(e,n){return null}},{key:"getVertexAttribOffset",value:function(e,n){return null}},{key:"hint",value:function(e,n){}},{key:"isBuffer",value:function(e){}},{key:"isEnabled",value:function(e){}},{key:"isFramebuffer",value:function(e){}},{key:"isProgram",value:function(e){}},{key:"isRenderbuffer",value:function(e){}},{key:"isShader",value:function(e){}},{key:"isTexture",value:function(e){}},{key:"lineWidth",value:function(e){}},{key:"linkProgram",value:function(e){}},{key:"pixelStorei",value:function(e,n){}},{key:"polygonOffset",value:function(e,n){}},{key:"readPixels",value:function(e,n,E,t,u,_,T){}},{key:"renderbufferStorage",value:function(e,n,E,t){}},{key:"sampleCoverage",value:function(e,n){}},{key:"scissor",value:function(e,n,E,t){}},{key:"shaderSource",value:function(e,n){}},{key:"stencilFunc",value:function(e,n,E){}},{key:"stencilFuncSeparate",value:function(e,n,E,t){}},{key:"stencilMask",value:function(e){}},{key:"stencilMaskSeparate",value:function(e,n){}},{key:"stencilOp",value:function(e,n,E){}},{key:"stencilOpSeparate",value:function(e,n,E,t){}},{key:"texImage2D",value:function(){}},{key:"texParameterf",value:function(e,n,E){}},{key:"texParameteri",value:function(e,n,E){}},{key:"texSubImage2D",value:function(){}},{key:"uniform1f",value:function(e,n){}},{key:"uniform1fv",value:function(e,n){}},{key:"uniform1i",value:function(e,n){}},{key:"uniform1iv",value:function(e,n){}},{key:"uniform2f",value:function(e,n,E){}},{key:"uniform2fv",value:function(e,n){}},{key:"uniform2i",value:function(e,n,E){}},{key:"uniform2iv",value:function(e,n){}},{key:"uniform3f",value:function(e,n,E,t){}},{key:"uniform3fv",value:function(e,n){}},{key:"uniform3i",value:function(e,n,E,t){}},{key:"uniform3iv",value:function(e,n){}},{key:"uniform4f",value:function(e,n,E,t,u){}},{key:"uniform4fv",value:function(e,n){}},{key:"uniform4i",value:function(e,n,E,t,u){}},{key:"uniform4iv",value:function(e,n){}},{key:"uniformMatrix2fv",value:function(e,n,E){}},{key:"uniformMatrix3fv",value:function(e,n,E){}},{key:"uniformMatrix4fv",value:function(e,n,E){}},{key:"useProgram",value:function(e){}},{key:"validateProgram",value:function(e){}},{key:"vertexAttrib1f",value:function(e,n){}},{key:"vertexAttrib1fv",value:function(e,n){}},{key:"vertexAttrib2f",value:function(e,n,E){}},{key:"vertexAttrib2fv",value:function(e,n){}},{key:"vertexAttrib3f",value:function(e,n,E,t){}},{key:"vertexAttrib3fv",value:function(e,n){}},{key:"vertexAttrib4f",value:function(e,n,E,t,u){}},{key:"vertexAttrib4fv",value:function(e,n){}},{key:"vertexAttribPointer",value:function(e,n,E,t,u,_){}},{key:"viewport",value:function(e,n,E,t){}},{key:"configureBackBuffer",value:function(e,n,E){!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4]}},{key:"compressedTexImage2D",value:function(){}},{key:"createVertexArray",value:function(){throw"not implemented"}},{key:"bindVertexArray",value:function(e){throw"not implemented"}},{key:"deleteVertexArray",value:function(e){throw"not implemented"}},{key:"isVertexArray",value:function(e){throw"not implemented"}}],[{key:"_forceSupportVAOPlatform",value:function(){return e.PlatformInfo.onMiniGame&&e.PlatformInfo.onIOS||e.PlatformInfo.onBDMiniGame||e.PlatformInfo.onQGMiniGame}},{key:"__init__",value:function(n){if(E._checkExtensions(n),!e.PlatformInfo.isWebGL2Render&&!e.PlatformInfo.onLayaRuntime){window._setupVertexArrayObject&&(E._forceSupportVAOPlatform()?window._forceSetupVertexArrayObject(n):window._setupVertexArrayObject(n));var t=(n.rawgl||n).getExtension("OES_vertex_array_object");if(t){var u=n;u.createVertexArray=function(){return t.createVertexArrayOES()},u.bindVertexArray=function(e){t.bindVertexArrayOES(e)},u.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},u.isVertexArray=function(e){t.isVertexArrayOES(e)}}}}},{key:"_getExtension",value:function(e,n){var t=E._extentionVendorPrefixes;for(var u in t){var _=e.getExtension(t[u]+n);if(_)return _}return null}},{key:"_checkExtensions",value:function(e){E._extTextureFilterAnisotropic=E._getExtension(e,"EXT_texture_filter_anisotropic"),E._compressedTextureS3tc=E._getExtension(e,"WEBGL_compressed_texture_s3tc"),E._compressedTexturePvrtc=E._getExtension(e,"WEBGL_compressed_texture_pvrtc"),E._compressedTextureEtc1=E._getExtension(e,"WEBGL_compressed_texture_etc1"),E._forceSupportVAOPlatform()||(E._angleInstancedArrays=E._getExtension(e,"ANGLE_instanced_arrays"))}},{key:"__init_native",value:function(){if(e.PlatformInfo.supportWebGLPlusRendering){var n=E;n.activeTexture=n.activeTextureForNative,n.bindTexture=n.bindTextureForNative}}},{key:"useProgram",value:function(e,n){return E._useProgram!==n&&(e.useProgram(n),E._useProgram=n,!0)}},{key:"setDepthTest",value:function(e,n){n!==E._depthTest&&(E._depthTest=n,n?e.enable(E.DEPTH_TEST):e.disable(E.DEPTH_TEST))}},{key:"setDepthMask",value:function(e,n){n!==E._depthMask&&(E._depthMask=n,e.depthMask(n))}},{key:"setDepthFunc",value:function(e,n){n!==E._depthFunc&&(E._depthFunc=n,e.depthFunc(n))}},{key:"setBlend",value:function(e,n){n!==E._blend&&(E._blend=n,n?e.enable(E.BLEND):e.disable(E.BLEND))}},{key:"setBlendFunc",value:function(e,n,t){(n!==E._sFactor||t!==E._dFactor)&&(E._sFactor=E._srcAlpha=n,E._dFactor=E._dstAlpha=t,e.blendFunc(n,t))}},{key:"setBlendFuncSeperate",value:function(e,n,t,u,_){n===E._sFactor&&t===E._dFactor&&u===E._srcAlpha&&_===E._dstAlpha||(E._sFactor=n,E._dFactor=t,E._srcAlpha=u,E._dstAlpha=_,e.blendFuncSeparate(n,t,u,_))}},{key:"setCullFace",value:function(e,n){n!==E._cullFace&&(E._cullFace=n,n?e.enable(E.CULL_FACE):e.disable(E.CULL_FACE))}},{key:"setFrontFace",value:function(e,n){n!==E._frontFace&&(E._frontFace=n,e.frontFace(n))}},{key:"activeTexture",value:function(e,n){E._activedTextureID!==n&&(e.activeTexture(n),E._activedTextureID=n)}},{key:"bindTexture",value:function(e,n,t){E._activeTextures[E._activedTextureID-E.TEXTURE0]!==t&&(e.bindTexture(n,t),E._activeTextures[E._activedTextureID-E.TEXTURE0]=t)}},{key:"useProgramForNative",value:function(e,n){return e.useProgram(n),!0}},{key:"setDepthTestForNative",value:function(e,n){n?e.enable(E.DEPTH_TEST):e.disable(E.DEPTH_TEST)}},{key:"setDepthMaskForNative",value:function(e,n){e.depthMask(n)}},{key:"setDepthFuncForNative",value:function(e,n){e.depthFunc(n)}},{key:"setBlendForNative",value:function(e,n){n?e.enable(E.BLEND):e.disable(E.BLEND)}},{key:"setBlendFuncForNative",value:function(e,n,E){e.blendFunc(n,E)}},{key:"setCullFaceForNative",value:function(e,n){n?e.enable(E.CULL_FACE):e.disable(E.CULL_FACE)}},{key:"setFrontFaceForNative",value:function(e,n){e.frontFace(n)}},{key:"activeTextureForNative",value:function(e,n){e.activeTexture(n)}},{key:"bindTextureForNative",value:function(e,n,E){e.bindTexture(n,E)}},{key:"bindVertexArrayForNative",value:function(e,n){e.bindVertexArray(n)}}]),E}();exports.WebGLContext=u,u.DEPTH_BUFFER_BIT=256,u.STENCIL_BUFFER_BIT=1024,u.COLOR_BUFFER_BIT=16384,u.POINTS=0,u.LINES=1,u.LINE_LOOP=2,u.LINE_STRIP=3,u.TRIANGLES=4,u.TRIANGLE_STRIP=5,u.TRIANGLE_FAN=6,u.ZERO=0,u.ONE=1,u.SRC_COLOR=768,u.ONE_MINUS_SRC_COLOR=769,u.SRC_ALPHA=770,u.ONE_MINUS_SRC_ALPHA=771,u.DST_ALPHA=772,u.ONE_MINUS_DST_ALPHA=773,u.DST_COLOR=774,u.ONE_MINUS_DST_COLOR=775,u.SRC_ALPHA_SATURATE=776,u.FUNC_ADD=32774,u.BLEND_EQUATION=32777,u.BLEND_EQUATION_RGB=32777,u.BLEND_EQUATION_ALPHA=34877,u.FUNC_SUBTRACT=32778,u.FUNC_REVERSE_SUBTRACT=32779,u.BLEND_DST_RGB=32968,u.BLEND_SRC_RGB=32969,u.BLEND_DST_ALPHA=32970,u.BLEND_SRC_ALPHA=32971,u.CONSTANT_COLOR=32769,u.ONE_MINUS_CONSTANT_COLOR=32770,u.CONSTANT_ALPHA=32771,u.ONE_MINUS_CONSTANT_ALPHA=32772,u.BLEND_COLOR=32773,u.ARRAY_BUFFER=34962,u.ELEMENT_ARRAY_BUFFER=34963,u.ARRAY_BUFFER_BINDING=34964,u.ELEMENT_ARRAY_BUFFER_BINDING=34965,u.STREAM_DRAW=35040,u.STATIC_DRAW=35044,u.DYNAMIC_DRAW=35048,u.BUFFER_SIZE=34660,u.BUFFER_USAGE=34661,u.CURRENT_VERTEX_ATTRIB=34342,u.FRONT=1028,u.BACK=1029,u.CULL_FACE=2884,u.FRONT_AND_BACK=1032,u.BLEND=3042,u.DITHER=3024,u.STENCIL_TEST=2960,u.DEPTH_TEST=2929,u.SCISSOR_TEST=3089,u.POLYGON_OFFSET_FILL=32823,u.SAMPLE_ALPHA_TO_COVERAGE=32926,u.SAMPLE_COVERAGE=32928,u.NO_ERROR=0,u.INVALID_ENUM=1280,u.INVALID_VALUE=1281,u.INVALID_OPERATION=1282,u.OUT_OF_MEMORY=1285,u.CW=2304,u.CCW=2305,u.LINE_WIDTH=2849,u.ALIASED_POINT_SIZE_RANGE=33901,u.ALIASED_LINE_WIDTH_RANGE=33902,u.CULL_FACE_MODE=2885,u.FRONT_FACE=2886,u.DEPTH_RANGE=2928,u.DEPTH_WRITEMASK=2930,u.DEPTH_CLEAR_VALUE=2931,u.DEPTH_FUNC=2932,u.STENCIL_CLEAR_VALUE=2961,u.STENCIL_FUNC=2962,u.STENCIL_FAIL=2964,u.STENCIL_PASS_DEPTH_FAIL=2965,u.STENCIL_PASS_DEPTH_PASS=2966,u.STENCIL_REF=2967,u.STENCIL_VALUE_MASK=2963,u.STENCIL_WRITEMASK=2968,u.STENCIL_BACK_FUNC=34816,u.STENCIL_BACK_FAIL=34817,u.STENCIL_BACK_PASS_DEPTH_FAIL=34818,u.STENCIL_BACK_PASS_DEPTH_PASS=34819,u.STENCIL_BACK_REF=36003,u.STENCIL_BACK_VALUE_MASK=36004,u.STENCIL_BACK_WRITEMASK=36005,u.VIEWPORT=2978,u.SCISSOR_BOX=3088,u.COLOR_CLEAR_VALUE=3106,u.COLOR_WRITEMASK=3107,u.UNPACK_ALIGNMENT=3317,u.PACK_ALIGNMENT=3333,u.MAX_TEXTURE_SIZE=3379,u.MAX_VIEWPORT_DIMS=3386,u.SUBPIXEL_BITS=3408,u.RED_BITS=3410,u.GREEN_BITS=3411,u.BLUE_BITS=3412,u.ALPHA_BITS=3413,u.DEPTH_BITS=3414,u.STENCIL_BITS=3415,u.POLYGON_OFFSET_UNITS=10752,u.POLYGON_OFFSET_FACTOR=32824,u.TEXTURE_BINDING_2D=32873,u.SAMPLE_BUFFERS=32936,u.SAMPLES=32937,u.SAMPLE_COVERAGE_VALUE=32938,u.SAMPLE_COVERAGE_INVERT=32939,u.NUM_COMPRESSED_TEXTURE_FORMATS=34466,u.COMPRESSED_TEXTURE_FORMATS=34467,u.DONT_CARE=4352,u.FASTEST=4353,u.NICEST=4354,u.GENERATE_MIPMAP_HINT=33170,u.BYTE=5120,u.UNSIGNED_BYTE=5121,u.SHORT=5122,u.UNSIGNED_SHORT=5123,u.INT=5124,u.UNSIGNED_INT=5125,u.FLOAT=5126,u.DEPTH_COMPONENT=6402,u.ALPHA=6406,u.RGB=6407,u.RGBA=6408,u.LUMINANCE=6409,u.LUMINANCE_ALPHA=6410,u.UNSIGNED_SHORT_4_4_4_4=32819,u.UNSIGNED_SHORT_5_5_5_1=32820,u.UNSIGNED_SHORT_5_6_5=33635,u.FRAGMENT_SHADER=35632,u.VERTEX_SHADER=35633,u.MAX_VERTEX_ATTRIBS=34921,u.MAX_VERTEX_UNIFORM_VECTORS=36347,u.MAX_VARYING_VECTORS=36348,u.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,u.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,u.MAX_TEXTURE_IMAGE_UNITS=34930,u.MAX_FRAGMENT_UNIFORM_VECTORS=36349,u.SHADER_TYPE=35663,u.DELETE_STATUS=35712,u.LINK_STATUS=35714,u.VALIDATE_STATUS=35715,u.ATTACHED_SHADERS=35717,u.ACTIVE_UNIFORMS=35718,u.ACTIVE_ATTRIBUTES=35721,u.SHADING_LANGUAGE_VERSION=35724,u.CURRENT_PROGRAM=35725,u.NEVER=512,u.LESS=513,u.EQUAL=514,u.LEQUAL=515,u.GREATER=516,u.NOTEQUAL=517,u.GEQUAL=518,u.ALWAYS=519,u.KEEP=7680,u.REPLACE=7681,u.INCR=7682,u.DECR=7683,u.INVERT=5386,u.INCR_WRAP=34055,u.DECR_WRAP=34056,u.VENDOR=7936,u.RENDERER=7937,u.VERSION=7938,u.NEAREST=9728,u.LINEAR=9729,u.NEAREST_MIPMAP_NEAREST=9984,u.LINEAR_MIPMAP_NEAREST=9985,u.NEAREST_MIPMAP_LINEAR=9986,u.LINEAR_MIPMAP_LINEAR=9987,u.TEXTURE_MAG_FILTER=10240,u.TEXTURE_MIN_FILTER=10241,u.TEXTURE_WRAP_S=10242,u.TEXTURE_WRAP_T=10243,u.TEXTURE_2D=3553,u.TEXTURE_3D=32879,u.TEXTURE=5890,u.TEXTURE_CUBE_MAP=34067,u.TEXTURE_BINDING_CUBE_MAP=34068,u.TEXTURE_CUBE_MAP_POSITIVE_X=34069,u.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,u.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,u.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,u.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,u.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,u.MAX_CUBE_MAP_TEXTURE_SIZE=34076,u.TEXTURE0=33984,u.TEXTURE1=33985,u.TEXTURE2=33986,u.TEXTURE3=33987,u.TEXTURE4=33988,u.TEXTURE5=33989,u.TEXTURE6=33990,u.TEXTURE7=33991,u.TEXTURE8=33992,u.TEXTURE9=33993,u.TEXTURE10=33994,u.TEXTURE11=33995,u.TEXTURE12=33996,u.TEXTURE13=33997,u.TEXTURE14=33998,u.TEXTURE15=33999,u.TEXTURE16=34e3,u.TEXTURE17=34001,u.TEXTURE18=34002,u.TEXTURE19=34003,u.TEXTURE20=34004,u.TEXTURE21=34005,u.TEXTURE22=34006,u.TEXTURE23=34007,u.TEXTURE24=34008,u.TEXTURE25=34009,u.TEXTURE26=34010,u.TEXTURE27=34011,u.TEXTURE28=34012,u.TEXTURE29=34013,u.TEXTURE30=34014,u.TEXTURE31=34015,u.ACTIVE_TEXTURE=34016,u.REPEAT=10497,u.CLAMP_TO_EDGE=33071,u.MIRRORED_REPEAT=33648,u.FLOAT_VEC2=35664,u.FLOAT_VEC3=35665,u.FLOAT_VEC4=35666,u.INT_VEC2=35667,u.INT_VEC3=35668,u.INT_VEC4=35669,u.BOOL=35670,u.BOOL_VEC2=35671,u.BOOL_VEC3=35672,u.BOOL_VEC4=35673,u.FLOAT_MAT2=35674,u.FLOAT_MAT3=35675,u.FLOAT_MAT4=35676,u.SAMPLER_2D=35678,u.SAMPLER_CUBE=35680,u.VERTEX_ATTRIB_ARRAY_ENABLED=34338,u.VERTEX_ATTRIB_ARRAY_SIZE=34339,u.VERTEX_ATTRIB_ARRAY_STRIDE=34340,u.VERTEX_ATTRIB_ARRAY_TYPE=34341,u.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,u.VERTEX_ATTRIB_ARRAY_POINTER=34373,u.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,u.COMPILE_STATUS=35713,u.LOW_FLOAT=36336,u.MEDIUM_FLOAT=36337,u.HIGH_FLOAT=36338,u.LOW_INT=36339,u.MEDIUM_INT=36340,u.HIGH_INT=36341,u.FRAMEBUFFER=36160,u.RENDERBUFFER=36161,u.RGBA4=32854,u.RGB5_A1=32855,u.RGB565=36194,u.DEPTH_COMPONENT16=33189,u.STENCIL_INDEX=6401,u.STENCIL_INDEX8=36168,u.DEPTH_STENCIL=34041,u.RENDERBUFFER_WIDTH=36162,u.RENDERBUFFER_HEIGHT=36163,u.RENDERBUFFER_INTERNAL_FORMAT=36164,u.RENDERBUFFER_RED_SIZE=36176,u.RENDERBUFFER_GREEN_SIZE=36177,u.RENDERBUFFER_BLUE_SIZE=36178,u.RENDERBUFFER_ALPHA_SIZE=36179,u.RENDERBUFFER_DEPTH_SIZE=36180,u.RENDERBUFFER_STENCIL_SIZE=36181,u.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,u.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,u.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,u.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,u.COLOR_ATTACHMENT0=36064,u.DEPTH_ATTACHMENT=36096,u.STENCIL_ATTACHMENT=36128,u.DEPTH_STENCIL_ATTACHMENT=33306,u.NONE=0,u.FRAMEBUFFER_COMPLETE=36053,u.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,u.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,u.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,u.FRAMEBUFFER_UNSUPPORTED=36061,u.FRAMEBUFFER_BINDING=36006,u.RENDERBUFFER_BINDING=36007,u.MAX_RENDERBUFFER_SIZE=34024,u.INVALID_FRAMEBUFFER_OPERATION=1286,u.UNPACK_FLIP_Y_WEBGL=37440,u.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,u.CONTEXT_LOST_WEBGL=37442,u.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,u.BROWSER_DEFAULT_WEBGL=37444,u.mainContext=null,u._extentionVendorPrefixes=["","WEBKIT_","MOZ_"],u._activeTextures=new Array(8),u._glTextureIDs=[u.TEXTURE0,u.TEXTURE1,u.TEXTURE2,u.TEXTURE3,u.TEXTURE4,u.TEXTURE5,u.TEXTURE6,u.TEXTURE7],u._useProgram=null,u._depthTest=!0,u._depthMask=!0,u._depthFunc=u.LESS,u._blend=!1,u._sFactor=u.ONE,u._dFactor=u.ZERO,u._srcAlpha=u.ONE,u._dstAlpha=u.ZERO,u._cullFace=!1,u._frontFace=u.CCW,u._activedTextureID=u.TEXTURE0;
},{"../utils/PlatformInfo":"HmZQ"}],"M7il":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseTexture=void 0;var e=require("../layagl/LayaGL"),t=require("./Bitmap"),r=require("../webgl/WebGLContext"),o=require("../utils/PlatformInfo");function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function T(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function a(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?s(e):t}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x=function(_){function n(t,r){var o;return i(this,n),(o=a(this,u(n).call(this)))._wrapModeU=n.WARPMODE_REPEAT,o._wrapModeV=n.WARPMODE_REPEAT,o._filterMode=n.FILTERMODE_BILINEAR,o._readyed=!1,o._width=-1,o._height=-1,o._format=t,o._mipmap=r,o._anisoLevel=1,o._glTexture=e.LayaGL.instance.createTexture(),o}return R(n,t.Bitmap),T(n,[{key:"_isPot",value:function(e){return 0==(e&e-1)}},{key:"_getGLFormat",value:function(){var e;switch(this._format){case n.FORMAT_R8G8B8:e=r.WebGLContext.RGB;break;case n.FORMAT_R8G8B8A8:e=r.WebGLContext.RGBA;break;case n.FORMAT_ALPHA8:e=r.WebGLContext.ALPHA;break;case n.FORMAT_DXT1:if(!r.WebGLContext._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";e=r.WebGLContext._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case n.FORMAT_DXT5:if(!r.WebGLContext._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";e=r.WebGLContext._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case n.FORMAT_ETC1RGB:if(!r.WebGLContext._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";e=r.WebGLContext._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case n.FORMAT_PVRTCRGB_2BPPV:if(!r.WebGLContext._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";e=r.WebGLContext._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case n.FORMAT_PVRTCRGBA_2BPPV:if(!r.WebGLContext._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";e=r.WebGLContext._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case n.FORMAT_PVRTCRGB_4BPPV:if(!r.WebGLContext._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";e=r.WebGLContext._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case n.FORMAT_PVRTCRGBA_4BPPV:if(!r.WebGLContext._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";e=r.WebGLContext._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return e}},{key:"_setFilterMode",value:function(t){var o=e.LayaGL.instance;switch(r.WebGLContext.bindTexture(o,this._glTextureType,this._glTexture),t){case n.FILTERMODE_POINT:this._mipmap?o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MIN_FILTER,r.WebGLContext.NEAREST_MIPMAP_NEAREST):o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MIN_FILTER,r.WebGLContext.NEAREST),o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MAG_FILTER,r.WebGLContext.NEAREST);break;case n.FILTERMODE_BILINEAR:this._mipmap?o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MIN_FILTER,r.WebGLContext.LINEAR_MIPMAP_NEAREST):o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MIN_FILTER,r.WebGLContext.LINEAR),o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MAG_FILTER,r.WebGLContext.LINEAR);break;case n.FILTERMODE_TRILINEAR:this._mipmap?o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MIN_FILTER,r.WebGLContext.LINEAR_MIPMAP_LINEAR):o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MIN_FILTER,r.WebGLContext.LINEAR),o.texParameteri(this._glTextureType,r.WebGLContext.TEXTURE_MAG_FILTER,r.WebGLContext.LINEAR);break;default:throw new Error("BaseTexture:unknown filterMode value.")}}},{key:"_setWarpMode",value:function(t,o){var _=e.LayaGL.instance;if(r.WebGLContext.bindTexture(_,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(o){case n.WARPMODE_REPEAT:_.texParameteri(this._glTextureType,t,r.WebGLContext.REPEAT);break;case n.WARPMODE_CLAMP:_.texParameteri(this._glTextureType,t,r.WebGLContext.CLAMP_TO_EDGE)}else _.texParameteri(this._glTextureType,t,r.WebGLContext.CLAMP_TO_EDGE)}},{key:"_setAnisotropy",value:function(t){var _=r.WebGLContext._extTextureFilterAnisotropic;if(_&&!o.PlatformInfo.onLimixiu){t=Math.max(t,1);var i=e.LayaGL.instance;r.WebGLContext.bindTexture(i,this._glTextureType,this._glTexture),t=Math.min(i.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),i.texParameterf(this._glTextureType,_.TEXTURE_MAX_ANISOTROPY_EXT,t)}}},{key:"_disposeResource",value:function(){this._glTexture&&(e.LayaGL.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))}},{key:"_getSource",value:function(){return this._readyed?this._glTexture:null}},{key:"generateMipmap",value:function(){this._isPot(this.width)&&this._isPot(this.height)&&e.LayaGL.instance.generateMipmap(this._glTextureType)}},{key:"mipmap",get:function(){return this._mipmap}},{key:"format",get:function(){return this._format}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){this._wrapModeU!==e&&(this._wrapModeU=e,-1!==this._width&&this._setWarpMode(r.WebGLContext.TEXTURE_WRAP_S,e))}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){this._wrapModeV!==e&&(this._wrapModeV=e,-1!==this._height&&this._setWarpMode(r.WebGLContext.TEXTURE_WRAP_T,e))}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,-1!==this._width&&-1!==this._height&&this._setFilterMode(e))}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){e!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,e)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(e))}},{key:"defaulteTexture",get:function(){throw"BaseTexture:must override it."}}]),n}();exports.BaseTexture=x,x.WARPMODE_REPEAT=0,x.WARPMODE_CLAMP=1,x.FILTERMODE_POINT=0,x.FILTERMODE_BILINEAR=1,x.FILTERMODE_TRILINEAR=2,x.FORMAT_R8G8B8=0,x.FORMAT_R8G8B8A8=1,x.FORMAT_ALPHA8=2,x.FORMAT_DXT1=3,x.FORMAT_DXT5=4,x.FORMAT_ETC1RGB=5,x.FORMAT_PVRTCRGB_2BPPV=9,x.FORMAT_PVRTCRGBA_2BPPV=10,x.FORMAT_PVRTCRGB_4BPPV=11,x.FORMAT_PVRTCRGBA_4BPPV=12,x.FORMAT_DEPTH_16=0,x.FORMAT_STENCIL_8=1,x.FORMAT_DEPTHSTENCIL_16_8=2,x.FORMAT_DEPTHSTENCIL_NONE=3;
},{"../layagl/LayaGL":"ezDE","./Bitmap":"ljsO","../webgl/WebGLContext":"vf9T","../utils/PlatformInfo":"HmZQ"}],"zb/G":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Texture2D=void 0;var e=require("../layagl/LayaGL"),t=require("./BaseTexture"),r=require("../webgl/WebGLContext");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}function n(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(a){function s(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.BaseTexture.FORMAT_R8G8B8A8,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i(this,s),(e=n(this,_(s).call(this,u,T)))._glTextureType=r.WebGLContext.TEXTURE_2D,e._width=a,e._height=o,e._canRead=h,e._setWarpMode(r.WebGLContext.TEXTURE_WRAP_S,e._wrapModeU),e._setWarpMode(r.WebGLContext.TEXTURE_WRAP_T,e._wrapModeV),e._setFilterMode(e._filterMode),e._setAnisotropy(e._anisoLevel),e._mipmap){e._mipmapCount=Math.max(Math.ceil(Math.log2(a))+1,Math.ceil(Math.log2(2))+1);for(var l=0;l<e._mipmapCount;l++)e._setPixels(null,l,Math.max(a>>l,1),Math.max(o>>l,1));e._setGPUMemory(a*o*4*(1+1/3))}else e._mipmapCount=1,e._setGPUMemory(a*o*4);return e}return T(s,t.BaseTexture),o(s,[{key:"_getFormatByteCount",value:function(){switch(this._format){case t.BaseTexture.FORMAT_R8G8B8:return 3;case t.BaseTexture.FORMAT_R8G8B8A8:return 4;case t.BaseTexture.FORMAT_ALPHA8:return 1;default:throw"Texture2D: unknown format."}}},{key:"_setPixels",value:function(a,i,s,o){var n=e.LayaGL.instance,u=this._glTextureType,_=this._getGLFormat();r.WebGLContext.bindTexture(n,u,this._glTexture),this.format===t.BaseTexture.FORMAT_R8G8B8?(n.pixelStorei(r.WebGLContext.UNPACK_ALIGNMENT,1),n.texImage2D(u,i,_,s,o,0,_,r.WebGLContext.UNSIGNED_BYTE,a),n.pixelStorei(r.WebGLContext.UNPACK_ALIGNMENT,4)):n.texImage2D(u,i,_,s,o,0,_,r.WebGLContext.UNSIGNED_BYTE,a)}},{key:"_calcualatesCompressedDataSize",value:function(e,r,a){switch(e){case t.BaseTexture.FORMAT_DXT1:case t.BaseTexture.FORMAT_ETC1RGB:return(r+3>>2)*(a+3>>2)*8;case t.BaseTexture.FORMAT_DXT5:return(r+3>>2)*(a+3>>2)*16;case t.BaseTexture.FORMAT_PVRTCRGB_4BPPV:case t.BaseTexture.FORMAT_PVRTCRGBA_4BPPV:return Math.floor((Math.max(r,8)*Math.max(a,8)*4+7)/8);case t.BaseTexture.FORMAT_PVRTCRGB_2BPPV:case t.BaseTexture.FORMAT_PVRTCRGBA_2BPPV:return Math.floor((Math.max(r,16)*Math.max(a,8)*2+7)/8);default:return 0}}},{key:"_pharseDDS",value:function(e){var r=new Int32Array(e,0,31);if(542327876!=r[0])throw"Invalid magic number in DDS header";if(!(4&r[20]))throw"Unsupported format, must contain a FourCC code";var a=r[21];switch(this._format){case t.BaseTexture.FORMAT_DXT1:if(827611204!==a)throw"the FourCC code is not same with texture format.";break;case t.BaseTexture.FORMAT_DXT5:if(894720068!==a)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var i=1;if(131072&r[2]){if(i=Math.max(1,r[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var s=r[4],o=r[3];this._width=s,this._height=o;var n=r[1]+4;this._upLoadCompressedTexImage2D(e,s,o,i,n,0)}},{key:"_pharseKTX",value:function(e){var a=new Uint8Array(e,0,12);if(171!=a[0]||75!=a[1]||84!=a[2]||88!=a[3]||32!=a[4]||49!=a[5]||49!=a[6]||187!=a[7]||13!=a[8]||10!=a[9]||26!=a[10]||10!=a[11])throw"Invalid fileIdentifier in KTX header";var i=new Int32Array(a.buffer,a.length,13);switch(i[4]){case r.WebGLContext._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=t.BaseTexture.FORMAT_ETC1RGB;break;default:throw"unknown texture format."}var s=i[11],o=i[6],n=i[7];this._width=o,this._height=n;var u=64+i[12];this._upLoadCompressedTexImage2D(e,o,n,s,u,4)}},{key:"_pharsePVR",value:function(e){var r=new Int32Array(e,0,13);if(55727696!=r[0])throw"Invalid magic number in PVR header";switch(r[2]){case 0:this._format=t.BaseTexture.FORMAT_PVRTCRGB_2BPPV;break;case 2:this._format=t.BaseTexture.FORMAT_PVRTCRGB_4BPPV;break;case 1:this._format=t.BaseTexture.FORMAT_PVRTCRGBA_2BPPV;break;case 3:this._format=t.BaseTexture.FORMAT_PVRTCRGBA_4BPPV;break;default:throw"Texture2D:unknown PVR format."}var a=r[11],i=r[7],s=r[6];this._width=i,this._height=s;var o=r[12]+52;this._upLoadCompressedTexImage2D(e,i,s,a,o,0)}},{key:"_upLoadCompressedTexImage2D",value:function(t,a,i,s,o,n){var u=e.LayaGL.instance,_=this._glTextureType;r.WebGLContext.bindTexture(u,_,this._glTexture);for(var T=this._getGLFormat(),h=o,l=0;l<s;l++){h+=n;var x=this._calcualatesCompressedDataSize(this._format,a,i),c=new Uint8Array(t,h,x);u.compressedTexImage2D(_,l,T,a,i,0,c),a=Math.max(a>>1,1),i=Math.max(i>>1,1),h+=x}var p=h;this._setGPUMemory(p),this._readyed=!0,this._activeResource()}},{key:"loadImageSource",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.width,o=t.height;this._width=i,this._height=o,this._isPot(i)&&this._isPot(o)||(this._mipmap=!1),this._setWarpMode(r.WebGLContext.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(r.WebGLContext.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode);var n=e.LayaGL.instance;r.WebGLContext.bindTexture(n,this._glTextureType,this._glTexture);var u=this._getGLFormat();if(s.gBrowser.onLayaRuntime?(t.setPremultiplyAlpha&&t.setPremultiplyAlpha(a),n.texImage2D(this._glTextureType,0,r.WebGLContext.RGBA,r.WebGLContext.RGBA,r.WebGLContext.UNSIGNED_BYTE,t)):(a&&n.pixelStorei(r.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.texImage2D(this._glTextureType,0,u,u,r.WebGLContext.UNSIGNED_BYTE,t),a&&n.pixelStorei(r.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),this._mipmap?(n.generateMipmap(this._glTextureType),this._setGPUMemory(i*o*4*(1+1/3))):this._setGPUMemory(i*o*4),this._canRead)if(s.gBrowser.onLayaRuntime)this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,o));else{var _=s.gBrowser;_.canvas.size(i,o),_.canvas.clear(),_.context.drawImage(t,0,0,i,o),this._pixels=new Uint8Array(s.gBrowser.context.getImageData(0,0,i,o).data.buffer)}this._readyed=!0,this._activeResource()}},{key:"setPixels",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e)throw"Texture2D:pixels can't be null.";var r=Math.max(this._width>>t,1),a=Math.max(this._height>>t,1),i=r*a*this._getFormatByteCount();if(e.length<i)throw"Texture2D:pixels length should at least "+i+".";this._setPixels(e,t,r,a),this._canRead&&(this._pixels=e),this._readyed=!0,this._activeResource()}},{key:"setSubPixels",value:function(a,i,s,o,n){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!n)throw"Texture2D:pixels can't be null.";var _=e.LayaGL.instance,T=this._glTextureType;r.WebGLContext.bindTexture(_,T,this._glTexture);var h=this._getGLFormat();this._format===t.BaseTexture.FORMAT_R8G8B8?(_.pixelStorei(r.WebGLContext.UNPACK_ALIGNMENT,1),_.texSubImage2D(T,u,a,i,s,o,h,r.WebGLContext.UNSIGNED_BYTE,n),_.pixelStorei(r.WebGLContext.UNPACK_ALIGNMENT,4)):_.texSubImage2D(T,u,a,i,s,o,h,r.WebGLContext.UNSIGNED_BYTE,n),this._readyed=!0,this._activeResource()}},{key:"setCompressData",value:function(e){switch(this._format){case t.BaseTexture.FORMAT_DXT1:case t.BaseTexture.FORMAT_DXT5:this._pharseDDS(e);break;case t.BaseTexture.FORMAT_ETC1RGB:this._pharseKTX(e);break;case t.BaseTexture.FORMAT_PVRTCRGB_2BPPV:case t.BaseTexture.FORMAT_PVRTCRGBA_2BPPV:case t.BaseTexture.FORMAT_PVRTCRGB_4BPPV:case t.BaseTexture.FORMAT_PVRTCRGBA_4BPPV:this._pharsePVR(e);break;default:throw"Texture2D:unkonwn format."}}},{key:"_recoverResource",value:function(){}},{key:"getPixels",value:function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"defaulteTexture",get:function(){return s.grayTexture}}],[{key:"__init__",value:function(){var e=new Uint8Array(3);e[0]=128,e[1]=128,e[2]=128,s.grayTexture=new s(1,1,t.BaseTexture.FORMAT_R8G8B8,!1,!1),s.grayTexture.setPixels(e),s.grayTexture.lock=!0,e[0]=255,e[1]=255,e[2]=255,s.whiteTexture=new s(1,1,t.BaseTexture.FORMAT_R8G8B8,!1,!1),s.whiteTexture.setPixels(e),s.whiteTexture.lock=!0,e[0]=0,e[1]=0,e[2]=0,s.blackTexture=new s(1,1,t.BaseTexture.FORMAT_R8G8B8,!1,!1),s.blackTexture.setPixels(e),s.blackTexture.lock=!0}},{key:"_parse",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=a?new s(a[0],a[1],a[2],a[3],a[4]):new s(0,0);switch(r&&(i.wrapModeU=r.wrapModeU,i.wrapModeV=r.wrapModeV,i.filterMode=r.filterMode,i.anisoLevel=r.anisoLevel),i._format){case t.BaseTexture.FORMAT_R8G8B8:case t.BaseTexture.FORMAT_R8G8B8A8:i.loadImageSource(e);break;case t.BaseTexture.FORMAT_DXT1:case t.BaseTexture.FORMAT_DXT5:case t.BaseTexture.FORMAT_ETC1RGB:case t.BaseTexture.FORMAT_PVRTCRGB_2BPPV:case t.BaseTexture.FORMAT_PVRTCRGBA_2BPPV:case t.BaseTexture.FORMAT_PVRTCRGB_4BPPV:case t.BaseTexture.FORMAT_PVRTCRGBA_4BPPV:i.setCompressData(e);break;default:throw"Texture2D:unkonwn format."}return i}},{key:"load",value:function(e,t){s.gLoaderMgr.create(e,t,null,s.gLoaderType.TEXTURE2D)}}]),s}();exports.Texture2D=l,l.gLoaderMgr=null,l.gLoaderType=null,l.gBrowser=null,l.grayTexture=null,l.whiteTexture=null,l.blackTexture=null;
},{"../layagl/LayaGL":"ezDE","./BaseTexture":"M7il","../webgl/WebGLContext":"vf9T"}],"oKQa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseShader=void 0;var t=require("../../resource/Resource");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,o){return!o||"object"!==e(o)&&"function"!=typeof o?n(t):o}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(e){function n(){return o(this,n),r(this,u(n).call(this))}return c(n,t.Resource),n}();exports.BaseShader=f;
},{"../../resource/Resource":"M+wd"}],"k75q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderState2D=void 0;var A=require("../../maths/Matrix");function e(A,e){if(!(A instanceof e))throw new TypeError("Cannot call a class as a function")}function r(A,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(A,t.key,t)}}function t(A,e,t){return e&&r(A.prototype,e),t&&r(A,t),A}var M=function(){function A(){e(this,A)}return t(A,null,[{key:"mat2MatArray",value:function(e,r){var t=e,M=r;return M[0]=t.a,M[1]=t.b,M[2]=A.EMPTYMAT4_ARRAY[2],M[3]=A.EMPTYMAT4_ARRAY[3],M[4]=t.c,M[5]=t.d,M[6]=A.EMPTYMAT4_ARRAY[6],M[7]=A.EMPTYMAT4_ARRAY[7],M[8]=A.EMPTYMAT4_ARRAY[8],M[9]=A.EMPTYMAT4_ARRAY[9],M[10]=A.EMPTYMAT4_ARRAY[10],M[11]=A.EMPTYMAT4_ARRAY[11],M[12]=t.tx,M[13]=t.ty,M[14]=A.EMPTYMAT4_ARRAY[14],M[15]=A.EMPTYMAT4_ARRAY[15],r}},{key:"restoreTempArray",value:function(){A.TEMPMAT4_ARRAY[0]=1,A.TEMPMAT4_ARRAY[1]=0,A.TEMPMAT4_ARRAY[4]=0,A.TEMPMAT4_ARRAY[5]=1,A.TEMPMAT4_ARRAY[12]=0,A.TEMPMAT4_ARRAY[13]=0}},{key:"clear",value:function(){A.worldScissorTest=!1,A.worldAlpha=1}}]),A}();exports.RenderState2D=M,M._MAXSIZE=99999999,M.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],M.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],M.worldMatrix4=M.TEMPMAT4_ARRAY,M.worldMatrix=new A.Matrix,M.matWVP=null,M.worldAlpha=1,M.worldScissorTest=!1,M.width=0,M.height=0;
},{"../../maths/Matrix":"GG2z"}],"pIGp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTexture2D=void 0;var e=require("././Texture2D"),t=require("../layagl/LayaGL"),r=require("./BaseTexture"),n=require("../webgl/WebGLContext"),i=require("../webgl/shader/BaseShader"),a=require("../webgl/utils/RenderState2D"),o=require("../utils/PlatformInfo");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}function c(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?_(e):t}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(u){function s(e,t){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.BaseTexture.FORMAT_R8G8B8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.BaseTexture.FORMAT_DEPTH_16;return f(this,s),(i=c(this,l(s).call(this,a,!1)))._mgrKey=0,i._glTextureType=n.WebGLContext.TEXTURE_2D,i._width=e,i._height=t,i._depthStencilFormat=o,i._create(e,t),i.lock=!0,i}return b(s,r.BaseTexture),h(s,[{key:"getIsReady",value:function(){return!0}},{key:"_create",value:function(e,i){var a=t.LayaGL.instance;this._frameBuffer=a.createFramebuffer(),n.WebGLContext.bindTexture(a,this._glTextureType,this._glTexture);var o=this._getGLFormat();if(a.texImage2D(this._glTextureType,0,o,e,i,0,o,n.WebGLContext.UNSIGNED_BYTE,null),this._setGPUMemory(e*i*4),a.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,this._frameBuffer),a.framebufferTexture2D(n.WebGLContext.FRAMEBUFFER,n.WebGLContext.COLOR_ATTACHMENT0,n.WebGLContext.TEXTURE_2D,this._glTexture,0),this._depthStencilFormat!==r.BaseTexture.FORMAT_DEPTHSTENCIL_NONE)switch(this._depthStencilBuffer=a.createRenderbuffer(),a.bindRenderbuffer(n.WebGLContext.RENDERBUFFER,this._depthStencilBuffer),this._depthStencilFormat){case r.BaseTexture.FORMAT_DEPTH_16:a.renderbufferStorage(n.WebGLContext.RENDERBUFFER,n.WebGLContext.DEPTH_COMPONENT16,e,i),a.framebufferRenderbuffer(n.WebGLContext.FRAMEBUFFER,n.WebGLContext.DEPTH_ATTACHMENT,n.WebGLContext.RENDERBUFFER,this._depthStencilBuffer);break;case r.BaseTexture.FORMAT_STENCIL_8:a.renderbufferStorage(n.WebGLContext.RENDERBUFFER,n.WebGLContext.STENCIL_INDEX8,e,i),a.framebufferRenderbuffer(n.WebGLContext.FRAMEBUFFER,n.WebGLContext.STENCIL_ATTACHMENT,n.WebGLContext.RENDERBUFFER,this._depthStencilBuffer);break;case r.BaseTexture.FORMAT_DEPTHSTENCIL_16_8:a.renderbufferStorage(n.WebGLContext.RENDERBUFFER,n.WebGLContext.DEPTH_STENCIL,e,i),a.framebufferRenderbuffer(n.WebGLContext.FRAMEBUFFER,n.WebGLContext.DEPTH_STENCIL_ATTACHMENT,n.WebGLContext.RENDERBUFFER,this._depthStencilBuffer)}a.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,null),a.bindRenderbuffer(n.WebGLContext.RENDERBUFFER,null),this._setWarpMode(n.WebGLContext.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(n.WebGLContext.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()}},{key:"generateMipmap",value:function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,t.LayaGL.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))}},{key:"start",value:function(){var e=t.LayaGL.instance;t.LayaGL.instance.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,this._frameBuffer),this._lastRT=s._currentActive,s._currentActive=this,this._readyed=!0,e.viewport(0,0,this._width,this._height),this._lastWidth=a.RenderState2D.width,this._lastHeight=a.RenderState2D.height,a.RenderState2D.width=this._width,a.RenderState2D.height=this._height,i.BaseShader.activeShader=null}},{key:"end",value:function(){t.LayaGL.instance.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,null),s._currentActive=null,this._readyed=!0}},{key:"restore",value:function(){var e=t.LayaGL.instance;this._lastRT!=s._currentActive&&(t.LayaGL.instance.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,this._lastRT?this._lastRT._frameBuffer:null),s._currentActive=this._lastRT),this._readyed=!0,e.viewport(0,0,this._lastWidth,this._lastHeight),a.RenderState2D.width=this._lastWidth,a.RenderState2D.height=this._lastHeight,i.BaseShader.activeShader=null}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=t.LayaGL.instance;o.clearColor(e,r,i,a);var u=n.WebGLContext.COLOR_BUFFER_BIT;switch(this._depthStencilFormat){case n.WebGLContext.DEPTH_COMPONENT16:u|=n.WebGLContext.DEPTH_BUFFER_BIT;break;case n.WebGLContext.STENCIL_INDEX8:u|=n.WebGLContext.STENCIL_BUFFER_BIT;break;case n.WebGLContext.DEPTH_STENCIL:u|=n.WebGLContext.DEPTH_BUFFER_BIT,u|=n.WebGLContext.STENCIL_BUFFER_BIT}o.clear(u)}},{key:"getData",value:function(e,r,i,a){if(o.PlatformInfo.onLayaRuntime&&2==window.conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var u=t.LayaGL.instance;if(u.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,this._frameBuffer),!(u.checkFramebufferStatus(n.WebGLContext.FRAMEBUFFER)===n.WebGLContext.FRAMEBUFFER_COMPLETE))return u.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,null),null;var f=new Uint8Array(this._width*this._height*4),s=this._getGLFormat();return u.readPixels(e,r,i,a,s,n.WebGLContext.UNSIGNED_BYTE,f),u.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,null),f}},{key:"getDataAsync",value:function(e,r,i,a,o){var u=t.LayaGL.instance;u.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,this._frameBuffer),u.readPixelsAsync(e,r,i,a,n.WebGLContext.RGBA,n.WebGLContext.UNSIGNED_BYTE,function(e){o(new Uint8Array(e))}),u.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,null)}},{key:"recycle",value:function(){}},{key:"_disposeResource",value:function(){if(this._frameBuffer){var e=t.LayaGL.instance;e.deleteTexture(this._glTexture),e.deleteFramebuffer(this._frameBuffer),e.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}}},{key:"depthStencilFormat",get:function(){return this._depthStencilFormat}},{key:"defaulteTexture",get:function(){return e.Texture2D.grayTexture}},{key:"sourceWidth",get:function(){return this._width}},{key:"sourceHeight",get:function(){return this._height}},{key:"offsetX",get:function(){return 0}},{key:"offsetY",get:function(){return 0}}],[{key:"pushRT",value:function(){s.rtStack.push({rt:s._currentActive,w:a.RenderState2D.width,h:a.RenderState2D.height})}},{key:"popRT",value:function(){var e=t.LayaGL.instance,r=s.rtStack.pop();r&&(s._currentActive!=r.rt&&(t.LayaGL.instance.bindFramebuffer(n.WebGLContext.FRAMEBUFFER,r.rt?r.rt._frameBuffer:null),s._currentActive=r.rt),e.viewport(0,0,r.w,r.h),a.RenderState2D.width=r.w,a.RenderState2D.height=r.h)}},{key:"currentActive",get:function(){return s._currentActive}}]),s}();exports.RenderTexture2D=E,E.rtStack=[],E.defuv=[0,0,1,0,1,1,0,1],E.flipyuv=[0,1,1,1,1,0,0,0];
},{"././Texture2D":"zb/G","../layagl/LayaGL":"ezDE","./BaseTexture":"M7il","../webgl/WebGLContext":"vf9T","../webgl/shader/BaseShader":"oKQa","../webgl/utils/RenderState2D":"k75q","../utils/PlatformInfo":"HmZQ"}],"v/6A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGLRTMgr=void 0;var e=require("./BaseTexture"),r=require("./RenderTexture2D");function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}var u=function(){function n(){t(this,n)}return o(n,null,[{key:"getRT",value:function(t,o){o|=0,(t|=0)>=1e4&&console.error("getRT error! w too big");var u,i=1e4*o+t,a=n.dict[i];return a&&a.length>0?((u=a.pop())._mgrKey=i,u):((u=new r.RenderTexture2D(t,o,e.BaseTexture.FORMAT_R8G8B8A8,-1))._mgrKey=i,u)}},{key:"releaseRT",value:function(e){if(!(e._mgrKey<=0)){var r=n.dict[e._mgrKey];!r&&(r=[],n.dict[e._mgrKey]=r),e._mgrKey=0,r.push(e)}}}]),n}();exports.WebGLRTMgr=u,u.dict={};
},{"./BaseTexture":"M7il","./RenderTexture2D":"pIGp"}],"brGx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BlendMode=void 0;var e=require("../WebGLContext");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function l(e,t,l){return t&&n(e.prototype,t),l&&n(e,l),e}var o=function(){function n(){t(this,n)}return l(n,null,[{key:"_init_",value:function(e){n.fns=[n.BlendNormal,n.BlendAdd,n.BlendMultiply,n.BlendScreen,n.BlendOverlay,n.BlendLight,n.BlendMask,n.BlendDestinationOut],n.targetFns=[n.BlendNormalTarget,n.BlendAddTarget,n.BlendMultiplyTarget,n.BlendScreenTarget,n.BlendOverlayTarget,n.BlendLightTarget,n.BlendMask,n.BlendDestinationOut]}},{key:"BlendNormal",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE_MINUS_SRC_ALPHA)}},{key:"BlendAdd",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.DST_ALPHA)}},{key:"BlendMultiply",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.DST_COLOR,e.WebGLContext.ONE_MINUS_SRC_ALPHA)}},{key:"BlendScreen",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE)}},{key:"BlendOverlay",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE_MINUS_SRC_COLOR)}},{key:"BlendLight",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE)}},{key:"BlendNormalTarget",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE_MINUS_SRC_ALPHA)}},{key:"BlendAddTarget",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.DST_ALPHA)}},{key:"BlendMultiplyTarget",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.DST_COLOR,e.WebGLContext.ONE_MINUS_SRC_ALPHA)}},{key:"BlendScreenTarget",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE)}},{key:"BlendOverlayTarget",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE_MINUS_SRC_COLOR)}},{key:"BlendLightTarget",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ONE,e.WebGLContext.ONE)}},{key:"BlendMask",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ZERO,e.WebGLContext.SRC_ALPHA)}},{key:"BlendDestinationOut",value:function(t){e.WebGLContext.setBlendFunc(t,e.WebGLContext.ZERO,e.WebGLContext.ZERO)}}]),n}();exports.BlendMode=o,o.activeBlendFunction=null,o.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],o.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},o.NORMAL="normal",o.ADD="add",o.MULTIPLY="multiply",o.SCREEN="screen",o.OVERLAY="overlay",o.LIGHT="light",o.MASK="mask",o.DESTINATIONOUT="destination-out",o.LIGHTER="lighter",o.fns=[],o.targetFns=[];
},{"../WebGLContext":"vf9T"}],"SZM4":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderDefinesBase=void 0;var i=function(){function t(n,i,a){e(this,t),this._value=0,this._name2int=n,this._int2name=i,this._int2nameMap=a}return n(t,[{key:"add",value:function(e){return e instanceof String?this._value|=this._name2int[e]:this._value|=e,this._value}},{key:"addInt",value:function(e){return this._value|=e,this._value}},{key:"remove",value:function(e){return e instanceof String?this._value&=~this._name2int[e]:this._value&=~e,this._value}},{key:"isDefine",value:function(e){return(this._value&e)===e}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){this._value=e}},{key:"toNameDic",value:function(){var e=this._int2nameMap[this._value];return e||t._toText(this._value,this._int2name,this._int2nameMap)}}],[{key:"_reg",value:function(e,t,n,i){n[e]=t,i[t]=e}},{key:"_toText",value:function(e,t,n){var i=n[e];if(i)return i;for(var a={},r=1,u=0;u<32&&!((r=1<<u)>e);u++)if(e&r){var o=t[r];o&&(a[o]="")}return n[e]=a,a}},{key:"_toInt",value:function(e,t){for(var n=e.split("."),i=0,a=0,r=n.length;a<r;a++){var u=t[n[a]];if(!u)throw new Error("Defines to int err:"+e+"/"+n[a]);i|=u}return i}}]),t}();exports.ShaderDefinesBase=i;
},{}],"el31":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderDefines2D=void 0;var e=require("../ShaderDefinesBase");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?u(e):n}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(t){function r(){return n(this,r),i(this,f(r).call(this,r.__name2int,r.__int2name,r.__int2nameMap))}return a(r,e.ShaderDefinesBase),o(r,null,[{key:"__init__",value:function(){r.reg("TEXTURE2D",r.TEXTURE2D),r.reg("PRIMITIVE",r.PRIMITIVE),r.reg("GLOW_FILTER",r.FILTERGLOW),r.reg("BLUR_FILTER",r.FILTERBLUR),r.reg("COLOR_FILTER",r.FILTERCOLOR),r.reg("COLOR_ADD",r.COLORADD),r.reg("WORLDMAT",r.WORLDMAT),r.reg("FILLTEXTURE",r.FILLTEXTURE),r.reg("FSHIGHPRECISION",r.SHADERDEFINE_FSHIGHPRECISION),r.reg("MVP3D",r.MVP3D)}},{key:"reg",value:function(e,t){this._reg(e,t,r.__name2int,r.__int2name)}},{key:"toText",value:function(e,t,n){return this._toText(e,t,n)}},{key:"toInt",value:function(e){return this._toInt(e,r.__name2int)}}]),r}();exports.ShaderDefines2D=E,E.TEXTURE2D=1,E.PRIMITIVE=4,E.FILTERGLOW=8,E.FILTERBLUR=16,E.FILTERCOLOR=32,E.COLORADD=64,E.WORLDMAT=128,E.FILLTEXTURE=256,E.SKINMESH=512,E.SHADERDEFINE_FSHIGHPRECISION=1024,E.MVP3D=2048,E.NOOPTMASK=E.FILTERGLOW|E.FILTERBLUR|E.FILTERCOLOR|E.FILLTEXTURE,E.__name2int={},E.__int2name=[],E.__int2nameMap=[];
},{"../ShaderDefinesBase":"SZM4"}],"GllP":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.StringKey=void 0;var r=function(){function e(){t(this,e),this._strsToID={},this._idToStrs=[],this._length=0}return n(e,[{key:"add",value:function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)}},{key:"getID",value:function(t){var e=this._strsToID[t];return null==e?-1:e}},{key:"getName",value:function(t){var e=this._idToStrs[t];return null==e?void 0:e}}]),e}();exports.StringKey=r;
},{}],"vwHa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderNode=void 0;var t=require("./ShaderCompile");function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function e(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}var s=function(){function e(t){i(this,e),this.childs=[],this.text="",this.useFuns="",this.z=0,this.includefiles=t}return n(e,[{key:"setParent",value:function(t){t.childs.push(this),this.z=t.z+1,this.parent=t}},{key:"setCondition",value:function(t,i){t&&(this.conditionType=i,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)}},{key:"toscript",value:function(t,i){return this._toscript(t,i,++e.__id)}},{key:"_toscript",value:function(i,e,n){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var s=!!this.condition.call(i);if(this.conditionType===t.ShaderCompile.IFDEF_ELSE&&(s=!s),!s)return e}if(this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(t,s,r){t._toscript(i,e,n)}),this.includefiles.length>0&&this.useFuns.length>0)for(var r,o=0,h=this.includefiles.length;o<h;o++)this.includefiles[o].curUseID!=n&&(r=this.includefiles[o].file.getFunsScript(this.useFuns)).length>0&&(this.includefiles[o].curUseID=n,e[0]=r+e[0]);return e}}]),e}();exports.ShaderNode=s,s.__id=1;
},{"./ShaderCompile":"Qke2"}],"JFR/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InlcudeFile=void 0;var e=require("././ShaderCompile");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function t(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}var i=function(){function t(r){n(this,t),this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=r;for(var i,s,o=0;!((o=r.indexOf("#begin",o))<0);){for(s=o+5;!((s=r.indexOf("#end",s))<0)&&"i"===r.charAt(s+4);)s+=5;if(s<0)throw"add include err,no #end:"+r;i=r.indexOf("\n",o);var u=e.ShaderCompile.splitToWords(r.substr(o,i-o),null);"code"==u[1]?this.codes[u[2]]=r.substr(i+1,s-i-1):"function"==u[1]&&(i=r.indexOf("function",o),i+="function".length,this.funs[u[3]]=r.substr(i+1,s-i-1),this.funnames+=u[3]+";"),o=s+1}}return r(t,[{key:"getWith",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=e?this.codes[e]:this.script;if(!n)throw"get with error:"+e;return n}},{key:"getFunsScript",value:function(e){var n="";for(var t in this.funs)e.indexOf(t+";")>=0&&(n+=this.funs[t]);return n}}]),t}();exports.InlcudeFile=i;
},{"././ShaderCompile":"Qke2"}],"Qke2":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderCompile=void 0;var t=require("././ShaderNode"),n=require("././InlcudeFile"),r=require("../WebGLContext"),i=require("../shader/Shader");function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var l=function(){function e(n,r,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;o(this,e),this._clearCR=new RegExp("\r","g");var a=this;function l(e){e=e.replace(a._clearCR,"");var n=[],r=new t.ShaderNode(n);return a._compileToTree(r,e.split("\n"),0,n,s),r}var u=Date.now();this._VS=l(n),this._PS=l(r),this._nameMap=i,Date.now()-u>2&&console.log("ShaderCompile use time:"+(Date.now()-u)+"  size:"+n.length+"/"+r.length)}return a(e,[{key:"_compileToTree",value:function(n,r,i,o,s){var a,l,u,c,d,f,p,h,_,x,C;for(_=i;_<r.length;_++)if(!((u=r[_]).length<1)&&0!==(f=u.indexOf("//"))){if(f>=0&&(u=u.substr(0,f)),a=h||new t.ShaderNode(o),h=null,a.text=u,a.noCompile=!0,(f=u.indexOf("#"))>=0){for(c="#",C=f+1,x=u.length;C<x;C++){var E=u.charAt(C);if(" "===E||"\t"===E||"?"===E)break;c+=E}switch(a.name=c,c){case"#ifdef":case"#ifndef":if(a.src=u,a.noCompile=null!=u.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+u.substr(f+a.name.length)+"}"):(p=u.replace(/^\s*/,"").split(/\s+/),a.setCondition(p[1],"#ifdef"===c?e.IFDEF_YES:e.IFDEF_ELSE),a.text="//"+a.text),a.setParent(n),n=a,s)for(p=u.substr(C).split(e._splitToWordExps3),C=0;C<p.length;C++)(u=p[C]).length&&(s[u]=!0);continue;case"#if":if(a.src=u,a.noCompile=!0,a.setParent(n),n=a,s)for(p=u.substr(C).split(e._splitToWordExps3),C=0;C<p.length;C++)(u=p[C]).length&&"defined"!=u&&(s[u]=!0);continue;case"#else":a.src=u,l=(n=n.parent).childs[n.childs.length-1],a.noCompile=l.noCompile,a.noCompile||(a.condition=l.condition,a.conditionType=l.conditionType==e.IFDEF_YES?e.IFDEF_ELSE:e.IFDEF_YES,a.text="//"+a.text+" "+l.text+" "+a.conditionType),a.setParent(n),n=a;continue;case"#endif":l=(n=n.parent).childs[n.childs.length-1],a.noCompile=l.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(n);continue;case"#include":p=e.splitToWords(u,null);var b=e.includes[p[1]];if(!b)throw"ShaderCompile error no this include file:"+p[1];if((f=p[0].indexOf("?"))<0){a.setParent(n),u=b.getWith("with"==p[2]?p[3]:null),this._compileToTree(a,u.split("\n"),0,o,s),a.text="";continue}a.setCondition(p[0].substr(f+1),e.IFDEF_YES),a.text=b.getWith("with"==p[2]?p[3]:null);break;case"#import":d=(p=e.splitToWords(u,null))[1],o.push({node:a,file:e.includes[d],ofs:a.text.length});continue}}else{if((l=n.childs[n.childs.length-1])&&!l.name){o.length>0&&e.splitToWords(u,l),h=a,l.text+="\n"+u;continue}o.length>0&&e.splitToWords(u,a)}a.setParent(n)}}},{key:"createShader",value:function(e,t,n,r){var o={},s="";if(e)for(var a in e)s+="#define "+a+"\n",o[a]=!0;var l=this._VS.toscript(o,[]),u=this._PS.toscript(o,[]);return(n||i.Shader.create)(s+l.join("\n"),s+u.join("\n"),t,this._nameMap,r)}}],[{key:"_parseOne",value:function(t,n,r,i,o,s){var a={type:e.shaderParamsMap[r[i+1]],name:r[i+2],size:isNaN(parseInt(r[i+3]))?1:parseInt(r[i+3])};return s&&("attribute"==o?t.push(a):n.push(a)),":"==r[i+3]&&(a.type=r[i+4],i+=2),i+=2}},{key:"addInclude",value:function(t,r){if(!r||0===r.length)throw new Error("add shader include file err:"+t);if(e.includes[t])throw new Error("add shader include file err, has add:"+t);e.includes[t]=new n.InlcudeFile(r)}},{key:"preGetParams",value:function(t,n){var r,i,o=[t,n],s={},a=[],l=[],u={},c=[];s.attributes=a,s.uniforms=l,s.defines=u;for(var d=0;d<2;d++){o[d]=o[d].replace(e._removeAnnotation,"");var f,p=o[d].match(e._reg);for(r=0,i=p.length;r<i;r++){var h=p[r];if("attribute"==h||"uniform"==h)r=e._parseOne(a,l,p,r,h,!0);else{if("#define"==h){c[h=p[++r]]=1;continue}if("#ifdef"==h){u[f=p[++r]]=u[f]||[];for(r++;r<i;r++)if("attribute"==(h=p[r])||"uniform"==h)r=e._parseOne(a,l,p,r,h,c[f]);else if("#else"==h)for(r++;r<i;r++)if("attribute"==(h=p[r])||"uniform"==h)r=e._parseOne(a,l,p,r,h,!c[f]);else if("#endif"==h)break}}}}return s}},{key:"splitToWords",value:function(e,t){for(var n,r,i=[],o=-1,s=0,a=e.length;s<a;s++)if(n=e.charAt(s)," \t=+-*/&%!<>()'\",;".indexOf(n)>=0){if(o>=0&&s-o>1&&(r=e.substr(o,s-o),i.push(r)),'"'==n||"'"==n){var l=e.indexOf(n,s+1);if(l<0)throw"Sharder err:"+e;i.push(e.substr(s+1,l-s-1)),s=l,o=-1;continue}"("==n&&t&&i.length>0&&(r=i[i.length-1]+";","vec4;main;".indexOf(r)<0&&(t.useFuns+=r)),o=-1}else o<0&&(o=s);return o<a&&a-o>1&&(r=e.substr(o,a-o),i.push(r)),i}}]),e}();exports.ShaderCompile=l,l.IFDEF_NO=0,l.IFDEF_YES=1,l.IFDEF_ELSE=2,l.IFDEF_PARENT=3,l._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),l._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),l._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),l.includes={},l.shaderParamsMap={float:r.WebGLContext.FLOAT,int:r.WebGLContext.INT,bool:r.WebGLContext.BOOL,vec2:r.WebGLContext.FLOAT_VEC2,vec3:r.WebGLContext.FLOAT_VEC3,vec4:r.WebGLContext.FLOAT_VEC4,ivec2:r.WebGLContext.INT_VEC2,ivec3:r.WebGLContext.INT_VEC3,ivec4:r.WebGLContext.INT_VEC4,bvec2:r.WebGLContext.BOOL_VEC2,bvec3:r.WebGLContext.BOOL_VEC3,bvec4:r.WebGLContext.BOOL_VEC4,mat2:r.WebGLContext.FLOAT_MAT2,mat3:r.WebGLContext.FLOAT_MAT3,mat4:r.WebGLContext.FLOAT_MAT4,sampler2D:r.WebGLContext.SAMPLER_2D,samplerCube:r.WebGLContext.SAMPLER_CUBE},l._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g");
},{"././ShaderNode":"vwHa","././InlcudeFile":"JFR/","../WebGLContext":"vf9T","../shader/Shader":"PB8V"}],"PB8V":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Shader=void 0;var t=require("././BaseShader"),n=require("../../utils/Stat"),r=require("../../utils/StringKey"),o=require("../WebGLContext"),a=require("../utils/ShaderCompile");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function m(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function r(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(u(this,r),(n=m(this,f(r).call(this)))._attribInfo=null,n.customCompile=!1,n._curActTexIndex=0,n.tag={},n._program=null,n._params=null,n._paramsMap={},!e||!t)throw"Shader Error";return n._attribInfo=i,n._id=++r._count,n._vs=e,n._ps=t,n._nameMap=a||{},null!=o&&(r.sharders[o]=c(n)),n.recreateResource(),n.lock=!0,n}return h(r,t.BaseShader),s(r,[{key:"recreateResource",value:function(){this._compile(),this._setGPUMemory(0)}},{key:"_disposeResource",value:function(){o.WebGLContext.mainContext.deleteShader(this._vshader),o.WebGLContext.mainContext.deleteShader(this._pshader),o.WebGLContext.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0}},{key:"_compile",value:function(){if(this._vs&&this._ps&&!this._params){var e;this._reCompile=!0,this._params=[],this.customCompile&&(e=a.ShaderCompile.preGetParams(this._vs,this._ps));var t,n,i,u=o.WebGLContext.mainContext;this._program=u.createProgram(),this._vshader=r._createShader(u,this._vs,o.WebGLContext.VERTEX_SHADER),this._pshader=r._createShader(u,this._ps,o.WebGLContext.FRAGMENT_SHADER),u.attachShader(this._program,this._vshader),u.attachShader(this._program,this._pshader);var l=this._attribInfo?this._attribInfo.length:0;for(n=0;n<l;n+=2)u.bindAttribLocation(this._program,this._attribInfo[n+1],this._attribInfo[n]);if(u.linkProgram(this._program),!this.customCompile&&!u.getProgramParameter(this._program,o.WebGLContext.LINK_STATUS))throw u.getProgramInfoLog(this._program);var s=this.customCompile?e.uniforms.length:u.getProgramParameter(this._program,o.WebGLContext.ACTIVE_UNIFORMS);for(n=0;n<s;n++){var m=this.customCompile?e.uniforms[n]:u.getActiveUniform(this._program,n);(t={vartype:"uniform",glfun:null,ivartype:1,location:u.getUniformLocation(this._program,m.name),name:m.name,type:m.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")>0&&(t.name=t.name.substr(0,t.name.length-3),t.isArray=!0,t.location=u.getUniformLocation(this._program,t.name)),this._params.push(t)}for(n=0,i=this._params.length;n<i;n++)switch((t=this._params[n]).indexOfParams=n,t.index=1,t.value=[t.location,null],t.codename=t.name,t.name=this._nameMap[t.codename]?this._nameMap[t.codename]:t.codename,this._paramsMap[t.name]=t,t._this=this,t.uploadedValue=[],t.type){case o.WebGLContext.INT:t.fun=t.isArray?this._uniform1iv:this._uniform1i;break;case o.WebGLContext.FLOAT:t.fun=t.isArray?this._uniform1fv:this._uniform1f;break;case o.WebGLContext.FLOAT_VEC2:t.fun=t.isArray?this._uniform_vec2v:this._uniform_vec2;break;case o.WebGLContext.FLOAT_VEC3:t.fun=t.isArray?this._uniform_vec3v:this._uniform_vec3;break;case o.WebGLContext.FLOAT_VEC4:t.fun=t.isArray?this._uniform_vec4v:this._uniform_vec4;break;case o.WebGLContext.SAMPLER_2D:t.fun=this._uniform_sampler2D;break;case o.WebGLContext.SAMPLER_CUBE:t.fun=this._uniform_samplerCube;break;case o.WebGLContext.FLOAT_MAT4:t.glfun=u.uniformMatrix4fv,t.fun=this._uniformMatrix4fv;break;case o.WebGLContext.BOOL:t.fun=this._uniform1i;break;case o.WebGLContext.FLOAT_MAT2:case o.WebGLContext.FLOAT_MAT3:default:throw new Error("compile shader err!")}}}},{key:"getUniform",value:function(e){return this._paramsMap[e]}},{key:"_uniform1f",value:function(e,t){var n=e.uploadedValue;return n[0]!==t?(o.WebGLContext.mainContext.uniform1f(e.location,n[0]=t),1):0}},{key:"_uniform1fv",value:function(e,t){if(t.length<4){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(o.WebGLContext.mainContext.uniform1fv(e.location,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],1):0}return o.WebGLContext.mainContext.uniform1fv(e.location,t),1}},{key:"_uniform_vec2",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]?(o.WebGLContext.mainContext.uniform2f(e.location,n[0]=t[0],n[1]=t[1]),1):0}},{key:"_uniform_vec2v",value:function(e,t){if(t.length<2){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(o.WebGLContext.mainContext.uniform2fv(e.location,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],1):0}return o.WebGLContext.mainContext.uniform2fv(e.location,t),1}},{key:"_uniform_vec3",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]?(o.WebGLContext.mainContext.uniform3f(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2]),1):0}},{key:"_uniform_vec3v",value:function(e,t){return o.WebGLContext.mainContext.uniform3fv(e.location,t),1}},{key:"_uniform_vec4",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(o.WebGLContext.mainContext.uniform4f(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),1):0}},{key:"_uniform_vec4v",value:function(e,t){return o.WebGLContext.mainContext.uniform4fv(e.location,t),1}},{key:"_uniformMatrix2fv",value:function(e,t){return o.WebGLContext.mainContext.uniformMatrix2fv(e.location,!1,t),1}},{key:"_uniformMatrix3fv",value:function(e,t){return o.WebGLContext.mainContext.uniformMatrix3fv(e.location,!1,t),1}},{key:"_uniformMatrix4fv",value:function(e,t){return o.WebGLContext.mainContext.uniformMatrix4fv(e.location,!1,t),1}},{key:"_uniform1i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t?(o.WebGLContext.mainContext.uniform1i(e.location,n[0]=t),1):0}},{key:"_uniform1iv",value:function(e,t){return o.WebGLContext.mainContext.uniform1iv(e.location,t),1}},{key:"_uniform_ivec2",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]?(o.WebGLContext.mainContext.uniform2i(e.location,n[0]=t[0],n[1]=t[1]),1):0}},{key:"_uniform_ivec2v",value:function(e,t){return o.WebGLContext.mainContext.uniform2iv(e.location,t),1}},{key:"_uniform_vec3i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]?(o.WebGLContext.mainContext.uniform3i(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2]),1):0}},{key:"_uniform_vec3vi",value:function(e,t){return o.WebGLContext.mainContext.uniform3iv(e.location,t),1}},{key:"_uniform_vec4i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(o.WebGLContext.mainContext.uniform4i(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),1):0}},{key:"_uniform_vec4vi",value:function(e,t){return o.WebGLContext.mainContext.uniform4iv(e.location,t),1}},{key:"_uniform_sampler2D",value:function(e,t){var n=o.WebGLContext.mainContext,r=e.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,n.uniform1i(e.location,this._curActTexIndex),o.WebGLContext.activeTexture(n,o.WebGLContext.TEXTURE0+this._curActTexIndex),o.WebGLContext.bindTexture(n,o.WebGLContext.TEXTURE_2D,t),this._curActTexIndex++,1):(o.WebGLContext.activeTexture(n,o.WebGLContext.TEXTURE0+r[0]),o.WebGLContext.bindTexture(n,o.WebGLContext.TEXTURE_2D,t),0)}},{key:"_uniform_samplerCube",value:function(e,t){var n=o.WebGLContext.mainContext,r=e.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,n.uniform1i(e.location,this._curActTexIndex),o.WebGLContext.activeTexture(n,o.WebGLContext.TEXTURE0+this._curActTexIndex),o.WebGLContext.bindTexture(n,o.WebGLContext.TEXTURE_CUBE_MAP,t),this._curActTexIndex++,1):(o.WebGLContext.activeTexture(n,o.WebGLContext.TEXTURE0+r[0]),o.WebGLContext.bindTexture(n,o.WebGLContext.TEXTURE_CUBE_MAP,t),0)}},{key:"_noSetValue",value:function(e){console.log("no....:"+e.name)}},{key:"uploadOne",value:function(e,t){o.WebGLContext.useProgram(o.WebGLContext.mainContext,this._program);var n=this._paramsMap[e];n.fun.call(this,n,t)}},{key:"uploadTexture2D",value:function(e){var t=o.WebGLContext;t._activeTextures[0]!==e&&(t.bindTexture(o.WebGLContext.mainContext,t.TEXTURE_2D,e),t._activeTextures[0]=e)}},{key:"upload",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t.BaseShader.activeShader=t.BaseShader.bindShader=this;var a=o.WebGLContext.mainContext;o.WebGLContext.useProgram(a,this._program),this._reCompile?(r=this._params,this._reCompile=!1):r=r||this._params;for(var i,u,l=r.length,s=0,m=0;m<l;m++)null!==(u=e[(i=r[m]).name])&&(s+=i.fun.call(this,i,u));n.Stat.shaderCall+=s}},{key:"uploadArray",value:function(e,r,a){t.BaseShader.activeShader=this,t.BaseShader.bindShader=this,o.WebGLContext.useProgram(o.WebGLContext.mainContext,this._program);this._params;for(var i,u,l=0,s=r-2;s>=0;s-=2)(u=this._paramsMap[e[s]])&&null!=(i=e[s+1])&&(a&&a[u.name]&&a[u.name].bind(),l+=u.fun.call(this,u,i));n.Stat.shaderCall+=l}},{key:"getParams",value:function(){return this._params}},{key:"setAttributesLocation",value:function(e){this._attribInfo=e}}],[{key:"getShader",value:function(e){return r.sharders[e]}},{key:"create",value:function(e,t){return new r(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:null)}},{key:"withCompile",value:function(e,t,n,o){if(n&&r.sharders[n])return r.sharders[n];var a=r._preCompileShader[r.SHADERNAME2ID*e];if(!a)throw new Error("withCompile shader err!"+e);return a.createShader(t,n,o,null)}},{key:"withCompile2D",value:function(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(o&&r.sharders[o])return r.sharders[o];var u=r._preCompileShader[r.SHADERNAME2ID*e+t];if(!u)throw new Error("withCompile shader err!"+e+" "+t);return u.createShader(n,o,a,i)}},{key:"addInclude",value:function(e,t){a.ShaderCompile.addInclude(e,t)}},{key:"preCompile",value:function(e,t,n,o){var i=r.SHADERNAME2ID*e;r._preCompileShader[i]=new a.ShaderCompile(t,n,o)}},{key:"preCompile2D",value:function(e,t,n,o,i){var u=r.SHADERNAME2ID*e+t;r._preCompileShader[u]=new a.ShaderCompile(n,o,i)}},{key:"_createShader",value:function(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,o.WebGLContext.COMPILE_STATUS)?r:(console.log(e.getShaderInfoLog(r)),null)}}]),r}();exports.Shader=v,v._count=0,v._preCompileShader={},v.SHADERNAME2ID=2e-4,v.nameKey=new r.StringKey,v.sharders=new Array(32);
},{"././BaseShader":"oKQa","../../utils/Stat":"xuKH","../../utils/StringKey":"GllP","../WebGLContext":"vf9T","../utils/ShaderCompile":"Qke2"}],"hTSO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Shader2X=void 0;var e=require("../Shader");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function u(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?i(e):n}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=c(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(t){function r(e,t){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return n(this,r),(o=u(this,a(r).call(this,e,t,i,l,c)))._params2dQuick2=null,o._shaderValueWidth=0,o._shaderValueHeight=0,o}return f(r,e.Shader),o(r,[{key:"_disposeResource",value:function(){l(a(r.prototype),"_disposeResource",this).call(this),this._params2dQuick2=null}},{key:"upload2dQuick2",value:function(e){this.upload(e,this._params2dQuick2||this._make2dQuick2())}},{key:"_make2dQuick2",value:function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var e,t=this._params,n=0,r=t.length;n<r;n++)"size"!==(e=t[n]).name&&this._params2dQuick2.push(e)}return this._params2dQuick2}}],[{key:"create",value:function(e,t){return new r(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:null)}}]),r}();exports.Shader2X=p;
},{"../Shader":"PB8V"}],"cqLV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Value2D=void 0;var e=require("../../Shader"),t=require("../Shader2X"),i=require("../ShaderDefines2D"),a=require("../../../utils/RenderState2D"),s=require("../../../../utils/PlatformInfo");function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}var l=function(){function n(e,t){h(this,n),this.defines=new i.ShaderDefines2D,this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.clipOff=[0,0],this.mainID=e,this.subID=t,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=e|t,this._inClassCache=n._cache[this._cacheID],e>0&&!this._inClassCache&&(this._inClassCache=n._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}return r(n,[{key:"setValue",value:function(e){}},{key:"_ShaderWithCompile",value:function(){return e.Shader.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,t.Shader2X.create,this._attribLocation)}},{key:"upload",value:function(){var t=a.RenderState2D;a.RenderState2D.worldMatrix4===a.RenderState2D.TEMPMAT4_ARRAY||this.defines.addInt(i.ShaderDefines2D.WORLDMAT),this.mmat=t.worldMatrix4,a.RenderState2D.matWVP&&(this.defines.addInt(i.ShaderDefines2D.MVP3D),this.u_MvpMatrix=a.RenderState2D.matWVP.elements);var s=e.Shader.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();s._shaderValueWidth!==t.width||s._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,s._shaderValueWidth=t.width,s._shaderValueHeight=t.height,s.upload(this,null)):s.upload(this,s._params2dQuick2||s._make2dQuick2())}},{key:"setFilters",value:function(e){if(this.filters=e,e)for(var t,i=e.length,a=0;a<i;a++)(t=e[a])&&(this.defines.add(t.type),t.action.setValue(this))}},{key:"clear",value:function(){this.defines._value=this.subID+(s.PlatformInfo.shaderHighPrecision?i.ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION:0),this.clipOff[0]=0}},{key:"release",value:function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1,this.clipOff[0]=0)}}],[{key:"_initone",value:function(e,t){n._typeClass[e]=t,n._cache[e]=[],n._cache[e]._length=0}},{key:"__init__",value:function(){}},{key:"create",value:function(e,t){var i=n._cache[e|t];return i._length?i[--i._length]:new n._typeClass[e|t](t)}}]),n}();exports.Value2D=l,l._cache=[],l._typeClass=[],l.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];
},{"../../Shader":"PB8V","../Shader2X":"hTSO","../ShaderDefines2D":"el31","../../../utils/RenderState2D":"k75q","../../../../utils/PlatformInfo":"HmZQ"}],"/SF1":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubmitKey=void 0;var i=function(){function t(){e(this,t),this.clear()}return r(t,[{key:"clear",value:function(){this.submitType=-1,this.blendShader=this.other=0}},{key:"copyFrom",value:function(e){this.other=e.other,this.blendShader=e.blendShader,this.submitType=e.submitType}},{key:"copyFrom2",value:function(e,t,r){this.other=r,this.submitType=t}},{key:"equal3_2",value:function(e,t,r){return this.submitType===t&&this.other===r&&this.blendShader===e.blendShader}},{key:"equal4_2",value:function(e,t,r){return this.submitType===t&&this.other===r&&this.blendShader===e.blendShader}},{key:"equal_3",value:function(e){return this.submitType===e.submitType&&this.blendShader===e.blendShader}},{key:"equal",value:function(e){return this.other===e.other&&this.submitType===e.submitType&&this.blendShader===e.blendShader}}]),t}();exports.SubmitKey=i;
},{}],"ud/G":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubmitCMD=void 0;var e=require("././SubmitKey");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var i=function(){function n(){t(this,n),this._ref=1,this._key=new e.SubmitKey}return r(n,[{key:"renderSubmit",value:function(){return this.fun.apply(this._this,this.args),1}},{key:"getRenderType",value:function(){return 0}},{key:"releaseRender",value:function(){if(--this._ref<1){var e=n.POOL;e[e._length++]=this}}}],[{key:"create",value:function(e,t,r){var i=n.POOL._length?n.POOL[--n.POOL._length]:new n;return i.fun=t,i.args=e,i._this=r,i._ref=1,i._key.clear(),i}}]),n}();exports.SubmitCMD=i,i.POOL=[],i.POOL._length=0;
},{"././SubmitKey":"/SF1"}],"zHX+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Filter=void 0;var e=require("../maths/Matrix"),t=require("../maths/Point"),r=require("../maths/Rectangle"),i=require("../resource/RenderTexture2D"),a=require("../resource/WebGLRTMgr"),n=require("../webgl/canvas/BlendMode"),h=require("../webgl/shader/d2/ShaderDefines2D"),l=require("../webgl/shader/d2/value/Value2D"),u=require("../webgl/submit/SubmitCMD");function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var c=function(){function e(){d(this,e)}return s(e,[{key:"type",get:function(){return-1}}]),e}();exports.Filter=c,c.BLUR=16,c.COLOR=32,c.GLOW=8,c._filter=function(d,o,s,y){var g=o,f=this._next;if(f){var x=d.filters,T=x.length;if(1==T&&x[0].type==c.COLOR)return o.save(),o.setColorFilter(x[0]),f._fun.call(f,d,o,s,y),void o.restore();var w,R=l.Value2D.create(h.ShaderDefines2D.TEXTURE2D,0),v=t.Point.TEMP,b=g._curMat,p=e.Matrix.create();b.copyTo(p);var M=0,D=0,_=null,C=d._cacheStyle.filterCache||null;if(C&&0==d.getRepaint()){if((d._cacheStyle.hasGlowFilter||!1)&&(M=50,D=25),(w=d.getBounds()).width<=0||w.height<=0)return;w.width+=M,w.height+=M,v.x=w.x*p.a+w.y*p.c,v.y=w.y*p.d+w.x*p.b,w.x=v.x,w.y=v.y,v.x=w.width*p.a+w.height*p.c,v.y=w.height*p.d+w.width*p.b,w.width=v.x,w.height=v.y}else{d._isHaveGlowFilter()&&(M=50,D=25),(w=new r.Rectangle).copyFrom(d.getSelfBounds()),w.x+=d.x,w.y+=d.y,w.x-=d.pivotX+4,w.y-=d.pivotY+4;var O=w.x,L=w.y;if(w.width+=M+8,w.height+=M+8,v.x=w.x*p.a+w.y*p.c,v.y=w.y*p.d+w.x*p.b,w.x=v.x,w.y=v.y,v.x=w.width*p.a+w.height*p.c,v.y=w.height*p.d+w.width*p.b,w.width=v.x,w.height=v.y,w.width<=0||w.height<=0)return;C&&a.WebGLRTMgr.releaseRT(C),_=a.WebGLRTMgr.getRT(w.width,w.height);var m=C=a.WebGLRTMgr.getRT(w.width,w.height);d._getCacheStyle().filterCache=C,g.pushRT(),g.useRT(_);var q=d.x-O+D,E=d.y-L+D;f._fun.call(f,d,o,q,E),g.useRT(m);for(var P=0;P<T;P++){0!=P&&(g.useRT(_),g.drawTarget(m,0,0,w.width,w.height,e.Matrix.TEMP.identity(),R,null,n.BlendMode.TOINT.overlay),g.useRT(m));var S=x[P];switch(S.type){case c.BLUR:case c.GLOW:S._glRender&&S._glRender.render(_,o,w.width,w.height,S);break;case c.COLOR:g.setColorFilter(S),g.drawTarget(_,0,0,w.width,w.height,e.Matrix.EMPTY.identity(),l.Value2D.create(h.ShaderDefines2D.TEXTURE2D,0)),g.setColorFilter(null)}}g.popRT()}if(s=s-D-d.x,y=y-D-d.y,v.setTo(s,y),p.transformPoint(v),s=v.x+w.x,y=v.y+w.y,g._drawRenderTexture(C,s,y,w.width,w.height,e.Matrix.TEMP.identity(),1,i.RenderTexture2D.defuv),_){var F=u.SubmitCMD.create([_],function(e){e.destroy()},this);_=null,o.addRenderObject(F)}p.destroy()}};
},{"../maths/Matrix":"GG2z","../maths/Point":"ziZY","../maths/Rectangle":"iPyf","../resource/RenderTexture2D":"pIGp","../resource/WebGLRTMgr":"v/6A","../webgl/canvas/BlendMode":"brGx","../webgl/shader/d2/ShaderDefines2D":"el31","../webgl/shader/d2/value/Value2D":"cqLV","../webgl/submit/SubmitCMD":"ud/G"}],"kHKw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Utils=void 0;var e=require("../maths/Point"),t=require("../maths/Rectangle");function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var i=function(){function n(){r(this,n)}return a(n,null,[{key:"toRadian",value:function(e){return e*n._pi2}},{key:"toAngle",value:function(e){return e*n._pi}},{key:"toHexColor",value:function(e){if(e<0||isNaN(e))return null;for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t}},{key:"getGID",value:function(){return n._gid++}},{key:"concatArray",value:function(e,t){if(!t)return e;if(!e)return t;var r,n=t.length;for(r=0;r<n;r++)e.push(t[r]);return e}},{key:"clearArray",value:function(e){return e?(e.length=0,e):e}},{key:"copyArray",value:function(e,t){if(e||(e=[]),!t)return e;e.length=t.length;var r,n=t.length;for(r=0;r<n;r++)e[r]=t[r];return e}},{key:"getGlobalRecByPoints",value:function(r,n,a,i,o){var l,u;l=e.Point.create().setTo(n,a),l=r.localToGlobal(l),u=e.Point.create().setTo(i,o),u=r.localToGlobal(u);var s=t.Rectangle._getWrapRec([l.x,l.y,u.x,u.y]);return l.recover(),u.recover(),s}},{key:"getGlobalPosAndScale",value:function(e){return n.getGlobalRecByPoints(e,0,0,1,1)}},{key:"bind",value:function(e,t){return e.bind(t)}},{key:"updateOrder",value:function(e){if(!e||e.length<2)return!1;for(var t,r,n,a=1,i=e.length;a<i;){for(n=e[t=a],r=e[t]._zOrder;--t>-1&&e[t]._zOrder>r;)e[t+1]=e[t];e[t+1]=n,a++}return!0}},{key:"transPointList",value:function(e,t,r){var n,a=e.length;for(n=0;n<a;n+=2)e[n]+=t,e[n+1]+=r}},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=parseInt(e,t);return isNaN(r)?0:r})},{key:"getFileExtension",value:function(e){n._extReg.lastIndex=e.lastIndexOf(".");var t=n._extReg.exec(e);return t&&t.length>1?t[1].toLowerCase():null}},{key:"getTransformRelativeToWindow",value:function(e,t,r){var a=n.gStage,i=n.getGlobalPosAndScale(e),o=a._canvasTransform.clone(),l=o.tx,u=o.ty;o.rotate(-Math.PI/180*a.canvasDegree),o.scale(a.clientScaleX,a.clientScaleY);var s,c,f,g,v=a.canvasDegree%180!=0;return v?(s=r+i.y,c=t+i.x,s*=o.d,c*=o.a,90==a.canvasDegree?(s=l-s,c+=u):(s+=l,c=u-c)):(s=t+i.x,c=r+i.y,s*=o.a,c*=o.d,s+=l,c+=u),c+=a._safariOffsetY,v?(f=o.d*i.height,g=o.a*i.width):(f=o.a*i.width,g=o.d*i.height),{x:s,y:c,scaleX:f,scaleY:g}}},{key:"fitDOMElementInArea",value:function(e,t,r,a,i,o){e._fitLayaAirInitialized||(e._fitLayaAirInitialized=!0,e.style.transformOrigin=e.style.webKittransformOrigin="left top",e.style.position="absolute");var l=n.getTransformRelativeToWindow(t,r,a);e.style.transform=e.style.webkitTransform="scale("+l.scaleX+","+l.scaleY+") rotate("+n.gStage.canvasDegree+"deg)",e.style.width=i+"px",e.style.height=o+"px",e.style.left=l.x+"px",e.style.top=l.y+"px"}},{key:"isOkTextureList",value:function(e){if(!e)return!1;var t,r,n=e.length;for(t=0;t<n;t++)if(!(r=e[t])||!r._getSource())return!1;return!0}},{key:"isOKCmdList",value:function(e){if(!e)return!1;var t,r=e.length;for(t=0;t<r;t++)e[t];return!0}},{key:"getQueryString",value:function(e){if(!window.location||!window.location.search)return null;var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(t);return null!=r?unescape(r[2]):null}}]),n}();exports.Utils=i,i.gStage=null,i._gid=1,i._pi=180/Math.PI,i._pi2=Math.PI/180,i._extReg=/\.(\w+)\??/g,i.parseXMLFromString=function(e){var t;if(e=e.replace(/>\s+</g,"><"),(t=(new DOMParser).parseFromString(e,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors")>-1)throw new Error(t.firstChild.firstChild.textContent);return t};
},{"../maths/Point":"ziZY","../maths/Rectangle":"iPyf"}],"iLoT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorUtils=void 0;var r=require("./Utils");function o(r,o){if(!(r instanceof o))throw new TypeError("Cannot call a class as a function")}function t(r,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function e(r,o,e){return o&&t(r.prototype,o),e&&t(r,e),r}var i=function(){function t(e){if(o(this,t),this.arrColor=[],null==e)return this.strColor="#00000000",this.numColor=0,void(this.arrColor=[0,0,0,0]);var i,l,n;if("string"==typeof e)if(e.indexOf("rgba(")>=0||e.indexOf("rgb(")>=0){var a,s,h=e;for(a=h.indexOf("("),s=h.indexOf(")"),h=h.substring(a+1,s),this.arrColor=h.split(","),l=this.arrColor.length,i=0;i<l;i++)this.arrColor[i]=parseFloat(this.arrColor[i]),i<3&&(this.arrColor[i]=Math.round(this.arrColor[i]));n=4==this.arrColor.length?256*(256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2])+Math.round(255*this.arrColor[3]):256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2],this.strColor=e}else{if(this.strColor=e,"#"===e.charAt(0)&&(e=e.substr(1)),3===(l=e.length)||4===l){var u="";for(i=0;i<l;i++)u+=e[i]+e[i];e=u}n=parseInt(e,16)}else n=e,this.strColor=r.Utils.toHexColor(n);this.strColor.indexOf("rgba")>=0||9===this.strColor.length?(this.arrColor=[((4278190080&n)>>>24)/255,((16711680&n)>>16)/255,((65280&n)>>8)/255,(255&n)/255],this.numColor=(4278190080&n)>>>24|(16711680&n)>>8|(65280&n)<<8|(255&n)<<24):(this.arrColor=[((16711680&n)>>16)/255,((65280&n)>>8)/255,(255&n)/255,1],this.numColor=4278190080|(16711680&n)>>16|65280&n|(255&n)<<16),this.arrColor.__id=++t._COLODID}return e(t,null,[{key:"_initDefault",value:function(){for(var r in t._DEFAULT={},t._COLOR_MAP)t._SAVE[r]=t._DEFAULT[r]=new t(t._COLOR_MAP[r]);return t._DEFAULT}},{key:"_initSaveMap",value:function(){for(var r in t._SAVE_SIZE=0,t._SAVE={},t._DEFAULT)t._SAVE[r]=t._DEFAULT[r]}},{key:"create",value:function(r){var o=r+"",e=t._SAVE[o];return null!=e?e:(t._SAVE_SIZE<1e3&&t._initSaveMap(),t._SAVE[o]=new t(r))}}]),t}();exports.ColorUtils=i,i._SAVE={},i._SAVE_SIZE=0,i._COLOR_MAP={purple:"#800080",orange:"#ffa500",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"},i._DEFAULT=i._initDefault(),i._COLODID=1;
},{"./Utils":"kHKw"}],"uQu9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorFilter=void 0;var t=require("././Filter"),r=require("../utils/ColorUtils");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function n(t,r){for(var e=0;e<r.length;e++){var i=r[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),t}function a(t,r){return!r||"object"!==e(r)&&"function"!=typeof r?u(t):r}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&c(t,r)}function c(t,r){return(c=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var f=function(e){function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return i(this,n),t=a(this,l(n).call(this)),r||(r=t._copyMatrix(n.IDENTITY_MATRIX)),t._mat=new Float32Array(16),t._alpha=new Float32Array(4),t.setByMatrix(r),t}return s(n,t.Filter),o(n,[{key:"gray",value:function(){return this.setByMatrix(n.GRAY_MATRIX)}},{key:"color",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.setByMatrix([1,0,0,0,t,0,1,0,0,r,0,0,1,0,e,0,0,0,1,i])}},{key:"setColor",value:function(t){var e=r.ColorUtils.create(t).arrColor,i=[0,0,0,0,256*e[0],0,0,0,0,256*e[1],0,0,0,0,256*e[2],0,0,0,1,0];return this.setByMatrix(i)}},{key:"setByMatrix",value:function(t){this._matrix!=t&&this._copyMatrix(t);for(var r=0,e=0,i=0;i<20;i++)i%5!=4?this._mat[r++]=t[i]:this._alpha[e++]=t[i];return this}},{key:"adjustColor",value:function(t,r,e,i){return this.adjustHue(i),this.adjustContrast(r),this.adjustBrightness(t),this.adjustSaturation(e),this}},{key:"adjustBrightness",value:function(t){return 0==(t=this._clampValue(t,100))||isNaN(t)?this:this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1])}},{key:"adjustContrast",value:function(t){if(0==(t=this._clampValue(t,100))||isNaN(t))return this;var r,e=(r=t<0?127+t/100*127:127*(r=0==(r=t%1)?n.DELTA_INDEX[t]:n.DELTA_INDEX[t<<0]*(1-r)+n.DELTA_INDEX[1+(t<<0)]*r)+127)/127,i=.5*(127-r);return this._multiplyMatrix([e,0,0,0,i,0,e,0,0,i,0,0,e,0,i,0,0,0,1,0,0,0,0,0,1])}},{key:"adjustSaturation",value:function(t){if(0==(t=this._clampValue(t,100))||isNaN(t))return this;var r=1+(t>0?3*t/100:t/100),e=1-r,i=.3086*e,n=.6094*e,o=.082*e;return this._multiplyMatrix([i+r,n,o,0,0,i,n+r,o,0,0,i,n,o+r,0,0,0,0,0,1,0,0,0,0,0,1])}},{key:"adjustHue",value:function(t){if(0==(t=this._clampValue(t,180)/180*Math.PI)||isNaN(t))return this;var r=Math.cos(t),e=Math.sin(t),i=.213,n=.715,o=.072;return this._multiplyMatrix([i+r*(1-i)+e*-i,n+r*-n+e*-n,o+r*-o+e*(1-o),0,0,i+r*-i+.143*e,n+r*(1-n)+.14*e,o+r*-o+-.283*e,0,0,i+r*-i+-.787*e,n+r*-n+e*n,o+r*(1-o)+e*o,0,0,0,0,0,1,0,0,0,0,0,1])}},{key:"reset",value:function(){return this.setByMatrix(this._copyMatrix(n.IDENTITY_MATRIX))}},{key:"_multiplyMatrix",value:function(t){var r=[];this._matrix=this._fixMatrix(this._matrix);for(var e=0;e<5;e++){for(var i=0;i<5;i++)r[i]=this._matrix[i+5*e];for(i=0;i<5;i++){for(var n=0,o=0;o<5;o++)n+=t[i+5*o]*r[o];this._matrix[i+5*e]=n}}return this.setByMatrix(this._matrix)}},{key:"_clampValue",value:function(t,r){return Math.min(r,Math.max(-r,t))}},{key:"_fixMatrix",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==t?n.IDENTITY_MATRIX:(t.length<n.LENGTH?t=t.slice(0,t.length).concat(n.IDENTITY_MATRIX.slice(t.length,n.LENGTH)):t.length>n.LENGTH&&(t=t.slice(0,n.LENGTH)),t)}},{key:"_copyMatrix",value:function(t){var r=n.LENGTH;this._matrix||(this._matrix=[]);for(var e=0;e<r;e++)this._matrix[e]=t[e];return this._matrix}},{key:"type",get:function(){return t.Filter.COLOR}}]),n}();exports.ColorFilter=f,f.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],f.GRAY_MATRIX=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0],f.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],f.LENGTH=25;
},{"././Filter":"zHX+","../utils/ColorUtils":"iLoT"}],"n0RH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawTextureCmd=void 0;var e=require("../../filters/ColorFilter"),t=require("../../utils/Pool");function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var n=function(){function o(){r(this,o),this.colorFlt=null}return i(o,[{key:"recover",value:function(){this.texture._removeReference(),this.texture=null,this.matrix=null,t.Pool.recover("DrawTextureCmd",this)}},{key:"run",value:function(e,t,r){e.drawTextureWithTransform(this.texture,this.x,this.y,this.width,this.height,this.matrix,t,r,this.alpha,this.blendMode,this.colorFlt)}},{key:"cmdID",get:function(){return o.ID}}],[{key:"create",value:function(r,i,n,l,u,a,s,c,h){var f=t.Pool.getItemByClass("DrawTextureCmd",o);return f.texture=r,r._addReference(),f.x=i,f.y=n,f.width=l,f.height=u,f.matrix=a,f.alpha=s,f.color=c,f.blendMode=h,c&&(f.colorFlt=new e.ColorFilter,f.colorFlt.setColor(c)),f}}]),o}();exports.DrawTextureCmd=n,n.ID="DrawTexture";
},{"../../filters/ColorFilter":"uQu9","../../utils/Pool":"Jkpb"}],"ty0b":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FillTextureCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}var n=function(){function r(){t(this,r)}return i(r,[{key:"recover",value:function(){this.texture=null,this.offset=null,this.other=null,e.Pool.recover("FillTextureCmd",this)}},{key:"run",value:function(e,t,r){e.fillTexture(this.texture,this.x+t,this.y+r,this.width,this.height,this.type,this.offset,this.other)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,i,n,o,u,l,s,h){var a=e.Pool.getItemByClass("FillTextureCmd",r);return a.texture=t,a.x=i,a.y=n,a.width=o,a.height=u,a.type=l,a.offset=s,a.other=h,a}}]),r}();exports.FillTextureCmd=n,n.ID="FillTexture";
},{"../../utils/Pool":"Jkpb"}],"zk/l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RestoreCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}var n=function(){function t(){r(this,t)}return o(t,[{key:"recover",value:function(){e.Pool.recover("RestoreCmd",this)}},{key:"run",value:function(e,r,t){e.restore()}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(){return e.Pool.getItemByClass("RestoreCmd",t)}}]),t}();exports.RestoreCmd=n,n.ID="Restore";
},{"../../utils/Pool":"Jkpb"}],"gArK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RotateCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var n=function(){function o(){t(this,o)}return r(o,[{key:"recover",value:function(){e.Pool.recover("RotateCmd",this)}},{key:"run",value:function(e,t,o){e._rotate(this.angle,this.pivotX+t,this.pivotY+o)}},{key:"cmdID",get:function(){return o.ID}}],[{key:"create",value:function(t,r,n){var a=e.Pool.getItemByClass("RotateCmd",o);return a.angle=t,a.pivotX=r,a.pivotY=n,a}}]),o}();exports.RotateCmd=n,n.ID="Rotate";
},{"../../utils/Pool":"Jkpb"}],"Tl7A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScaleCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=function(){function r(){t(this,r)}return n(r,[{key:"recover",value:function(){e.Pool.recover("ScaleCmd",this)}},{key:"run",value:function(e,t,r){e._scale(this.scaleX,this.scaleY,this.pivotX+t,this.pivotY+r)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,n,o,a){var c=e.Pool.getItemByClass("ScaleCmd",r);return c.scaleX=t,c.scaleY=n,c.pivotX=o,c.pivotY=a,c}}]),r}();exports.ScaleCmd=o,o.ID="Scale";
},{"../../utils/Pool":"Jkpb"}],"MOMZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransformCmd=void 0;var r=require("../../utils/Pool");function e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function t(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function n(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),r}var o=function(){function t(){e(this,t)}return n(t,[{key:"recover",value:function(){this.matrix=null,r.Pool.recover("TransformCmd",this)}},{key:"run",value:function(r,e,t){r._transform(this.matrix,this.pivotX+e,this.pivotY+t)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(e,n,o){var i=r.Pool.getItemByClass("TransformCmd",t);return i.matrix=e,i.pivotX=n,i.pivotY=o,i}}]),t}();exports.TransformCmd=o,o.ID="Transform";
},{"../../utils/Pool":"Jkpb"}],"V/SB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TranslateCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a=function(){function r(){t(this,r)}return n(r,[{key:"recover",value:function(){e.Pool.recover("TranslateCmd",this)}},{key:"run",value:function(e,t,r){e.translate(this.tx,this.ty)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,n){var a=e.Pool.getItemByClass("TranslateCmd",r);return a.tx=t,a.ty=n,a}}]),r}();exports.TranslateCmd=a,a.ID="Translate";
},{"../../utils/Pool":"Jkpb"}],"d9b0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bezier=void 0;var t=require("././Point");function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var o=0;o<n.length;o++){var i=n[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,n,i){return n&&o(t.prototype,n),i&&o(t,i),t}var e=function(){function o(){n(this,o),this._controlPoints=[new t.Point,new t.Point,new t.Point],this._calFun=this.getPoint2}return i(o,[{key:"_switchPoint",value:function(t,n){var o=this._controlPoints.shift();o.setTo(t,n),this._controlPoints.push(o)}},{key:"getPoint2",value:function(t,n){var o=this._controlPoints[0],i=this._controlPoints[1],e=this._controlPoints[2],r=Math.pow(1-t,2)*o.x+2*t*(1-t)*i.x+Math.pow(t,2)*e.x,s=Math.pow(1-t,2)*o.y+2*t*(1-t)*i.y+Math.pow(t,2)*e.y;n.push(r,s)}},{key:"getPoint3",value:function(t,n){var o=this._controlPoints[0],i=this._controlPoints[1],e=this._controlPoints[2],r=this._controlPoints[3],s=Math.pow(1-t,3)*o.x+3*i.x*t*(1-t)*(1-t)+3*e.x*t*t*(1-t)+r.x*Math.pow(t,3),a=Math.pow(1-t,3)*o.y+3*i.y*t*(1-t)*(1-t)+3*e.y*t*t*(1-t)+r.y*Math.pow(t,3);n.push(s,a)}},{key:"insertPoints",value:function(t,n){var o,i;for(i=1/(t=t>0?t:5),o=0;o<=1;o+=i)this._calFun(o,n)}},{key:"getBezierPoints",value:function(n){var o,i,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if((i=n.length)<2*(r+1))return[];var s=[];switch(r){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=r;)this._controlPoints.push(t.Point.create());for(o=0;o<2*r;o+=2)this._switchPoint(n[o],n[o+1]);for(o=2*r;o<i;o+=2)this._switchPoint(n[o],n[o+1]),o/2%r==0&&this.insertPoints(e,s);return s}}]),o}();exports.Bezier=e,e.I=new e;
},{"././Point":"ziZY"}],"5c0r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GrahamScan=void 0;var t=require("././Point"),e=require("../utils/Utils");function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}var o=function(){function r(){n(this,r)}return i(r,null,[{key:"multiply",value:function(t,e,n){return(t.x-n.x)*(e.y-n.y)-(e.x-n.x)*(t.y-n.y)}},{key:"dis",value:function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)}},{key:"_getPoints",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(r._mPointList||(r._mPointList=[]);r._mPointList.length<e;)r._mPointList.push(new t.Point);return i||(i=[]),i.length=0,n?r.getFrom(i,r._mPointList,e):r.getFromR(i,r._mPointList,e),i}},{key:"getFrom",value:function(t,e,n){var r;for(r=0;r<n;r++)t.push(e[r]);return t}},{key:"getFromR",value:function(t,e,n){var r;for(r=0;r<n;r++)t.push(e.pop());return t}},{key:"pListToPointList",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.length/2,o=r._getPoints(i,n,r._tempPointList);for(e=0;e<i;e++)o[e].setTo(t[e+e],t[e+e+1]);return o}},{key:"pointListToPlist",value:function(t){var e,n,i=t.length,o=r._temPList;for(o.length=0,e=0;e<i;e++)n=t[e],o.push(n.x,n.y);return o}},{key:"scanPList",value:function(t){return e.Utils.copyArray(t,r.pointListToPlist(r.scan(r.pListToPointList(t,!0))))}},{key:"scan",value:function(t){var n,i,o,u,l,s=0,a=t.length,y={};for((u=r._temArr).length=0,n=(a=t.length)-1;n>=0;n--)l=(o=t[n]).x+"_"+o.y,y.hasOwnProperty(l)||(y[l]=!0,u.push(o));for(a=u.length,e.Utils.copyArray(t,u),n=1;n<a;n++)(t[n].y<t[s].y||t[n].y==t[s].y&&t[n].x<t[s].x)&&(s=n);for(o=t[0],t[0]=t[s],t[s]=o,n=1;n<a-1;n++){for(s=n,i=n+1;i<a;i++)(r.multiply(t[i],t[s],t[0])>0||0==r.multiply(t[i],t[s],t[0])&&r.dis(t[0],t[i])<r.dis(t[0],t[s]))&&(s=i);o=t[n],t[n]=t[s],t[s]=o}if((u=r._temArr).length=0,t.length<3)return e.Utils.copyArray(u,t);for(u.push(t[0],t[1],t[2]),n=3;n<a;n++){for(;u.length>=2&&r.multiply(t[n],u[u.length-1],u[u.length-2])>=0;)u.pop();t[n]&&u.push(t[n])}return u}}]),r}();exports.GrahamScan=o,o._tempPointList=[],o._temPList=[],o._temArr=[];
},{"././Point":"ziZY","../utils/Utils":"kHKw"}],"/R4M":[function(require,module,exports) {
"use strict";function e(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Config=void 0;var i=function i(){e(this,i)};exports.Config=i,i.animationInterval=50,i.isAntialias=!1,i.isAlpha=!1,i.premultipliedAlpha=!0,i.isStencil=!0,i.preserveDrawingBuffer=!1,i.webGL2D_MeshAllocMaxMem=!0,i.is2DPixelArtGame=!1,i.useWebGL2=!1,i.useRetinalCanvas=!1;
},{}],"nP6w":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Texture=void 0;var t=require("../events/Event"),e=require("../events/EventDispatcher"),i=require("../maths/Rectangle"),r=require("../utils/Handler");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,i){return e&&h(t.prototype,e),i&&h(t,i),t}function u(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(n){function h(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return o(this,h),(t=u(this,l(h).call(this))).uvrect=[0,0,1,1],t._destroyed=!1,t._referenceCount=0,t.$_GID=0,t.offsetX=0,t.offsetY=0,t._w=0,t._h=0,t.sourceWidth=0,t.sourceHeight=0,t.url=null,t.scaleRate=1,t.setTo(e,i,r,n),t}return c(h,e.EventDispatcher),s(h,[{key:"_addReference",value:function(){this._bitmap&&this._bitmap._addReference(),this._referenceCount++}},{key:"_removeReference",value:function(){this._bitmap&&this._bitmap._removeReference(),this._referenceCount--}},{key:"_getSource",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._destroyed||!this._bitmap?null:(this.recoverBitmap(t),this._bitmap.destroyed?null:this.bitmap._getSource())}},{key:"_onLoaded",value:function(e,i){if(i)if(i==this);else if(i instanceof h){var r=i;h._create(i,0,0,r.width,r.height,0,0,r.sourceWidth,r.sourceHeight,this)}else this.bitmap=i,this.sourceWidth=this._w=i.width,this.sourceHeight=this._h=i.height;else;e&&e.run(),this.event(t.Event.READY,this)}},{key:"getIsReady",value:function(){return!this._destroyed&&!!this._bitmap}},{key:"setTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.bitmap=t,this.sourceWidth=i,this.sourceHeight=r,t&&(this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||t.width,this.sourceHeight=this.sourceHeight||t.height),this.uv=e||h.DEF_UV}},{key:"load",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._destroyed||h.gLoader.load(t,r.Handler.create(this,this._onLoaded,[e]),null,"htmlimage",1,!1,null,!0)}},{key:"getTexturePixels",value:function(t,e,i,r){var n,o,s,u=this.bitmap,a=u.width,l=u.height;if(t+i>a&&(i-=t+i-a),e+r>l&&(r-=e+r-l),i<=0||r<=0)return null;var c=4*i,v=null;try{v=u.getPixels()}catch(w){}if(v){if(0==t&&0==e&&i==a&&r==l)return v;var f=new Uint8Array(i*r*4);for(n=4*t,o=(e+r-1)*(c=4*a)+4*t,s=r-1;s>=0;s--)f.set(b.slice(o,o+4*i),n),n+=c,o-=c;return f}var d=new h.gContext;d.size(i,r),d.asBitmap=!0;var _=null;if(0!=t||0!=e||i!=a||r!=l){var g=(_=_.concat())[0],y=_[1],p=(_[2]-g)/a,m=(_[7]-y)/l;_=[g+t*p,y+e*m,g+(t+i)*p,y+e*m,g+(t+i)*p,y+(e+r)*m,g+t*p,y+(e+r)*m]}d._drawTextureM(this,0,0,i,r,null,1,_),d._targets.start(),d.flush(),d._targets.end(),d._targets.restore();var b=d._targets.getData(0,0,i,r);for(d.destroy(),f=new Uint8Array(i*r*4),n=0,o=(r-1)*c,s=r-1;s>=0;s--)f.set(b.slice(o,o+c),n),n+=c,o-=c;return f}},{key:"getPixels",value:function(t,e,i,r){return window.conch?this._nativeObj.getImageData(t,e,i,r):this.getTexturePixels(t,e,i,r)}},{key:"recoverBitmap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this._bitmap.url;this._destroyed||this._bitmap&&!this._bitmap.destroyed||!e||h.gLoader.load(e,r.Handler.create(this,function(e){this.bitmap=e,t&&t()}),null,"htmlimage",1,!1,null,!0)}},{key:"disposeBitmap",value:function(){!this._destroyed&&this._bitmap&&this._bitmap.destroy()}},{key:"destroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._destroyed){this._destroyed=!0;var e=this._bitmap;e&&(e._removeReference(this._referenceCount),(0===e.referenceCount||t)&&e.destroy(),e=null),this.url&&this===h.gLoader.getRes(this.url)&&h.gLoader.clearRes(this.url)}}},{key:"uv",get:function(){return this._uv},set:function(t){this.uvrect[0]=Math.min(t[0],t[2],t[4],t[6]),this.uvrect[1]=Math.min(t[1],t[3],t[5],t[7]),this.uvrect[2]=Math.max(t[0],t[2],t[4],t[6])-this.uvrect[0],this.uvrect[3]=Math.max(t[1],t[3],t[5],t[7])-this.uvrect[1],this._uv=t}},{key:"width",get:function(){return this._w?this._w:this.bitmap?this.uv&&this.uv!==h.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width:0},set:function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}},{key:"height",get:function(){return this._h?this._h:this.bitmap?this.uv&&this.uv!==h.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height:0},set:function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}},{key:"bitmap",get:function(){return this._bitmap},set:function(t){this._bitmap&&this._bitmap._removeReference(this._referenceCount),this._bitmap=t,t&&t._addReference(this._referenceCount)}},{key:"destroyed",get:function(){return this._destroyed}}],[{key:"moveUV",value:function(t,e,i){for(var r=0;r<8;r+=2)i[r]+=t,i[r+1]+=e;return i}},{key:"create",value:function(t,e,i,r,n){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return h._create(t,e,i,r,n,o,s,u,a)}},{key:"_create",value:function(t,e,i,r,n){var o,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,v=t instanceof h,f=v?t.uv:h.DEF_UV,d=v?t.bitmap:t;d.width&&e+r>d.width&&(r=d.width-e),d.height&&i+n>d.height&&(n=d.height-i),c?(o=c).setTo(d,null,a||r,l||n):o=new h(d,null,a||r,l||n),o.width=r,o.height=n,o.offsetX=s,o.offsetY=u;var _=1/d.width,g=1/d.height;e*=_,i*=g,r*=_,n*=g;var y=o.uv[0],p=o.uv[1],m=o.uv[4],b=o.uv[5],w=m-y,k=b-p,x=h.moveUV(f[0],f[1],[e,i,e+r,i,e+r,i+n,e,i+n]);o.uv=new Float32Array([y+x[0]*w,p+x[1]*k,m-(1-x[2])*w,p+x[3]*k,m-(1-x[4])*w,b-(1-x[5])*k,y+x[6]*w,b-(1-x[7])*k]);var R=d.scaleRate;return R&&1!=R?(o.sourceWidth/=R,o.sourceHeight/=R,o.width/=R,o.height/=R,o.scaleRate=R):o.scaleRate=1,o}},{key:"createFromTexture",value:function(t,e,r,n,o){var s=t.scaleRate;1!=s&&(e*=s,r*=s,n*=s,o*=s);var u=i.Rectangle.TEMP.setTo(e-t.offsetX,r-t.offsetY,n,o),a=u.intersection(h._rect1.setTo(0,0,t.width,t.height),h._rect2);return a?h.create(t,a.x,a.y,a.width,a.height,a.x-u.x,a.y-u.y,n,o):null}}]),h}();exports.Texture=f,f.gContext=null,f.gLoader=null,f.DEF_UV=new Float32Array([0,0,1,0,1,1,0,1]),f.NO_UV=new Float32Array([0,0,0,0,0,0,0,0]),f.INV_UV=new Float32Array([0,1,1,1,1,0,0,0]),f._rect1=new i.Rectangle,f._rect2=new i.Rectangle;
},{"../events/Event":"jK6U","../events/EventDispatcher":"IA8z","../maths/Rectangle":"iPyf","../utils/Handler":"FZg7"}],"MDgz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawStyle=void 0;var e=require("../../utils/ColorUtils");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var n=function(){function o(e){t(this,o),this.setValue(e)}return r(o,[{key:"setValue",value:function(t){this._color=t?t instanceof e.ColorUtils?t:e.ColorUtils.create(t):e.ColorUtils.create("#000000")}},{key:"reset",value:function(){this._color=e.ColorUtils.create("#000000")}},{key:"toInt",value:function(){return this._color.numColor}},{key:"equal",value:function(t){return t instanceof String?this._color.strColor===t:t instanceof e.ColorUtils&&this._color.numColor===t.numColor}},{key:"toColorStr",value:function(){return this._color.strColor}}],[{key:"create",value:function(t){if(t){var r=t instanceof e.ColorUtils?t:e.ColorUtils.create(t);return r._drawStyle||(r._drawStyle=new o(t))}return o.DEFAULT}}]),o}();exports.DrawStyle=n,n.DEFAULT=new n("#000000");
},{"../../utils/ColorUtils":"iLoT"}],"3MIm":[function(require,module,exports) {
"use strict";function t(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}function h(t,h){for(var e=0;e<h.length;e++){var a=h[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function e(t,e,a){return e&&h(t.prototype,e),a&&h(t,a),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Path=void 0;var a=function(){function h(){t(this,h),this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}return e(h,[{key:"beginPath",value:function(t){this.paths.length=1,this._curPath=this.paths[0]=new i,this._curPath.convex=t}},{key:"closePath",value:function(){this._curPath.loop=!0}},{key:"newPath",value:function(){this._curPath=new i,this.paths.push(this._curPath)}},{key:"addPoint",value:function(t,h){this._curPath.path.push(t,h)}},{key:"push",value:function(t,h){this._curPath?this._curPath.path.length>0&&(this._curPath=new i,this.paths.push(this._curPath)):(this._curPath=new i,this.paths.push(this._curPath));var e=this._curPath;e.path=t.slice(),e.convex=h}},{key:"reset",value:function(){this.paths.length=0}}]),h}();exports.Path=a;var i=function h(){t(this,h),this.path=[],this.loop=!1,this.convex=!1};
},{}],"U5L8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubmitBase=void 0;var e=require("././SubmitKey"),t=require("../shader/d2/value/Value2D");function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var u=function(){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.TYPE_2D;n(this,r),this.clipInfoID=-1,this._mesh=null,this._blendFn=null,this._id=0,this._renderType=0,this._parent=null,this._key=new e.SubmitKey,this._startIdx=0,this._numEle=0,this._ref=1,this.shaderValue=null,this._renderType=t,this._id=++r.ID}return i(r,[{key:"getID",value:function(){return this._id}},{key:"getRenderType",value:function(){return this._renderType}},{key:"toString",value:function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key}},{key:"renderSubmit",value:function(){return 1}},{key:"releaseRender",value:function(){}}],[{key:"__init__",value:function(){var e=r.RENDERBASE=new r(-1);e.shaderValue=new t.Value2D(0,0),e.shaderValue.ALPHA=1,e._ref=4294967295}}]),r}();exports.SubmitBase=u,u.TYPE_2D=1e4,u.TYPE_CANVAS=10003,u.TYPE_CMDSETRT=10004,u.TYPE_CUSTOM=10005,u.TYPE_BLURRT=10006,u.TYPE_CMDDESTORYPRERT=10007,u.TYPE_DISABLESTENCIL=10008,u.TYPE_OTHERIBVB=10009,u.TYPE_PRIMITIVE=10010,u.TYPE_RT=10011,u.TYPE_BLUR_RT=10012,u.TYPE_TARGET=10013,u.TYPE_CHANGE_VALUE=10014,u.TYPE_SHAPE=10015,u.TYPE_TEXTURE=10016,u.TYPE_FILLTEXTURE=10017,u.KEY_ONCE=-1,u.KEY_FILLRECT=1,u.KEY_DRAWTEXTURE=2,u.KEY_VG=3,u.KEY_TRIANGLES=4,u.ID=1,u.preRender=null;
},{"././SubmitKey":"/SF1","../shader/d2/value/Value2D":"cqLV"}],"3ch1":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Buffer=void 0;var e=require("../../layagl/LayaGL");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}var f=function(){function t(){r(this,t),this._byteLength=0,this._glBuffer=e.LayaGL.instance.createBuffer()}return n(t,[{key:"_bindForVAO",value:function(){}},{key:"bind",value:function(){return!1}},{key:"destroy",value:function(){this._glBuffer&&(e.LayaGL.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),t}();exports.Buffer=f;
},{"../../layagl/LayaGL":"ezDE"}],"5Dwh":[function(require,module,exports) {
"use strict";function o(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderInfo=void 0;var e=function e(){o(this,e)};exports.RenderInfo=e,e.loopStTm=0,e.loopCount=0;
},{}],"XmYZ":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Buffer2D=void 0;var e=require("../../layagl/LayaGL"),t=require("../WebGLContext"),i=require("../shader/BaseShader"),r=require("./Buffer"),n=require("../../renders/RenderInfo");function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}function a(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?o(e):t}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(f){function s(){var e;return u(this,s),(e=a(this,_(s).call(this)))._maxsize=0,e._upload=!0,e._uploadSize=0,e._bufferSize=0,e._u8Array=null,e}return b(s,r.Buffer),h(s,[{key:"setByteLength",value:function(e){this._byteLength!==e&&(e<=this._bufferSize||this._resizeBuffer(2*e+256,!0),this._byteLength=e)}},{key:"needSize",value:function(e){var t=this._byteLength;if(e){var i=this._byteLength+e;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return t}},{key:"_bufferData",value:function(){this._maxsize=Math.max(this._maxsize,this._byteLength),n.RenderInfo.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,e.LayaGL.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),e.LayaGL.instance.bufferSubData(this._bufferType,0,new Uint8Array(this._buffer,0,this._byteLength))}},{key:"_bufferSubData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this._maxsize=Math.max(this._maxsize,this._byteLength),n.RenderInfo.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,e.LayaGL.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),i||r){var f=this._buffer.slice(i,r);e.LayaGL.instance.bufferSubData(this._bufferType,t,f)}else e.LayaGL.instance.bufferSubData(this._bufferType,t,this._buffer)}},{key:"_checkArrayUse",value:function(){}},{key:"_bind_uploadForVAO",value:function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)}},{key:"_bind_upload",value:function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)}},{key:"_bind_subUpload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(e,t,i),!0)}},{key:"_resizeBuffer",value:function(e,t){var i=this._buffer;if(e<=i.byteLength)return this;var r=this._u8Array;if(t&&i&&i.byteLength>0){var n=new ArrayBuffer(e),f=r&&r.buffer==i?r:new Uint8Array(i);(r=this._u8Array=new Uint8Array(n)).set(f,0),i=this._buffer=n}else i=this._buffer=new ArrayBuffer(e),this._u8Array=null;return this._checkArrayUse(),this._upload=!0,this._bufferSize=i.byteLength,this}},{key:"append",value:function(e){var t,i;this._upload=!0,t=e.byteLength,e instanceof Uint8Array?(this._resizeBuffer(this._byteLength+t,!0),i=new Uint8Array(this._buffer,this._byteLength)):e instanceof Uint16Array?(this._resizeBuffer(this._byteLength+t,!0),i=new Uint16Array(this._buffer,this._byteLength)):e instanceof Float32Array&&(this._resizeBuffer(this._byteLength+t,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(e,0),this._byteLength+=t,this._checkArrayUse()}},{key:"appendU16Array",value:function(e,t){this._resizeBuffer(this._byteLength+2*t,!0);var i=new Uint16Array(this._buffer,this._byteLength,t);if(6==t)i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5];else if(t>=100)i.set(new Uint16Array(e.buffer,0,t));else for(var r=0;r<t;r++)i[r]=e[r];this._byteLength+=2*t,this._checkArrayUse()}},{key:"appendEx",value:function(e,t){var i;this._upload=!0,i=e.byteLength,this._resizeBuffer(this._byteLength+i,!0),new t(this._buffer,this._byteLength).set(e,0),this._byteLength+=i,this._checkArrayUse()}},{key:"appendEx2",value:function(e,t,i){var r,n,f,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;for(this._upload=!0,r=i*u,this._resizeBuffer(this._byteLength+r,!0),n=new t(this._buffer,this._byteLength),f=0;f<i;f++)n[f]=e[f];this._byteLength+=r,this._checkArrayUse()}},{key:"getBuffer",value:function(){return this._buffer}},{key:"setNeedUpload",value:function(){this._upload=!0}},{key:"getNeedUpload",value:function(){return this._upload}},{key:"upload",value:function(){var n=this._bind_upload();return e.LayaGL.instance.bindBuffer(this._bufferType,null),this._bufferType==t.WebGLContext.ARRAY_BUFFER&&(r.Buffer._bindedVertexBuffer=null),this._bufferType==t.WebGLContext.ELEMENT_ARRAY_BUFFER&&(r.Buffer._bindedIndexBuffer=null),i.BaseShader.activeShader=null,n}},{key:"subUpload",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=this._bind_subUpload();return e.LayaGL.instance.bindBuffer(this._bufferType,null),this._bufferType==t.WebGLContext.ARRAY_BUFFER&&(r.Buffer._bindedVertexBuffer=null),this._bufferType==t.WebGLContext.ELEMENT_ARRAY_BUFFER&&(r.Buffer._bindedIndexBuffer=null),i.BaseShader.activeShader=null,n}},{key:"_disposeResource",value:function(){this._upload=!0,this._uploadSize=0}},{key:"clear",value:function(){this._byteLength=0,this._upload=!0}},{key:"bufferLength",get:function(){return this._buffer.byteLength}},{key:"byteLength",set:function(e){this.setByteLength(e)}}],[{key:"__int__",value:function(e){}}]),s}();exports.Buffer2D=l,l.FLOAT32=4,l.SHORT=2;
},{"../../layagl/LayaGL":"ezDE","../WebGLContext":"vf9T","../shader/BaseShader":"oKQa","./Buffer":"3ch1","../../renders/RenderInfo":"5Dwh"}],"epk0":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VertexBuffer2D=void 0;var e=require("././Buffer2D"),t=require("../../layagl/LayaGL"),r=require("../WebGLContext"),n=require("./Buffer");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=y(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function y(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(o){function u(e,t){var n;return f(this,u),(n=a(this,s(u).call(this)))._vertexStride=e,n._bufferUsage=t,n._bufferType=r.WebGLContext.ARRAY_BUFFER,n._buffer=new ArrayBuffer(8),n._floatArray32=new Float32Array(n._buffer),n._uint32Array=new Uint32Array(n._buffer),n}return b(u,e.Buffer2D),i(u,[{key:"getFloat32Array",value:function(){return this._floatArray32}},{key:"appendArray",value:function(e){var t=this._byteLength>>2;this.setByteLength(this._byteLength+4*e.length),this.getFloat32Array().set(e,t),this._upload=!0}},{key:"_checkArrayUse",value:function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))}},{key:"deleteBuffer",value:function(){c(s(u.prototype),"_disposeResource",this).call(this)}},{key:"_bindForVAO",value:function(){t.LayaGL.instance.bindBuffer(r.WebGLContext.ARRAY_BUFFER,this._glBuffer)}},{key:"bind",value:function(){return n.Buffer._bindedVertexBuffer!==this._glBuffer&&(t.LayaGL.instance.bindBuffer(r.WebGLContext.ARRAY_BUFFER,this._glBuffer),n.Buffer._bindedVertexBuffer=this._glBuffer,!0)}},{key:"destroy",value:function(){c(s(u.prototype),"destroy",this).call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null}},{key:"vertexStride",get:function(){return this._vertexStride}}]),u}();exports.VertexBuffer2D=_,_.create=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35048;return new _(e,t)};
},{"././Buffer2D":"XmYZ","../../layagl/LayaGL":"ezDE","../WebGLContext":"vf9T","./Buffer":"3ch1"}],"Sng0":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IndexBuffer2D=void 0;var e=require("././Buffer2D"),t=require("../../layagl/LayaGL"),r=require("../WebGLContext"),n=require("./Buffer");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(o){function f(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:35044;return u(this,f),(e=a(this,s(f).call(this)))._bufferUsage=t,e._bufferType=r.WebGLContext.ELEMENT_ARRAY_BUFFER,e._buffer=new ArrayBuffer(8),e}return y(f,e.Buffer2D),i(f,[{key:"_checkArrayUse",value:function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))}},{key:"getUint16Array",value:function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))}},{key:"_bindForVAO",value:function(){t.LayaGL.instance.bindBuffer(r.WebGLContext.ELEMENT_ARRAY_BUFFER,this._glBuffer)}},{key:"bind",value:function(){return n.Buffer._bindedIndexBuffer!==this._glBuffer&&(t.LayaGL.instance.bindBuffer(r.WebGLContext.ELEMENT_ARRAY_BUFFER,this._glBuffer),n.Buffer._bindedIndexBuffer=this._glBuffer,!0)}},{key:"destory",value:function(){this._uint16Array=null,this._buffer=null}},{key:"disposeResource",value:function(){this._disposeResource()}}]),f}();exports.IndexBuffer2D=b,b.create=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:35044;return new b(e)};
},{"././Buffer2D":"XmYZ","../../layagl/LayaGL":"ezDE","../WebGLContext":"vf9T","./Buffer":"3ch1"}],"jc9p":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BufferStateBase=void 0;var e=require("../layagl/LayaGL");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a=function(){function r(){t(this,r),this._nativeVertexArrayObject=e.LayaGL.instance.createVertexArray()}return n(r,[{key:"bind",value:function(){r._curBindedBufferState!==this&&(e.LayaGL.instance.bindVertexArray(this._nativeVertexArrayObject),r._curBindedBufferState=this)}},{key:"unBind",value:function(){if(r._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";e.LayaGL.instance.bindVertexArray(null),r._curBindedBufferState=null}},{key:"bindForNative",value:function(){e.LayaGL.instance.bindVertexArray(this._nativeVertexArrayObject),r._curBindedBufferState=this}},{key:"unBindForNative",value:function(){e.LayaGL.instance.bindVertexArray(null),r._curBindedBufferState=null}},{key:"destroy",value:function(){e.LayaGL.instance.deleteVertexArray(this._nativeVertexArrayObject)}}]),r}();exports.BufferStateBase=a;
},{"../layagl/LayaGL":"ezDE"}],"E08N":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BufferState2D=void 0;var t=require("././BufferStateBase");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,o){return!o||"object"!==e(o)&&"function"!=typeof o?n(t):o}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=function(e){function n(){return o(this,n),r(this,u(n).call(this))}return f(n,t.BufferStateBase),n}();exports.BufferState2D=c;
},{"././BufferStateBase":"jc9p"}],"v5Bv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mesh2D=void 0;var e=require("././VertexBuffer2D"),t=require("././IndexBuffer2D"),i=require("./../../../Config"),r=require("../BufferState2D"),n=require("../WebGLContext");function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,i){return t&&u(e.prototype,t),i&&u(e,i),e}var o=function(){function u(r,a,o){s(this,u),this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._quadNum=0,this.canReuse=!1,this._stride=r,this._vb=new e.VertexBuffer2D(r,n.WebGLContext.DYNAMIC_DRAW),a?this._vb._resizeBuffer(a,!1):i.Config.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*r,!1),this._ib=new t.IndexBuffer2D,o&&this._ib._resizeBuffer(o,!1)}return a(u,[{key:"cloneWithNewVB",value:function(){var e=new u(this._stride,0,0);return e._ib=this._ib,e._quadNum=this._quadNum,e._attribInfo=this._attribInfo,e}},{key:"cloneWithNewVBIB",value:function(){var e=new u(this._stride,0,0);return e._attribInfo=this._attribInfo,e}},{key:"getVBW",value:function(){return this._vb.setNeedUpload(),this._vb}},{key:"getVBR",value:function(){return this._vb}},{key:"getIBR",value:function(){return this._ib}},{key:"getIBW",value:function(){return this._ib.setNeedUpload(),this._ib}},{key:"createQuadIB",value:function(e){this._quadNum=e,this._ib._resizeBuffer(6*e*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var t=this._ib.getUint16Array(),i=0,r=0,n=0;n<e;n++)t[i++]=r,t[i++]=r+2,t[i++]=r+1,t[i++]=r,t[i++]=r+3,t[i++]=r+2,r+=4;this._ib.setNeedUpload()}},{key:"setAttributes",value:function(e){if(this._attribInfo=e,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"}},{key:"configVAO",value:function(e){if(!this._applied){this._applied=!0,this._vao||(this._vao=new r.BufferState2D),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var t=this._attribInfo.length/3,i=0,n=0;n<t;n++){var s=this._attribInfo[i+1],u=this._attribInfo[i],a=this._attribInfo[i+2];e.enableVertexAttribArray(n),e.vertexAttribPointer(n,s,u,!1,this._stride,a),i+=3}this._vao.unBind()}}},{key:"useMesh",value:function(e){this._applied||this.configVAO(e),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()}},{key:"getEleNum",value:function(){return this._ib.getBuffer().byteLength/2}},{key:"releaseMesh",value:function(){}},{key:"destroy",value:function(){}},{key:"clearVB",value:function(){this._vb.clear()}}]),u}();exports.Mesh2D=o,o._gvaoid=0;
},{"././VertexBuffer2D":"epk0","././IndexBuffer2D":"Sng0","./../../../Config":"/R4M","../BufferState2D":"E08N","../WebGLContext":"vf9T"}],"e2cl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshQuadTexture=void 0;var e=require("././Mesh2D"),t=require("../WebGLContext");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?f(e):t}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(t){function r(){var e;return n(this,r),(e=u(this,s(r).call(this,r.const_stride,4,4))).canReuse=!0,e.setAttributes(r._fixattriInfo),r._fixib?(e._ib=r._fixib,e._quadNum=r._maxIB):(e.createQuadIB(r._maxIB),r._fixib=e._ib),e}return a(r,e.Mesh2D),i(r,[{key:"releaseMesh",value:function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,r._POOL.push(this)}},{key:"destroy",value:function(){this._vb.destroy(),this._vb.deleteBuffer()}},{key:"addQuad",value:function(e,t,n,o){var i=this._vb,u=i._byteLength>>2;i.setByteLength(u+r.const_stride<<2);var f=i._floatArray32||i.getFloat32Array(),s=i._uint32Array,a=u,c=o?255:0;f[a++]=e[0],f[a++]=e[1],f[a++]=t[0],f[a++]=t[1],s[a++]=n,s[a++]=c,f[a++]=e[2],f[a++]=e[3],f[a++]=t[2],f[a++]=t[3],s[a++]=n,s[a++]=c,f[a++]=e[4],f[a++]=e[5],f[a++]=t[4],f[a++]=t[5],s[a++]=n,s[a++]=c,f[a++]=e[6],f[a++]=e[7],f[a++]=t[6],f[a++]=t[7],s[a++]=n,s[a++]=c,i._upload=!0}}],[{key:"getAMesh",value:function(e){var t=null;return t=r._POOL.length?r._POOL.pop():new r,e&&t._vb._resizeBuffer(65536*r.const_stride,!1),t}}]),r}();exports.MeshQuadTexture=l,l.const_stride=24,l._maxIB=16384,l._fixattriInfo=[t.WebGLContext.FLOAT,4,0,t.WebGLContext.UNSIGNED_BYTE,4,16,t.WebGLContext.UNSIGNED_BYTE,4,20],l._POOL=[];
},{"././Mesh2D":"v5Bv","../WebGLContext":"vf9T"}],"n6s4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshTexture=void 0;var e=require("././Mesh2D"),t=require("../WebGLContext");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?s(e):t}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(t){function r(){var e;return n(this,r),(e=u(this,f(r).call(this,r.const_stride,4,4))).canReuse=!0,e.setAttributes(r._fixattriInfo),e}return a(r,e.Mesh2D),i(r,[{key:"addData",value:function(e,t,n,o,i){var u=this._vb,s=this._ib,f=e.length>>1,a=u.needSize(f*r.const_stride)>>2,c=u._floatArray32||u.getFloat32Array(),l=u._uint32Array,y=0,b=o.a,h=o.b,p=o.c,_=o.d,d=o.tx,v=o.ty,O=0;for(O=0;O<f;O++){var g=e[y],m=e[y+1];c[a]=g*b+m*p+d,c[a+1]=g*h+m*_+v,c[a+2]=t[y],c[a+3]=t[y+1],l[a+4]=i,l[a+5]=255,a+=6,y+=2}u.setNeedUpload();var x=this.vertNum,L=n.length,N=s.needSize(n.byteLength),P=s.getUint16Array(),S=N>>1;if(x>0){var w=S+L,j=0;for(O=S;O<w;O++,j++)P[O]=n[j]+x}else P.set(n,S);s.setNeedUpload(),this.vertNum+=f,this.indexNum+=n.length}},{key:"releaseMesh",value:function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,r._POOL.push(this)}},{key:"destroy",value:function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()}}],[{key:"getAMesh",value:function(e){var t;return t=r._POOL.length?r._POOL.pop():new r,e&&t._vb._resizeBuffer(65536*r.const_stride,!1),t}}]),r}();exports.MeshTexture=l,l.const_stride=24,l._fixattriInfo=[t.WebGLContext.FLOAT,4,0,t.WebGLContext.UNSIGNED_BYTE,4,16,t.WebGLContext.UNSIGNED_BYTE,4,20],l._POOL=[];
},{"././Mesh2D":"v5Bv","../WebGLContext":"vf9T"}],"CxvY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshVG=void 0;var e=require("././Mesh2D"),t=require("../WebGLContext");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(t){function n(){var e;return r(this,n),(e=s(this,f(n).call(this,n.const_stride,4,4))).canReuse=!0,e.setAttributes(n._fixattriInfo),e}return c(n,e.Mesh2D),i(n,[{key:"addVertAndIBToMesh",value:function(e,t,r,o){for(var i=this._vb.needSize(t.length/2*n.const_stride)>>2,s=this._vb._floatArray32||this._vb.getFloat32Array(),u=this._vb._uint32Array,f=0,c=t.length/2,a=0;a<c;a++)s[i++]=t[f],s[i++]=t[f+1],f+=2,u[i++]=r;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(o)),this._ib.setNeedUpload(),this.vertNum+=c,this.indexNum+=o.length}},{key:"releaseMesh",value:function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,n._POOL.push(this)}},{key:"destroy",value:function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()}}],[{key:"getAMesh",value:function(e){var t;return t=n._POOL.length?n._POOL.pop():new n,e&&t._vb._resizeBuffer(65536*n.const_stride,!1),t}}]),n}();exports.MeshVG=l,l.const_stride=12,l._fixattriInfo=[t.WebGLContext.FLOAT,2,0,t.WebGLContext.UNSIGNED_BYTE,4,8],l._POOL=[];
},{"././Mesh2D":"v5Bv","../WebGLContext":"vf9T"}],"NpEt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGLCacheAsNormalCanvas=void 0;var t=require("../../maths/Matrix"),e=require("../submit/SubmitBase"),s=require("../utils/MeshQuadTexture"),i=require("../utils/MeshTexture"),h=require("../utils/MeshVG");function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,s){return e&&a(t.prototype,e),s&&a(t,s),t}var o=function(){function a(e,s){n(this,a),this.submitStartPos=0,this.submitEndPos=0,this.context=null,this.touches=[],this.submits=[],this.sprite=null,this.meshlist=[],this.cachedClipInfo=new t.Matrix,this.oldTx=0,this.oldTy=0,this.invMat=new t.Matrix,this.context=e,this.sprite=s,e._globalClipMatrix.copyTo(this.cachedClipInfo)}return c(a,[{key:"startRec",value:function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context)),this.context._incache=!0,this.touches.length=0,this.context.touches=this.touches,this.context._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=this.context._submits._length;for(var t=0,n=this.meshlist.length;t<n;t++){var a=this.meshlist[t];a.canReuse?a.releaseMesh():a.destroy()}this.meshlist.length=0,this._mesh=s.MeshQuadTexture.getAMesh(!1),this._pathMesh=h.MeshVG.getAMesh(!1),this._triangleMesh=i.MeshTexture.getAMesh(!1),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),this.context._curSubmit=e.SubmitBase.RENDERBASE,this._oldMesh=this.context._mesh,this._oldPathMesh=this.context._pathMesh,this._oldTriMesh=this.context._triangleMesh,this._oldMeshList=this.context.meshlist,this.context._mesh=this._mesh,this.context._pathMesh=this._pathMesh,this.context._triangleMesh=this._triangleMesh,this.context.meshlist=this.meshlist,this.oldTx=this.context._curMat.tx,this.oldTy=this.context._curMat.ty,this.context._curMat.tx=0,this.context._curMat.ty=0,this.context._curMat.copyTo(this.invMat),this.invMat.invert()}},{key:"endRec",value:function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var t=this.context._submits;this.submitEndPos=t._length;for(var s=this.submitEndPos-this.submitStartPos,i=0;i<s;i++)this.submits.push(t[this.submitStartPos+i]);t._length-=s,this.context._mesh=this._oldMesh,this.context._pathMesh=this._oldPathMesh,this.context._triangleMesh=this._oldTriMesh,this.context.meshlist=this._oldMeshList,this.context._curSubmit=e.SubmitBase.RENDERBASE,this.context._curMat.tx=this.oldTx,this.context._curMat.ty=this.oldTy,this.context.touches=null,this.context._incache=!1}},{key:"isCacheValid",value:function(){var t=this.context._globalClipMatrix;return t.a==this.cachedClipInfo.a&&t.b==this.cachedClipInfo.b&&t.c==this.cachedClipInfo.c&&t.d==this.cachedClipInfo.d&&t.tx==this.cachedClipInfo.tx&&t.ty==this.cachedClipInfo.ty}},{key:"flushsubmit",value:function(){var t=e.SubmitBase.RENDERBASE;this.submits.forEach(function(s){s!=e.SubmitBase.RENDERBASE&&(e.SubmitBase.preRender=t,t=s,s.renderSubmit())})}},{key:"releaseMem",value:function(){}}]),a}();exports.WebGLCacheAsNormalCanvas=o,o.matI=new t.Matrix;
},{"../../maths/Matrix":"GG2z","../submit/SubmitBase":"U5L8","../utils/MeshQuadTexture":"e2cl","../utils/MeshTexture":"n6s4","../utils/MeshVG":"CxvY"}],"mB8l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SaveBase=void 0;var e=require("../../submit/SubmitBase");function E(e,E){if(!(e instanceof E))throw new TypeError("Cannot call a class as a function")}function T(e,E){for(var T=0;T<E.length;T++){var _=E[T];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(e,_.key,_)}}function _(e,E,_){return E&&T(e.prototype,E),_&&T(e,_),e}var t=function(){function T(){E(this,T)}return _(T,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(E){this._dataObj[this._valueName]=this._value,T.POOL[T.POOL._length++]=this,this._newSubmit&&(E._curSubmit=e.SubmitBase.RENDERBASE)}}],[{key:"_createArray",value:function(){var e=[];return e._length=0,e}},{key:"_init",value:function(){var e=T._namemap={};return e[T.TYPE_ALPHA]="ALPHA",e[T.TYPE_FILESTYLE]="fillStyle",e[T.TYPE_FONT]="font",e[T.TYPE_LINEWIDTH]="lineWidth",e[T.TYPE_STROKESTYLE]="strokeStyle",e[T.TYPE_ENABLEMERGE]="_mergeID",e[T.TYPE_MARK]=e[T.TYPE_TRANSFORM]=e[T.TYPE_TRANSLATE]=[],e[T.TYPE_TEXTBASELINE]="textBaseline",e[T.TYPE_TEXTALIGN]="textAlign",e[T.TYPE_GLOBALCOMPOSITEOPERATION]="_nBlendType",e[T.TYPE_SHADER]="shader",e[T.TYPE_FILTERS]="filters",e[T.TYPE_COLORFILTER]="_colorFiler",e}},{key:"save",value:function(e,E,_,t){if((e._saveMark._saveuse&E)!==E){e._saveMark._saveuse|=E;var a=T.POOL,n=a._length>0?a[--a._length]:new T;n._value=_[n._valueName=T._namemap[E]],n._dataObj=_,n._newSubmit=t;var r=e._save;r[r._length++]=n}}}]),T}();exports.SaveBase=t,t.TYPE_ALPHA=1,t.TYPE_FILESTYLE=2,t.TYPE_FONT=8,t.TYPE_LINEWIDTH=256,t.TYPE_STROKESTYLE=512,t.TYPE_MARK=1024,t.TYPE_TRANSFORM=2048,t.TYPE_TRANSLATE=4096,t.TYPE_ENABLEMERGE=8192,t.TYPE_TEXTBASELINE=16384,t.TYPE_TEXTALIGN=32768,t.TYPE_GLOBALCOMPOSITEOPERATION=65536,t.TYPE_CLIPRECT=131072,t.TYPE_CLIPRECT_STENCIL=262144,t.TYPE_IBVB=524288,t.TYPE_SHADER=1048576,t.TYPE_FILTERS=2097152,t.TYPE_FILTERS_TYPE=4194304,t.TYPE_COLORFILTER=8388608,t.POOL=t._createArray(),t._namemap=t._init();
},{"../../submit/SubmitBase":"U5L8"}],"nEZ+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SaveClipRect=void 0;var e=require("././SaveBase"),a=require("../../../maths/Matrix"),i=require("../../../maths/Rectangle");function t(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function n(e,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function l(e,a,i){return a&&n(e.prototype,a),i&&n(e,i),e}var r=function(){function n(){t(this,n),this._globalClipMatrix=new a.Matrix,this._clipInfoID=-1,this._clipRect=new i.Rectangle,this.incache=!1}return l(n,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(e){this._globalClipMatrix.copyTo(e._globalClipMatrix),this._clipRect.clone(e._clipRect),e._clipInfoID=this._clipInfoID,n.POOL[n.POOL._length++]=this,e._clipInCache=this.incache}}],[{key:"save",value:function(a){if((a._saveMark._saveuse&e.SaveBase.TYPE_CLIPRECT)!=e.SaveBase.TYPE_CLIPRECT){a._saveMark._saveuse|=e.SaveBase.TYPE_CLIPRECT;var i=n.POOL,t=i._length>0?i[--i._length]:new n;a._globalClipMatrix.copyTo(t._globalClipMatrix),a._clipRect.clone(t._clipRect),t._clipInfoID=a._clipInfoID,t.incache=a._clipInCache;var l=a._save;l[l._length++]=t}}}]),n}();exports.SaveClipRect=r,r.POOL=e.SaveBase._createArray();
},{"././SaveBase":"mB8l","../../../maths/Matrix":"GG2z","../../../maths/Rectangle":"iPyf"}],"9jTL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SaveMark=void 0;var e=require("././SaveBase");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function a(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function t(e,r,t){return r&&a(e.prototype,r),t&&a(e,t),e}var n=function(){function e(){r(this,e),this._saveuse=0}return t(e,[{key:"isSaveMark",value:function(){return!0}},{key:"restore",value:function(r){r._saveMark=this._preSaveMark,e.POOL[e.POOL._length++]=this}}],[{key:"Create",value:function(r){var a=e.POOL,t=a._length>0?a[--a._length]:new e;return t._saveuse=0,t._preSaveMark=r._saveMark,r._saveMark=t,t}}]),e}();exports.SaveMark=n,n.POOL=e.SaveBase._createArray();
},{"././SaveBase":"mB8l"}],"tJOq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SaveTransform=void 0;var e=require("././SaveBase"),a=require("../../../maths/Matrix");function r(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function t(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function n(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}var s=function(){function t(){r(this,t),this._matrix=new a.Matrix}return n(t,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(e){e._curMat=this._savematrix,t.POOL[t.POOL._length++]=this}}],[{key:"save",value:function(a){var r=a._saveMark;if((r._saveuse&e.SaveBase.TYPE_TRANSFORM)!==e.SaveBase.TYPE_TRANSFORM){r._saveuse|=e.SaveBase.TYPE_TRANSFORM;var n=t.POOL,s=n._length>0?n[--n._length]:new t;s._savematrix=a._curMat,a._curMat=a._curMat.copyTo(s._matrix);var i=a._save;i[i._length++]=s}}}]),t}();exports.SaveTransform=s,s.POOL=e.SaveBase._createArray();
},{"././SaveBase":"mB8l","../../../maths/Matrix":"GG2z"}],"SgVA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SaveTranslate=void 0;var e=require("././SaveBase"),t=require("../../../maths/Matrix");function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}var o=function(){function e(){a(this,e),this._mat=new t.Matrix}return n(e,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(t){this._mat.copyTo(t._curMat),e.POOL[e.POOL._length++]=this}}],[{key:"save",value:function(t){var a=e.POOL,r=a._length>0?a[--a._length]:new e;t._curMat.copyTo(r._mat);var n=t._save;n[n._length++]=r}}]),e}();exports.SaveTranslate=o,o.POOL=e.SaveBase._createArray();
},{"././SaveBase":"mB8l","../../../maths/Matrix":"GG2z"}],"EntU":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\nuniform vec2 clipOff;\t\t\t// 使用要把clip偏移。cacheas normal用. 只用了[0]\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\t\n\tvec2 clpos = clipMatPos.xy;\n\t#ifdef WORLDMAT\n\t\t// 如果有mmat，需要修改clipMatPos,因为 这是cacheas normal （如果不是就错了）， clipMatPos被去掉了偏移\n\t\tif(clipOff[0]>0.0){\n\t\t\tclpos.x+=mmat[3].x;\t//tx\t最简单处理\n\t\t\tclpos.y+=mmat[3].y;\t//ty\n\t\t}\n\t#endif\n\tvec2 clippos = pos.xy - clpos;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}";
},{}],"j/v+":[function(require,module,exports) {
module.exports="/*\n\ttexture和fillrect使用的。\n*/\n#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}";
},{}],"7cAU":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nattribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}";
},{}],"0hMb":[function(require,module,exports) {
module.exports="precision mediump float;\n#define GLSLIFY 1\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}";
},{}],"HLG3":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nattribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}";
},{}],"pYy2":[function(require,module,exports) {
module.exports="precision mediump float;\n#define GLSLIFY 1\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}";
},{}],"jNoH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Shader2D=void 0;var e=require("././ShaderDefines2D"),r=require("../../canvas/DrawStyle"),i=require("../Shader"),l=f(require("./files/texture.vs.glsl")),t=f(require("./files/texture.ps.glsl")),n=f(require("./files/primitive.vs.glsl")),s=f(require("./files/primitive.ps.glsl")),a=f(require("./skinAnishader/skinShader.vs.glsl")),u=f(require("./skinAnishader/skinShader.ps.glsl"));function f(e){return e&&e.__esModule?e:{default:e}}function d(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function o(e,r){for(var i=0;i<r.length;i++){var l=r[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function h(e,r,i){return r&&o(e.prototype,r),i&&o(e,i),e}var D=function(){function f(){d(this,f),this.ALPHA=1,this.defines=new e.ShaderDefines2D,this.shaderType=0,this.fillStyle=r.DrawStyle.DEFAULT,this.strokeStyle=r.DrawStyle.DEFAULT}return h(f,[{key:"destroy",value:function(){this.defines=null,this.filters=null}}],[{key:"__init__",value:function(){i.Shader.preCompile2D(0,e.ShaderDefines2D.TEXTURE2D,l.default,t.default,null),i.Shader.preCompile2D(0,e.ShaderDefines2D.PRIMITIVE,n.default,s.default,null),i.Shader.preCompile2D(0,e.ShaderDefines2D.SKINMESH,a.default,u.default,null)}}]),f}();exports.Shader2D=D;
},{"././ShaderDefines2D":"el31","../../canvas/DrawStyle":"MDgz","../Shader":"PB8V","./files/texture.vs.glsl":"EntU","./files/texture.ps.glsl":"j/v+","./files/primitive.vs.glsl":"7cAU","./files/primitive.ps.glsl":"0hMb","./skinAnishader/skinShader.vs.glsl":"HLG3","./skinAnishader/skinShader.ps.glsl":"pYy2"}],"AumK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SkinMeshBuffer=void 0;var e=require("../../../WebGLContext"),t=require("../../../utils/IndexBuffer2D"),n=require("../../../utils/VertexBuffer2D");function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var a=function(){function i(){r(this,i);e.WebGLContext.mainContext;this.ib=t.IndexBuffer2D.create(e.WebGLContext.DYNAMIC_DRAW),this.vb=n.VertexBuffer2D.create(8)}return u(i,[{key:"addSkinMesh",value:function(e){e.getData2(this.vb,this.ib,this.vb._byteLength/32)}},{key:"reset",value:function(){this.vb.clear(),this.ib.clear()}}],[{key:"getInstance",value:function(){return i.instance=i.instance||new i}}]),i}();exports.SkinMeshBuffer=a;
},{"../../../WebGLContext":"vf9T","../../../utils/IndexBuffer2D":"Sng0","../../../utils/VertexBuffer2D":"epk0"}],"gohm":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.BasePoly=void 0;var a=function(){function t(){e(this,t)}return r(t,null,[{key:"createLine2",value:function(e,r,a,n,o,s){if(e.length<4)return null;var u=t.tempData.length>e.length+2?t.tempData:new Array(e.length+2);u[0]=e[0],u[1]=e[1];var l=2,h=0,i=e.length;for(h=2;h<i;h+=2)Math.abs(e[h]-e[h-2])+Math.abs(e[h+1]-e[h-1])>.01&&(u[l++]=e[h],u[l++]=e[h+1]);s&&Math.abs(e[0]-u[l-2])+Math.abs(e[1]-u[l-1])>.01&&(u[l++]=e[0],u[l++]=e[1]);var f=o;i=l/2;var c,p,v,y,M,b,g,q,w,m,d,P,k,x,A,D,j,B,L,O,T=a/2;v=u[0],y=u[1],m=v-(M=u[2]);w=(w=-(y-(b=u[3])))/(O=Math.sqrt(w*w+m*m))*T,m=m/O*T;for(f.push(v-w,y-m,v+w,y+m),h=1;h<i-1;h++)v=u[2*(h-1)],y=u[2*(h-1)+1],M=u[2*h],b=u[2*h+1],g=u[2*(h+1)],q=u[2*(h+1)+1],m=v-M,P=M-g,A=(-(w=(w=-(y-b))/(O=Math.sqrt(w*w+m*m))*T)+v)*(-(m=m/O*T)+b)-(-w+M)*(-m+y),B=(-(d=(d=-(b-q))/(O=Math.sqrt(d*d+P*P))*T)+g)*(-(P=P/O*T)+b)-(-d+M)*(-P+q),L=(k=-m+y-(-m+b))*(j=-d+M-(-d+g))-(D=-P+q-(-P+b))*(x=-w+M-(-w+v)),Math.abs(L)<.1?(L+=10.1,f.push(M-w,b-m,M+w,b+m)):(((c=(x*B-j*A)/L)-M)*(c-M)+((p=(D*A-k*B)/L)-b)+(p-b),f.push(c,p,M-(c-M),b-(p-b)));for(v=u[l-4],y=u[l-3],m=v-(M=u[l-2]),w=(w=-(y-(b=u[l-1])))/(O=Math.sqrt(w*w+m*m))*T,m=m/O*T,f.push(M-w,b-m,M+w,b+m),h=1;h<i;h++)r.push(n+2*(h-1),n+2*(h-1)+1,n+2*h+1,n+2*h+1,n+2*h,n+2*(h-1));return f}},{key:"createLineTriangle",value:function(e,t,r,a,n,o,s){var u=e.slice(),l=u.length,h=u[0],i=u[1],f=u[2],c=(u[2],0),p=0,v=0,y=0,M=l/2;if(!(M<=1)&&2!=M){for(var b=new Array(4*M),g=0,q=0,w=0;w<M-1;w++)h=u[q++],i=u[q++],f=u[q++],y=u[q++]-i,0!=(v=f-h)&&0!=y&&(c=Math.sqrt(v*v+y*y))>.001&&(b[p=4*g]=h,b[p+1]=i,b[p+2]=v/c,b[p+3]=y/c,g++);for(a?(h=u[l-2],i=u[l-1],f=u[0],y=u[1]-i,0!=(v=f-h)&&0!=y&&(c=Math.sqrt(v*v+y*y))>.001&&(b[p=4*g]=h,b[p+1]=i,b[p+2]=v/c,b[p+3]=y/c,g++)):(b[p=4*g]=h,b[p+1]=i,b[p+2]=v/c,b[p+3]=y/c,g++),q=0,w=0;w<M;w++){h=u[q],i=u[q+1],f=u[q+2],u[q+3];u[q+4],u[q+5]}}}}]),t}();exports.BasePoly=a,a.tempData=new Array(256);
},{}],"ToUH":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.EarcutNode=void 0;var e=function e(s,i,n){t(this,e),this.i=s,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1};exports.EarcutNode=e;
},{}],"FTPB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Earcut=void 0;var e=require("././EarcutNode");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function t(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}var i=function(){function r(){n(this,r)}return t(r,null,[{key:"earcut",value:function(e,n,t){t=t||2;var i,a,x,u,l,o,v,y=n&&n.length,f=y?n[0]*t:e.length,s=r.linkedList(e,0,f,t,!0),c=[];if(!s)return c;if(y&&(s=r.eliminateHoles(e,n,s,t)),e.length>80*t){i=x=e[0],a=u=e[1];for(var p=t;p<f;p+=t)(l=e[p])<i&&(i=l),(o=e[p+1])<a&&(a=o),l>x&&(x=l),o>u&&(u=o);v=0!==(v=Math.max(x-i,u-a))?1/v:0}return r.earcutLinked(s,c,t,i,a,v),c}},{key:"linkedList",value:function(e,n,t,i,a){var x,u;if(a===r.signedArea(e,n,t,i)>0)for(x=n;x<t;x+=i)u=r.insertNode(x,e[x],e[x+1],u);else for(x=t-i;x>=n;x-=i)u=r.insertNode(x,e[x],e[x+1],u);return u&&r.equals(u,u.next)&&(r.removeNode(u),u=u.next),u}},{key:"filterPoints",value:function(e,n){if(!e)return e;n||(n=e);var t,i=e;do{if(t=!1,i.steiner||!r.equals(i,i.next)&&0!==r.area(i.prev,i,i.next))i=i.next;else{if(r.removeNode(i),(i=n=i.prev)===i.next)break;t=!0}}while(t||i!==n);return n}},{key:"earcutLinked",value:function(e,n,t,i,a,x){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(e){!u&&x&&r.indexCurve(e,i,a,x);for(var l,o,v=e;e.prev!==e.next;)if(l=e.prev,o=e.next,x?r.isEarHashed(e,i,a,x):r.isEar(e))n.push(l.i/t),n.push(e.i/t),n.push(o.i/t),r.removeNode(e),e=o.next,v=o.next;else if((e=o)===v){u?1===u?(e=r.cureLocalIntersections(e,n,t),r.earcutLinked(e,n,t,i,a,x,2)):2===u&&r.splitEarcut(e,n,t,i,a,x):r.earcutLinked(r.filterPoints(e,null),n,t,i,a,x,1);break}}}},{key:"isEar",value:function(e){var n=e.prev,t=e,i=e.next;if(r.area(n,t,i)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(r.pointInTriangle(n.x,n.y,t.x,t.y,i.x,i.y,a.x,a.y)&&r.area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}},{key:"isEarHashed",value:function(e,n,t,i){var a=e.prev,x=e,u=e.next;if(r.area(a,x,u)>=0)return!1;for(var l=a.x<x.x?a.x<u.x?a.x:u.x:x.x<u.x?x.x:u.x,o=a.y<x.y?a.y<u.y?a.y:u.y:x.y<u.y?x.y:u.y,v=a.x>x.x?a.x>u.x?a.x:u.x:x.x>u.x?x.x:u.x,y=a.y>x.y?a.y>u.y?a.y:u.y:x.y>u.y?x.y:u.y,f=r.zOrder(l,o,n,t,i),s=r.zOrder(v,y,n,t,i),c=e.nextZ;c&&c.z<=s;){if(c!==e.prev&&c!==e.next&&r.pointInTriangle(a.x,a.y,x.x,x.y,u.x,u.y,c.x,c.y)&&r.area(c.prev,c,c.next)>=0)return!1;c=c.nextZ}for(c=e.prevZ;c&&c.z>=f;){if(c!==e.prev&&c!==e.next&&r.pointInTriangle(a.x,a.y,x.x,x.y,u.x,u.y,c.x,c.y)&&r.area(c.prev,c,c.next)>=0)return!1;c=c.prevZ}return!0}},{key:"cureLocalIntersections",value:function(e,n,t){var i=e;do{var a=i.prev,x=i.next.next;!r.equals(a,x)&&r.intersects(a,i,i.next,x)&&r.locallyInside(a,x)&&r.locallyInside(x,a)&&(n.push(a.i/t),n.push(i.i/t),n.push(x.i/t),r.removeNode(i),r.removeNode(i.next),i=e=x),i=i.next}while(i!==e);return i}},{key:"splitEarcut",value:function(e,n,t,i,a,x){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&r.isValidDiagonal(u,l)){var o=r.splitPolygon(u,l);return u=r.filterPoints(u,u.next),o=r.filterPoints(o,o.next),r.earcutLinked(u,n,t,i,a,x),void r.earcutLinked(o,n,t,i,a,x)}l=l.next}u=u.next}while(u!==e)}},{key:"eliminateHoles",value:function(e,n,t,i){var a,x,u,l,o,v=[];for(a=0,x=n.length;a<x;a++)u=n[a]*i,l=a<x-1?n[a+1]*i:e.length,(o=r.linkedList(e,u,l,i,!1))===o.next&&(o.steiner=!0),v.push(r.getLeftmost(o));for(v.sort(r.compareX),a=0;a<v.length;a++)r.eliminateHole(v[a],t),t=r.filterPoints(t,t.next);return t}},{key:"compareX",value:function(e,n){return e.x-n.x}},{key:"eliminateHole",value:function(e,n){if(n=r.findHoleBridge(e,n)){var t=r.splitPolygon(n,e);r.filterPoints(t,t.next)}}},{key:"findHoleBridge",value:function(e,n){var t,i=n,a=e.x,x=e.y,u=-1/0;do{if(x<=i.y&&x>=i.next.y&&i.next.y!==i.y){var l=i.x+(x-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(l<=a&&l>u){if(u=l,l===a){if(x===i.y)return i;if(x===i.next.y)return i.next}t=i.x<i.next.x?i:i.next}}i=i.next}while(i!==n);if(!t)return null;if(a===u)return t.prev;var o,v=t,y=t.x,f=t.y,s=1/0;for(i=t.next;i!==v;)a>=i.x&&i.x>=y&&a!==i.x&&r.pointInTriangle(x<f?a:u,x,y,f,x<f?u:a,x,i.x,i.y)&&((o=Math.abs(x-i.y)/(a-i.x))<s||o===s&&i.x>t.x)&&r.locallyInside(i,e)&&(t=i,s=o),i=i.next;return t}},{key:"indexCurve",value:function(e,n,t,i){var a=e;do{null===a.z&&(a.z=r.zOrder(a.x,a.y,n,t,i)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,r.sortLinked(a)}},{key:"sortLinked",value:function(e){var n,r,t,i,a,x,u,l,o=1;do{for(r=e,e=null,a=null,x=0;r;){for(x++,t=r,u=0,n=0;n<o&&(u++,t=t.nextZ);n++);for(l=o;u>0||l>0&&t;)0!==u&&(0===l||!t||r.z<=t.z)?(i=r,r=r.nextZ,u--):(i=t,t=t.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=t}a.nextZ=null,o*=2}while(x>1);return e}},{key:"zOrder",value:function(e,n,r,t,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*i)|n<<8))|n<<4))|n<<2))|n<<1))<<1}},{key:"getLeftmost",value:function(e){var n=e,r=e;do{n.x<r.x&&(r=n),n=n.next}while(n!==e);return r}},{key:"pointInTriangle",value:function(e,n,r,t,i,a,x,u){return(i-x)*(n-u)-(e-x)*(a-u)>=0&&(e-x)*(t-u)-(r-x)*(n-u)>=0&&(r-x)*(a-u)-(i-x)*(t-u)>=0}},{key:"isValidDiagonal",value:function(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!r.intersectsPolygon(e,n)&&r.locallyInside(e,n)&&r.locallyInside(n,e)&&r.middleInside(e,n)}},{key:"area",value:function(e,n,r){return(n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y)}},{key:"equals",value:function(e,n){return e.x===n.x&&e.y===n.y}},{key:"intersects",value:function(e,n,t,i){return!!(r.equals(e,n)&&r.equals(t,i)||r.equals(e,i)&&r.equals(t,n))||r.area(e,n,t)>0!=r.area(e,n,i)>0&&r.area(t,i,e)>0!=r.area(t,i,n)>0}},{key:"intersectsPolygon",value:function(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&r.intersects(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}},{key:"locallyInside",value:function(e,n){return r.area(e.prev,e,e.next)<0?r.area(e,n,e.next)>=0&&r.area(e,e.prev,n)>=0:r.area(e,n,e.prev)<0||r.area(e,e.next,n)<0}},{key:"middleInside",value:function(e,n){var r=e,t=!1,i=(e.x+n.x)/2,a=(e.y+n.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(t=!t),r=r.next}while(r!==e);return t}},{key:"splitPolygon",value:function(n,r){var t=new e.EarcutNode(n.i,n.x,n.y),i=new e.EarcutNode(r.i,r.x,r.y),a=n.next,x=r.prev;return n.next=r,r.prev=n,t.next=a,a.prev=t,i.next=t,t.prev=i,x.next=i,i.prev=x,i}},{key:"insertNode",value:function(n,r,t,i){var a=new e.EarcutNode(n,r,t);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}},{key:"removeNode",value:function(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}},{key:"signedArea",value:function(e,n,r,t){for(var i=0,a=n,x=r-t;a<r;a+=t)i+=(e[x]-e[a])*(e[a+1]+e[x+1]),x=a;return i}}]),r}();exports.Earcut=i;
},{"././EarcutNode":"ToUH"}],"IFWI":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.CONST3D2D=void 0;var e=function e(){t(this,e)};exports.CONST3D2D=e,e.BYTES_PE=4,e.BYTES_PIDX=2,e.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],e.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],e._TMPARRAY=[],e._OFFSETX=0,e._OFFSETY=0;
},{}],"8e/+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Submit=void 0;var e=require("././SubmitBase"),t=require("../../utils/Stat"),n=require("../WebGLContext"),r=require("../canvas/BlendMode"),o=require("../utils/CONST3D2D");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(i){function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.SubmitBase.TYPE_2D;return u(this,a),l(this,d(a).call(this,t))}return h(a,e.SubmitBase),s(a,[{key:"renderSubmit",value:function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var e=this.shaderValue.textureHost;if(e){var o=e._getSource();if(!o)return 1;this.shaderValue.texture=o}var i=n.WebGLContext.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),r.BlendMode.activeBlendFunction!==this._blendFn&&(n.WebGLContext.setBlend(i,!0),this._blendFn(i),r.BlendMode.activeBlendFunction=this._blendFn),i.drawElements(n.WebGLContext.TRIANGLES,this._numEle,n.WebGLContext.UNSIGNED_SHORT,this._startIdx),t.Stat.renderBatches++,t.Stat.trianglesFaces+=this._numEle/3,1}},{key:"releaseRender",value:function(){e.SubmitBase.RENDERBASE!=this&&--this._ref<1&&(a.POOL[a._poolSize++]=this,this.shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))}}],[{key:"create",value:function(e,t,n){var i=a._poolSize?a.POOL[--a._poolSize]:new a;i._ref=1,i._mesh=t,i._key.clear(),i._startIdx=t.indexNum*o.CONST3D2D.BYTES_PIDX,i._numEle=0;var u=e._nBlendType;i._blendFn=e._targets?r.BlendMode.targetFns[u]:r.BlendMode.fns[u],i.shaderValue=n,i.shaderValue.setValue(e._shader2D);var s=e._shader2D.filters;return s&&i.shaderValue.setFilters(s),i}},{key:"createShape",value:function(e,t,n,o){var i=a._poolSize?a.POOL[--a._poolSize]:new a;i._mesh=t,i._numEle=n,i._startIdx=2*t.indexNum,i._ref=1,i.shaderValue=o,i.shaderValue.setValue(e._shader2D);var u=e._nBlendType;return i._key.blendShader=u,i._blendFn=e._targets?r.BlendMode.targetFns[u]:r.BlendMode.fns[u],i}}]),a}();exports.Submit=_,_._poolSize=0,_.POOL=[];
},{"././SubmitBase":"U5L8","../../utils/Stat":"xuKH","../WebGLContext":"vf9T","../canvas/BlendMode":"brGx","../utils/CONST3D2D":"IFWI"}],"wNtg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubmitCanvas=void 0;var e=require("././SubmitBase"),t=require("../../maths/Matrix"),r=require("../shader/d2/value/Value2D"),n=require("../utils/CONST3D2D"),a=require("../utils/RenderState2D");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?f(e):t}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(o){function l(){var a;return i(this,l),(a=s(this,d(l).call(this,e.SubmitBase.TYPE_2D)))._matrix=new t.Matrix,a._matrix4=n.CONST3D2D.defaultMatrix4.concat(),a.shaderValue=new r.Value2D(0,0),a}return c(l,e.SubmitBase),u(l,[{key:"renderSubmit",value:function(){var e=a.RenderState2D.worldAlpha,r=a.RenderState2D.worldMatrix4,n=a.RenderState2D.worldMatrix,o=a.RenderState2D.worldFilters,i=a.RenderState2D.worldShaderDefines,l=this.shaderValue,u=this._matrix,s=this._matrix4,f=t.Matrix.TEMP;return t.Matrix.mul(u,n,f),s[0]=f.a,s[1]=f.b,s[4]=f.c,s[5]=f.d,s[12]=f.tx,s[13]=f.ty,a.RenderState2D.worldMatrix=f.clone(),a.RenderState2D.worldMatrix4=s,a.RenderState2D.worldAlpha=a.RenderState2D.worldAlpha*l.alpha,l.filters&&l.filters.length&&(a.RenderState2D.worldFilters=l.filters,a.RenderState2D.worldShaderDefines=l.defines),this.canv.flushsubmit(),a.RenderState2D.worldAlpha=e,a.RenderState2D.worldMatrix4=r,a.RenderState2D.worldMatrix.destroy(),a.RenderState2D.worldMatrix=n,a.RenderState2D.worldFilters=o,a.RenderState2D.worldShaderDefines=i,1}},{key:"releaseRender",value:function(){if(--this._ref<1){var e=l.POOL;this._mesh=null,e[e._length++]=this}}},{key:"getRenderType",value:function(){return e.SubmitBase.TYPE_CANVAS}}],[{key:"create",value:function(e,t,r){var n=l.POOL._length?l.POOL[--l.POOL._length]:new l;n.canv=e,n._ref=1,n._numEle=0;var a=n.shaderValue;return a.alpha=t,a.defines.setValue(0),r&&r.length&&a.setFilters(r),n}}]),l}();exports.SubmitCanvas=p,p.POOL=[],p.POOL._length=0;
},{"././SubmitBase":"U5L8","../../maths/Matrix":"GG2z","../shader/d2/value/Value2D":"cqLV","../utils/CONST3D2D":"IFWI","../utils/RenderState2D":"k75q"}],"wued":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubmitTarget=void 0;var e=require("././SubmitKey"),t=require("../../utils/Stat"),n=require("../WebGLContext"),r=require("../canvas/BlendMode"),a=require("../utils/CONST3D2D");function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}var o=function(){function l(){i(this,l),this.blendType=0,this._ref=1,this._key=new e.SubmitKey}return u(l,[{key:"renderSubmit",value:function(){var e=n.WebGLContext.mainContext;this._mesh.useMesh(e);var r=this.srcRT;return r&&(this.shaderValue.texture=r._getSource(),this.shaderValue.upload(),this.blend(),t.Stat.renderBatches++,t.Stat.trianglesFaces+=this._numEle/3,n.WebGLContext.mainContext.drawElements(n.WebGLContext.TRIANGLES,this._numEle,n.WebGLContext.UNSIGNED_SHORT,this._startIdx)),1}},{key:"blend",value:function(){if(r.BlendMode.activeBlendFunction!==r.BlendMode.fns[this.blendType]){var e=n.WebGLContext.mainContext;e.enable(n.WebGLContext.BLEND),r.BlendMode.fns[this.blendType](e),r.BlendMode.activeBlendFunction=r.BlendMode.fns[this.blendType]}}},{key:"getRenderType",value:function(){return 0}},{key:"releaseRender",value:function(){if(--this._ref<1){var e=l.POOL;e[e._length++]=this}}}],[{key:"create",value:function(e,t,n,r){var i=l.POOL._length?l.POOL[--l.POOL._length]:new l;if(i._mesh=t,i.srcRT=r,i._startIdx=t.indexNum*a.CONST3D2D.BYTES_PIDX,i._ref=1,i._key.clear(),i._numEle=0,i.blendType=e._nBlendType,i._key.blendShader=i.blendType,i.shaderValue=n,i.shaderValue.setValue(e._shader2D),e._colorFiler){var u=e._colorFiler;n.defines.add(u.type),n.colorMat=u._mat,n.colorAlpha=u._alpha}return i}}]),l}();exports.SubmitTarget=o,o.POOL=[],o.POOL._length=0;
},{"././SubmitKey":"/SF1","../../utils/Stat":"xuKH","../WebGLContext":"vf9T","../canvas/BlendMode":"brGx","../utils/CONST3D2D":"IFWI"}],"MTlA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubmitTexture=void 0;var e=require("././SubmitBase"),t=require("../../utils/Stat"),r=require("../WebGLContext"),n=require("../canvas/BlendMode"),i=require("../shader/BaseShader"),o=require("../shader/d2/ShaderDefines2D"),a=require("../utils/CONST3D2D");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}function c(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(u){function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.SubmitBase.TYPE_2D;return s(this,l),c(this,f(l).call(this,t))}return _(l,e.SubmitBase),d(l,[{key:"releaseRender",value:function(){--this._ref<1&&(l.POOL[l._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))}},{key:"renderSubmit",value:function(){if(0===this._numEle)return 1;var a=this.shaderValue.textureHost;if(a){var u=a?a._getSource():null;if(!u)return 1}var s=r.WebGLContext.mainContext;this._mesh.useMesh(s);var l=e.SubmitBase.preRender,d=e.SubmitBase.preRender._key;return 0===this._key.blendShader&&this._key.submitType===d.submitType&&this._key.blendShader===d.blendShader&&i.BaseShader.activeShader&&e.SubmitBase.preRender.clipInfoID==this.clipInfoID&&l.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&o.ShaderDefines2D.NOOPTMASK)?i.BaseShader.activeShader.uploadTexture2D(u):(n.BlendMode.activeBlendFunction!==this._blendFn&&(r.WebGLContext.setBlend(s,!0),this._blendFn(s),n.BlendMode.activeBlendFunction=this._blendFn),this.shaderValue.texture=u,this.shaderValue.upload()),s.drawElements(r.WebGLContext.TRIANGLES,this._numEle,r.WebGLContext.UNSIGNED_SHORT,this._startIdx),t.Stat.renderBatches++,t.Stat.trianglesFaces+=this._numEle/3,1}}],[{key:"create",value:function(t,r,i){var o=l._poolSize?l.POOL[--l._poolSize]:new l(e.SubmitBase.TYPE_TEXTURE);o._mesh=r,o._key.clear(),o._key.submitType=e.SubmitBase.KEY_DRAWTEXTURE,o._ref=1,o._startIdx=r.indexNum*a.CONST3D2D.BYTES_PIDX,o._numEle=0;var u=t._nBlendType;if(o._key.blendShader=u,o._blendFn=t._targets?n.BlendMode.targetFns[u]:n.BlendMode.fns[u],o.shaderValue=i,t._colorFiler){var s=t._colorFiler;i.defines.add(s.type),i.colorMat=s._mat,i.colorAlpha=s._alpha}return o}}]),l}();exports.SubmitTexture=b,b._poolSize=0,b.POOL=[];
},{"././SubmitBase":"U5L8","../../utils/Stat":"xuKH","../WebGLContext":"vf9T","../canvas/BlendMode":"brGx","../shader/BaseShader":"oKQa","../shader/d2/ShaderDefines2D":"el31","../utils/CONST3D2D":"IFWI"}],"+9Iz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CharSubmitCache=void 0;var t=require("../../maths/Matrix"),e=require("../shader/d2/ShaderDefines2D"),i=require("../shader/d2/value/Value2D"),a=require("../submit/SubmitTexture"),r=require("../../renders/RenderInfo");function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function o(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var l=function(){function n(){s(this,n),this._data=[],this._ndata=0,this._clipid=-1,this._clipMatrix=new t.Matrix,this._enbale=!1}return o(n,[{key:"clear",value:function(){this._tex=null,this._imgId=-1,this._ndata=0,this._enbale=!1,this._colorFiler=null}},{key:"destroy",value:function(){this.clear(),this._data.length=0,this._data=null}},{key:"add",value:function(t,e,i,a,r,s){this._ndata>0&&(this._tex!=e||this._imgId!=i||this._clipid>=0&&this._clipid!=t._clipInfoID)&&this.submit(t),this._clipid=t._clipInfoID,t._globalClipMatrix.copyTo(this._clipMatrix),this._tex=e,this._imgId=i,this._colorFiler=t._colorFiler,this._data[this._ndata]=a,this._data[this._ndata+1]=r,this._data[this._ndata+2]=s,this._ndata+=3}},{key:"getPos",value:function(){return 0==n.__nPosPool?new Array(8):n.__posPool[--n.__nPosPool]}},{key:"enable",value:function(t,e){t!==this._enbale&&(this._enbale=t,this._enbale||this.submit(e))}},{key:"submit",value:function(t){var s=this._ndata;if(s){var o=t._mesh,l=t._colorFiler;t._colorFiler=this._colorFiler;var _=a.SubmitTexture.create(t,o,i.Value2D.create(e.ShaderDefines2D.TEXTURE2D,0));t._submits[t._submits._length++]=t._curSubmit=_,_.shaderValue.textureHost=this._tex,_._key.other=this._imgId,t._colorFiler=l,t._copyClipInfo(_,this._clipMatrix),_.clipInfoID=this._clipid;for(var h=0;h<s;h+=3)o.addQuad(this._data[h],this._data[h+1],this._data[h+2],!0),n.__posPool[n.__nPosPool++]=this._data[h];s/=3,_._numEle+=6*s,o.indexNum+=6*s,o.vertNum+=4*s,t._drawCount+=s,this._ndata=0,r.RenderInfo.loopCount%100==0&&(this._data.length=0)}}}]),n}();exports.CharSubmitCache=l,l.__posPool=[],l.__nPosPool=0;
},{"../../maths/Matrix":"GG2z","../shader/d2/ShaderDefines2D":"el31","../shader/d2/value/Value2D":"cqLV","../submit/SubmitTexture":"MTlA","../../renders/RenderInfo":"5Dwh"}],"cilI":[function(require,module,exports) {
"use strict";function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function i(t,i){for(var e=0;e<i.length;e++){var h=i[e];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function e(t,e,h){return e&&i(t.prototype,e),h&&i(t,h),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.AtlasGrid=void 0;var h=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,i),this.atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._used=0,this._cells=null,this._rowInfo=null,this.atlasID=s,this._init(e,h)}return e(i,[{key:"addRect",value:function(t,i,e,h){return!!this._get(i,e,h)&&(this._fill(h.x,h.y,i,e,t),this._texCount++,!0)}},{key:"_release",value:function(){this._cells=null,this._rowInfo=null}},{key:"_init",value:function(t,i){return this._width=t,this._height=i,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)}},{key:"_get",value:function(t,i,e){if(t>this._width||i>this._height)return!1;for(var h=-1,s=-1,r=this._width,l=this._height,n=this._cells,_=0;_<l;_++)if(!(this._rowInfo[_]<t))for(var o=0;o<r;){var c=3*(_*r+o);if(0!=n[c]||n[c+1]<t||n[c+2]<i)o+=n[c+1];else{h=o,s=_;for(var a=0;a<t;a++)if(n[3*a+c+2]<i){h=-1;break}if(!(h<0))return e.x=h,e.y=s,!0;o+=n[c+1]}}return!1}},{key:"_fill",value:function(t,i,e,h,s){var r=this._width,l=this._height;this._check(t+e<=r&&i+h<=l);for(var n=i;n<h+i;++n){this._check(this._rowInfo[n]>=e),this._rowInfo[n]-=e;for(var _=0;_<e;_++){var o=3*(t+n*r+_);this._check(0==this._cells[o]),this._cells[o]=s,this._cells[o+1]=e,this._cells[o+2]=h}}if(t>0)for(n=0;n<h;++n){var c=0;for(_=t-1;_>=0&&0==this._cells[3*((i+n)*r+_)];--_,++c);for(_=c;_>0;--_)this._cells[3*((i+n)*r+t-_)+1]=_,this._check(_>0)}if(i>0)for(_=t;_<t+e;++_){for(c=0,n=i-1;n>=0&&0==this._cells[3*(_+n*r)];--n,c++);for(n=c;n>0;--n)this._cells[3*(_+(i-n)*r)+2]=n,this._check(n>0)}this._used+=e*h/(this._width*this._height)}},{key:"_check",value:function(t){0==t&&console.log("xtexMerger 错误啦")}},{key:"_clear",value:function(){this._texCount=0;for(var t=0;t<this._height;t++)this._rowInfo[t]=this._width;for(var i=0;i<this._height;i++)for(var e=0;e<this._width;e++){var h=3*(i*this._width+e);this._cells[h]=0,this._cells[h+1]=this._width-e,this._cells[h+2]=this._width-i}}}]),i}();exports.AtlasGrid=h;
},{}],"4VZi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextTexture=void 0;var e=require("././TextAtlas"),t=require("../../layagl/LayaGL"),n=require("../../renders/RenderInfo"),o=require("../../resource/Resource"),r=require("../WebGLContext"),a=require("../../utils/PlatformInfo");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function x(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(i){function s(e,t){var n;return u(this,s),(n=x(this,h(s).call(this)))._texW=0,n._texH=0,n.__destroyed=!1,n._discardTm=0,n.genID=0,n.bitmap={id:0,_glTexture:null},n.curUsedCovRate=0,n.curUsedCovRateAtlas=0,n.lastTouchTm=0,n.ri=null,n._texW=e||s.gTextRender.atlasWidth,n._texH=t||s.gTextRender.atlasWidth,n.bitmap.id=n.id,n.lock=!0,n}return f(s,o.Resource),l(s,[{key:"recreateResource",value:function(){if(!this._source){var e=a.PlatformInfo.onLayaRuntime?t.LayaGL.instance.getDefaultCommandEncoder():r.WebGLContext.mainContext,n=this._source=e.createTexture();this.bitmap._glTexture=n,r.WebGLContext.bindTexture(e,r.WebGLContext.TEXTURE_2D,n),e.texImage2D(r.WebGLContext.TEXTURE_2D,0,r.WebGLContext.RGBA,this._texW,this._texH,0,r.WebGLContext.RGBA,r.WebGLContext.UNSIGNED_BYTE,null),e.texParameteri(r.WebGLContext.TEXTURE_2D,r.WebGLContext.TEXTURE_MIN_FILTER,r.WebGLContext.LINEAR),e.texParameteri(r.WebGLContext.TEXTURE_2D,r.WebGLContext.TEXTURE_MAG_FILTER,r.WebGLContext.LINEAR),e.texParameteri(r.WebGLContext.TEXTURE_2D,r.WebGLContext.TEXTURE_WRAP_S,r.WebGLContext.CLAMP_TO_EDGE),e.texParameteri(r.WebGLContext.TEXTURE_2D,r.WebGLContext.TEXTURE_WRAP_T,r.WebGLContext.CLAMP_TO_EDGE),s.gTextRender.debugUV&&this.fillWhite()}}},{key:"addChar",value:function(e,n,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(s.gTextRender.isWan1Wan)return this.addCharCanvas(e,n,o,i);!this._source&&this.recreateResource();var u=a.PlatformInfo.onLayaRuntime?t.LayaGL.instance.getDefaultCommandEncoder():r.WebGLContext.mainContext;r.WebGLContext.bindTexture(u,r.WebGLContext.TEXTURE_2D,this._source),!a.PlatformInfo.onLayaRuntime&&u.pixelStorei(r.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var l,x,c,h,f=e.data;return e.data instanceof Uint8ClampedArray&&(f=new Uint8Array(f.buffer)),u.texSubImage2D(r.WebGLContext.TEXTURE_2D,0,n,o,e.width,e.height,r.WebGLContext.RGBA,r.WebGLContext.UNSIGNED_BYTE,f),!a.PlatformInfo.onLayaRuntime&&u.pixelStorei(r.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.PlatformInfo.onLayaRuntime?(l=n/this._texW,x=o/this._texH,c=(n+e.width)/this._texW,h=(o+e.height)/this._texH):(l=(n+1)/this._texW,x=o/this._texH,c=(n+e.width-1)/this._texW,h=(o+e.height-1)/this._texH),(i=i||new Array(8))[0]=l,i[1]=x,i[2]=c,i[3]=x,i[4]=c,i[5]=h,i[6]=l,i[7]=h,i}},{key:"addCharCanvas",value:function(e,n,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!this._source&&this.recreateResource();var u,s,l,x,c=a.PlatformInfo.onLayaRuntime?t.LayaGL.instance.getDefaultCommandEncoder():r.WebGLContext.mainContext;return r.WebGLContext.bindTexture(c,r.WebGLContext.TEXTURE_2D,this._source),!a.PlatformInfo.onLayaRuntime&&c.pixelStorei(r.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texSubImage2D(r.WebGLContext.TEXTURE_2D,0,n,o,r.WebGLContext.RGBA,r.WebGLContext.UNSIGNED_BYTE,e),!a.PlatformInfo.onLayaRuntime&&c.pixelStorei(r.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.PlatformInfo.onLayaRuntime?(u=n/this._texW,s=o/this._texH,l=(n+e.width)/this._texW,x=(o+e.height)/this._texH):(u=(n+1)/this._texW,s=(o+1)/this._texH,l=(n+e.width-1)/this._texW,x=(o+e.height-1)/this._texH),(i=i||new Array(8))[0]=u,i[1]=s,i[2]=l,i[3]=s,i[4]=l,i[5]=x,i[6]=u,i[7]=x,i}},{key:"fillWhite",value:function(){!this._source&&this.recreateResource();var e=a.PlatformInfo.onLayaRuntime?t.LayaGL.instance.getDefaultCommandEncoder():r.WebGLContext.mainContext,n=new Uint8Array(this._texW*this._texH*4);n.fill(255),e.texSubImage2D(r.WebGLContext.TEXTURE_2D,0,0,0,this._texW,this._texH,r.WebGLContext.RGBA,r.WebGLContext.UNSIGNED_BYTE,n)}},{key:"discard",value:function(){this._texW==s.gTextRender.atlasWidth&&this._texH==s.gTextRender.atlasWidth?(this.genID++,s.poolLen>=s.pool.length&&(s.pool=s.pool.concat(new Array(10))),this._discardTm=n.RenderInfo.loopStTm,s.pool[s.poolLen++]=this):this.destroy()}},{key:"destroy",value:function(){this.__destroyed=!0;var e=a.PlatformInfo.onLayaRuntime?t.LayaGL.instance.getDefaultCommandEncoder():r.WebGLContext.mainContext;this._source&&e.deleteTexture(this._source),this._source=null}},{key:"touchRect",value:function(t,n){this.lastTouchTm!=n&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=n);var o=s.gTextRender.atlasWidth*s.gTextRender.atlasWidth,r=e.TextAtlas.atlasGridW*e.TextAtlas.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/o,this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/e.TextAtlas.atlasGridW)*Math.ceil(t.bmpHeight/e.TextAtlas.atlasGridW)/(o/r)}},{key:"_getSource",value:function(){return this._source}},{key:"drawOnScreen",value:function(e,t){}},{key:"texture",get:function(){return this}}],[{key:"getTextTexture",value:function(e,t){if(e!=s.gTextRender.atlasWidth||e!=s.gTextRender.atlasWidth)return new s(e,t);if(s.poolLen>0){var n=s.pool[--s.poolLen];return s.poolLen>0&&s.clean(),n}return new s(e,t)}},{key:"clean",value:function(){var e=n.RenderInfo.loopStTm;if(0===s.cleanTm&&(s.cleanTm=e),e-s.cleanTm>=s.gTextRender.checkCleanTextureDt){for(var t=0;t<s.poolLen;t++){var o=s.pool[t];e-o._discardTm>=s.gTextRender.destroyUnusedTextureDt&&(o.destroy(),s.pool[t]=s.pool[s.poolLen-1],s.poolLen--,t--)}s.cleanTm=e}}}]),s}();exports.TextTexture=d,d.gTextRender=null,d.pool=new Array(10),d.poolLen=0,d.cleanTm=0;
},{"././TextAtlas":"wZaE","../../layagl/LayaGL":"ezDE","../../renders/RenderInfo":"5Dwh","../../resource/Resource":"M+wd","../WebGLContext":"vf9T","../../utils/PlatformInfo":"HmZQ"}],"wZaE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextAtlas=void 0;var t=require("././AtlasGrid"),e=require("././TextTexture"),i=require("././TextRender");function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}var n=function(){function a(){r(this,a),this.texWidth=1024,this.texHeight=1024,this.protectDist=1,this.texture=null,this.charMaps={},this.texHeight=this.texWidth=i.TextRender.atlasWidth,this.texture=e.TextTexture.getTextTexture(this.texWidth,this.texHeight),this.texWidth/a.atlasGridW>256&&(a.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new t.AtlasGrid(this.texWidth/a.atlasGridW,this.texHeight/a.atlasGridW,this.texture.id)}return s(a,[{key:"setProtecteDist",value:function(t){this.protectDist=t}},{key:"getAEmpty",value:function(t,e,i){var r=this.atlasgrid.addRect(1,Math.ceil(t/a.atlasGridW),Math.ceil(e/a.atlasGridW),i);return r&&(i.x*=a.atlasGridW,i.y*=a.atlasGridW),r}},{key:"destroy",value:function(){for(var t in this.charMaps){this.charMaps[t].deleted=!0}this.texture.discard()}},{key:"printDebugInfo",value:function(){}},{key:"usedRate",get:function(){return this.atlasgrid._used}}]),a}();exports.TextAtlas=n,n.atlasGridW=16;
},{"././AtlasGrid":"cilI","././TextTexture":"4VZi","././TextRender":"LV+0"}],"1cf6":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FontInfo=void 0;var i=function(){function e(n){t(this,e),this._font="14px Arial",this._family="Arial",this._size=14,this._italic=!1,this._bold=!1,this._id=e._gfontID++,this.setFont(n||this._font)}return n(e,[{key:"setFont",value:function(t){this._font=t;var e=t.split(" "),n=e.length;if(n<2)1==n&&e[0].indexOf("px")>0&&(this._size=parseInt(e[0]));else{for(var i=-1,o=0;o<n;o++)if(e[o].indexOf("px")>0||e[o].indexOf("pt")>0){i=o,this._size=parseInt(e[o]),this._size<=0&&(console.error("font parse error:"+t),this._size=14);break}var r=i+1,s=e[r];for(r++;r<n;r++)s+=" "+e[r];this._family=s.split(",")[0],this._italic=e.indexOf("italic")>=0,this._bold=e.indexOf("bold")>=0}}}],[{key:"Parse",value:function(t){if(t===e._lastFont)return e._lastFontInfo;var n=e._cache[t];return n||(n=e._cache[t]=new e(t)),e._lastFont=t,e._lastFontInfo=n,n}}]),e}();exports.FontInfo=i,i.EMPTY=new i(null),i._cache={},i._gfontID=0,i._lastFont="";
},{}],"RVK6":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.WordText=void 0;var r=function(){function e(){t(this,e),this.save=[],this.toUpperCase=null,this.width=-1,this.pageChars=[],this.startID=0,this.startIDStroke=0,this.lastGCCnt=0,this.splitRender=!1}return n(e,[{key:"setText",value:function(t){this.changed=!0,this._text=t,this.width=-1,this.cleanCache()}},{key:"toString",value:function(){return this._text}},{key:"charCodeAt",value:function(t){return this._text?this._text.charCodeAt(t):NaN}},{key:"charAt",value:function(t){return this._text?this._text.charAt(t):null}},{key:"cleanCache",value:function(){this.pageChars.forEach(function(t){var e=t.tex;t.words;1==t.words.length&&e&&e.ri&&e.destroy()}),this.pageChars=[],this.startID=0}},{key:"length",get:function(){return this._text?this._text.length:0}}]),e}();exports.WordText=r;
},{}],"Nw20":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CharRenderInfo=void 0;var e=require("../../renders/RenderInfo");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=function(){function r(){t(this,r),this.char="",this.deleted=!1,this.uv=new Array(8),this.pos=0,this.orix=0,this.oriy=0,this.touchTick=0,this.isSpace=!1}return n(r,[{key:"touch",value:function(){var t=e.RenderInfo.loopCount;this.touchTick!=t&&this.tex.touchRect(this,t),this.touchTick=t}}]),r}();exports.CharRenderInfo=o;
},{"../../renders/RenderInfo":"5Dwh"}],"a3UO":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ICharRender=void 0;var r=function(){function n(){e(this,n)}return t(n,[{key:"getWidth",value:function(e,n){return 0}},{key:"scale",value:function(e,n){}},{key:"getCharBmp",value:function(e,n,t,r,o,u,a,i,c,l){arguments.length>10&&void 0!==arguments[10]&&arguments[10];return null}},{key:"canvasWidth",get:function(){return 0},set:function(e){}}]),n}();exports.ICharRender=r;
},{}],"K+/B":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CharRender_Canvas=void 0;var t=require("./ICharRender");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}function i(t,a){return!a||"object"!==e(a)&&"function"!=typeof a?o(t):a}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(e){function n(t,e){var s,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return a(this,n),(s=i(this,r(n).call(this))).ctx=null,s.lastScaleX=1,s.lastScaleY=1,s.needResetScale=!1,s.maxTexW=0,s.maxTexH=0,s.scaleFontSize=!0,s.showDbgInfo=!1,s.supportImageData=!0,s.maxTexW=t,s.maxTexH=e,s.scaleFontSize=o,s.supportImageData=l,s.showDbgInfo=c,n.canvas||(n.canvas=window.document.createElement("canvas"),n.canvas.width=1024,n.canvas.height=512,n.canvas.style.left="-10000px",n.canvas.style.position="absolute",document.body.appendChild(n.canvas),s.ctx=n.canvas.getContext("2d")),s}return l(n,t.ICharRender),s(n,[{key:"getWidth",value:function(t,e){return this.ctx?(this.ctx._lastFont!=t&&(this.ctx.font=t,this.ctx._lastFont=t),this.ctx.measureText(e).width):0}},{key:"scale",value:function(t,e){if(!this.supportImageData)return this.lastScaleX=t,void(this.lastScaleY=e);this.lastScaleX==t&&this.lastScaleY==e||(this.ctx.setTransform(t,0,0,e,0,0),this.lastScaleX=t,this.lastScaleY=e)}},{key:"getCharBmp",value:function(t,e,a,s,i,o,r,l,c,h){var f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;if(!this.supportImageData)return this.getCharCanvas(t,e,a,s,i,o,r,l,c,h);var u=this.ctx;u.font!=e&&(u.font=e,u._lastFont=e),o.width=u.measureText(t).width;var v=o.width*this.lastScaleX,d=o.height*this.lastScaleY;v+=(r+c)*this.lastScaleX,d+=(l+h)*this.lastScaleY,v=Math.ceil(v),d=Math.ceil(d);var p=(v=Math.min(v,n.canvas.width))+2*a+1,x=(d=Math.min(d,n.canvas.height))+2*a+1;f&&(p=Math.max(p,f[0]+f[2]+1),x=Math.max(x,f[1]+f[3]+1)),u.clearRect(0,0,p,x),u.save(),u.textBaseline="top",a>0&&(u.strokeStyle=i,u.lineWidth=a,u.strokeText(t,r,l)),u.fillStyle=s,u.fillText(t,r,l),this.showDbgInfo&&(u.strokeStyle="#ff0000",u.strokeRect(0,0,v,d),u.strokeStyle="#00ff00",u.strokeRect(r,l,o.width,o.height)),f&&-1==f[2]&&(f[2]=Math.ceil((o.width+2*a)*this.lastScaleX));var m=f?u.getImageData(f[0],f[1],f[2],f[3]):u.getImageData(0,0,v,d);return u.restore(),o.bmpWidth=m.width,o.bmpHeight=m.height,m}},{key:"getCharCanvas",value:function(t,e,a,s,i,o,r,l,c,h){var f=this.ctx;f.font!=e&&(f.font=e,f._lastFont=e),o.width=f.measureText(t).width;var u=o.width*this.lastScaleX,v=o.height*this.lastScaleY;return u+=(r+c)*this.lastScaleX,v+=(l+h)*this.lastScaleY+1,u=Math.min(u,this.maxTexW),v=Math.min(v,this.maxTexH),n.canvas.width=Math.min(u+1,this.maxTexW),n.canvas.height=Math.min(v+1,this.maxTexH),f.font=e,f.clearRect(0,0,u+1+a,v+1+a),f.setTransform(1,0,0,1,0,0),f.save(),this.scaleFontSize&&f.scale(this.lastScaleX,this.lastScaleY),f.translate(r,l),f.textAlign="left",f.textBaseline="top",a>0?(f.strokeStyle=i,f.fillStyle=s,f.lineWidth=a,f.fillAndStrokeText?f.fillAndStrokeText(t,0,0):(f.strokeText(t,0,0),f.fillText(t,0,0))):(f.fillStyle=s,f.fillText(t,0,0)),this.showDbgInfo&&(f.strokeStyle="#ff0000",f.strokeRect(0,0,u,v),f.strokeStyle="#00ff00",f.strokeRect(0,0,o.width,o.height)),f.restore(),o.bmpWidth=n.canvas.width,o.bmpHeight=n.canvas.height,n.canvas}},{key:"canvasWidth",get:function(){return n.canvas.width},set:function(t){n.canvas.width!=t&&(n.canvas.width=t,t>2048&&console.warn("画文字设置的宽度太大，超过2048了"),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.lastScaleX,this.lastScaleY))}}]),n}();exports.CharRender_Canvas=h,h.canvas=null;
},{"./ICharRender":"a3UO"}],"8y2Y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CharRender_Native=void 0;var t=require("./ICharRender"),e=require("../../utils/ColorUtils");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function u(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=function(n){function r(){var t;return o(this,r),(t=u(this,c(r).call(this))).lastFont="",t}return l(r,t.ICharRender),i(r,[{key:"getWidth",value:function(t,e){return window.conchTextCanvas?(window.conchTextCanvas.font=t,this.lastFont=t,window.conchTextCanvas.measureText(e).width):0}},{key:"scale",value:function(t,e){}},{key:"getCharBmp",value:function(t,n,o,r,i,u,a,c,l,f){arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(!window.conchTextCanvas)return null;window.conchTextCanvas.font=n,this.lastFont=n;u.width=window.conchTextCanvas.measureText(t).width,u.height;var s=e.ColorUtils.create(i).numColor,h=e.ColorUtils.create(r).numColor,p=window.conchTextCanvas.getTextBitmapData(t,h,o>2?2:o,s);return u.bmpWidth=p.width,u.bmpHeight=p.height,p}}]),r}();exports.CharRender_Native=s;
},{"./ICharRender":"a3UO","../../utils/ColorUtils":"iLoT"}],"NuLl":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextConst=void 0;var e=function e(){t(this,e)};exports.TextConst=e,e.ENUM_TEXTALIGN_CENTER=0,e.ENUM_TEXTALIGN_LEFT=1,e.ENUM_TEXTALIGN_RIGHT=2,e.defFont="Arial";
},{}],"LV+0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextRender=void 0;var t=require("././TextAtlas"),e=require("././TextTexture"),i=require("../../display/Sprite"),a=require("../../maths/Point"),s=require("../../renders/RenderInfo"),r=require("../../resource/Texture"),n=require("../../utils/FontInfo"),o=require("../../utils/WordText"),h=require("./CharRenderInfo"),l=require("./CharRender_Canvas"),f=require("./CharRender_Native"),u=require("../../utils/PlatformInfo"),c=require("../../display/TextConst");function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function g(t,e,i){return e&&x(t.prototype,e),i&&x(t,i),t}var m=function(){function x(){d(this,x),this.fontSizeInfo={},this.charRender=null,this.mapFont={},this.fontID=0,this.mapColor=[],this.colorID=0,this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.textAtlases=[],this.isoTextures=[],this.lastFont=null,this.fontSizeW=0,this.fontSizeH=0,this.fontSizeOffX=0,this.fontSizeOffY=0,this.renderPerChar=!0,this.tmpAtlasPos=new a.Point,this.textureMem=0;var t=!1,e=window,i=e.Laya&&e.Laya.MiniAdpter;i&&i.systemInfo&&i.systemInfo.system&&(t="ios 10.1.1"===i.systemInfo.system.toLowerCase()),u.PlatformInfo.onMiniGame&&!t&&(x.isWan1Wan=!0),u.PlatformInfo.onLimixiu&&(x.isWan1Wan=!0),this.charRender=u.PlatformInfo.onLayaRuntime?new f.CharRender_Native:new l.CharRender_Canvas(x.atlasWidth,x.atlasWidth,x.scaleFontWithCtx,!x.isWan1Wan,!1),x.textRenderInst=this,x.atlasWidth2=x.atlasWidth*x.atlasWidth}return g(x,[{key:"setFont",value:function(t){if(this.lastFont!=t){this.lastFont=t;var e=this.getFontSizeInfo(t._family),i=e>>24,a=e>>16&255,s=e>>8&255,r=255&e,n=t._size/x.standardFontSize;this.fontSizeOffX=Math.ceil(i*n),this.fontSizeOffY=Math.ceil(a*n),this.fontSizeW=Math.ceil(s*n),this.fontSizeH=Math.ceil(r*n),t._font.indexOf("italic")>=0?this.fontStr=t._font.replace("italic",""):this.fontStr=t._font}}},{key:"getNextChar",value:function(t){var e=t.length,i=this._curStrPos;if(i>=e)return null;for(var a=i,s=0;a<e;a++){var r=t.charCodeAt(a);if(r>>>11==27){if(1==s)break;s=1,a++}else if(65038===r||65039===r);else if(8205==r)s=2;else if(0==s)s=1;else if(1==s)break}return this._curStrPos=a,t.substring(i,a)}},{key:"filltext",value:function(t,e,i,a,s,r,o,h,l){var f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;if(!(e.length<=0)){var u=n.FontInfo.Parse(s),d=0;switch(l){case"center":d=c.TextConst.ENUM_TEXTALIGN_CENTER;break;case"right":d=c.TextConst.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,a,u,r,o,h,d,f)}}},{key:"fillWords",value:function(t,e,i,a,s,r,o,h){if(e&&!(e.length<=0)){var l=n.FontInfo.Parse(s);this._fast_filltext(t,null,e,i,a,l,r,o,h,0,0)}}},{key:"_fast_filltext",value:function(t,e,i,a,s,r,n,h,l,f){arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(!(e&&e.length<1||i&&i.length<1)){if(l<0&&(l=0),this.setFont(r),this.fontScaleX=this.fontScaleY=1,!u.PlatformInfo.onLayaRuntime&&x.scaleFontWithCtx){var d=1,g=1;if(u.PlatformInfo.onLayaRuntime?(d=t._curMat.getScaleX(),g=t._curMat.getScaleY()):(d=t.getMatScaleX(),g=t.getMatScaleY()),d<1e-4||g<.1)return;d>1&&(this.fontScaleX=d),g>1&&(this.fontScaleY=g)}r._italic&&(t._italicDeg=13);var m=e,p=!i&&e instanceof o.WordText,v=e,S=!!i,R=p?m.pageChars:[],y=0;switch(p?(v=m._text,(y=m.width)<0&&(y=m.width=this.charRender.getWidth(this.fontStr,v))):y=v?this.charRender.getWidth(this.fontStr,v):0,f){case c.TextConst.ENUM_TEXTALIGN_CENTER:a-=y/2;break;case c.TextConst.ENUM_TEXTALIGN_RIGHT:a-=y}m&&R&&this.hasFreedText(R)&&(R=m.pageChars=[]);var T=null,_=(p||x.forceWholeRender,this.renderPerChar=!p||x.forceSplitRender||S||p&&m.splitRender);if(!R||R.length<1)if(_){var C,I=0,w=0;for(this._curStrPos=0;;){if(S){var W=i[this._curStrPos++];W?(C=W.char,I=W.x,w=W.y):C=null}else C=this.getNextChar(v);if(!C)break;if(!(T=this.getCharRenderInfo(C,r,n,h,l,!1)))break;if(T.isSpace);else{var A=R[T.tex.id];if(A)A=A.words;else{var b={texgen:T.tex.genID,tex:T.tex,words:[]};R[T.tex.id]=b,A=b.words}u.PlatformInfo.onLayaRuntime?A.push({ri:T,x:I,y:w,w:T.bmpWidth/this.fontScaleX,h:T.bmpHeight/this.fontScaleY}):A.push({ri:T,x:I+1/this.fontScaleX,y:w,w:(T.bmpWidth-2)/this.fontScaleX,h:(T.bmpHeight-1)/this.fontScaleY}),I+=T.width}}}else{var B=x.noAtlas||y*this.fontScaleX>x.atlasWidth;T=this.getCharRenderInfo(v,r,n,h,l,B),u.PlatformInfo.onLayaRuntime?R[0]={texgen:T.tex.genID,tex:T.tex,words:[{ri:T,x:0,y:0,w:T.bmpWidth/this.fontScaleX,h:T.bmpHeight/this.fontScaleY}]}:R[0]={texgen:T.tex.genID,tex:T.tex,words:[{ri:T,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(T.bmpWidth-2)/this.fontScaleX,h:(T.bmpHeight-1)/this.fontScaleY}]}}this._drawResortedWords(t,a,s,R),t._italicDeg=0}}},{key:"_drawResortedWords",value:function(t,e,i,a){for(var s=t._charSubmitCache&&t._charSubmitCache._enbale,r=t._curMat,n=a.length,o=0;o<n;o++){var h=a[o];if(h){var l=h.words,f=l.length;if(!(f<=0))for(var c=a[o].tex,d=0;d<f;d++){var x=l[d],g=x.ri;if(!g.isSpace){if(g.touch(),t.drawTexAlign=!0,u.PlatformInfo.onLayaRuntime)t._drawTextureM(c.texture,e+x.x-g.orix,i+x.y-g.oriy,x.w,x.h,null,1,g.uv);else{var m=c;t._inner_drawTexture(m.texture,m.id,e+x.x-g.orix,i+x.y-g.oriy,x.w,x.h,r,g.uv,1,s)}t.touches&&t.touches.push(g)}}}}}},{key:"hasFreedText",value:function(t){for(var e=t.length,i=0;i<e;i++){var a=t[i];if(a){var s=a.tex;if(s.__destroyed||s.genID!=a.texgen)return!0}}return!1}},{key:"getCharRenderInfo",value:function(t,i,a,s,r){var n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this.mapFont[i._family];null==o&&(this.mapFont[i._family]=o=this.fontID++);var l=t+"_"+o+"_"+i._size+"_"+a;r>0&&(l+="_"+s+r),i._bold&&(l+="P"),1==this.fontScaleX&&1==this.fontScaleY||(l+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var f=0,u=this.textAtlases.length,c=null,d=null;if(!n)for(f=0;f<u;f++)if(c=(d=this.textAtlases[f]).charMaps[l])return c.touch(),c;c=new h.CharRenderInfo,this.charRender.scale(this.fontScaleX,this.fontScaleY),c.char=t,c.height=i._size;var g=i._size/3|0,m=null,p=Math.ceil(this.charRender.getWidth(this.fontStr,t)*this.fontScaleX);if(p>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,p+2*g)),n){m=this.charRender.getCharBmp(t,this.fontStr,r,a,s,c,g,g,g,g,null);var v=e.TextTexture.getTextTexture(m.width,m.height);v.addChar(m,0,0,c.uv),c.tex=v,c.orix=g,c.oriy=g,v.ri=c,this.isoTextures.push(v)}else{var S=t.length,R=1*r,y=Math.ceil((this.fontSizeW+2*R)*this.fontScaleX),T=Math.ceil((this.fontSizeH+2*R)*this.fontScaleY);x.imgdtRect[0]=(g-this.fontSizeOffX-R)*this.fontScaleX|0,x.imgdtRect[1]=(g-this.fontSizeOffY-R)*this.fontScaleY|0,this.renderPerChar||1==S?(x.imgdtRect[2]=Math.max(p,y),x.imgdtRect[3]=Math.max(p,T)):(x.imgdtRect[2]=-1,x.imgdtRect[3]=T),m=this.charRender.getCharBmp(t,this.fontStr,r,a,s,c,g,g,g,g,x.imgdtRect),d=this.addBmpData(m,c),x.isWan1Wan?(c.orix=g,c.oriy=g):(c.orix=this.fontSizeOffX+R,c.oriy=this.fontSizeOffY+R),d.charMaps[l]=c}return c}},{key:"addBmpData",value:function(e,i){for(var a=e.width,s=e.height,r=this.textAtlases.length,n=null,o=!1,h=0;h<r&&!(o=(n=this.textAtlases[h]).getAEmpty(a,s,this.tmpAtlasPos));h++);if(!o){if(n=new t.TextAtlas,this.textAtlases.push(n),!(o=n.getAEmpty(a,s,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return o&&(n.texture.addChar(e,this.tmpAtlasPos.x,this.tmpAtlasPos.y,i.uv),i.tex=n.texture),n}},{key:"GC",value:function(){for(var t=0,i=this.textAtlases.length,a=x.destroyAtlasDt,r=0,n=s.RenderInfo.loopCount,o=-1,h=0,l=null,f=null;t<i;t++){if(l=(f=this.textAtlases[t]).texture){l.curUsedCovRate,r+=l.curUsedCovRateAtlas;var u=f.usedRate-l.curUsedCovRateAtlas;h<u&&(h=u,o=t)}n-f.texture.lastTouchTm>a&&(x.showLog&&console.log(f.texture.id),f.destroy(),this.textAtlases[t]=this.textAtlases[i-1],i--,t--,o=-1)}for(this.textAtlases.length=i,i=this.isoTextures.length,t=0;t<i;t++)n-(l=this.isoTextures[t]).lastTouchTm>x.destroyUnusedTextureDt&&(l.ri.deleted=!0,l.ri.tex=null,l.destroy(),this.isoTextures[t]=this.isoTextures[i-1],i--,t--);this.isoTextures.length=i;var c=this.textAtlases.length>1&&this.textAtlases.length-r>=2;(x.atlasWidth*x.atlasWidth*4*this.textAtlases.length>x.cleanMem||c||x.simClean)&&(x.simClean=!1,x.showLog&&console.log("清理使用率低的贴图。总使用率:",r,":",this.textAtlases.length,"最差贴图:"+o),o>=0&&((f=this.textAtlases[o]).destroy(),this.textAtlases[o]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),e.TextTexture.clean()}},{key:"cleanAtlases",value:function(){}},{key:"getCharBmp",value:function(t){}},{key:"checkBmpLine",value:function(t,e,i,a){this.bmpData32.buffer!=t.data.buffer&&(this.bmpData32=new Uint32Array(t.data.buffer));for(var s=t.width*e+i,r=i;r<a;r++)if(0!=this.bmpData32[s++])return!0;return!1}},{key:"updateBbx",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t.width,s=t.height,r=0,n=e[1],o=0,h=n;if(this.checkBmpLine(t,n,0,a))for(;;){if((h=(n+o)/2|0)+1>=n){e[1]=h;break}this.checkBmpLine(t,h,0,a)?n=h:o=h}if(e[3]>s)e[3]=s;else if(h=n=e[3],o=s,this.checkBmpLine(t,n,0,a))for(;;){if((h=(n+o)/2|0)-1<=n){e[3]=h;break}this.checkBmpLine(t,h,0,a)?n=h:o=h}if(!i){var l=e[0],f=a*e[1];for(h=e[1];h<e[3];h++){for(r=0;r<l;r++)if(0!=this.bmpData32[f+r]){l=r;break}f+=a}e[0]=l;var u=e[2];for(f=a*e[1],h=e[1];h<e[3];h++){for(r=u;r<a;r++)if(0!=this.bmpData32[f+r]){u=r;break}f+=a}e[2]=u}}},{key:"getFontSizeInfo",value:function(t){var e=this.fontSizeInfo[t];if(null!=e)return e;var i="bold "+x.standardFontSize+"px "+t;if(x.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(i,"有"),this.fontSizeH=1.5*x.standardFontSize;var a=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[t]=a,a}x.pixelBBX[0]=x.standardFontSize/2,x.pixelBBX[1]=x.standardFontSize/2,x.pixelBBX[2]=x.standardFontSize,x.pixelBBX[3]=x.standardFontSize;var s=16,r=16;this.charRender.scale(1,1),x.tmpRI.height=x.standardFontSize;var n=this.charRender.getCharBmp("g",i,0,"red",null,x.tmpRI,s,r,16,16);u.PlatformInfo.onLayaRuntime&&(n.data=new Uint8ClampedArray(n.data)),this.bmpData32=new Uint32Array(n.data.buffer),this.updateBbx(n,x.pixelBBX,!1),n=this.charRender.getCharBmp("有",i,0,"red",null,x.tmpRI,r,r,16,16),u.PlatformInfo.onLayaRuntime&&(n.data=new Uint8ClampedArray(n.data)),this.bmpData32=new Uint32Array(n.data.buffer),x.pixelBBX[2]<s+x.tmpRI.width&&(x.pixelBBX[2]=s+x.tmpRI.width),this.updateBbx(n,x.pixelBBX,!1),u.PlatformInfo.onLayaRuntime&&(s=0,r=0);var o=Math.max(s-x.pixelBBX[0],0)<<24|Math.max(r-x.pixelBBX[1],0)<<16|x.pixelBBX[2]-x.pixelBBX[0]<<8|x.pixelBBX[3]-x.pixelBBX[1];return this.fontSizeInfo[t]=o,o}},{key:"printDbgInfo",value:function(){for(var t in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+x.atlasWidth+"x"+x.atlasWidth," 用canvas:",x.isWan1Wan),console.log("图集占用空间:"+x.atlasWidth*x.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var e=this.getFontSizeInfo(t),i=e>>24,a=e>>16&255,r=e>>8&255,n=255&e;console.log("    "+t," off:",i,a," size:",r,n)}var o=0;console.log("缓存数据:");var h=0,l=0;this.textAtlases.forEach(function(t){var e=t.texture.id,i=s.RenderInfo.loopCount-t.texture.lastTouchTm,a=i>0?i+"帧以前":"当前帧";for(var r in h+=t.texture.curUsedCovRate,l+=t.texture.curUsedCovRateAtlas,console.log("--图集(id:"+e+",当前使用率:"+(1e3*t.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*t.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*t.usedRate|0,"%, 使用于:"+a+")--:"),t.charMaps){var n=t.charMaps[r];console.log("     off:",n.orix,n.oriy," bmp宽高:",n.bmpWidth,n.bmpHeight,"无效:",n.deleted,"touchdt:",s.RenderInfo.loopCount-n.touchTick,"位置:",n.uv[0]*x.atlasWidth|0,n.uv[1]*x.atlasWidth|0,"字符:",n.char,"key:",r),o++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",s.RenderInfo.loopCount-t.lastTouchTm,"char:",t.ri.char)}),console.log("总缓存:",o,"总使用率:",h,"总当前图集使用率:",l)}},{key:"showAtlas",value:function(t,e,a,s,n,o){if(!this.textAtlases[t])return console.log("没有这个图集"),null;var h=new i.Sprite,l=this.textAtlases[t].texture,f={width:x.atlasWidth,height:x.atlasWidth,sourceWidth:x.atlasWidth,sourceHeight:x.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return l._getSource()},bitmap:{id:l.id},_uv:r.Texture.DEF_UV};return h.size=function(t,i){return this.width=t,this.height=i,h.graphics.clear(),h.graphics.drawRect(0,0,h.width,h.height,e),h.graphics.drawTexture(f,0,0,h.width,h.height),this},h.graphics.drawRect(0,0,n,o,e),h.graphics.drawTexture(f,0,0,n,o),h.pos(a,s),window.Laya.stage.addChild(h),h}},{key:"filltext_native",value:function(t,e,i,a,s,r,o,h,l,f){var u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;if(!(e&&e.length<=0||i&&i.length<1)){var d=n.FontInfo.Parse(r),x=0;switch(f){case"center":x=c.TextConst.ENUM_TEXTALIGN_CENTER;break;case"right":x=c.TextConst.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(t,e,i,a,s,d,o,h,l,x,u)}}}]),x}();exports.TextRender=m,m.useOldCharBook=!1,m.atlasWidth=2048,m.noAtlas=!1,m.forceSplitRender=!1,m.forceWholeRender=!1,m.scaleFontWithCtx=!0,m.standardFontSize=32,m.destroyAtlasDt=10,m.checkCleanTextureDt=2e3,m.destroyUnusedTextureDt=3e3,m.cleanMem=104857600,m.isWan1Wan=!1,m.showLog=!1,m.debugUV=!1,m.atlasWidth2=4194304,m.tmpRI=new h.CharRenderInfo,m.pixelBBX=[0,0,0,0],m.textRenderInst=null,m.imgdtRect=[0,0,0,0],m.simClean=!1,e.TextTexture.gTextRender=m;
},{"././TextAtlas":"wZaE","././TextTexture":"4VZi","../../display/Sprite":"LHsS","../../maths/Point":"ziZY","../../renders/RenderInfo":"5Dwh","../../resource/Texture":"nP6w","../../utils/FontInfo":"1cf6","../../utils/WordText":"RVK6","./CharRenderInfo":"Nw20","./CharRender_Canvas":"K+/B","./CharRender_Native":"8y2Y","../../utils/PlatformInfo":"HmZQ","../../display/TextConst":"NuLl"}],"TY9w":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HTMLCanvas=void 0;var t=require("././Bitmap"),e=require("././Texture"),r=require("././Texture2D"),o=require("../utils/PlatformInfo");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?c(t):e}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var o=a(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function a(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function l(t,e,r){return e&&f(t.prototype,e),r&&f(t,r),t}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var x=function(n){function a(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i(this,a),(t=u(this,h(a).call(this)))._source=e?document.createElement("canvas"):c(t),t.lock=!0,t}return _(a,t.Bitmap),l(a,[{key:"_getSource",value:function(){return this._source}},{key:"source",get:function(){return this._source}}]),l(a,[{key:"clear",value:function(){this._ctx&&this._ctx.clear&&this._ctx.clear(),this._texture&&(this._texture.destroy(),this._texture=null)}},{key:"destroy",value:function(){s(h(a.prototype),"destroy",this).call(this),this._setCPUMemory(0),this._ctx&&this._ctx.destroy(),this._ctx=null}},{key:"release",value:function(){}},{key:"_setContext",value:function(t){this._ctx=t}},{key:"getContext",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.context}},{key:"getMemSize",value:function(){return 0}},{key:"size",value:function(t,e){(this._width!=t||this._height!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._width=t,this._height=e,this._setCPUMemory(t*e*4),this._ctx&&this._ctx.size&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t),this._texture&&(this._texture.destroy(),this._texture=null))}},{key:"getTexture",value:function(){if(!this._texture){var t=new r.Texture2D;t.loadImageSource(this.source),this._texture=new e.Texture(t)}return this._texture}},{key:"toBase64",value:function(t,e){if(this._source){if(o.PlatformInfo.onLayaRuntime){var r=window;if(2==r.conchConfig.threadMode)throw"native 2 thread mode use toBase64Async";var n=this._ctx._targets.sourceWidth,i=this._ctx._targets.sourceHeight,u=this._ctx._targets.getData(0,0,n,i);return r.conchToBase64FlipY?r.conchToBase64FlipY(t,e,u.buffer,n,i):r.conchToBase64(t,e,u.buffer,n,i)}return this._source.toDataURL(t,e)}return null}},{key:"toBase64Async",value:function(t,e,r){var o=this._ctx._targets.sourceWidth,n=this._ctx._targets.sourceHeight;this._ctx._targets.getDataAsync(0,0,o,n,function(i){var u=window,c=u.conchToBase64FlipY?u.conchToBase64FlipY(t,e,i.buffer,o,n):u.conchToBase64(t,e,i.buffer,o,n);r(c)})}},{key:"context",get:function(){return this._ctx?this._ctx:(this._source==this?this._ctx=a.gContext.CreatContext():this._ctx=this._source.getContext(o.PlatformInfo.onLayaRuntime?"layagl":"2d"),this._ctx._canvas=this,this._ctx)}}]),a}();exports.HTMLCanvas=x;
},{"././Bitmap":"ljsO","././Texture":"nP6w","././Texture2D":"zb/G","../utils/PlatformInfo":"HmZQ"}],"hGj3":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ContextBase=void 0;var r=function(){function n(){e(this,n)}return t(n,null,[{key:"CreatContext",value:function(){return new n}}]),n}();exports.ContextBase=r;
},{}],"2BX4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Context=void 0;var t=require("././Texture"),e=require("../layagl/LayaGL"),i=require("../maths/Bezier"),s=require("../maths/Matrix"),a=require("../maths/Point"),r=require("../maths/Rectangle"),h=require("../utils/ColorUtils"),n=require("../utils/Stat"),l=require("../webgl/WebGLContext"),u=require("../webgl/canvas/BlendMode"),_=require("../webgl/canvas/DrawStyle"),o=require("../webgl/canvas/Path"),c=require("../webgl/canvas/WebGLCacheAsNormalCanvas"),d=require("../webgl/canvas/save/SaveBase"),f=require("../webgl/canvas/save/SaveClipRect"),m=require("../webgl/canvas/save/SaveMark"),v=require("../webgl/canvas/save/SaveTransform"),b=require("../webgl/canvas/save/SaveTranslate"),M=require("./BaseTexture"),S=require("../webgl/submit/SubmitBase"),T=require("./RenderTexture2D"),y=require("./Texture2D"),p=require("../webgl/shader/BaseShader"),x=require("../webgl/shader/d2/Shader2D"),g=require("../webgl/shader/d2/ShaderDefines2D"),k=require("../webgl/shader/d2/skinAnishader/SkinMeshBuffer"),R=require("../webgl/shader/d2/value/Value2D"),E=require("../webgl/shapes/BasePoly"),w=require("../webgl/shapes/Earcut"),D=require("../webgl/submit/Submit"),C=require("../webgl/submit/SubmitCMD"),A=require("../webgl/submit/SubmitCanvas"),B=require("../webgl/submit/SubmitKey"),P=require("../webgl/submit/SubmitTarget"),I=require("../webgl/submit/SubmitTexture"),N=require("../webgl/text/CharSubmitCache"),L=require("../webgl/text/TextRender"),O=require("../webgl/utils/MeshQuadTexture"),G=require("../webgl/utils/MeshTexture"),U=require("../webgl/utils/MeshVG"),V=require("../webgl/utils/RenderState2D"),X=require("./HTMLCanvas"),W=require("./ContextBase");function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function H(t,e,i){return e&&F(t.prototype,e),i&&F(t,i),t}function Q(t,e){return!e||"object"!==q(e)&&"function"!=typeof e?K(t):e}function K(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Z(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}function z(t,e){return(z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var J=function(X){function q(){var e;if(Y(this,q),(e=Q(this,j(q).call(this)))._tmpMatrix=new s.Matrix,e._drawTexToDrawTri_Vert=new Float32Array(8),e._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3]),e._tempUV=new Float32Array(8),e._drawTriUseAbsMatrix=!1,e._id=++q._COUNT,e._other=null,e._renderNextSubmitIndex=0,e._path=null,e._drawCount=1,e._width=q._MAXSIZE,e._height=q._MAXSIZE,e._renderCount=0,e._isConvexCmd=!0,e._submits=null,e._curSubmit=null,e._submitKey=new B.SubmitKey,e._mesh=null,e._pathMesh=null,e._triangleMesh=null,e.meshlist=[],e._transedPoints=new Array(8),e._temp4Points=new Array(8),e._clipRect=q.MAXCLIPRECT,e._globalClipMatrix=new s.Matrix(q._MAXSIZE,0,0,q._MAXSIZE,0,0),e._clipInCache=!1,e._clipInfoID=0,e._curMat=null,e._lastMatScaleX=1,e._lastMatScaleY=1,e._lastMat_a=1,e._lastMat_b=0,e._lastMat_c=0,e._lastMat_d=1,e._nBlendType=0,e._save=null,e._targets=null,e._charSubmitCache=null,e._saveMark=null,e._shader2D=new x.Shader2D,e.sprite=null,e._italicDeg=0,e._lastTex=null,e._fillColor=0,e._flushCnt=0,e.defTexture=null,e._colorFiler=null,e.drawTexAlign=!1,e._incache=!1,e.isMain=!1,q._contextcount++,!e.defTexture){var i=new y.Texture2D(2,2);i.setPixels(new Uint8Array(16)),i.lock=!0,e.defTexture=new t.Texture(i)}return e._lastTex=e.defTexture,e.clear(),e}return Z(q,W.ContextBase),H(q,[{key:"drawImage",value:function(){}},{key:"getImageData",value:function(){}},{key:"measureText",value:function(t){return null}},{key:"setTransform",value:function(){}},{key:"$transform",value:function(t,e,i,s,a,r){}},{key:"clearRect",value:function(t,e,i,s){}},{key:"_drawRect",value:function(t,e,i,s,a){n.Stat.renderBatches++,a&&(this.fillStyle=a),this.fillRect(t,e,i,s,null)}},{key:"drawTexture2",value:function(t,e,i,s,a,r){}},{key:"transformByMatrix",value:function(t,e,i){this.transform(t.a,t.b,t.c,t.d,t.tx+e,t.ty+i)}},{key:"saveTransform",value:function(t){this.save()}},{key:"restoreTransform",value:function(t){this.restore()}},{key:"drawRect",value:function(t,e,i,s,a,r,h){null!=a&&(this.fillStyle=a,this.fillRect(t,e,i,s)),null!=r&&(this.strokeStyle=r,this.lineWidth=h,this.strokeRect(t,e,i,s))}},{key:"alpha",value:function(t){this.globalAlpha*=t}},{key:"_transform",value:function(t,e,i){this.translate(e,i),this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty),this.translate(-e,-i)}},{key:"_rotate",value:function(t,e,i){this.translate(e,i),this.rotate(t),this.translate(-e,-i)}},{key:"_scale",value:function(t,e,i,s){this.translate(i,s),this.scale(t,e),this.translate(-i,-s)}},{key:"_drawLine",value:function(t,e,i,s,a,r,h,n,l){this.beginPath(),this.strokeStyle=h,this.lineWidth=n,this.moveTo(t+i,e+s),this.lineTo(t+a,e+r),this.stroke()}},{key:"_drawLines",value:function(t,e,i,s,a,r){this.beginPath(),this.strokeStyle=s,this.lineWidth=a;i.length;this.addPath(i.slice(),!1,!1,t,e),this.stroke()}},{key:"drawCurves",value:function(t,e,i,s,a){this.beginPath(),this.strokeStyle=s,this.lineWidth=a,this.moveTo(t+i[0],e+i[1]);for(var r=2,h=i.length;r<h;)this.quadraticCurveTo(t+i[r++],e+i[r++],t+i[r++],e+i[r++]);this.stroke()}},{key:"_fillAndStroke",value:function(t,e,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];null!=t&&(this.fillStyle=t,this.fill()),null!=e&&i>0&&(this.strokeStyle=e,this.lineWidth=i,this.stroke())}},{key:"_drawCircle",value:function(t,e,i,s,a,r,h){n.Stat.renderBatches++,this.beginPath(!0),this.arc(t,e,i,0,q.PI2),this.closePath(),this._fillAndStroke(s,a,r)}},{key:"_drawPie",value:function(t,e,i,s,a,r,h,n,l){this.beginPath(),this.moveTo(t,e),this.arc(t,e,i,s,a),this.closePath(),this._fillAndStroke(r,h,n)}},{key:"_drawPoly",value:function(t,e,i,s,a,r,h,n){i.length;this.beginPath(),this.addPath(i.slice(),!0,h,t,e),this.closePath(),this._fillAndStroke(s,a,r,h)}},{key:"_drawPath",value:function(t,e,i,s,a){this.beginPath();for(var r=0,h=i.length;r<h;r++){var n=i[r];switch(n[0]){case"moveTo":this.moveTo(t+n[1],e+n[2]);break;case"lineTo":this.lineTo(t+n[1],e+n[2]);break;case"arcTo":this.arcTo(t+n[1],e+n[2],t+n[3],e+n[4],n[5]);break;case"closePath":this.closePath()}}null!=s&&(this.fillStyle=s.fillStyle,this.fill()),null!=a&&(this.strokeStyle=a.strokeStyle,this.lineWidth=a.lineWidth||1,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.miterLimit=a.miterLimit,this.stroke())}},{key:"clearBG",value:function(t,e,i,s){var a=l.WebGLContext.mainContext;a.clearColor(t,e,i,s),a.clear(l.WebGLContext.COLOR_BUFFER_BIT)}},{key:"_getSubmits",value:function(){return this._submits}},{key:"_releaseMem",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var e=0,i=this._submits._length;e<i;e++)this._submits[e].releaseRender();var s;for(this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null,e=0,s=this.meshlist.length;e<s;e++){this.meshlist[e].destroy()}this.meshlist.length=0,this.sprite=null,t||(this._targets&&this._targets.destroy(),this._targets=null)}}},{key:"destroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];--q._contextcount,this.sprite=null,this._releaseMem(t),this._charSubmitCache.destroy(),this._mesh.destroy(),t||(this._targets&&this._targets.destroy(),this._targets=null)}},{key:"clear",value:function(){this._submits||(this._other=$.DEFAULT,this._curMat=s.Matrix.create(),this._charSubmitCache=new N.CharSubmitCache,this._mesh=O.MeshQuadTexture.getAMesh(this.isMain),this.meshlist.push(this._mesh),this._pathMesh=U.MeshVG.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._triangleMesh=G.MeshTexture.getAMesh(this.isMain),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[m.SaveMark.Create(this)],this._save.length=10,this._shader2D=new x.Shader2D),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=$.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=q.MAXCLIPRECT,this._curSubmit=S.SubmitBase.RENDERBASE,S.SubmitBase.RENDERBASE._ref=16777215,S.SubmitBase.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=_.DrawStyle.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1}},{key:"size",value:function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new T.RenderTexture2D(t,e,M.BaseTexture.FORMAT_R8G8B8A8,-1)),this.isMain&&(l.WebGLContext.mainContext.viewport(0,0,t,e),V.RenderState2D.width=t,V.RenderState2D.height=e)),0===t&&0===e&&this._releaseMem()}},{key:"getMatScaleX",value:function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b?this._lastMatScaleX:(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b,this._lastMatScaleX)}},{key:"getMatScaleY",value:function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d?this._lastMatScaleY:(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d,this._lastMatScaleY)}},{key:"setFillColor",value:function(t){this._fillColor=t}},{key:"getFillColor",value:function(){return this._fillColor}},{key:"translate",value:function(t,e){0===t&&0===e||(b.SaveTranslate.save(this),this._curMat._bTransform?(v.SaveTransform.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))}},{key:"save",value:function(){this._save[this._save._length++]=m.SaveMark.Create(this)}},{key:"restore",value:function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var i=t-1;i>=0;i--){var s=this._save[i];if(s.restore(this),s.isSaveMark())return void(this._save._length=i)}e!=this._nBlendType&&(this._curSubmit=S.SubmitBase.RENDERBASE)}}},{key:"fillText",value:function(t,e,i,s,a,r){this._fillText(t,null,e,i,s,a,null,0,null)}},{key:"_fillText",value:function(t,e,i,s,a,r,h,n,l){var u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;t?q._textRender.filltext(this,t,i,s,a,r,h,n,l,u):e&&q._textRender.fillWords(this,e,i,s,a,r,h,n)}},{key:"_fast_filltext",value:function(t,e,i,s,a,r,h,n){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;q._textRender._fast_filltext(this,t,null,e,i,s,a,r,h,n,l)}},{key:"fillWords",value:function(t,e,i,s,a){this._fillText(null,t,e,i,s,a,null,-1,null,0)}},{key:"fillBorderWords",value:function(t,e,i,s,a,r,h){this._fillBorderText(null,t,e,i,s,a,r,h,null)}},{key:"drawText",value:function(t,e,i,s,a,r){this._fillText(t,null,e,i,s,h.ColorUtils.create(a).strColor,null,-1,r)}},{key:"strokeWord",value:function(t,e,i,s,a,r,n){this._fillText(t,null,e,i,s,null,h.ColorUtils.create(a).strColor,r||1,n)}},{key:"fillBorderText",value:function(t,e,i,s,a,r,n,l){this._fillBorderText(t,null,e,i,s,h.ColorUtils.create(a).strColor,h.ColorUtils.create(r).strColor,n,l)}},{key:"_fillBorderText",value:function(t,e,i,s,a,r,h,n,l){this._fillText(t,e,i,s,a,r,h,n||1,l)}},{key:"_fillRect",value:function(e,i,s,a,r){var h=this._curSubmit,n=h&&h._key.submitType===S.SubmitBase.KEY_DRAWTEXTURE&&h._key.blendShader===this._nBlendType;this._mesh.vertNum+4>q._MAXVERTNUM&&(this._mesh=O.MeshQuadTexture.getAMesh(this.isMain),this.meshlist.push(this._mesh),n=!1),n&&(n=n&&this.isSameClipInfo(h)),this.transformQuad(e,i,s,a,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,t.Texture.NO_UV,r,!1),n||(h=this._curSubmit=I.SubmitTexture.create(this,this._mesh,R.Value2D.create(g.ShaderDefines2D.TEXTURE2D,0)),this._submits[this._submits._length++]=h,this._copyClipInfo(h,this._globalClipMatrix),h.shaderValue.textureHost=this._lastTex,h._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,h._renderType=S.SubmitBase.TYPE_TEXTURE),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)}},{key:"fillRect",value:function(t,e,i,s,a){var r=a?_.DrawStyle.create(a):this._shader2D.fillStyle,h=this.mixRGBandAlpha(r.toInt());this._fillRect(t,e,i,s,h)}},{key:"fillTexture",value:function(t,e,i,s,a,r,h,n){t._getSource()?this._fillTexture(t,t.width,t.height,t.uvrect,e,i,s,a,r,h.x,h.y):this.sprite&&q.gSysTimer.callLater(this,this._repaintSprite)}},{key:"_fillTexture",value:function(t,e,i,s,a,r,h,n,l,u,_){var o=this._curSubmit;this._mesh.vertNum+4>q._MAXVERTNUM&&(this._mesh=O.MeshQuadTexture.getAMesh(this.isMain),this.meshlist.push(this._mesh));var c=!0,d=!0;switch(l){case"repeat":break;case"repeat-x":d=!1;break;case"repeat-y":c=!1;break;case"no-repeat":c=d=!1}var f=this._temp4Points,m=0,v=0,b=0,M=0,T=0,y=0;if(u<0?(b=a,m=-u%e/e):b=a+u,_<0?(M=r,v=-_%i/i):M=r+_,T=a+h,y=r+n,!c&&(T=Math.min(T,a+u+e)),!d&&(y=Math.min(y,r+_+i)),!(T<a||y<r||b>T||M>y)){var p=(T-a-u)/e,x=(y-r-_)/i;if(this.transformQuad(b,M,T-b,y-M,0,this._curMat,this._transedPoints),f[0]=m,f[1]=v,f[2]=p,f[3]=v,f[4]=p,f[5]=x,f[6]=m,f[7]=x,!this.clipedOff(this._transedPoints)){var k=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,f,k,!0);var E=R.Value2D.create(g.ShaderDefines2D.TEXTURE2D,0);E.defines.add(g.ShaderDefines2D.FILLTEXTURE),E.u_TexRange=s,o=this._curSubmit=I.SubmitTexture.create(this,this._mesh,E),this._submits[this._submits._length++]=o,this._copyClipInfo(o,this._globalClipMatrix),o.shaderValue.textureHost=t,o._renderType=S.SubmitBase.TYPE_TEXTURE,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}}},{key:"setColorFilter",value:function(t){d.SaveBase.save(this,d.SaveBase.TYPE_COLORFILTER,this,!0),this._colorFiler=t,this._curSubmit=S.SubmitBase.RENDERBASE}},{key:"drawTexture",value:function(t,e,i,s,a){this._drawTextureM(t,e,i,s,a,null,1,null)}},{key:"drawTextures",value:function(t,e,i,s){if(t._getSource())for(var a=e.length/2,r=0,h=t.bitmap.id,n=0;n<a;n++)this._inner_drawTexture(t,h,e[r++]+i,e[r++]+s,0,0,null,null,1,!1);else this.sprite&&q.gSysTimer.callLater(this,this._repaintSprite)}},{key:"_drawTextureAddSubmit",value:function(t,e){var i=null;i=I.SubmitTexture.create(this,this._mesh,R.Value2D.create(g.ShaderDefines2D.TEXTURE2D,0)),this._submits[this._submits._length++]=i,i.shaderValue.textureHost=e,i._key.other=t,i._renderType=S.SubmitBase.TYPE_TEXTURE,this._curSubmit=i}},{key:"_drawTextureM",value:function(t,e,i,s,a,r,h,n){var l=this.sprite;return!!t._getSource(function(){l&&l.repaint()})&&this._inner_drawTexture(t,t.bitmap.id,e,i,s,a,r,n,h,!1)}},{key:"_drawRenderTexture",value:function(t,e,i,s,a,r,h,n){return this._inner_drawTexture(t,-1,e,i,s,a,r,n,1,!1)}},{key:"submitDebugger",value:function(){this._submits[this._submits._length++]=C.SubmitCMD.create([],function(){},this)}},{key:"_copyClipInfo",value:function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var s=t.shaderValue.clipMatPos;s[0]=e.tx,s[1]=e.ty,t.clipInfoID=this._clipInfoID,this._clipInCache&&(t.shaderValue.clipOff[0]=1)}},{key:"isSameClipInfo",value:function(t){return t.clipInfoID===this._clipInfoID}},{key:"_useNewTex2DSubmit",value:function(t,e){this._mesh.vertNum+e>q._MAXVERTNUM&&(this._mesh=O.MeshQuadTexture.getAMesh(this.isMain),this.meshlist.push(this._mesh));var i=I.SubmitTexture.create(this,this._mesh,R.Value2D.create(g.ShaderDefines2D.TEXTURE2D,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this._copyClipInfo(i,this._globalClipMatrix)}},{key:"_drawTexRect",value:function(t,e,i,s,a){this.transformQuad(t,e,i,s,this._italicDeg,this._curMat,this._transedPoints);var r=this._transedPoints;r[0]=r[0]+.5|0,r[1]=r[1]+.5|0,r[2]=r[2]+.5|0,r[3]=r[3]+.5|0,r[4]=r[4]+.5|0,r[5]=r[5]+.5|0,r[6]=r[6]+.5|0,r[7]=r[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,a,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)}},{key:"drawCallOptimize",value:function(t){return this._charSubmitCache.enable(t,this),t}},{key:"_inner_drawTexture",value:function(t,e,i,s,a,r,h,n,l,u){var _=this._curSubmit._key;if(n=n||t._uv,_.submitType===S.SubmitBase.KEY_TRIANGLES&&_.other===e){var o=this._drawTexToDrawTri_Vert;o[0]=i,o[1]=s,o[2]=i+a,o[3]=s,o[4]=i+a,o[5]=s+r,o[6]=i,o[7]=s+r,this._drawTriUseAbsMatrix=!0;var c=this._tempUV;return c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],this.drawTriangles(t,0,0,o,c,this._drawTexToDrawTri_Index,h,l,null,null),this._drawTriUseAbsMatrix=!1,!0}var d=this._mesh,f=this._curSubmit,m=u?this._charSubmitCache.getPos():this._transedPoints;if(this.transformQuad(i,s,a||t.width,r||t.height,this._italicDeg,h||this._curMat,m),this.drawTexAlign){var v=Math.round;m[0]=v(m[0]),m[1]=v(m[1]),m[2]=v(m[2]),m[3]=v(m[3]),m[4]=v(m[4]),m[5]=v(m[5]),m[6]=v(m[6]),m[7]=v(m[7]),this.drawTexAlign=!1}var b=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*l);if(u)return this._charSubmitCache.add(this,t,e,m,n,b),!0;this._drawCount++;var M=e>=0&&_.submitType===S.SubmitBase.KEY_DRAWTEXTURE&&_.other===e;return M&&(M=M&&this.isSameClipInfo(f)),this._lastTex=t,d.vertNum+4>q._MAXVERTNUM&&(d=this._mesh=O.MeshQuadTexture.getAMesh(this.isMain),this.meshlist.push(d),M=!1),d.addQuad(m,n,b,!0),M||(this._submits[this._submits._length++]=this._curSubmit=f=I.SubmitTexture.create(this,d,R.Value2D.create(g.ShaderDefines2D.TEXTURE2D,0)),f.shaderValue.textureHost=t,f._key.other=e,this._copyClipInfo(f,this._globalClipMatrix)),f._numEle+=6,d.indexNum+=6,d.vertNum+=4,!0}},{key:"transform4Points",value:function(t,e,i){var s=e.tx,a=e.ty,r=e.a,h=e.b,n=e.c,l=e.d,u=t[0],_=t[1],o=t[2],c=t[3],d=t[4],f=t[5],m=t[6],v=t[7];e._bTransform?(i[0]=u*r+_*n+s,i[1]=u*h+_*l+a,i[2]=o*r+c*n+s,i[3]=o*h+c*l+a,i[4]=d*r+f*n+s,i[5]=d*h+f*l+a,i[6]=m*r+v*n+s,i[7]=m*h+v*l+a):(i[0]=u+s,i[1]=_+a,i[2]=o+s,i[3]=c+a,i[4]=d+s,i[5]=f+a,i[6]=m+s,i[7]=v+a)}},{key:"clipedOff",value:function(t){return this._clipRect.width<=0||this._clipRect.height<=0}},{key:"transformQuad",value:function(t,e,i,s,a,r,h){var n=0;0!=a&&(n=Math.tan(a*Math.PI/180)*s);var l=t+i,u=e+s,_=r.tx,o=r.ty,c=r.a,d=r.b,f=r.c,m=r.d,v=t+n,b=e,M=l+n,S=e,T=l,y=u,p=t,x=u;r._bTransform?(h[0]=v*c+b*f+_,h[1]=v*d+b*m+o,h[2]=M*c+S*f+_,h[3]=M*d+S*m+o,h[4]=T*c+y*f+_,h[5]=T*d+y*m+o,h[6]=p*c+x*f+_,h[7]=p*d+x*m+o):(h[0]=v+_,h[1]=b+o,h[2]=M+_,h[3]=S+o,h[4]=T+_,h[5]=y+o,h[6]=p+_,h[7]=x+o)}},{key:"pushRT",value:function(){this.addRenderObject(C.SubmitCMD.create(null,T.RenderTexture2D.pushRT,this))}},{key:"popRT",value:function(){this.addRenderObject(C.SubmitCMD.create(null,T.RenderTexture2D.popRT,this)),this.breakNextMerge()}},{key:"useRT",value:function(t){this.addRenderObject(C.SubmitCMD.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()}},{key:"RTRestore",value:function(t){this.addRenderObject(C.SubmitCMD.create([t],function(t){t.restore()},this)),this.breakNextMerge()}},{key:"breakNextMerge",value:function(){this._curSubmit=S.SubmitBase.RENDERBASE}},{key:"_repaintSprite",value:function(){this.sprite&&this.sprite.repaint()}},{key:"drawTextureWithTransform",value:function(t,e,i,a,r,h,n,l,u,_){var o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,c=null,d=this._curMat;_&&(c=this.globalCompositeOperation,this.globalCompositeOperation=_);var f=this._colorFiler;if(o&&this.setColorFilter(o),!h)return this._drawTextureM(t,e+n,i+l,a,r,d,u,null),_&&(this.globalCompositeOperation=c),void(o&&this.setColorFilter(f));var m=this._tmpMatrix;m.a=h.a,m.b=h.b,m.c=h.c,m.d=h.d,m.tx=h.tx+n,m.ty=h.ty+l,m._bTransform=h._bTransform,h&&d._bTransform?(s.Matrix.mul(m,d,m),(h=m)._bTransform=!0):(m.tx+=d.tx,m.ty+=d.ty,h=m),this._drawTextureM(t,e,i,a,r,h,u,null),_&&(this.globalCompositeOperation=c),o&&this.setColorFilter(f)}},{key:"_flushToTarget",value:function(t,e){V.RenderState2D.worldScissorTest=!1,l.WebGLContext.mainContext.disable(l.WebGLContext.SCISSOR_TEST);var i=V.RenderState2D.worldAlpha,a=V.RenderState2D.worldMatrix4,r=V.RenderState2D.worldMatrix;V.RenderState2D.worldShaderDefines;V.RenderState2D.worldMatrix=s.Matrix.EMPTY,V.RenderState2D.restoreTempArray(),V.RenderState2D.worldMatrix4=V.RenderState2D.TEMPMAT4_ARRAY,V.RenderState2D.worldAlpha=1,p.BaseShader.activeShader=null,e.start(),t._submits._length>0&&e.clear(0,0,0,0),t._curSubmit=S.SubmitBase.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=S.SubmitBase.RENDERBASE,p.BaseShader.activeShader=null,V.RenderState2D.worldAlpha=i,V.RenderState2D.worldMatrix4=a,V.RenderState2D.worldMatrix=r}},{key:"drawCanvas",value:function(t,e,i,r,h){if(t){var n,l=t.context;if(l._targets)l._submits._length>0&&(n=C.SubmitCMD.create([l,l._targets],this._flushToTarget,this),this._submits[this._submits._length++]=n),this._drawRenderTexture(l._targets,e,i,r,h,null,1,T.RenderTexture2D.flipyuv),this._curSubmit=S.SubmitBase.RENDERBASE;else{var u=t;u.touches&&u.touches.forEach(function(t){t.touch()}),n=A.SubmitCanvas.create(t,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=n,n._key.clear();var _=n._matrix;this._curMat.copyTo(_);var o=_.tx,c=_.ty;_.tx=_.ty=0,_.transformPoint(a.Point.TEMP.setTo(e,i)),_.translate(a.Point.TEMP.x+o,a.Point.TEMP.y+c),s.Matrix.mul(u.invMat,_,_),this._curSubmit=S.SubmitBase.RENDERBASE}}}},{key:"drawTarget",value:function(e,i,s,a,r,h,n){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;this._drawCount++;if(this._mesh.vertNum+4>q._MAXVERTNUM&&(this._mesh=O.MeshQuadTexture.getAMesh(this.isMain),this.meshlist.push(this._mesh)),this.transformQuad(i,s,a,r,0,h||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,l||t.Texture.DEF_UV,4294967295,!0);var _=this._curSubmit=P.SubmitTarget.create(this,this._mesh,n,e);return _.blendType=-1==u?this._nBlendType:u,this._copyClipInfo(_,this._globalClipMatrix),_._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._submits[this._submits._length++]=_,this._curSubmit=S.SubmitBase.RENDERBASE,!0}return this._curSubmit=S.SubmitBase.RENDERBASE,!1}},{key:"drawTriangles",value:function(t,e,i,a,r,h,n,l,u,_){if(t._getSource()){this._drawCount++;var o=this._tmpMatrix,c=this._triangleMesh,d=null,f=!1;u&&(d=this._colorFiler,this._colorFiler=u,this._curSubmit=S.SubmitBase.RENDERBASE,f=d!=u);var m=t.bitmap,v=this._curSubmit._key,b=v.submitType===S.SubmitBase.KEY_TRIANGLES&&v.other===m.id&&v.blendShader==this._nBlendType;if(c.vertNum+a.length/2>q._MAXVERTNUM&&(c=this._triangleMesh=G.MeshTexture.getAMesh(this.isMain),this.meshlist.push(c),b=!1),!b){var M=this._curSubmit=I.SubmitTexture.create(this,c,R.Value2D.create(g.ShaderDefines2D.TEXTURE2D,0));M.shaderValue.textureHost=t,M._renderType=S.SubmitBase.TYPE_TEXTURE,M._key.submitType=S.SubmitBase.KEY_TRIANGLES,M._key.other=m.id,this._copyClipInfo(M,this._globalClipMatrix),this._submits[this._submits._length++]=M}var T=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*l);this._drawTriUseAbsMatrix?c.addData(a,r,h,n,T):(n?(o.a=n.a,o.b=n.b,o.c=n.c,o.d=n.d,o.tx=n.tx+e,o.ty=n.ty+i):(o.a=1,o.b=0,o.c=0,o.d=1,o.tx=e,o.ty=i),s.Matrix.mul(o,this._curMat,o),c.addData(a,r,h,o,T)),this._curSubmit._numEle+=h.length,f&&(this._colorFiler=d,this._curSubmit=S.SubmitBase.RENDERBASE)}else this.sprite&&q.gSysTimer.callLater(this,this._repaintSprite)}},{key:"transform",value:function(t,e,i,a,r,h){v.SaveTransform.save(this),s.Matrix.mul(s.Matrix.TEMP.setTo(t,e,i,a,r,h),this._curMat,this._curMat),this._curMat._checkTransform()}},{key:"_transformByMatrix",value:function(t,e,i){t.setTranslate(e,i),s.Matrix.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0}},{key:"setTransformByMatrix",value:function(t){t.copyTo(this._curMat)}},{key:"rotate",value:function(t){v.SaveTransform.save(this),this._curMat.rotateEx(t)}},{key:"scale",value:function(t,e){v.SaveTransform.save(this),this._curMat.scaleEx(t,e)}},{key:"clipRect",value:function(t,e,i,s){f.SaveClipRect.save(this),this._clipRect==q.MAXCLIPRECT?this._clipRect=new r.Rectangle(t,e,i,s):(this._clipRect.width=i,this._clipRect.height=s,this._clipRect.x=t,this._clipRect.y=e),q._clipID_Gen++,q._clipID_Gen%=1e4,this._clipInfoID=q._clipID_Gen;var a=this._globalClipMatrix,h=a.tx,n=a.ty,l=h+a.a,u=n+a.d;if(this._clipRect.width>=q._MAXSIZE?(a.a=a.d=q._MAXSIZE,a.b=a.c=a.tx=a.ty=0):(this._curMat._bTransform?(a.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,a.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,a.a=this._clipRect.width*this._curMat.a,a.b=this._clipRect.width*this._curMat.b,a.c=this._clipRect.height*this._curMat.c,a.d=this._clipRect.height*this._curMat.d):(a.tx=this._clipRect.x+this._curMat.tx,a.ty=this._clipRect.y+this._curMat.ty,a.a=this._clipRect.width,a.b=a.c=0,a.d=this._clipRect.height),this._incache&&(this._clipInCache=!0)),a.a>0&&a.d>0){var _=a.tx+a.a,o=a.ty+a.d;_<=h||o<=n||a.tx>=l||a.ty>=u?(a.a=-.1,a.d=-.1):(a.tx<h&&(a.a-=h-a.tx,a.tx=h),_>l&&(a.a-=_-l),a.ty<n&&(a.d-=n-a.ty,a.ty=n),o>u&&(a.d-=o-u),a.a<=0&&(a.a=-.1),a.d<=0&&(a.d=-.1))}}},{key:"drawMesh",value:function(t,e,i,s,a,r,h,n){arguments.length>8&&void 0!==arguments[8]&&arguments[8]}},{key:"addRenderObject",value:function(t){this._submits[this._submits._length++]=t}},{key:"submitElement",value:function(t,e){this.isMain;var i=this._submits,s=i._length;e<0&&(e=i._length);for(var a=S.SubmitBase.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,i[t]!==S.SubmitBase.RENDERBASE?(S.SubmitBase.preRender=a,t+=(a=i[t]).renderSubmit()):t++;return s}},{key:"flush",value:function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),k.SkinMeshBuffer.instance&&k.SkinMeshBuffer.getInstance().reset(),this._curSubmit=S.SubmitBase.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var s=this.meshlist[e];s.canReuse?s.releaseMesh():s.destroy()}return this.meshlist.length=0,this._mesh=O.MeshQuadTexture.getAMesh(this.isMain),this._pathMesh=U.MeshVG.getAMesh(this.isMain),this._triangleMesh=G.MeshTexture.getAMesh(this.isMain),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&this.isMain&&L.TextRender.textRenderInst&&L.TextRender.textRenderInst.GC(),t}},{key:"beginPath",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._getPath().beginPath(t)}},{key:"closePath",value:function(){this._path.closePath()}},{key:"addPath",value:function(t,e,i,s,a){for(var r=0,h=0,n=t.length/2;h<n;h++){var l=t[r]+s,u=t[r+1]+a;t[r]=l,t[r+1]=u,r+=2}this._getPath().push(t,i)}},{key:"fill",value:function(){var t=this._curMat,e=this._getPath(),i=this._curSubmit,s=i._key.submitType===S.SubmitBase.KEY_VG&&i._key.blendShader===this._nBlendType;s&&(s=s&&this.isSameClipInfo(i)),s||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var a,r=this.mixRGBandAlpha(this.fillStyle.toInt()),h=0,n=0,l=e.paths.length;n<l;n++){var u=e.paths[n],_=u.path.length/2;if(!(_<3||3==_&&!u.convex)){var o,c,d,f,m=u.path.concat(),v=0;if(t._bTransform)for(v=0;v<_;v++)c=(o=v<<1)+1,d=m[o],f=m[c],m[o]=t.a*d+t.c*f+t.tx,m[c]=t.b*d+t.d*f+t.ty;else for(v=0;v<_;v++)c=(o=v<<1)+1,d=m[o],f=m[c],m[o]=d+t.tx,m[c]=f+t.ty;this._pathMesh.vertNum+_>q._MAXVERTNUM&&(this._curSubmit._numEle+=h,h=0,this._pathMesh=U.MeshVG.getAMesh(this.isMain),this._curSubmit=this.addVGSubmit(this._pathMesh));var b=this._pathMesh.vertNum;if(u.convex){var M=_-2;a=new Array(3*M);for(var T=0,y=0;y<M;y++)a[T++]=b,a[T++]=y+1+b,a[T++]=y+2+b}else if(a=w.Earcut.earcut(m,null,2),b>0)for(var p=0;p<a.length;p++)a[p]+=b;this._pathMesh.addVertAndIBToMesh(this,m,r,a),h+=a.length}}this._curSubmit._numEle+=h}},{key:"addVGSubmit",value:function(t){var e=D.Submit.createShape(this,t,0,R.Value2D.create(g.ShaderDefines2D.PRIMITIVE,0));return e._key.submitType=S.SubmitBase.KEY_VG,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e}},{key:"stroke",value:function(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,s=i._key.submitType===S.SubmitBase.KEY_VG&&i._key.blendShader===this._nBlendType;s&&(s=s&&this.isSameClipInfo(i)),s||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var a=0,r=0,h=e.paths.length;r<h;r++){var n=e.paths[r];if(!(n.path.length<=0)){var l=[],u=[],_=2*n.path.length;if(!(_<2)){this._pathMesh.vertNum+_>q._MAXVERTNUM&&(this._curSubmit._numEle+=a,a=0,this._pathMesh=U.MeshVG.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),E.BasePoly.createLine2(n.path,l,this.lineWidth,this._pathMesh.vertNum,u,n.loop);var o,c,d,f,m=u.length/2,v=this._curMat,b=0;if(v._bTransform)for(b=0;b<m;b++)c=(o=b<<1)+1,d=u[o],f=u[c],u[o]=v.a*d+v.c*f+v.tx,u[c]=v.b*d+v.d*f+v.ty;else for(b=0;b<m;b++)c=(o=b<<1)+1,d=u[o],f=u[c],u[o]=d+v.tx,u[c]=f+v.ty;this._pathMesh.addVertAndIBToMesh(this,u,t,l),a+=l.length}}}this._curSubmit._numEle+=a}}},{key:"moveTo",value:function(t,e){var i=this._getPath();i.newPath(),i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e)}},{key:"lineTo",value:function(t,e){var i=this._getPath();Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001||(i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e))}},{key:"arcTo",value:function(t,e,i,s,a){var r=0,h=0,n=0,l=this._path._lastOriX-t,u=this._path._lastOriY-e,_=Math.sqrt(l*l+u*u);if(!(_<=1e-6)){var o=l/_,c=u/_,d=i-t,f=s-e,m=d*d+f*f,v=Math.sqrt(m);if(!(v<=1e-6)){var b=d/v,M=f/v,S=o+b,T=c+M,y=Math.sqrt(S*S+T*T);if(!(y<=1e-6)){var p=S/y,x=T/y,g=Math.acos(p*o+x*c),k=Math.PI/2-g,R=(_=a/Math.tan(k))*o+t,E=_*c+e,w=Math.sqrt(_*_+a*a),D=t+p*w,C=e+x*w,A=0,B=0;if(o*M-c*b>=0){var P=2*k/q.SEGNUM;A=Math.sin(P),B=Math.cos(P)}else P=2*-k/q.SEGNUM,A=Math.sin(P),B=Math.cos(P);var I=this._path._lastOriX,N=this._path._lastOriY,L=R,O=E;(Math.abs(L-this._path._lastOriX)>.1||Math.abs(O-this._path._lastOriY)>.1)&&(h=L,n=O,I=L,N=O,this._path.addPoint(h,n));var G=R-D,U=E-C;for(r=0;r<q.SEGNUM;r++){var V=G*B+U*A,X=-G*A+U*B;h=V+D,n=X+C,(Math.abs(I-h)>.1||Math.abs(N-n)>.1)&&(this._path.addPoint(h,n),I=h,N=n),G=V,U=X}}}}}},{key:"arc",value:function(t,e,i,s,a){var r,h,n,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=(!(arguments.length>6&&void 0!==arguments[6])||arguments[6],0),_=0,o=0,c=0,d=0,f=0;if(_=a-s,l)if(Math.abs(_)>=2*Math.PI)_=2*-Math.PI;else for(;_>0;)_-=2*Math.PI;else if(Math.abs(_)>=2*Math.PI)_=2*Math.PI;else for(;_<0;)_+=2*Math.PI;var m=this.getMatScaleX(),v=this.getMatScaleY(),b=i*(m>v?m:v),M=2*Math.PI*b;r=_/(n=0|Math.max(M/10,10))/2,o=Math.abs(4/3*(1-Math.cos(r))/Math.sin(r)),l&&(o=-o);var S=this._getPath();for(h=0;h<=n;h++)u=s+_*(h/n),c=Math.cos(u),f=e+Math.sin(u)*i,(d=t+c*i)==this._path._lastOriX&&f==this._path._lastOriY||S.addPoint(d,f);c=Math.cos(a),f=e+Math.sin(a)*i,(d=t+c*i)==this._path._lastOriX&&f==this._path._lastOriY||S.addPoint(d,f)}},{key:"quadraticCurveTo",value:function(t,e,s,a){for(var r=i.Bezier.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,s,a],30,2),h=0,n=r.length/2;h<n;h++)this.lineTo(r[2*h],r[2*h+1]);this.lineTo(s,a)}},{key:"mixRGBandAlpha",value:function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)}},{key:"_mixRGBandAlpha",value:function(t,e){if(e>=1)return t;var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24}},{key:"strokeRect",value:function(t,e,i,s,a){if(this.lineWidth>0){var r=this.mixRGBandAlpha(this.strokeStyle._color.numColor),h=this.lineWidth/2;this._fillRect(t-h,e-h,i+this.lineWidth,this.lineWidth,r),this._fillRect(t-h,e-h+s,i+this.lineWidth,this.lineWidth,r),this._fillRect(t-h,e+h,this.lineWidth,s-this.lineWidth,r),this._fillRect(t-h+i,e+h,this.lineWidth,s-this.lineWidth,r)}}},{key:"clip",value:function(){}},{key:"drawParticle",value:function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i}},{key:"_getPath",value:function(){return this._path||(this._path=new o.Path)}},{key:"_fillTexture_h",value:function(t,e,i,s,a,r,h,n){for(var l=r,u=Math.floor(n/s),_=n%s,o=0;o<u;o++)this._inner_drawTexture(t,e,l,h,s,a,this._curMat,i,1,!1),l+=s;if(_>0){var c=i[2]-i[0],d=i[0]+c*(_/s),f=q.tmpuv1;f[0]=i[0],f[1]=i[1],f[2]=d,f[3]=i[3],f[4]=d,f[5]=i[5],f[6]=i[6],f[7]=i[7],this._inner_drawTexture(t,e,l,h,_,a,this._curMat,f,1,!1)}}},{key:"_fillTexture_v",value:function(t,e,i,s,a,r,h,n){for(var l=h,u=Math.floor(n/a),_=n%a,o=0;o<u;o++)this._inner_drawTexture(t,e,r,l,s,a,this._curMat,i,1,!1),l+=a;if(_>0){var c=i[7]-i[1],d=i[1]+c*(_/a),f=q.tmpuv1;f[0]=i[0],f[1]=i[1],f[2]=i[2],f[3]=i[3],f[4]=i[4],f[5]=d,f[6]=i[6],f[7]=d,this._inner_drawTexture(t,e,r,l,s,_,this._curMat,f,1,!1)}}},{key:"drawTextureWithSizeGrid",value:function(t,e,i,s,a,r,h,n){if(t._getSource()){e+=h,i+=n;var l=t.uv,u=t.bitmap.width,_=t.bitmap.height,o=r[0],c=r[3],d=o/_,f=c/u,m=r[1],v=r[2],b=m/u,M=v/_,S=r[4],T=!1;if(s==u&&(c=m=0),a==_&&(o=v=0),c+m>s){var y=s;T=!0,s=c+m,this.save(),this.clipRect(0+e,0+i,y,a)}var p=t.bitmap.id,x=this._curMat,g=this._tempUV,k=l[0],R=l[1],E=l[4],w=l[5],D=k,C=R,A=E,B=w;if(c&&o&&(A=k+f,B=R+d,g[0]=k,g[1]=R,g[2]=A,g[3]=R,g[4]=A,g[5]=B,g[6]=k,g[7]=B,this._inner_drawTexture(t,p,e,i,c,o,x,g,1,!1)),m&&o&&(D=E-b,C=R,A=E,B=R+d,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,this._inner_drawTexture(t,p,s-m+e,0+i,m,o,x,g,1,!1)),c&&v&&(D=k,C=w-M,A=k+f,B=w,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,this._inner_drawTexture(t,p,0+e,a-v+i,c,v,x,g,1,!1)),m&&v&&(D=E-b,C=w-M,A=E,B=w,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,this._inner_drawTexture(t,p,s-m+e,a-v+i,m,v,x,g,1,!1)),o&&(D=k+f,C=R,A=E-b,B=R+d,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,S?this._fillTexture_h(t,p,g,t.width-c-m,o,c+e,i,s-c-m):this._inner_drawTexture(t,p,c+e,i,s-c-m,o,x,g,1,!1)),v&&(D=k+f,C=w-M,A=E-b,B=w,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,S?this._fillTexture_h(t,p,g,t.width-c-m,v,c+e,a-v+i,s-c-m):this._inner_drawTexture(t,p,c+e,a-v+i,s-c-m,v,x,g,1,!1)),c&&(D=k,C=R+d,A=k+f,B=w-M,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,S?this._fillTexture_v(t,p,g,c,t.height-o-v,e,o+i,a-o-v):this._inner_drawTexture(t,p,e,o+i,c,a-o-v,x,g,1,!1)),m&&(D=E-b,C=R+d,A=E,B=w-M,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,S?this._fillTexture_v(t,p,g,m,t.height-o-v,s-m+e,o+i,a-o-v):this._inner_drawTexture(t,p,s-m+e,o+i,m,a-o-v,x,g,1,!1)),D=k+f,C=R+d,A=E-b,B=w-M,g[0]=D,g[1]=C,g[2]=A,g[3]=C,g[4]=A,g[5]=B,g[6]=D,g[7]=B,S){var P=q.tmpUVRect;P[0]=D,P[1]=C,P[2]=A-D,P[3]=B-C,this._fillTexture(t,t.width-c-m,t.height-o-v,P,c+e,o+i,s-c-m,a-o-v,"repeat",0,0)}else this._inner_drawTexture(t,p,c+e,o+i,s-c-m,a-o-v,x,g,1,!1);T&&this.restore()}}},{key:"lineJoin",get:function(){return null},set:function(t){}},{key:"lineCap",get:function(){return null},set:function(t){}},{key:"miterLimit",get:function(){return null},set:function(t){}},{key:"asBitmap",set:function(t){if(t){if(this._targets||(this._targets=new T.RenderTexture2D(this._width,this._height,M.BaseTexture.FORMAT_R8G8B8A8,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}},{key:"fillStyle",set:function(t){this._shader2D.fillStyle.equal(t)||(d.SaveBase.save(this,d.SaveBase.TYPE_FILESTYLE,this._shader2D,!1),this._shader2D.fillStyle=_.DrawStyle.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())},get:function(){return this._shader2D.fillStyle}},{key:"globalAlpha",set:function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(d.SaveBase.save(this,d.SaveBase.TYPE_ALPHA,this._shader2D,!1),this._shader2D.ALPHA=t)},get:function(){return this._shader2D.ALPHA}},{key:"textAlign",set:function(t){this._other.textAlign===t||(this._other=this._other.make(),d.SaveBase.save(this,d.SaveBase.TYPE_TEXTALIGN,this._other,!1),this._other.textAlign=t)},get:function(){return this._other.textAlign}},{key:"textBaseline",set:function(t){this._other.textBaseline===t||(this._other=this._other.make(),d.SaveBase.save(this,d.SaveBase.TYPE_TEXTBASELINE,this._other,!1),this._other.textBaseline=t)},get:function(){return this._other.textBaseline}},{key:"globalCompositeOperation",set:function(t){var e=u.BlendMode.TOINT[t];null==e||this._nBlendType===e||(d.SaveBase.save(this,d.SaveBase.TYPE_GLOBALCOMPOSITEOPERATION,this,!0),this._curSubmit=S.SubmitBase.RENDERBASE,this._nBlendType=e)},get:function(){return u.BlendMode.NAMES[this._nBlendType]}},{key:"strokeStyle",set:function(t){this._shader2D.strokeStyle.equal(t)||(d.SaveBase.save(this,d.SaveBase.TYPE_STROKESTYLE,this._shader2D,!1),this._shader2D.strokeStyle=_.DrawStyle.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())},get:function(){return this._shader2D.strokeStyle}},{key:"lineWidth",set:function(t){this._other.lineWidth===t||(this._other=this._other.make(),d.SaveBase.save(this,d.SaveBase.TYPE_LINEWIDTH,this._other,!1),this._other.lineWidth=t)},get:function(){return this._other.lineWidth}},{key:"font",set:function(t){this._other=this._other.make(),d.SaveBase.save(this,d.SaveBase.TYPE_FONT,this._other,!1)}},{key:"canvas",get:function(){return this._canvas}}],[{key:"__init__",value:function(){q.MAXCLIPRECT=new r.Rectangle(0,0,q._MAXSIZE,q._MAXSIZE),$.DEFAULT=new $,c.WebGLCacheAsNormalCanvas}},{key:"CreatContext",value:function(){return new q}},{key:"set2DRenderConfig",value:function(){var t=e.LayaGL.instance;l.WebGLContext.setBlend(t,!0),l.WebGLContext.setBlendFunc(t,l.WebGLContext.ONE,l.WebGLContext.ONE_MINUS_SRC_ALPHA),l.WebGLContext.setDepthTest(t,!1),l.WebGLContext.setCullFace(t,!1),l.WebGLContext.setDepthMask(t,!0),l.WebGLContext.setFrontFace(t,l.WebGLContext.CCW),t.viewport(0,0,V.RenderState2D.width,V.RenderState2D.height)}}]),q}();exports.Context=J,J.gSysTimer=null,J._SUBMITVBSIZE=32e3,J._MAXSIZE=99999999,J._MAXVERTNUM=65535,J.MAXCLIPRECT=null,J._COUNT=0,J.SEGNUM=32,J._contextcount=0,J.PI2=2*Math.PI,J._clipID_Gen=0,J._textRender=new L.TextRender,J.tmpuv1=[0,0,0,0,0,0,0,0],J.tmpUV=[0,0,0,0,0,0,0,0],J.tmpUVRect=[0,0,0,0];var $=function(){function t(){Y(this,t),this.lineWidth=1}return H(t,[{key:"clear",value:function(){this.lineWidth=1,this.textAlign=this.textBaseline=null}},{key:"make",value:function(){return this===t.DEFAULT?new t:this}}]),t}();X.HTMLCanvas.gContext=J;
},{"././Texture":"nP6w","../layagl/LayaGL":"ezDE","../maths/Bezier":"d9b0","../maths/Matrix":"GG2z","../maths/Point":"ziZY","../maths/Rectangle":"iPyf","../utils/ColorUtils":"iLoT","../utils/Stat":"xuKH","../webgl/WebGLContext":"vf9T","../webgl/canvas/BlendMode":"brGx","../webgl/canvas/DrawStyle":"MDgz","../webgl/canvas/Path":"3MIm","../webgl/canvas/WebGLCacheAsNormalCanvas":"NpEt","../webgl/canvas/save/SaveBase":"mB8l","../webgl/canvas/save/SaveClipRect":"nEZ+","../webgl/canvas/save/SaveMark":"9jTL","../webgl/canvas/save/SaveTransform":"tJOq","../webgl/canvas/save/SaveTranslate":"SgVA","./BaseTexture":"M7il","../webgl/submit/SubmitBase":"U5L8","./RenderTexture2D":"pIGp","./Texture2D":"zb/G","../webgl/shader/BaseShader":"oKQa","../webgl/shader/d2/Shader2D":"jNoH","../webgl/shader/d2/ShaderDefines2D":"el31","../webgl/shader/d2/skinAnishader/SkinMeshBuffer":"AumK","../webgl/shader/d2/value/Value2D":"cqLV","../webgl/shapes/BasePoly":"gohm","../webgl/shapes/Earcut":"FTPB","../webgl/submit/Submit":"8e/+","../webgl/submit/SubmitCMD":"ud/G","../webgl/submit/SubmitCanvas":"wNtg","../webgl/submit/SubmitKey":"/SF1","../webgl/submit/SubmitTarget":"wued","../webgl/submit/SubmitTexture":"MTlA","../webgl/text/CharSubmitCache":"+9Iz","../webgl/text/TextRender":"LV+0","../webgl/utils/MeshQuadTexture":"e2cl","../webgl/utils/MeshTexture":"n6s4","../webgl/utils/MeshVG":"CxvY","../webgl/utils/RenderState2D":"k75q","./HTMLCanvas":"TY9w","./ContextBase":"hGj3"}],"RsJd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGL=void 0;var e=require("./utils/RenderState2D"),t=require("./WebGLContext");function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var a=function(){function n(){r(this,n)}return i(n,null,[{key:"_uint8ArraySlice",value:function(){for(var e=this.length,t=new Uint8Array(this.length),r=0;r<e;r++)t[r]=this[r];return t}},{key:"_float32ArraySlice",value:function(){for(var e=this.length,t=new Float32Array(this.length),r=0;r<e;r++)t[r]=this[r];return t}},{key:"_uint16ArraySlice",value:function(){var e,t,r;if(0===arguments.length)for(e=this.length,t=new Uint16Array(e),r=0;r<e;r++)t[r]=this[r];else if(2===arguments.length){var n=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1];if(i>n)for(e=i-n,t=new Uint16Array(e),r=n;r<i;r++)t[r-n]=this[r];else t=new Uint16Array(0)}return t}},{key:"enable",value:function(){return!0}},{key:"inner_enable",value:function(){return Float32Array.prototype.slice||(Float32Array.prototype.slice=n._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=n._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=n._uint8ArraySlice),!0}},{key:"onStageResize",value:function(r,n){null!=t.WebGLContext.mainContext&&(t.WebGLContext.mainContext.viewport(0,0,r,n),e.RenderState2D.width=r,e.RenderState2D.height=n)}}]),n}();exports.WebGL=a,a._isWebGL2=!1,a.isNativeRender_enable=!1;
},{"./utils/RenderState2D":"k75q","./WebGLContext":"vf9T"}],"Gwgr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Render=void 0;var e=require("./../../Config"),i=require("../layagl/LayaGL"),n=require("../resource/Context"),t=require("../utils/PlatformInfo"),r=require("../webgl/WebGL"),a=require("../webgl/WebGLContext"),o=require("../webgl/canvas/BlendMode"),s=require("../webgl/shader/d2/Shader2D"),u=require("../webgl/shader/d2/ShaderDefines2D"),l=require("../webgl/shader/d2/value/Value2D"),c=require("../webgl/submit/SubmitBase"),_=require("../webgl/utils/Buffer2D");function g(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function d(e,i){for(var n=0;n<i.length;n++){var t=i[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function b(e,i,n){return i&&d(e.prototype,i),n&&d(e,n),e}var f=function(){function d(e,i,n){g(this,d),this._timeId=0,d._mainCanvas=n,d._mainCanvas.source.id="layaCanvas",d._mainCanvas.source.width=e,d._mainCanvas.source.height=i,d.isConchApp&&document.body.appendChild(d._mainCanvas.source),this.initRender(d._mainCanvas,e,i),window.requestAnimationFrame(function e(i){d.gStage._loop();window.requestAnimationFrame(e)}),d.gStage.on("visibilitychange",this,this._onVisibilitychange)}return b(d,[{key:"_onVisibilitychange",value:function(){d.gStage.isVisibility?0!=this._timeId&&window.clearInterval(this._timeId):this._timeId=window.setInterval(this._enterFrame,1e3)}},{key:"initRender",value:function(g,b,f){var h=i.LayaGL.instance=a.WebGLContext.mainContext=function(n){var a,o=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];e.Config.useWebGL2||o.shift();for(var s=0;s<o.length;s++){try{a=n.getContext(o[s],{stencil:e.Config.isStencil,alpha:e.Config.isAlpha,antialias:e.Config.isAntialias,premultipliedAlpha:e.Config.premultipliedAlpha,preserveDrawingBuffer:e.Config.preserveDrawingBuffer})}catch(u){}if(a)return"webgl2"===o[s]&&(r.WebGL._isWebGL2=!0,t.PlatformInfo.isWebGL2Render=!0),new i.LayaGL,a}return null}(d._mainCanvas.source);if(!h)return!1;g.size(b,f),a.WebGLContext.__init__(h),n.Context.__init__(),c.SubmitBase.__init__();var p=new n.Context;p.isMain=!0,d._context=p,g._setContext(p),r.WebGL.shaderHighPrecision=!1;try{h.getShaderPrecisionFormat(a.WebGLContext.FRAGMENT_SHADER,a.WebGLContext.HIGH_FLOAT).precision?r.WebGL.shaderHighPrecision=t.PlatformInfo.shaderHighPrecision=!0:r.WebGL.shaderHighPrecision=!1}catch(m){}return i.LayaGL.instance=h,u.ShaderDefines2D.__init__(),l.Value2D.__init__(),s.Shader2D.__init__(),_.Buffer2D.__int__(h),o.BlendMode._init_(h),!0}},{key:"_enterFrame",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];d.gStage._loop()}}],[{key:"context",get:function(){return d._context}},{key:"canvas",get:function(){return d._mainCanvas.source}}]),d}();exports.Render=f,f.gStage=null,f.supportWebGLPlusCulling=!1,f.supportWebGLPlusAnimation=!1,f.supportWebGLPlusRendering=!1,f.isConchApp=!1,f.isConchApp=null!=window.conch,f.isConchApp&&(f.supportWebGLPlusCulling=!0,f.supportWebGLPlusAnimation=!0,f.supportWebGLPlusRendering=!0,t.PlatformInfo.supportWebGLPlusRendering=!0);
},{"./../../Config":"/R4M","../layagl/LayaGL":"ezDE","../resource/Context":"2BX4","../utils/PlatformInfo":"HmZQ","../webgl/WebGL":"RsJd","../webgl/WebGLContext":"vf9T","../webgl/canvas/BlendMode":"brGx","../webgl/shader/d2/Shader2D":"jNoH","../webgl/shader/d2/ShaderDefines2D":"el31","../webgl/shader/d2/value/Value2D":"cqLV","../webgl/submit/SubmitBase":"U5L8","../webgl/utils/Buffer2D":"XmYZ"}],"jv+d":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GraphicsBounds=void 0;var t=require("./cmd/AlphaCmd"),e=require("./cmd/DrawCircleCmd"),r=require("./cmd/DrawCurvesCmd"),i=require("./cmd/DrawImageCmd"),a=require("./cmd/DrawLineCmd"),o=require("./cmd/DrawLinesCmd"),s=require("./cmd/DrawPathCmd"),n=require("./cmd/DrawPieCmd"),d=require("./cmd/DrawPolyCmd"),h=require("./cmd/DrawRectCmd"),u=require("./cmd/DrawTextureCmd"),c=require("./cmd/FillTextureCmd"),m=require("./cmd/RestoreCmd"),l=require("./cmd/RotateCmd"),_=require("./cmd/ScaleCmd"),g=require("./cmd/TransformCmd"),p=require("./cmd/TranslateCmd"),P=require("../maths/Bezier"),f=require("../maths/GrahamScan"),y=require("../maths/Matrix"),v=require("../maths/Point"),x=require("../maths/Rectangle"),w=require("../renders/Render"),C=require("../utils/Pool"),R=require("../utils/Utils");function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function B(t,e,r){return e&&T(t.prototype,e),r&&T(t,r),t}var b=function(){function y(){D(this,y),this._cacheBoundsType=!1}return B(y,[{key:"destroy",value:function(){this._graphics=null,this._cacheBoundsType=!1,this._temp&&(this._temp.length=0),this._rstBoundPoints&&(this._rstBoundPoints.length=0),this._bounds&&this._bounds.recover(),this._bounds=null,C.Pool.recover("GraphicsBounds",this)}},{key:"reset",value:function(){this._temp&&(this._temp.length=0)}},{key:"getBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=x.Rectangle._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds}},{key:"getBoundPoints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=R.Utils.copyArray(this._rstBoundPoints,this._temp)}},{key:"_getCmdPoints",value:function(){var v,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=(w.Render._context,this._graphics.cmds);if((v=this._temp||(this._temp=[])).length=0,D||null==this._graphics._one||(y._tempCmds.length=0,y._tempCmds.push(this._graphics._one),D=y._tempCmds),!D)return v;var T=y._tempMatrixArrays;T.length=0;var B=y._initMatrix;B.identity();for(var b,k,I=y._tempMatrix,A=0,q=D.length;A<q;A++)switch((b=D[A]).cmdID){case t.AlphaCmd.ID:T.push(B),B=B.clone();break;case m.RestoreCmd.ID:B=T.pop();break;case _.ScaleCmd.ID:I.identity(),I.translate(-b.pivotX,-b.pivotY),I.scale(b.scaleX,b.scaleY),I.translate(b.pivotX,b.pivotY),this._switchMatrix(B,I);break;case l.RotateCmd.ID:I.identity(),I.translate(-b.pivotX,-b.pivotY),I.rotate(b.angle),I.translate(b.pivotX,b.pivotY),this._switchMatrix(B,I);break;case p.TranslateCmd.ID:I.identity(),I.translate(b.tx,b.ty),this._switchMatrix(B,I);break;case g.TransformCmd.ID:I.identity(),I.translate(-b.pivotX,-b.pivotY),I.concat(b.matrix),I.translate(b.pivotX,b.pivotY),this._switchMatrix(B,I);break;case i.DrawImageCmd.ID:case c.FillTextureCmd.ID:y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,b.width,b.height),B);break;case u.DrawTextureCmd.ID:B.copyTo(I),b.matrix&&I.concat(b.matrix),y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,b.width,b.height),I);break;case i.DrawImageCmd.ID:if(k=b.texture,C)b.width&&b.height?y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,b.width,b.height),B):y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,k.width,k.height),B);else{var M=(b.width||k.sourceWidth)/k.width,X=(b.height||k.sourceHeight)/k.height,Y=M*k.sourceWidth,S=X*k.sourceHeight,W=k.offsetX>0?k.offsetX:0,G=k.offsetY>0?k.offsetY:0;W*=M,G*=X,y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x-W,b.y-G,Y,S),B)}break;case c.FillTextureCmd.ID:b.width&&b.height?y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,b.width,b.height),B):(k=b.texture,y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,k.width,k.height),B));break;case u.DrawTextureCmd.ID:var L;b.matrix?(B.copyTo(I),I.concat(b.matrix),L=I):L=B,C?b.width&&b.height?y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,b.width,b.height),L):(k=b.texture,y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,k.width,k.height),L)):(k=b.texture,M=(b.width||k.sourceWidth)/k.width,X=(b.height||k.sourceHeight)/k.height,Y=M*k.sourceWidth,S=X*k.sourceHeight,W=k.offsetX>0?k.offsetX:0,G=k.offsetY>0?k.offsetY:0,W*=M,G*=X,y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x-W,b.y-G,Y,S),L));break;case h.DrawRectCmd.ID:y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x,b.y,b.width,b.height),B);break;case e.DrawCircleCmd.ID:y._addPointArrToRst(v,x.Rectangle._getBoundPointS(b.x-b.radius,b.y-b.radius,b.radius+b.radius,b.radius+b.radius),B);break;case a.DrawLineCmd.ID:var H;y._tempPoints.length=0,H=.5*b.lineWidth,b.fromX==b.toX?y._tempPoints.push(b.fromX+H,b.fromY,b.toX+H,b.toY,b.fromX-H,b.fromY,b.toX-H,b.toY):b.fromY==b.toY?y._tempPoints.push(b.fromX,b.fromY+H,b.toX,b.toY+H,b.fromX,b.fromY-H,b.toX,b.toY-H):y._tempPoints.push(b.fromX,b.fromY,b.toX,b.toY),y._addPointArrToRst(v,y._tempPoints,B);break;case r.DrawCurvesCmd.ID:y._addPointArrToRst(v,P.Bezier.I.getBezierPoints(b.points),B,b.x,b.y);break;case o.DrawLinesCmd.ID:case d.DrawPolyCmd.ID:y._addPointArrToRst(v,b.points,B,b.x,b.y);break;case s.DrawPathCmd.ID:y._addPointArrToRst(v,this._getPathPoints(b.paths),B,b.x,b.y);break;case n.DrawPieCmd.ID:y._addPointArrToRst(v,this._getPiePoints(b.x,b.y,b.radius,b.startAngle,b.endAngle),B)}return v.length>200?v=R.Utils.copyArray(v,x.Rectangle._getWrapRec(v)._getBoundPoints()):v.length>8&&(v=f.GrahamScan.scanPList(v)),v}},{key:"_switchMatrix",value:function(t,e){e.concat(t),e.copyTo(t)}},{key:"_getPiePoints",value:function(t,e,r,i,a){var o=y._tempPoints;y._tempPoints.length=0;var s=Math.PI/180,n=a-i;if(n>=360||n<=-360)return o.push(t-r,e-r),o.push(t+r,e-r),o.push(t+r,e+r),o.push(t-r,e+r),o;o.push(t,e);var d=n%360;d<0&&(d+=360);var h=i+d,u=i*s,c=h*s;o.push(t+r*Math.cos(u),e+r*Math.sin(u)),o.push(t+r*Math.cos(c),e+r*Math.sin(c));for(var m=90*Math.ceil(i/90),l=90*Math.floor(h/90),_=m;_<=l;_+=90){var g=_*s;o.push(t+r*Math.cos(g),e+r*Math.sin(g))}return o}},{key:"_getPathPoints",value:function(t){var e,r,i,a=y._tempPoints;for(a.length=0,r=t.length,e=0;e<r;e++)(i=t[e]).length>1&&(a.push(i[1],i[2]),i.length>3&&a.push(i[3],i[4]));return a}}],[{key:"create",value:function(){return C.Pool.getItemByClass("GraphicsBounds",y)}},{key:"_addPointArrToRst",value:function(t,e,r){var i,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;for(a=e.length,i=0;i<a;i+=2)y._addPointToRst(t,e[i]+o,e[i+1]+s,r)}},{key:"_addPointToRst",value:function(t,e,r,i){var a=v.Point.TEMP;a.setTo(e||0,r||0),i.transformPoint(a),t.push(a.x,a.y)}}]),y}();exports.GraphicsBounds=b,b._tempMatrix=new y.Matrix,b._initMatrix=new y.Matrix,b._tempPoints=[],b._tempMatrixArrays=[],b._tempCmds=[];
},{"./cmd/AlphaCmd":"cNOx","./cmd/DrawCircleCmd":"DptT","./cmd/DrawCurvesCmd":"Q9+B","./cmd/DrawImageCmd":"xzxk","./cmd/DrawLineCmd":"J3Wj","./cmd/DrawLinesCmd":"s56c","./cmd/DrawPathCmd":"SEdD","./cmd/DrawPieCmd":"mNeg","./cmd/DrawPolyCmd":"rhuG","./cmd/DrawRectCmd":"r0FX","./cmd/DrawTextureCmd":"n0RH","./cmd/FillTextureCmd":"ty0b","./cmd/RestoreCmd":"zk/l","./cmd/RotateCmd":"gArK","./cmd/ScaleCmd":"Tl7A","./cmd/TransformCmd":"MOMZ","./cmd/TranslateCmd":"V/SB","../maths/Bezier":"d9b0","../maths/GrahamScan":"5c0r","../maths/Matrix":"GG2z","../maths/Point":"ziZY","../maths/Rectangle":"iPyf","../renders/Render":"Gwgr","../utils/Pool":"Jkpb","../utils/Utils":"kHKw"}],"Z/jw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ClipRectCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}var n=function(){function r(){t(this,r)}return i(r,[{key:"recover",value:function(){e.Pool.recover("ClipRectCmd",this)}},{key:"run",value:function(e,t,r){e.clipRect(this.x+t,this.y+r,this.width,this.height)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,i,n,o){var c=e.Pool.getItemByClass("ClipRectCmd",r);return c.x=t,c.y=i,c.width=n,c.height=o,c}}]),r}();exports.ClipRectCmd=n,n.ID="ClipRect";
},{"../../utils/Pool":"Jkpb"}],"DbEk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Draw9GridTexture=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}var n=function(){function t(){r(this,t)}return i(t,[{key:"recover",value:function(){this.texture._removeReference(),e.Pool.recover("Draw9GridTexture",this)}},{key:"run",value:function(e,r,t){e.drawTextureWithSizeGrid(this.texture,this.x,this.y,this.width,this.height,this.sizeGrid,r,t)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(r,i,n,u,o,a){var s=e.Pool.getItemByClass("Draw9GridTexture",t);return s.texture=r,r._addReference(),s.x=i,s.y=n,s.width=u,s.height=o,s.sizeGrid=a,s}}]),t}();exports.Draw9GridTexture=n,n.ID="Draw9GridTexture";
},{"../../utils/Pool":"Jkpb"}],"UZl8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawTexturesCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}var u=function(){function t(){r(this,t)}return n(t,[{key:"recover",value:function(){this.texture._removeReference(),this.texture=null,this.pos=null,e.Pool.recover("DrawTexturesCmd",this)}},{key:"run",value:function(e,r,t){e.drawTextures(this.texture,this.pos,r,t)}},{key:"cmdID",get:function(){return t.ID}}],[{key:"create",value:function(r,n){var u=e.Pool.getItemByClass("DrawTexturesCmd",t);return u.texture=r,r._addReference(),u.pos=n,u}}]),t}();exports.DrawTexturesCmd=u,u.ID="DrawTextures";
},{"../../utils/Pool":"Jkpb"}],"zZtX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawTrianglesCmd=void 0;var e=require("../../filters/ColorFilter"),r=require("../../utils/ColorUtils"),t=require("../../utils/Pool");function i(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function l(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,r,t){return r&&l(e.prototype,r),t&&l(e,t),e}var o=function(){function l(){i(this,l)}return n(l,[{key:"recover",value:function(){this.texture=null,this.vertices=null,this.uvs=null,this.indices=null,this.matrix=null,t.Pool.recover("DrawTrianglesCmd",this)}},{key:"run",value:function(e,r,t){e.drawTriangles(this.texture,this.x+r,this.y+t,this.vertices,this.uvs,this.indices,this.matrix,this.alpha,this.color,this.blendMode)}},{key:"cmdID",get:function(){return l.ID}}],[{key:"create",value:function(i,n,o,s,a,u,c,h,v,f){var d=t.Pool.getItemByClass("DrawTrianglesCmd",l);if(d.texture=i,d.x=n,d.y=o,d.vertices=s,d.uvs=a,d.indices=u,d.matrix=c,d.alpha=h,v){d.color=new e.ColorFilter;var y=r.ColorUtils.create(v).arrColor;d.color.color(255*y[0],255*y[1],255*y[2],255*y[3])}return d.blendMode=f,d}}]),l}();exports.DrawTrianglesCmd=o,o.ID="DrawTriangles";
},{"../../filters/ColorFilter":"uQu9","../../utils/ColorUtils":"iLoT","../../utils/Pool":"Jkpb"}],"W8S5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FillBorderTextCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}var i=function(){function r(){t(this,r)}return o(r,[{key:"recover",value:function(){e.Pool.recover("FillBorderTextCmd",this)}},{key:"run",value:function(e,t,r){e.fillBorderText(this.text,this.x+t,this.y+r,this.font,this.fillColor,this.borderColor,this.lineWidth,this.textAlign)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,o,i,l,n,u,a,s){var c=e.Pool.getItemByClass("FillBorderTextCmd",r);return c.text=t,c.x=o,c.y=i,c.font=l,c.fillColor=n,c.borderColor=u,c.lineWidth=a,c.textAlign=s,c}}]),r}();exports.FillBorderTextCmd=i,i.ID="FillBorderText";
},{"../../utils/Pool":"Jkpb"}],"QMD2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FillBorderWordsCmd=void 0;var r=require("../../utils/Pool");function e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function o(r,e){for(var o=0;o<e.length;o++){var t=e[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function t(r,e,t){return e&&o(r.prototype,e),t&&o(r,t),r}var i=function(){function o(){e(this,o)}return t(o,[{key:"recover",value:function(){this.words=null,r.Pool.recover("FillBorderWordsCmd",this)}},{key:"run",value:function(r,e,o){r.fillBorderWords(this.words,this.x+e,this.y+o,this.font,this.fillColor,this.borderColor,this.lineWidth)}},{key:"cmdID",get:function(){return o.ID}}],[{key:"create",value:function(e,t,i,l,n,s,d){var u=r.Pool.getItemByClass("FillBorderWordsCmd",o);return u.words=e,u.x=t,u.y=i,u.font=l,u.fillColor=n,u.borderColor=s,u.lineWidth=d,u}}]),o}();exports.FillBorderWordsCmd=i,i.ID="FillBorderWords";
},{"../../utils/Pool":"Jkpb"}],"QEEA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FillTextCmd=void 0;var t=require("../../utils/ColorUtils"),e=require("../../utils/FontInfo"),n=require("../../utils/Pool"),i=require("../../utils/WordText");function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}var l=function(){function r(){o(this,r),this._textIsWorldText=!1,this._fontColor=4294967295,this._strokeColor=0,this._fontObj=r._defFontObj,this._nTexAlign=0}return s(r,[{key:"recover",value:function(){n.Pool.recover("FillTextCmd",this)}},{key:"run",value:function(t,e,n){this._textIsWorldText?t._fast_filltext(this._text,this.x+e,this.y+n,this._fontObj,this._color,null,0,this._nTexAlign,0):t.drawText(this._text,this.x+e,this.y+n,this._font,this._color,this._textAlign)}},{key:"cmdID",get:function(){return r.ID}},{key:"text",get:function(){return this._text},set:function(t){this._text=t,this._textIsWorldText=t instanceof i.WordText,this._textIsWorldText&&this._text.cleanCache()}},{key:"font",get:function(){return this._font},set:function(t){this._font=t,this._fontObj=e.FontInfo.Parse(t),this._textIsWorldText&&this._text.cleanCache()}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._fontColor=t.ColorUtils.create(e).numColor,this._textIsWorldText&&this._text.cleanCache()}},{key:"textAlign",get:function(){return this._textAlign},set:function(t){switch(this._textAlign=t,t){case"center":this._nTexAlign=0;break;case"right":this._nTexAlign=1;break;default:this._nTexAlign=2}this._textIsWorldText&&this._text.cleanCache()}}],[{key:"create",value:function(t,e,o,s,l,x){var c=n.Pool.getItemByClass("FillTextCmd",r);return c.text=t,c._textIsWorldText=t instanceof i.WordText,c.x=e,c.y=o,c.font=s,c.color=l,c.textAlign=x,c}}]),r}();exports.FillTextCmd=l,l.ID="FillText",l._defFontObj=new e.FontInfo(null);
},{"../../utils/ColorUtils":"iLoT","../../utils/FontInfo":"1cf6","../../utils/Pool":"Jkpb","../../utils/WordText":"RVK6"}],"YuqL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FillWordsCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function o(e,r){for(var o=0;o<r.length;o++){var t=r[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function t(e,r,t){return r&&o(e.prototype,r),t&&o(e,t),e}var n=function(){function o(){r(this,o)}return t(o,[{key:"recover",value:function(){this.words=null,e.Pool.recover("FillWordsCmd",this)}},{key:"run",value:function(e,r,o){e.fillWords(this.words,this.x+r,this.y+o,this.font,this.color)}},{key:"cmdID",get:function(){return o.ID}}],[{key:"create",value:function(r,t,n,i,l){var s=e.Pool.getItemByClass("FillWordsCmd",o);return s.words=r,s.x=t,s.y=n,s.font=i,s.color=l,s}}]),o}();exports.FillWordsCmd=n,n.ID="FillWords";
},{"../../utils/Pool":"Jkpb"}],"0alP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SaveCmd=void 0;var e=require("../../utils/Pool");function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function t(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}var o=function(){function n(){r(this,n)}return t(n,[{key:"recover",value:function(){e.Pool.recover("SaveCmd",this)}},{key:"run",value:function(e,r,n){e.save()}},{key:"cmdID",get:function(){return n.ID}}],[{key:"create",value:function(){return e.Pool.getItemByClass("SaveCmd",n)}}]),n}();exports.SaveCmd=o,o.ID="Save";
},{"../../utils/Pool":"Jkpb"}],"Eycw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StrokeTextCmd=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}var n=function(){function r(){t(this,r)}return o(r,[{key:"recover",value:function(){e.Pool.recover("StrokeTextCmd",this)}},{key:"run",value:function(e,t,r){e.strokeWord(this.text,this.x+t,this.y+r,this.font,this.color,this.lineWidth,this.textAlign)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(t,o,n,i,u,l,a){var c=e.Pool.getItemByClass("StrokeTextCmd",r);return c.text=t,c.x=o,c.y=n,c.font=i,c.color=u,c.lineWidth=l,c.textAlign=a,c}}]),r}();exports.StrokeTextCmd=n,n.ID="StrokeText";
},{"../../utils/Pool":"Jkpb"}],"EApa":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.CacheManger=void 0;var i=function(){function n(){e(this,n)}return t(n,null,[{key:"regCacheByFunction",value:function(e,t){var i;n.unRegCacheByFunction(e,t),i={tryDispose:e,getCacheList:t},n._cacheList.push(i)}},{key:"unRegCacheByFunction",value:function(e,t){var i,c;for(c=n._cacheList.length,i=0;i<c;i++)if(n._cacheList[i].tryDispose==e&&n._cacheList[i].getCacheList==t)return void n._cacheList.splice(i,1)}},{key:"forceDispose",value:function(){var e,t=n._cacheList.length;for(e=0;e<t;e++)n._cacheList[e].tryDispose(!0)}},{key:"beginCheck",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;window.Laya.systemTimer.loop(e,null,n._checkLoop)}},{key:"stopCheck",value:function(){window.Laya.systemTimer.clear(null,n._checkLoop)}},{key:"_checkLoop",value:function(){var e=n._cacheList;if(!(e.length<1)){var t,i,c=Date.now();for(i=t=e.length;t>0&&(n._index++,n._index=n._index%i,e[n._index].tryDispose(!1),!(Date.now()-c>n.loopTimeLimit));)t--}}}]),n}();exports.CacheManger=i,i.loopTimeLimit=2,i._cacheList=[],i._index=0;
},{}],"gHBw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VectorGraphManager=void 0;var e=require("./CacheManger");function i(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function t(e,i){for(var t=0;t<i.length;t++){var s=i[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function s(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}var n=function(){function t(){i(this,t),this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],e.CacheManger.regCacheByFunction(this.startDispose.bind(this),this.getCacheList.bind(this))}return s(t,[{key:"getId",value:function(){return this._id++}},{key:"addShape",value:function(e,i){this.shapeDic[e]=i,this.useDic[e]||(this.useDic[e]=!0)}},{key:"addLine",value:function(e,i){this.shapeLineDic[e]=i,this.shapeLineDic[e]||(this.shapeLineDic[e]=!0)}},{key:"getShape",value:function(e){this._checkKey&&null!=this.useDic[e]&&(this.useDic[e]=!0)}},{key:"deleteShape",value:function(e){this.shapeDic[e]&&(this.shapeDic[e]=null,delete this.shapeDic[e]),this.shapeLineDic[e]&&(this.shapeLineDic[e]=null,delete this.shapeLineDic[e]),null!=this.useDic[e]&&delete this.useDic[e]}},{key:"getCacheList",value:function(){var e,i=[];for(e in this.shapeDic)i.push(this.shapeDic[e]);for(e in this.shapeLineDic)i.push(this.shapeLineDic[e]);return i}},{key:"startDispose",value:function(e){var i;for(i in this.useDic)this.useDic[i]=!1;this._checkKey=!0}},{key:"endDispose",value:function(){if(this._checkKey){var e;for(e in this.useDic)this.useDic[e]||this.deleteShape(e);this._checkKey=!1}}}],[{key:"getInstance",value:function(){return t.instance=t.instance||new t}}]),t}();exports.VectorGraphManager=n;
},{"./CacheManger":"EApa"}],"9Gi9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Graphics=void 0;var e=require("././GraphicsBounds"),t=require("././SpriteConst"),r=require("./cmd/AlphaCmd"),i=require("./cmd/ClipRectCmd"),n=require("./cmd/Draw9GridTexture"),s=require("./cmd/DrawCircleCmd"),a=require("./cmd/DrawCurvesCmd"),l=require("./cmd/DrawImageCmd"),d=require("./cmd/DrawLineCmd"),o=require("./cmd/DrawLinesCmd"),h=require("./cmd/DrawPathCmd"),u=require("./cmd/DrawPieCmd"),c=require("./cmd/DrawPolyCmd"),_=require("./cmd/DrawRectCmd"),v=require("./cmd/DrawTextureCmd"),m=require("./cmd/DrawTexturesCmd"),C=require("./cmd/DrawTrianglesCmd"),g=require("./cmd/FillBorderTextCmd"),f=require("./cmd/FillBorderWordsCmd"),p=require("./cmd/FillTextCmd"),T=require("./cmd/FillTextureCmd"),y=require("./cmd/FillWordsCmd"),x=require("./cmd/RestoreCmd"),R=require("./cmd/RotateCmd"),w=require("./cmd/SaveCmd"),k=require("./cmd/ScaleCmd"),D=require("./cmd/StrokeTextCmd"),q=require("./cmd/TransformCmd"),B=require("./cmd/TranslateCmd"),I=require("../events/Event"),P=require("../maths/Point"),A=require("../renders/Render"),S=require("../resource/Texture"),G=require("../utils/Utils"),F=require("../utils/VectorGraphManager");function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function L(e,t,r){return t&&E(e.prototype,t),r&&E(e,r),e}var H=function(){function E(){W(this,E),this._sp=null,this._one=null,this._render=this._renderEmpty,this._cmds=null,this._vectorgraphArray=null,this._graphicBounds=null,this.autoDestroy=!1,this.deffont="Arial",this._createData()}return L(E,[{key:"_createData",value:function(){}},{key:"_clearData",value:function(){}},{key:"_destroyData",value:function(){}},{key:"destroy",value:function(){this.clear(!0),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0,this._sp._setRenderType(0),this._sp=null),this._destroyData()}},{key:"clear",value:function(){if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){var e=this._one;if(this._cmds){var r,i=this._cmds.length;for(r=0;r<i;r++)(e=this._cmds[r]).recover();this._cmds.length=0}else e&&e.recover()}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._clearData(),this._sp&&(this._sp._renderType&=~t.SpriteConst.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),this._repaint(),this._vectorgraphArray){for(r=0,i=this._vectorgraphArray.length;r<i;r++)F.VectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[r]);this._vectorgraphArray.length=0}}},{key:"_clearBoundsCache",value:function(){this._graphicBounds&&this._graphicBounds.reset()}},{key:"_initGraphicBounds",value:function(){this._graphicBounds||(this._graphicBounds=e.GraphicsBounds.create(),this._graphicBounds._graphics=this)}},{key:"_repaint",value:function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()}},{key:"_isOnlyOne",value:function(){return!this._cmds||0===this._cmds.length}},{key:"getBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._initGraphicBounds(),this._graphicBounds.getBounds(e)}},{key:"getBoundPoints",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._initGraphicBounds(),this._graphicBounds.getBoundPoints(e)}},{key:"drawImage",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!e)return null;if(n||(n=e.sourceWidth),s||(s=e.sourceHeight),e.getIsReady()){var a=n/e.sourceWidth,d=s/e.sourceHeight;if(n=e.width*a,s=e.height*d,n<=0||s<=0)return null;r+=e.offsetX*a,i+=e.offsetY*d}this._sp&&(this._sp._renderType|=t.SpriteConst.GRAPHICS,this._sp._setRenderType(this._sp._renderType));var o=l.DrawImageCmd.create.call(this,e,r,i,n,s);return null==this._one?(this._one=o,this._render=this._renderOneImg):this._saveToCmd(null,o),this._repaint(),o}},{key:"drawTexture",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;if(!e||l<.01)return null;if(!e.getIsReady())return null;if(n||(n=e.sourceWidth),s||(s=e.sourceHeight),e.getIsReady()){var h=n/e.sourceWidth,u=s/e.sourceHeight;if(n=e.width*h,s=e.height*u,n<=0||s<=0)return null;r+=e.offsetX*h,i+=e.offsetY*u}this._sp&&(this._sp._renderType|=t.SpriteConst.GRAPHICS,this._sp._setRenderType(this._sp._renderType));var c=v.DrawTextureCmd.create.call(this,e,r,i,n,s,a,l,d,o);return this._repaint(),this._saveToCmd(null,c)}},{key:"drawTextures",value:function(e,t){return e?this._saveToCmd(A.Render._context.drawTextures,m.DrawTexturesCmd.create.call(this,e,t)):null}},{key:"drawTriangles",value:function(e,t,r,i,n,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;return this._saveToCmd(A.Render._context.drawTriangles,C.DrawTrianglesCmd.create.call(this,e,t,r,i,n,s,a,l,d,o))}},{key:"fillTexture",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"repeat",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return e&&e.getIsReady()?this._saveToCmd(A.Render._context._fillTexture,T.FillTextureCmd.create.call(this,e,t,r,i,n,s,a||P.Point.EMPTY,{})):null}},{key:"_saveToCmd",value:function(e,r){return this._sp&&(this._sp._renderType|=t.SpriteConst.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),null==this._one?(this._one=r,this._render=this._renderOne):(this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(r)),this._repaint(),r}},{key:"clipRect",value:function(e,t,r,n){return this._saveToCmd(A.Render._context.clipRect,i.ClipRectCmd.create.call(this,e,t,r,n))}},{key:"fillText",value:function(e,t,r,i,n,s){return this._saveToCmd(A.Render._context.fillText,p.FillTextCmd.create.call(this,e,t,r,i||this.deffont,n,s))}},{key:"fillBorderText",value:function(e,t,r,i,n,s,a,l){return this._saveToCmd(A.Render._context.fillBorderText,g.FillBorderTextCmd.create.call(this,e,t,r,i||this.deffont,n,s,a,l))}},{key:"fillWords",value:function(e,t,r,i,n){return this._saveToCmd(A.Render._context.fillWords,y.FillWordsCmd.create.call(this,e,t,r,i||this.deffont,n))}},{key:"fillBorderWords",value:function(e,t,r,i,n,s,a){return this._saveToCmd(A.Render._context.fillBorderWords,f.FillBorderWordsCmd.create.call(this,e,t,r,i||this.deffont,n,s,a))}},{key:"strokeText",value:function(e,t,r,i,n,s,a){return this._saveToCmd(A.Render._context.fillBorderText,D.StrokeTextCmd.create.call(this,e,t,r,i||this.deffont,null,n,s,a))}},{key:"alpha",value:function(e){return this._saveToCmd(A.Render._context.alpha,r.AlphaCmd.create.call(this,e))}},{key:"transform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this._saveToCmd(A.Render._context._transform,q.TransformCmd.create.call(this,e,t,r))}},{key:"rotate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this._saveToCmd(A.Render._context._rotate,R.RotateCmd.create.call(this,e,t,r))}},{key:"scale",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this._saveToCmd(A.Render._context._scale,k.ScaleCmd.create.call(this,e,t,r,i))}},{key:"translate",value:function(e,t){return this._saveToCmd(A.Render._context.translate,B.TranslateCmd.create.call(this,e,t))}},{key:"save",value:function(){return this._saveToCmd(A.Render._context._save,w.SaveCmd.create.call(this))}},{key:"restore",value:function(){return this._saveToCmd(A.Render._context.restore,x.RestoreCmd.create.call(this))}},{key:"replaceText",value:function(e){this._repaint();var t=this._cmds;if(t){for(var r=t.length-1;r>-1;r--)if(this._isTextCmd(t[r]))return t[r].text=e,!0}else if(this._one&&this._isTextCmd(this._one))return this._one.text=e,!0;return!1}},{key:"_isTextCmd",value:function(e){var t=e.cmdID;return t==p.FillTextCmd.ID||t==D.StrokeTextCmd.ID||t==g.FillBorderTextCmd.ID}},{key:"replaceTextColor",value:function(e){this._repaint();var t=this._cmds;if(t)for(var r=t.length-1;r>-1;r--)this._isTextCmd(t[r])&&this._setTextCmdColor(t[r],e);else this._one&&this._isTextCmd(this._one)&&this._setTextCmdColor(this._one,e)}},{key:"_setTextCmdColor",value:function(e,t){switch(e.cmdID){case p.FillTextCmd.ID:case D.StrokeTextCmd.ID:e.color=t;break;case g.FillBorderTextCmd.ID:case f.FillBorderWordsCmd.ID:case g.FillBorderTextCmd.ID:e.fillColor=t}}},{key:"loadImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=E.gLoader.getRes(e);a?a.getIsReady()?this.drawImage(a,t,r,i,n):a.once(I.Event.READY,this,this.drawImage,[a,t,r,i,n]):((a=new S.Texture).load(e),E.gLoader.cacheRes(e,a),a.once(I.Event.READY,this,this.drawImage,[a,t,r,i,n])),null!=s&&(a.getIsReady()?s.call(this._sp):a.on(I.Event.READY,this._sp,s))}},{key:"_renderEmpty",value:function(e,t,r,i){}},{key:"_renderAll",value:function(e,t,r,i){for(var n=this._cmds,s=0,a=n.length;s<a;s++)n[s].run(t,r,i)}},{key:"_renderOne",value:function(e,t,r,i){t.sprite=e,this._one.run(t,r,i)}},{key:"_renderOneImg",value:function(e,t,r,i){t.sprite=e,this._one.run(t,r,i)}},{key:"drawLine",value:function(e,t,r,i,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=s<1||s%2==0?0:.5;return this._saveToCmd(A.Render._context._drawLine,d.DrawLineCmd.create.call(this,e+a,t+a,r+a,i+a,n,s,0))}},{key:"drawLines",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!r||r.length<4)return null;var s=n<1||n%2==0?0:.5;return this._saveToCmd(A.Render._context._drawLines,o.DrawLinesCmd.create.call(this,e+s,t+s,r,i,n,0))}},{key:"drawCurves",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return this._saveToCmd(A.Render._context.drawCurves,a.DrawCurvesCmd.create.call(this,e,t,r,i,n))}},{key:"drawRect",value:function(e,t,r,i,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=a>=1&&s?a/2:0,d=s?a:0;return this._saveToCmd(A.Render._context.drawRect,_.DrawRectCmd.create.call(this,e+l,t+l,r-d,i-d,n,s,a))}},{key:"drawCircle",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=a>=1&&n?a/2:0;return this._saveToCmd(A.Render._context._drawCircle,s.DrawCircleCmd.create.call(this,e,t,r-l,i,n,a,0))}},{key:"drawPie",value:function(e,t,r,i,n,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,d=l>=1&&a?l/2:0,o=a?l:0;return this._saveToCmd(A.Render._context._drawPie,u.DrawPieCmd.create.call(this,e+d,t+d,r-o,G.Utils.toRadian(i),G.Utils.toRadian(n),s,a,l,0))}},{key:"drawPoly",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=!1;a=!(r.length>6);var l=s>=1&&n?s%2==0?0:.5:0;return this._saveToCmd(A.Render._context._drawPoly,c.DrawPolyCmd.create.call(this,e+l,t+l,r,i,n,s,a,0))}},{key:"drawPath",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this._saveToCmd(A.Render._context._drawPath,h.DrawPathCmd.create.call(this,e,t,r,i,n))}},{key:"draw9Grid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this._saveToCmd(null,n.Draw9GridTexture.create(e,t,r,i,s,a))}},{key:"cmds",get:function(){return this._cmds},set:function(e){this._sp&&(this._sp._renderType|=t.SpriteConst.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),this._cmds=e,this._render=this._renderAll,this._repaint()}}]),E}();exports.Graphics=H,H.gLoader=null;
},{"././GraphicsBounds":"jv+d","././SpriteConst":"3oZi","./cmd/AlphaCmd":"cNOx","./cmd/ClipRectCmd":"Z/jw","./cmd/Draw9GridTexture":"DbEk","./cmd/DrawCircleCmd":"DptT","./cmd/DrawCurvesCmd":"Q9+B","./cmd/DrawImageCmd":"xzxk","./cmd/DrawLineCmd":"J3Wj","./cmd/DrawLinesCmd":"s56c","./cmd/DrawPathCmd":"SEdD","./cmd/DrawPieCmd":"mNeg","./cmd/DrawPolyCmd":"rhuG","./cmd/DrawRectCmd":"r0FX","./cmd/DrawTextureCmd":"n0RH","./cmd/DrawTexturesCmd":"UZl8","./cmd/DrawTrianglesCmd":"zZtX","./cmd/FillBorderTextCmd":"W8S5","./cmd/FillBorderWordsCmd":"QMD2","./cmd/FillTextCmd":"QEEA","./cmd/FillTextureCmd":"ty0b","./cmd/FillWordsCmd":"YuqL","./cmd/RestoreCmd":"zk/l","./cmd/RotateCmd":"gArK","./cmd/SaveCmd":"0alP","./cmd/ScaleCmd":"Tl7A","./cmd/StrokeTextCmd":"Eycw","./cmd/TransformCmd":"MOMZ","./cmd/TranslateCmd":"V/SB","../events/Event":"jK6U","../maths/Point":"ziZY","../renders/Render":"Gwgr","../resource/Texture":"nP6w","../utils/Utils":"kHKw","../utils/VectorGraphManager":"gHBw"}],"U9cX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoundsStyle=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var o=function(){function n(){t(this,n)}return r(n,[{key:"reset",value:function(){return this.bounds&&this.bounds.recover(),this.userBounds&&this.userBounds.recover(),this.bounds=null,this.userBounds=null,this.temBM=null,this}},{key:"recover",value:function(){e.Pool.recover("BoundsStyle",this.reset())}}],[{key:"create",value:function(){return e.Pool.getItemByClass("BoundsStyle",n)}}]),n}();exports.BoundsStyle=o;
},{"../../utils/Pool":"Jkpb"}],"11pa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CacheStyle=void 0;var e=require("../../maths/Point"),t=require("../../maths/Rectangle"),a=require("../../resource/HTMLCanvas"),c=require("../../utils/Pool");function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var a=0;a<t.length;a++){var c=t[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function n(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e}var r=function(){function e(){s(this,e),this.reset()}return n(e,[{key:"needBitmapCache",value:function(){return this.cacheForFilters||!!this.mask}},{key:"needEnableCanvasRender",value:function(){return"none"!=this.userSetCache||this.cacheForFilters||!!this.mask}},{key:"releaseContext",value:function(){this.canvas&&this.canvas.size&&(c.Pool.recover("CacheCanvas",this.canvas),this.canvas.size(0,0),this.canvas.width=0,this.canvas.height=0),this.canvas=null}},{key:"createContext",value:function(){if(!this.canvas){this.canvas=c.Pool.getItem("CacheCanvas")||new a.HTMLCanvas(!1);var e=this.canvas.context;e||(e=this.canvas.getContext("2d"))}}},{key:"releaseFilterCache",value:function(){var e=this.filterCache;e&&(e.destroy(),e.recycle(),this.filterCache=null)}},{key:"recover",value:function(){this!==e.EMPTY&&c.Pool.recover("SpriteCache",this.reset())}},{key:"reset",value:function(){return this.releaseContext(),this.releaseFilterCache(),this.cacheAs="none",this.enableCanvasRender=!1,this.userSetCache="none",this.cacheForFilters=!1,this.staticCache=!1,this.reCache=!0,this.mask=null,this.maskParent=null,this.filterCache=null,this.filters=null,this.hasGlowFilter=!1,this.cacheRect&&this.cacheRect.recover(),this.cacheRect=null,this}},{key:"_calculateCacheRect",value:function(a,c,s,i){var n,r=a._cacheStyle;if(r.cacheRect||(r.cacheRect=t.Rectangle.create()),"bitmap"===c?((n=a.getSelfBounds()).width=n.width+2*e.CANVAS_EXTEND_EDGE,n.height=n.height+2*e.CANVAS_EXTEND_EDGE,n.x=n.x-a.pivotX,n.y=n.y-a.pivotY,n.x=n.x-e.CANVAS_EXTEND_EDGE,n.y=n.y-e.CANVAS_EXTEND_EDGE,n.x=Math.floor(n.x+s)-s,n.y=Math.floor(n.y+i)-i,n.width=Math.floor(n.width),n.height=Math.floor(n.height),r.cacheRect.copyFrom(n)):r.cacheRect.setTo(-a._style.pivotX,-a._style.pivotY,1,1),n=r.cacheRect,a._style.scrollRect){var h=a._style.scrollRect;n.x-=h.x,n.y-=h.y}return e._scaleInfo.setTo(1,1),e._scaleInfo}}],[{key:"create",value:function(){return c.Pool.getItemByClass("SpriteCache",e)}}]),e}();exports.CacheStyle=r,r.EMPTY=new r,r._scaleInfo=new e.Point,r.CANVAS_EXTEND_EDGE=16;
},{"../../maths/Point":"ziZY","../../maths/Rectangle":"iPyf","../../resource/HTMLCanvas":"TY9w","../../utils/Pool":"Jkpb"}],"C3xf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SpriteStyle=void 0;var e=require("../../utils/Pool");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}var o=function(){function r(){t(this,r),this.reset()}return i(r,[{key:"reset",value:function(){return this.scaleX=this.scaleY=1,this.skewX=this.skewY=0,this.pivotX=this.pivotY=this.rotation=0,this.alpha=1,this.scrollRect&&this.scrollRect.recover(),this.scrollRect=null,this.viewport&&this.viewport.recover(),this.viewport=null,this.hitArea=null,this.dragging=null,this.blendMode=null,this}},{key:"recover",value:function(){this!==r.EMPTY&&e.Pool.recover("SpriteStyle",this.reset())}}],[{key:"create",value:function(){return e.Pool.getItemByClass("SpriteStyle",r)}}]),r}();exports.SpriteStyle=o,o.EMPTY=new o;
},{"../../utils/Pool":"Jkpb"}],"kzmL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayaGLQuickRunner=void 0;var r=require("../Const"),a=require("../display/SpriteConst"),t=require("../maths/Matrix");function e(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}function i(r,a){for(var t=0;t<a.length;t++){var e=a[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function o(r,a,t){return a&&i(r.prototype,a),t&&i(r,t),r}var n=function(){function t(){e(this,t)}return o(t,null,[{key:"__init__",value:function(){t.map[a.SpriteConst.ALPHA|a.SpriteConst.TRANSFORM|a.SpriteConst.GRAPHICS]=t.alpha_transform_drawLayaGL,t.map[a.SpriteConst.ALPHA|a.SpriteConst.GRAPHICS]=t.alpha_drawLayaGL,t.map[a.SpriteConst.TRANSFORM|a.SpriteConst.GRAPHICS]=t.transform_drawLayaGL,t.map[a.SpriteConst.TRANSFORM|a.SpriteConst.CHILDS]=t.transform_drawNodes,t.map[a.SpriteConst.ALPHA|a.SpriteConst.TRANSFORM|a.SpriteConst.TEXTURE]=t.alpha_transform_drawTexture,t.map[a.SpriteConst.ALPHA|a.SpriteConst.TEXTURE]=t.alpha_drawTexture,t.map[a.SpriteConst.TRANSFORM|a.SpriteConst.TEXTURE]=t.transform_drawTexture,t.map[a.SpriteConst.GRAPHICS|a.SpriteConst.CHILDS]=t.drawLayaGL_drawNodes}},{key:"transform_drawTexture",value:function(r,a,e,i){r._style;var o=r.texture;a.saveTransform(t.curMat),a.transformByMatrix(r.transform,e,i),a.drawTexture(o,-r.pivotX,-r.pivotY,r._width||o.width,r._height||o.height),a.restoreTransform(t.curMat)}},{key:"alpha_drawTexture",value:function(r,a,t,e){var i,o=r._style,n=r.texture;if((i=o.alpha)>.01||r._needRepaint()){var s=a.globalAlpha;a.globalAlpha*=i,a.drawTexture(n,t-o.pivotX+n.offsetX,e-o.pivotY+n.offsetY,r._width||n.width,r._height||n.height),a.globalAlpha=s}}},{key:"alpha_transform_drawTexture",value:function(r,a,e,i){var o,n=r._style,s=r.texture;if((o=n.alpha)>.01||r._needRepaint()){var l=a.globalAlpha;a.globalAlpha*=o,a.saveTransform(t.curMat),a.transformByMatrix(r.transform,e,i),a.drawTexture(s,-n.pivotX+s.offsetX,-n.pivotY+s.offsetY,r._width||s.width,r._height||s.height),a.restoreTransform(t.curMat),a.globalAlpha=l}}},{key:"alpha_transform_drawLayaGL",value:function(r,a,e,i){var o,n=r._style;if((o=n.alpha)>.01||r._needRepaint()){var s=a.globalAlpha;a.globalAlpha*=o,a.saveTransform(t.curMat),a.transformByMatrix(r.transform,e,i),r._graphics&&r._graphics._render(r,a,-n.pivotX,-n.pivotY),a.restoreTransform(t.curMat),a.globalAlpha=s}}},{key:"alpha_drawLayaGL",value:function(r,a,t,e){var i,o=r._style;if((i=o.alpha)>.01||r._needRepaint()){var n=a.globalAlpha;a.globalAlpha*=i,r._graphics&&r._graphics._render(r,a,t-o.pivotX,e-o.pivotY),a.globalAlpha=n}}},{key:"transform_drawLayaGL",value:function(r,a,e,i){var o=r._style;a.saveTransform(t.curMat),a.transformByMatrix(r.transform,e,i),r._graphics&&r._graphics._render(r,a,-o.pivotX,-o.pivotY),a.restoreTransform(t.curMat)}},{key:"transform_drawNodes",value:function(a,e,i,o){var n=a._getBit(r.Const.DRAWCALL_OPTIMIZE)&&e.drawCallOptimize(!0),s=a._style;e.saveTransform(t.curMat),e.transformByMatrix(a.transform,i,o),i=-s.pivotX,o=-s.pivotY;var l,p=a._children,_=p.length;if(s.viewport){var f,h,u=s.viewport,v=u.x,d=u.y,m=u.right,c=u.bottom;for(y=0;y<_;++y)(l=p[y])._visible&&(f=l._x)<m&&f+l.width>v&&(h=l._y)<c&&h+l.height>d&&l.render(e,i,o)}else for(var y=0;y<_;++y)(l=p[y])._visible&&l.render(e,i,o);e.restoreTransform(t.curMat),n&&e.drawCallOptimize(!1)}},{key:"drawLayaGL_drawNodes",value:function(a,t,e,i){var o=a._getBit(r.Const.DRAWCALL_OPTIMIZE)&&t.drawCallOptimize(!0),n=a._style;e-=n.pivotX,i-=n.pivotY,a._graphics&&a._graphics._render(a,t,e,i);var s,l=a._children,p=l.length;if(n.viewport){var _,f,h=n.viewport,u=h.x,v=h.y,d=h.right,m=h.bottom;for(c=0;c<p;++c)(s=l[c])._visible&&(_=s._x)<d&&_+s.width>u&&(f=s._y)<m&&f+s.height>v&&s.render(t,e,i)}else for(var c=0;c<p;++c)(s=l[c])._visible&&s.render(t,e,i);o&&t.drawCallOptimize(!1)}}]),t}();exports.LayaGLQuickRunner=n,n.map={},n.curMat=new t.Matrix;
},{"../Const":"mW4A","../display/SpriteConst":"3oZi","../maths/Matrix":"GG2z"}],"FG7q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderSprite=void 0;var e=require("../Const"),t=require("../display/SpriteConst"),a=require("../filters/Filter"),r=require("../maths/Matrix"),n=require("../maths/Rectangle"),i=require("./LayaGLQuickRunner"),s=require("../resource/Texture"),l=require("../utils/Stat"),c=require("../webgl/WebGLContext"),o=require("../webgl/canvas/BlendMode"),u=require("../resource/WebGLRTMgr"),_=require("../webgl/shader/d2/ShaderDefines2D"),h=require("../webgl/shader/d2/value/Value2D"),v=require("../webgl/submit/SubmitCMD"),d=require("../webgl/canvas/WebGLCacheAsNormalCanvas");function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,a){return t&&p(e.prototype,t),a&&p(e,a),e}var g=function(){function p(e,r){if(f(this,p),i.LayaGLQuickRunner.map[e])return this._fun=i.LayaGLQuickRunner.map[e],void(this._next=p.NORENDER);switch(this._next=r||p.NORENDER,e){case 0:return void(this._fun=this._no);case t.SpriteConst.ALPHA:return void(this._fun=this._alpha);case t.SpriteConst.TRANSFORM:return void(this._fun=this._transform);case t.SpriteConst.BLEND:return void(this._fun=this._blend);case t.SpriteConst.CANVAS:return void(this._fun=this._canvas);case t.SpriteConst.MASK:return void(this._fun=this._mask);case t.SpriteConst.CLIP:return void(this._fun=this._clip);case t.SpriteConst.STYLE:return void(this._fun=this._style);case t.SpriteConst.GRAPHICS:return void(this._fun=this._graphics);case t.SpriteConst.CHILDS:return void(this._fun=this._children);case t.SpriteConst.CUSTOM:return void(this._fun=this._custom);case t.SpriteConst.TEXTURE:return void(this._fun=this._texture);case t.SpriteConst.FILTERS:return void(this._fun=a.Filter._filter);case p.INIT:return void(this._fun=p._initRenderFun)}this.onCreate(e)}return y(p,[{key:"onCreate",value:function(e){}},{key:"_style",value:function(e,t,a,r){var n=e._style;null!=n.render&&n.render(e,t,a,r);var i=this._next;i._fun.call(i,e,t,a,r)}},{key:"_no",value:function(e,t,a,r){}},{key:"_custom",value:function(e,t,a,r){e.customRender(t,a,r),this._next._fun.call(this._next,e,t,a-e.pivotX,r-e.pivotY)}},{key:"_clip",value:function(e,t,a,r){var n=this._next;if(n!=p.NORENDER){var i=e._style.scrollRect;t.save(),t.clipRect(a,r,i.width,i.height),n._fun.call(n,e,t,a-i.x,r-i.y),t.restore()}}},{key:"_texture",value:function(e,t,a,r){var n=e.texture;n._getSource()&&t.drawTexture(n,a-e.pivotX+n.offsetX,r-e.pivotY+n.offsetY,e._width||n.width,e._height||n.height);var i=this._next;i!=p.NORENDER&&i._fun.call(i,e,t,a,r)}},{key:"_graphics",value:function(e,t,a,r){var n=e._style,i=e._graphics;i&&i._render(e,t,a-n.pivotX,r-n.pivotY);var s=this._next;s!=p.NORENDER&&s._fun.call(s,e,t,a,r)}},{key:"_image",value:function(e,t,a,r){var n=e._style;t.drawTexture2(a,r,n.pivotX,n.pivotY,e.transform,e._graphics._one)}},{key:"_image2",value:function(e,t,a,r){var n=e._style;t.drawTexture2(a,r,n.pivotX,n.pivotY,e.transform,e._graphics._one)}},{key:"_alpha",value:function(e,t,a,r){var n;if((n=e._style.alpha)>.01||e._needRepaint()){var i=t.globalAlpha;t.globalAlpha*=n;var s=this._next;s._fun.call(s,e,t,a,r),t.globalAlpha=i}}},{key:"_transform",value:function(e,t,a,r){var n=e.transform,i=this._next;e._style;n&&i!=p.NORENDER?(t.save(),t.transform(n.a,n.b,n.c,n.d,n.tx+a,n.ty+r),i._fun.call(i,e,t,0,0),t.restore()):i!=p.NORENDER&&i._fun.call(i,e,t,a,r)}},{key:"_children",value:function(t,a,r,n){var i,s=t._style,l=t._children,c=l.length;r-=t.pivotX,n-=t.pivotY;var o=t._getBit(e.Const.DRAWCALL_OPTIMIZE)&&a.drawCallOptimize(!0);if(s.viewport){var u,_,h=s.viewport,v=h.x,d=h.y,f=h.right,p=h.bottom;for(y=0;y<c;++y)(i=l[y])._visible&&(u=i._x)<f&&u+i.width>v&&(_=i._y)<p&&_+i.height>d&&i.render(a,r,n)}else for(var y=0;y<c;++y)(i=l[y])._visible&&i.render(a,r,n);o&&a.drawCallOptimize(!1)}},{key:"_canvas",value:function(e,t,a,r){var n=e._cacheStyle,i=this._next;if(n.enableCanvasRender){"bitmap"===n.cacheAs?l.Stat.canvasBitmap++:l.Stat.canvasNormal++;var s=!1,c=!1;if(n.canvas){var o=n.canvas,u=(o.context,o.touches);if(u)for(var _=0;_<u.length;_++)if(u[_].deleted){c=!0;break}s=o.isCacheValid&&!o.isCacheValid()}if(e._needRepaint()||!n.canvas||c||s||window.Laya.stage.isGlobalRepaint())if("normal"===n.cacheAs){if(t._targets)return void i._fun.call(i,e,t,a,r);this._canvas_webgl_normal_repaint(e,t)}else this._canvas_repaint(e,t,a,r);var h=n.cacheRect;t.drawCanvas(n.canvas,a+h.x,r+h.y,h.width,h.height)}else i._fun.call(i,e,t,a,r)}},{key:"_canvas_repaint",value:function(e,t,a,r){var n,i,s,c,o,u,_,h,v,d=e._cacheStyle,f=this._next,p=d.canvas,y=d.cacheAs;if(_=(v=d._calculateCacheRect(e,y,a,r)).x,h=v.y,o=(c=d.cacheRect).width*_,u=c.height*h,i=c.x,s=c.y,"bitmap"===y&&(o>2048||u>2048))return console.warn("cache bitmap size larger than 2048,cache ignored"),d.releaseContext(),void f._fun.call(f,e,t,a,r);if(p||(d.createContext(),p=d.canvas),(n=p.context).sprite=e,(p.width!=o||p.height!=u)&&p.size(o,u),"bitmap"===y?n.asBitmap=!0:"normal"===y&&(n.asBitmap=!1),n.clear(),1!=_||1!=h){var g=n;g.save(),g.scale(_,h),f._fun.call(f,e,n,-i,-s),g.restore(),e._applyFilters()}else g=n,f._fun.call(f,e,n,-i,-s),e._applyFilters();d.staticCache&&(d.reCache=!1),l.Stat.canvasReCache++}},{key:"_canvas_webgl_normal_repaint",value:function(e,t){var a=e._cacheStyle,r=this._next,n=a.canvas,i=a.cacheAs;a._calculateCacheRect(e,i,0,0);n||(n=a.canvas=new d.WebGLCacheAsNormalCanvas(t,e));var s=n.context;n.startRec(),r._fun.call(r,e,s,e.pivotX,e.pivotY),e._applyFilters(),l.Stat.canvasReCache++,n.endRec()}},{key:"_blend",value:function(e,t,a,r){var n=e._style,i=this._next;n.blendMode?(t.save(),t.globalCompositeOperation=n.blendMode,i._fun.call(i,e,t,a,r),t.restore()):i._fun.call(i,e,t,a,r)}},{key:"_mask",value:function(e,t,a,i){var l=this._next,c=e.mask,o=t;if(c){o.save();var d=o.globalCompositeOperation,f=new n.Rectangle;if(f.copyFrom(c.getBounds()),f.width=Math.round(f.width),f.height=Math.round(f.height),f.x=Math.round(f.x),f.y=Math.round(f.y),f.width>0&&f.height>0){var y=f.width,g=f.height,R=u.WebGLRTMgr.getRT(y,g);o.breakNextMerge(),o.pushRT(),o.addRenderObject(v.SubmitCMD.create([o,R,y,g],p.tmpTarget,this)),c.render(o,-f.x,-f.y),o.breakNextMerge(),o.popRT(),o.save(),o.clipRect(a+f.x-e.getStyle().pivotX,i+f.y-e.getStyle().pivotY,y,g),l._fun.call(l,e,o,a,i),o.restore(),d=o.globalCompositeOperation,o.addRenderObject(v.SubmitCMD.create(["mask"],p.setBlendMode,this));var C=h.Value2D.create(_.ShaderDefines2D.TEXTURE2D,0),b=s.Texture.INV_UV;o.drawTarget(R,a+f.x-e.getStyle().pivotX,i+f.y-e.getStyle().pivotY,y,g,r.Matrix.TEMP.identity(),C,b,6),o.addRenderObject(v.SubmitCMD.create([R],p.recycleTarget,this)),o.addRenderObject(v.SubmitCMD.create([d],p.setBlendMode,this))}o.restore()}else l._fun.call(l,e,t,a,i)}}],[{key:"__init__",value:function(){var e,a,r;for(i.LayaGLQuickRunner.__init__(),r=new p(p.INIT,null),a=p.renders.length=2*t.SpriteConst.CHILDS,e=0;e<a;e++)p.renders[e]=r;p.renders[0]=new p(0,null)}},{key:"_initRenderFun",value:function(e,t,a,r){var n=e._renderType;(p.renders[n]=p._getTypeRender(n))._fun(e,t,a,r)}},{key:"_getTypeRender",value:function(e){if(i.LayaGLQuickRunner.map[e])return new p(e,null);for(var a=null,r=t.SpriteConst.CHILDS;r>0;)r&e&&(a=new p(r,a)),r>>=1;return a}},{key:"tmpTarget",value:function(e,t,a,r){t.start(),t.clear(0,0,0,0)}},{key:"recycleTarget",value:function(e){u.WebGLRTMgr.releaseRT(e)}},{key:"setBlendMode",value:function(e){var t=c.WebGLContext.mainContext;o.BlendMode.targetFns[o.BlendMode.TOINT[e]](t)}}]),p}();exports.RenderSprite=g,g.INIT=69905,g.renders=[],g.NORENDER=new g(0,null),g.tempUV=new Array(8);
},{"../Const":"mW4A","../display/SpriteConst":"3oZi","../filters/Filter":"zHX+","../maths/Matrix":"GG2z","../maths/Rectangle":"iPyf","./LayaGLQuickRunner":"kzmL","../resource/Texture":"nP6w","../utils/Stat":"xuKH","../webgl/WebGLContext":"vf9T","../webgl/canvas/BlendMode":"brGx","../resource/WebGLRTMgr":"v/6A","../webgl/shader/d2/ShaderDefines2D":"el31","../webgl/shader/d2/value/Value2D":"cqLV","../webgl/submit/SubmitCMD":"ud/G","../webgl/canvas/WebGLCacheAsNormalCanvas":"NpEt"}],"LHsS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sprite=void 0;var t=require("././Node"),e=require("././SpriteConst"),i=require("././Graphics"),s=require("../Const"),n=require("./css/BoundsStyle"),r=require("./css/CacheStyle"),h=require("./css/SpriteStyle"),a=require("../events/Event"),o=require("../filters/ColorFilter"),l=require("../filters/Filter"),u=require("../maths/GrahamScan"),c=require("../maths/Matrix"),_=require("../maths/Point"),y=require("../maths/Rectangle"),f=require("../renders/RenderSprite"),p=require("../resource/Context"),g=require("../resource/HTMLCanvas"),d=require("../resource/Texture"),v=require("../utils/Utils");function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function T(t,e,i){return e&&C(t.prototype,e),i&&C(t,i),t}function m(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?R(t):e}function R(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function P(t,e,i){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=b(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function b(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=A(t)););return t}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function E(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var x=function(p){function g(){var t;return k(this,g),(t=m(this,A(g).call(this)))._x=0,t._y=0,t._width=0,t._height=0,t._visible=!0,t._mouseState=0,t._renderType=0,t._transform=null,t._tfChanged=!1,t._repaint=e.SpriteConst.REPAINT_NONE,t._texture=null,t._style=h.SpriteStyle.EMPTY,t._cacheStyle=r.CacheStyle.EMPTY,t._boundStyle=null,t._graphics=null,t.mouseThrough=!1,t.autoSize=!1,t.hitTestPrior=!1,t}return E(g,t.Node),T(g,[{key:"destroy",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];P(A(g.prototype),"destroy",this).call(this,t),this._style&&this._style.recover(),this._cacheStyle&&this._cacheStyle.recover(),this._boundStyle&&this._boundStyle.recover(),this._style=null,this._cacheStyle=null,this._boundStyle=null,this._transform=null,this._graphics&&this._graphics.autoDestroy&&this._graphics.destroy(),this._graphics=null,this.texture=null}},{key:"updateZOrder",value:function(){v.Utils.updateOrder(this._children)&&this.repaint()}},{key:"_getBoundsStyle",value:function(){return this._boundStyle||(this._boundStyle=n.BoundsStyle.create()),this._boundStyle}},{key:"_setCustomRender",value:function(){}},{key:"_setCacheAs",value:function(t){}},{key:"_checkCanvasEnable",value:function(){var t=this._cacheStyle.needEnableCanvasRender();this._getCacheStyle().enableCanvasRender=t,t?(this._cacheStyle.needBitmapCache()?this._cacheStyle.cacheAs="bitmap":this._cacheStyle.cacheAs=this._cacheStyle.userSetCache,this._cacheStyle.reCache=!0,this._renderType|=e.SpriteConst.CANVAS):(this._cacheStyle.cacheAs="none",this._cacheStyle.releaseContext(),this._renderType&=~e.SpriteConst.CANVAS),this._setCacheAs(this._cacheStyle.cacheAs),this._setRenderType(this._renderType)}},{key:"reCache",value:function(){this._cacheStyle.reCache=!0,this._repaint|=e.SpriteConst.REPAINT_CACHE}},{key:"getRepaint",value:function(){return this._repaint}},{key:"_setX",value:function(t){this._x=t}},{key:"_setY",value:function(t){this._y=t}},{key:"_setWidth",value:function(t,e){}},{key:"_setHeight",value:function(t,e){}},{key:"set_width",value:function(t){this._width!==t&&(this._width=t,this._setWidth(this.texture,t),this._setTranformChange())}},{key:"get_width",value:function(){return this.autoSize?this.texture?this.texture.width:this._graphics||0!==this._children.length?this.getSelfBounds().width:0:this._width||(this.texture?this.texture.width:0)}},{key:"set_height",value:function(t){this._height!==t&&(this._height=t,this._setHeight(this.texture,t),this._setTranformChange())}},{key:"get_height",value:function(){return this.autoSize?this.texture?this.texture.height:this._graphics||0!==this._children.length?this.getSelfBounds().height:0:this._height||(this.texture?this.texture.height:0)}},{key:"setSelfBounds",value:function(t){this._getBoundsStyle().userBounds=t}},{key:"getBounds",value:function(){return this._getBoundsStyle().bounds=y.Rectangle._getWrapRec(this._boundPointsToParent())}},{key:"getSelfBounds",value:function(){return this._boundStyle&&this._boundStyle.userBounds?this._boundStyle.userBounds:this._graphics||0!==this._children.length||this._texture?this._getBoundsStyle().bounds=y.Rectangle._getWrapRec(this._getBoundPointsM(!1)):y.Rectangle.TEMP.setTo(0,0,0,0)}},{key:"_boundPointsToParent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=0,i=0;this._style&&(e=this.pivotX,i=this.pivotY,t=t||0!==this._style.rotation,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var s=this._getBoundPointsM(t);if(!s||s.length<1)return s;if(8!=s.length&&(s=t?u.GrahamScan.scanPList(s):y.Rectangle._getWrapRec(s,y.Rectangle.TEMP)._getBoundPoints()),!this.transform)return v.Utils.transPointList(s,this._x-e,this._y-i),s;var n,r=_.Point.TEMP,h=s.length;for(n=0;n<h;n+=2)r.x=s[n],r.y=s[n+1],this.toParentPoint(r),s[n]=r.x,s[n+1]=r.y;return s}},{key:"getGraphicBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._graphics?this._graphics.getBounds(t):y.Rectangle.TEMP.setTo(0,0,0,0)}},{key:"_getBoundPointsM",value:function(){var t,e,i,s,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(this._boundStyle||this._getBoundsStyle(),this._boundStyle.temBM||(this._boundStyle.temBM=[]),this._style.scrollRect){var r=v.Utils.clearArray(this._boundStyle.temBM),h=y.Rectangle.TEMP;return h.copyFrom(this._style.scrollRect),v.Utils.concatArray(r,h._getBoundPoints()),r}this._graphics?t=this._graphics.getBoundPoints():(t=v.Utils.clearArray(this._boundStyle.temBM),this._texture&&((h=y.Rectangle.TEMP).setTo(0,0,this.width||this._texture.width,this.height||this._texture.height),v.Utils.concatArray(t,h._getBoundPoints())));for(var a=0,o=(s=this._children).length;a<o;a++)(e=s[a])instanceof g&&!0===e._visible&&(i=e._boundPointsToParent(n))&&(t=t?v.Utils.concatArray(t,i):i);return t}},{key:"_getCacheStyle",value:function(){return this._cacheStyle===r.CacheStyle.EMPTY&&(this._cacheStyle=r.CacheStyle.create()),this._cacheStyle}},{key:"getStyle",value:function(){return this._style===h.SpriteStyle.EMPTY&&(this._style=h.SpriteStyle.create()),this._style}},{key:"setStyle",value:function(t){this._style=t}},{key:"_setScaleX",value:function(t){this._style.scaleX=t}},{key:"_setScaleY",value:function(t){this._style.scaleY=t}},{key:"set_scaleX",value:function(t){this.getStyle().scaleX!==t&&(this._setScaleX(t),this._setTranformChange())}},{key:"get_scaleX",value:function(){return this._style.scaleX}},{key:"set_scaleY",value:function(t){this.getStyle().scaleY!==t&&(this._setScaleY(t),this._setTranformChange())}},{key:"get_scaleY",value:function(){return this._style.scaleY}},{key:"_setRotation",value:function(t){this._style.rotation=t}},{key:"_setSkewX",value:function(t){this._style.skewX=t}},{key:"_setSkewY",value:function(t){this._style.skewY=t}},{key:"_createTransform",value:function(){return c.Matrix.create()}},{key:"_adjustTransform",value:function(){this._tfChanged=!1;var t=this._style,i=t.scaleX,s=t.scaleY,n=t.skewX,r=t.skewY,h=t.rotation,a=this._transform||(this._transform=this._createTransform());if(h||1!==i||1!==s||0!==n||0!==r){a._bTransform=!0;var o=.0174532922222222*(h-n),l=.0174532922222222*(h+r),u=Math.cos(l),c=Math.sin(l),_=Math.sin(o),y=Math.cos(o);a.a=i*u,a.b=i*c,a.c=-s*_,a.d=s*y,a.tx=a.ty=0}else a.identity(),this._renderType&=~e.SpriteConst.TRANSFORM,this._setRenderType(this._renderType);return a}},{key:"_setTransform",value:function(t){}},{key:"get_transform",value:function(){return this._tfChanged?this._adjustTransform():this._transform}},{key:"set_transform",value:function(t){this._tfChanged=!1;var i=this._transform||(this._transform=this._createTransform());t.copyTo(i),this._setTransform(i),t&&(this._x=i.tx,this._y=i.ty,i.tx=i.ty=0),t?this._renderType|=e.SpriteConst.TRANSFORM:this._renderType&=~e.SpriteConst.TRANSFORM,this._setRenderType(this._renderType),this.parentRepaint()}},{key:"_setPivotX",value:function(t){this.getStyle().pivotX=t}},{key:"_getPivotX",value:function(){return this._style.pivotX}},{key:"_setPivotY",value:function(t){this.getStyle().pivotY=t}},{key:"_getPivotY",value:function(){return this._style.pivotY}},{key:"_setAlpha",value:function(t){this._style.alpha!==t&&(this.getStyle().alpha=t,1!==t?this._renderType|=e.SpriteConst.ALPHA:this._renderType&=~e.SpriteConst.ALPHA,this._setRenderType(this._renderType),this.parentRepaint())}},{key:"_getAlpha",value:function(){return this._style.alpha}},{key:"get_visible",value:function(){return this._visible}},{key:"set_visible",value:function(t){this._visible!==t&&(this._visible=t,this.parentRepaint(e.SpriteConst.REPAINT_ALL))}},{key:"_setBlendMode",value:function(t){}},{key:"_setGraphics",value:function(t){}},{key:"_setGraphicsCallBack",value:function(){}},{key:"_setScrollRect",value:function(t){}},{key:"pos",value:function(t,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._x!==t||this._y!==i){if(this.destroyed)return this;if(s){this._setX(t),this._setY(i),this.parentRepaint(e.SpriteConst.REPAINT_CACHE);var n=this._cacheStyle.maskParent;n&&n.repaint(e.SpriteConst.REPAINT_CACHE)}else this.x=t,this.y=i}return this}},{key:"pivot",value:function(t,e){return this.pivotX=t,this.pivotY=e,this}},{key:"size",value:function(t,e){return this.width=t,this.height=e,this}},{key:"scale",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.getStyle();if(s.scaleX!=t||s.scaleY!=e){if(this.destroyed)return this;i?(this._setScaleX(t),this._setScaleY(e),this._setTranformChange()):(this.scaleX=t,this.scaleY=e)}return this}},{key:"skew",value:function(t,e){return this.skewX=t,this.skewY=e,this}},{key:"render",value:function(t,e,i){f.RenderSprite.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0}},{key:"drawToCanvas",value:function(t,e,i,s){return g.drawToCanvas(this,this._renderType,t,e,i,s)}},{key:"drawToTexture",value:function(t,e,i,s){return g.drawToTexture(this,this._renderType,t,e,i,s)}},{key:"customRender",value:function(t,i,s){this._repaint=e.SpriteConst.REPAINT_ALL}},{key:"_applyFilters",value:function(){}},{key:"_setColorFilter",value:function(t){}},{key:"_isHaveGlowFilter",value:function(){var t,e;if(this.filters)for(t=0;t<this.filters.length;t++)if(this.filters[t].type==l.Filter.GLOW)return!0;for(t=0,e=this._children.length;t<e;t++)if(this._children[t]._isHaveGlowFilter())return!0;return!1}},{key:"localToGlobal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!0===e&&(t=new _.Point(t.x,t.y));var s=this;for(i=i||g.gStage;s&&!s.destroyed&&s!=i;)t=s.toParentPoint(t),s=s.parent;return t}},{key:"globalToLocal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e&&(t=new _.Point(t.x,t.y));var s=this,n=[];for(i=i||g.gStage;s&&!s.destroyed&&s!=i;)n.push(s),s=s.parent;for(var r=n.length-1;r>=0;)t=(s=n[r]).fromParentPoint(t),r--;return t}},{key:"toParentPoint",value:function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t}},{key:"fromParentPoint",value:function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t}},{key:"fromStagePoint",value:function(t){return t}},{key:"on",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return 1!==this._mouseState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(s.Const.HAS_MOUSE,!0),this._parent&&this._onDisplay(),this._createListener(t,e,i,n,!1)):P(A(g.prototype),"on",this).call(this,t,e,i,n)}},{key:"once",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return 1!==this._mouseState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(s.Const.HAS_MOUSE,!0),this._parent&&this._onDisplay(),this._createListener(t,e,i,n,!0)):P(A(g.prototype),"once",this).call(this,t,e,i,n)}},{key:"_onDisplay",value:function(){if(1!==this._mouseState){var t=this;for(t=t.parent;t&&1!==t._mouseState&&!t._getBit(s.Const.HAS_MOUSE);)t.mouseEnabled=!0,t._setBit(s.Const.HAS_MOUSE,!0),t=t.parent}}},{key:"_setParent",value:function(t){P(A(g.prototype),"_setParent",this).call(this,t),t&&this._getBit(s.Const.HAS_MOUSE)&&this._onDisplay()}},{key:"loadImage",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==t)this.texture=null,n();else{var s=window.Laya.Loader.getRes(t);s||((s=new d.Texture).load(t),window.Laya.Loader.cacheRes(t,s)),this.texture=s,s.getIsReady()?n():s.once(a.Event.READY,null,n)}function n(){this.repaint(e.SpriteConst.REPAINT_ALL),i&&i.run()}return this}},{key:"repaint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.SpriteConst.REPAINT_CACHE;this._repaint&t||(this._repaint|=t,this.parentRepaint(t)),this._cacheStyle&&this._cacheStyle.maskParent&&this._cacheStyle.maskParent.repaint(t)}},{key:"_needRepaint",value:function(){return this._repaint&e.SpriteConst.REPAINT_CACHE&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache}},{key:"_childChanged",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._children.length?this._renderType|=e.SpriteConst.CHILDS:this._renderType&=~e.SpriteConst.CHILDS,this._setRenderType(this._renderType),t&&this._getBit(s.Const.HAS_ZORDER)&&g.gSysTimer.callLater(this,this.updateZOrder),this.repaint(e.SpriteConst.REPAINT_ALL)}},{key:"parentRepaint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.SpriteConst.REPAINT_CACHE,i=this._parent;!i||i._repaint&t||(i._repaint|=t,i.parentRepaint(t))}},{key:"_setMask",value:function(t){}},{key:"startDrag",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.92;this._style.dragging||(this.getStyle().dragging=new Dragging),this._style.dragging.start(this,t,e,i,s,n,r,h)}},{key:"stopDrag",value:function(){this._style.dragging&&this._style.dragging.stop()}},{key:"_setDisplay",value:function(t){t||this._cacheStyle&&(this._cacheStyle.releaseContext(),this._cacheStyle.releaseFilterCache(),this._cacheStyle.hasGlowFilter&&(this._cacheStyle.hasGlowFilter=!1)),P(A(g.prototype),"_setDisplay",this).call(this,t)}},{key:"hitTestPoint",value:function(t,e){var i=this.globalToLocal(_.Point.TEMP.setTo(t,e));return t=i.x,e=i.y,(this._style.hitArea?this._style.hitArea:this._width>0&&this._height>0?y.Rectangle.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(t,e)}},{key:"getMousePoint",value:function(){return this.globalToLocal(_.Point.TEMP.setTo(g.gStage.mouseX,g.gStage.mouseY))}},{key:"_setTexture",value:function(t){}},{key:"_setRenderType",value:function(t){}},{key:"_setTranformChange",value:function(){this._tfChanged=!0,this._renderType|=e.SpriteConst.TRANSFORM,this.parentRepaint(e.SpriteConst.REPAINT_CACHE)}},{key:"_setBgStyleColor",value:function(t,e,i,s,n){}},{key:"_setBorderStyleColor",value:function(t,e,i,s,n,r){}},{key:"captureMouseEvent",value:function(t){g.gMouseMgr.setCapture(this,t)}},{key:"releaseMouseEvent",value:function(){g.gMouseMgr.releaseCapture()}},{key:"customRenderEnable",set:function(t){t&&(this._renderType|=e.SpriteConst.CUSTOM,this._setRenderType(this._renderType),this._setCustomRender())}},{key:"cacheAs",get:function(){return this._cacheStyle.cacheAs},set:function(t){t!==this._cacheStyle.userSetCache&&(this.mask&&"normal"===t||(this._setCacheAs(t),this._getCacheStyle().userSetCache=t,this._checkCanvasEnable(),this.repaint()))}},{key:"staticCache",get:function(){return this._cacheStyle.staticCache},set:function(t){this._getCacheStyle().staticCache=t,t||this.reCache()}},{key:"x",get:function(){return this._x},set:function(t){if(!this.destroyed&&this._x!==t){this._setX(t),this.parentRepaint(e.SpriteConst.REPAINT_CACHE);var i=this._cacheStyle.maskParent;i&&i.repaint(e.SpriteConst.REPAINT_CACHE)}}},{key:"y",get:function(){return this._y},set:function(t){if(!this.destroyed&&this._y!==t){this._setY(t),this.parentRepaint(e.SpriteConst.REPAINT_CACHE);var i=this._cacheStyle.maskParent;i&&i.repaint(e.SpriteConst.REPAINT_CACHE)}}},{key:"width",get:function(){return this.get_width()},set:function(t){this.set_width(t)}},{key:"height",get:function(){return this.get_height()},set:function(t){this.set_height(t)}},{key:"displayWidth",get:function(){return this.width*this.scaleX}},{key:"displayHeight",get:function(){return this.height*this.scaleY}},{key:"scaleX",get:function(){return this._style.scaleX},set:function(t){this.set_scaleX(t)}},{key:"scaleY",get:function(){return this._style.scaleY},set:function(t){this.set_scaleY(t)}},{key:"rotation",get:function(){return this._style.rotation},set:function(t){this.getStyle().rotation!==t&&(this._setRotation(t),this._setTranformChange())}},{key:"skewX",get:function(){return this._style.skewX},set:function(t){this.getStyle().skewX!==t&&(this._setSkewX(t),this._setTranformChange())}},{key:"skewY",get:function(){return this._style.skewY},set:function(t){this.getStyle().skewY!==t&&(this._setSkewY(t),this._setTranformChange())}},{key:"transform",get:function(){return this._tfChanged?this._adjustTransform():this._transform},set:function(t){this.set_transform(t)}},{key:"pivotX",get:function(){return this._getPivotX()},set:function(t){this._setPivotX(t),this.repaint()}},{key:"pivotY",get:function(){return this._getPivotY()},set:function(t){this._setPivotY(t),this.repaint()}},{key:"alpha",get:function(){return this._getAlpha()},set:function(t){t=t<0?0:t>1?1:t,this._setAlpha(t)}},{key:"visible",get:function(){return this.get_visible()},set:function(t){this.set_visible(t)}},{key:"blendMode",get:function(){return this._style.blendMode},set:function(t){this._setBlendMode(t),this.getStyle().blendMode=t,t&&"source-over"!=t?this._renderType|=e.SpriteConst.BLEND:this._renderType&=~e.SpriteConst.BLEND,this._setRenderType(this._renderType),this.parentRepaint()}},{key:"graphics",get:function(){return this._graphics||(this.graphics=new i.Graphics,this._graphics.autoDestroy=!0),this._graphics},set:function(t){this._graphics&&(this._graphics._sp=null),this._graphics=t,t?(this._setGraphics(t),this._renderType|=e.SpriteConst.GRAPHICS,t._sp=this):this._renderType&=~e.SpriteConst.GRAPHICS,this._setRenderType(this._renderType),this.repaint()}},{key:"scrollRect",get:function(){return this._style.scrollRect},set:function(t){this.getStyle().scrollRect=t,this._setScrollRect(t),this.repaint(),t?this._renderType|=e.SpriteConst.CLIP:this._renderType&=~e.SpriteConst.CLIP,this._setRenderType(this._renderType)}},{key:"filters",get:function(){return this._cacheStyle.filters},set:function(t){t&&0===t.length&&(t=null),this._cacheStyle.filters!=t&&(this._getCacheStyle().filters=t?t.slice():null,t&&t.length?(this._setColorFilter(t[0]),this._renderType|=e.SpriteConst.FILTERS):(this._setColorFilter(null),this._renderType&=~e.SpriteConst.FILTERS),this._setRenderType(this._renderType),t&&t.length>0?(this._getBit(s.Const.DISPLAY)||this._setBitUp(s.Const.DISPLAY),1==t.length&&t[0]instanceof o.ColorFilter||(this._getCacheStyle().cacheForFilters=!0,this._checkCanvasEnable())):this._cacheStyle.cacheForFilters&&(this._cacheStyle.cacheForFilters=!1,this._checkCanvasEnable()),this._getCacheStyle().hasGlowFilter=this._isHaveGlowFilter(),this.repaint())}},{key:"stage",get:function(){return g.gStage}},{key:"hitArea",get:function(){return this._style.hitArea},set:function(t){this.getStyle().hitArea=t}},{key:"mask",get:function(){return this._cacheStyle.mask},set:function(t){t&&this.mask&&this.mask._cacheStyle.maskParent||(this._getCacheStyle().mask=t,this._setMask(t),this._checkCanvasEnable(),t?t._getCacheStyle().maskParent=this:this.mask&&(this.mask._getCacheStyle().maskParent=null),this._renderType|=e.SpriteConst.MASK,this._setRenderType(this._renderType),this.parentRepaint(e.SpriteConst.REPAINT_ALL))}},{key:"mouseEnabled",get:function(){return this._mouseState>1},set:function(t){this._mouseState=t?2:1}},{key:"globalScaleX",get:function(){for(var t=1,e=this;e&&e!==g.gStage;)t*=e.scaleX,e=e.parent;return t}},{key:"globalRotation",get:function(){for(var t=0,e=this;e&&e!==g.gStage;)t+=e.rotation,e=e.parent;return t}},{key:"globalScaleY",get:function(){for(var t=1,e=this;e&&e!==g.gStage;)t*=e.scaleY,e=e.parent;return t}},{key:"mouseX",get:function(){return this.getMousePoint().x}},{key:"mouseY",get:function(){return this.getMousePoint().y}},{key:"zOrder",get:function(){return this._zOrder},set:function(t){this._zOrder!=t&&(this._zOrder=t,this._parent&&(t&&this._parent._setBit(s.Const.HAS_ZORDER,!0),g.gSysTimer.callLater(this._parent,this.updateZOrder)))}},{key:"texture",get:function(){return this._texture},set:function(t){t instanceof String?this.loadImage(t):this._texture!=t&&(this._texture&&this._texture._removeReference(),this._texture=t,t&&t._addReference(),this._setTexture(t),this._setWidth(this._texture,this.width),this._setHeight(this._texture,this.height),t?this._renderType|=e.SpriteConst.TEXTURE:this._renderType&=~e.SpriteConst.TEXTURE,this._setRenderType(this._renderType),this.repaint())}},{key:"viewport",get:function(){return this._style.viewport},set:function(t){var e;t instanceof String&&((e=t.split(",")).length>3&&(t=new y.Rectangle(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))));this.getStyle().viewport=t}},{key:"drawCallOptimize",set:function(t){this._setBit(s.Const.DRAWCALL_OPTIMIZE,t)},get:function(){return this._getBit(s.Const.DRAWCALL_OPTIMIZE)}}],[{key:"fromImage",value:function(t){return(new g).loadImage(t)}}]),g}();exports.Sprite=x,x.gStage=null,x.gSysTimer=null,x.gMouseMgr=null,x.drawToCanvas=function(t,e,i,s,n,r){n-=t.x,r-=t.y,n|=0,r|=0,i|=0,s|=0;var h=new p.Context;h.size(i,s),h.asBitmap=!0,h._targets.start(),f.RenderSprite.renders[e]._fun(t,h,n,r),h.flush(),h._targets.end(),h._targets.restore();var a=h._targets.getData(0,0,i,s);h.destroy();for(var o=new ImageData(i,s),l=4*i,u=(new Uint8Array(l),o.data),c=s-1,_=c*l,y=0;c>=0;c--)u.set(a.subarray(y,y+l),_),_-=l,y+=l;var d=new g.HTMLCanvas(!0);return d.size(i,s),d.getContext("2d").putImageData(o,0,0),d},x.drawToTexture=function(t,e,i,s,n,r){n-=t.x,r-=t.y,n|=0,r|=0,i|=0,s|=0;var h=new p.Context;h.size(i,s),h.asBitmap=!0,h._targets.start(),f.RenderSprite.renders[e]._fun(t,h,n,r),h.flush(),h._targets.end(),h._targets.restore();var a=new d.Texture(h._targets,d.Texture.INV_UV);return h.destroy(!0),a};
},{"././Node":"9izd","././SpriteConst":"3oZi","././Graphics":"9Gi9","../Const":"mW4A","./css/BoundsStyle":"U9cX","./css/CacheStyle":"11pa","./css/SpriteStyle":"C3xf","../events/Event":"jK6U","../filters/ColorFilter":"uQu9","../filters/Filter":"zHX+","../maths/GrahamScan":"5c0r","../maths/Matrix":"GG2z","../maths/Point":"ziZY","../maths/Rectangle":"iPyf","../renders/RenderSprite":"FG7q","../resource/Context":"2BX4","../resource/HTMLCanvas":"TY9w","../resource/Texture":"nP6w","../utils/Utils":"kHKw"}],"Awc/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextStyle=void 0;var t=require("././SpriteStyle"),e=require("../../utils/Pool");function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function l(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var o=s(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function s(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var y=function(r){function n(){var t;return o(this,n),(t=l(this,f(n).apply(this,arguments))).italic=!1,t}return a(n,t.SpriteStyle),i(n,[{key:"reset",value:function(){return c(f(n.prototype),"reset",this).call(this),this.italic=!1,this.align="left",this.wordWrap=!1,this.leading=0,this.padding=[0,0,0,0],this.bgColor=null,this.borderColor=null,this.asPassword=!1,this.stroke=0,this.strokeColor="#000000",this.bold=!1,this.underline=!1,this.underlineColor=null,this.currBitmapFont=null,this}},{key:"recover",value:function(){this!==n.EMPTY&&e.Pool.recover("TextStyle",this.reset())}},{key:"render",value:function(t,e,r,o){(this.bgColor||this.borderColor)&&e.drawRect(r,o,t.width,t.height,this.bgColor,this.borderColor,1)}}],[{key:"create",value:function(){return e.Pool.getItemByClass("TextStyle",n)}}]),n}();exports.TextStyle=y,y.EMPTY=new y;
},{"././SpriteStyle":"C3xf","../../utils/Pool":"Jkpb"}],"fW8x":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Text=void 0;var t=require("././Sprite"),e=require("././SpriteConst"),i=require("./css/TextStyle"),s=require("../events/Event"),h=require("../maths/Point"),n=require("../maths/Rectangle"),r=require("../utils/WordText");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}function u(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?g(t):e}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=c(t,e);if(s){var h=Object.getOwnPropertyDescriptor(s,e);return h.get?h.get.call(i):h.value}})(t,e,i||t)}function c(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var x=function(o){function a(){var t;return l(this,a),(t=u(this,f(a).call(this)))._textWidth=0,t._textHeight=0,t._lines=[],t._lineWidths=[],t._startX=0,t._startY=0,t._charSize={},t._valign="top",t._fontSize=a.defaultFontSize,t._font=a.defaultFont,t._color="#000000",t._singleCharRender=!1,t.overflow=a.VISIBLE,t._style=i.TextStyle.EMPTY,t}return p(a,t.Sprite),_(a,[{key:"getStyle",value:function(){return this._style===i.TextStyle.EMPTY&&(this._style=i.TextStyle.create()),this._style}},{key:"_getTextStyle",value:function(){return this._style===i.TextStyle.EMPTY&&(this._style=i.TextStyle.create()),this._style}},{key:"destroy",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];d(f(a.prototype),"destroy",this).call(this,t),this._clipPoint=null,this._lines=null,this._lineWidths=null,this._words&&this._words.forEach(function(t){t.cleanCache()}),this._words=null,this._charSize=null}},{key:"_getBoundPointsM",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=n.Rectangle.TEMP;return t.setTo(0,0,this.width,this.height),t._getBoundPoints()}},{key:"getGraphicBounds",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=n.Rectangle.TEMP;return t.setTo(0,0,this.width,this.height),t}},{key:"_getCSSStyle",value:function(){return this._style}},{key:"get_text",value:function(){return this._text||""}},{key:"set_text",value:function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event(s.Event.CHANGE),this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}},{key:"lang",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]&&arguments[8],arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(t=a.langPacks&&a.langPacks[t]?a.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var e=0,i=arguments.length;e<i;e++)t=t.replace("{"+e+"}",arguments[e+1]);this._text=t}}},{key:"get_color",value:function(){return this._color}},{key:"set_color",value:function(t){this._color!=t&&(this._color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}},{key:"set_bgColor",value:function(t){this._getTextStyle().bgColor=t,this._renderType|=e.SpriteConst.STYLE,this._setBgStyleColor(0,0,this.width,this.height,t),this._setRenderType(this._renderType),this.isChanged=!0}},{key:"get_bgColor",value:function(){return this._style.bgColor}},{key:"_getContextFont",value:function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(a.gBrowser.onIPhone&&a.fontFamilyMap[this.font]||this.font)}},{key:"_isPassWordMode",value:function(){var t=this._style.asPassword;return"prompt"in this&&this.prompt==this._text&&(t=!1),t}},{key:"_getPassWordTxt",value:function(t){var e;e="";for(var i=t.length;i>0;i--)e+="●";return e}},{key:"_renderText",value:function(){var t=this.padding,e=this._lines.length;this.overflow!=a.VISIBLE&&(e=Math.min(e,Math.floor((this.height-t[0]-t[2])/(this.leading+this._charSize.height))+1));var i=this.scrollY/(this._charSize.height+this.leading)|0,s=this.graphics;s.clear(!0);var h=this._getContextFont();a.gBrowser.context.font=h;var n=t[3],o="left",l=this._lines,_=this.leading+this._charSize.height,u=this._style.currBitmapFont;u&&(_=this.leading+u.getMaxHeight());var g=t[0];if(!u&&this._width>0&&this._textWidth<=this._width&&("right"==this.align?(o="right",n=this._width-t[1]):"center"==this.align&&(o="center",n=.5*this._width+t[3]-t[1])),this._height>0){var d=this._textHeight>this._height?"top":this.valign;"middle"===d?g=.5*(this._height-e*_)+t[0]-t[2]:"bottom"===d&&(g=this._height-e*_-t[2])}var c=this._style;if(u&&u.autoScaleSize)var f=u.fontSize/this.fontSize;if(this._clipPoint){var p,y;if(s.save(),u&&u.autoScaleSize)p=this._width?this._width-t[3]-t[1]:this._textWidth,y=this._height?this._height-t[0]-t[2]:this._textHeight,p*=f,y*=f,s.clipRect(t[3],t[0],p,y);else s.clipRect(t[3],t[0],this._width?this._width-t[3]-t[1]:this._textWidth,this._height?this._height-t[0]-t[2]:this._textHeight);this.repaint()}var x=c.asPassword;"prompt"in this&&this.prompt==this._text&&(x=!1);for(var v=0,w=0,S=Math.min(this._lines.length,e+i)||1,C=i;C<S;C++){var T,k=l[C];if(x){var b=k.length;k="";for(var W=b;W>0;W--)k+="●"}if(null==k&&(k=""),v=n-(this._clipPoint?this._clipPoint.x:0),w=g+_*C-(this._clipPoint?this._clipPoint.y:0),this.underline&&this._drawUnderline(o,v,w,C),u){var m=this.width;u.autoScaleSize&&(m=this.width*f),u._drawText(k,this,v,w,this.align,m)}else this._words||(this._words=[]),this._words.length>C-i?T=this._words[C-i]:(T=new r.WordText,this._words.push(T)),T.setText(k),T.splitRender=this._singleCharRender,c.stroke?s.fillBorderText(T,v,w,h,this.color,c.strokeColor,c.stroke,o):s.fillText(T,v,w,h,this.color,o)}if(u&&u.autoScaleSize){var P=1/f;this.scale(P,P)}this._clipPoint&&s.restore(),this._startX=n,this._startY=g}},{key:"_drawUnderline",value:function(t,e,i,s){var h=this._lineWidths[s];switch(t){case"center":e-=h/2;break;case"right":e-=h}i+=this._charSize.height,this._graphics.drawLine(e,i,e+h,i,this.underlineColor||this.color,1)}},{key:"typeset",value:function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);a.gBrowser.onLayaRuntime?window.conchTextCanvas.font=this._getContextFont():a.gBrowser.context.font=this._getContextFont(),this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this._parseLines(this._getPassWordTxt(this._text)):this._parseLines(this._text),this._evalTextSize(),this._checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new h.Point(0,0)):this._clipPoint=null,this._renderText()}},{key:"_evalTextSize",value:function(){var t,e;t=Math.max.apply(this,this._lineWidths),e=this._style.currBitmapFont?this._lines.length*(this._style.currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e)}},{key:"_checkEnabledViewportOrNot",value:function(){return this.overflow==a.SCROLL&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)}},{key:"changeText",value:function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())}},{key:"_parseLines",value:function(t){var e=this.wordWrap||this.overflow==a.HIDDEN;if(e)var i=this._getWordWrapWidth();var s=this._style.currBitmapFont;if(s)this._charSize.width=s.getMaxWidth(),this._charSize.height=s.getMaxHeight();else{var h=null;(h=a.gBrowser.onLayaRuntime?window.conchTextCanvas.measureText(a._testWord):a.gBrowser.context.measureText(a._testWord))||(h={width:100}),this._charSize.width=h.width,this._charSize.height=h.height||this.fontSize}for(var n=t.replace(/\r\n/g,"\n").split("\n"),r=0,o=n.length;r<o;r++){var l=n[r];e?this._parseLine(l,i):(this._lineWidths.push(this._getTextWidth(l)),this._lines.push(l))}}},{key:"_parseLine",value:function(t,e){var i,s,h,n=this._lines,r=0;if((i=this._getTextWidth(t))<=e)return n.push(t),void this._lineWidths.push(i);i=this._charSize.width,0==(r=Math.floor(e/i))&&(r=1),s=i=this._getTextWidth(t.substring(0,r));for(var o=r,l=t.length;o<l;o++)if((s+=i=this._getTextWidth(t.charAt(o)))>e)if(this.wordWrap){var _=t.substring(h,o);if(_.charCodeAt(_.length-1)<255){var u=/(?:\w|-)+$/.exec(_);u&&(o=u.index+h,0==u.index?o+=_.length:_=t.substring(h,o))}if(n.push(_),this._lineWidths.push(s-i),h=o,!(o+r<l)){n.push(t.substring(h,l)),this._lineWidths.push(this._getTextWidth(n[n.length-1])),h=-1;break}o+=r,s=i=this._getTextWidth(t.substring(h,o)),o--}else if(this.overflow==a.HIDDEN)return n.push(t.substring(0,o)),void this._lineWidths.push(this._getTextWidth(n[n.length-1]));this.wordWrap&&-1!=h&&(n.push(t.substring(h,l)),this._lineWidths.push(this._getTextWidth(n[n.length-1])))}},{key:"_getTextWidth",value:function(t){var e=this._style.currBitmapFont;return e?e.getTextWidth(t):a.gBrowser.onLayaRuntime?window.conchTextCanvas.measureText(t).width:a.gBrowser.context.measureText(t).width}},{key:"_getWordWrapWidth",value:function(){var t,e=this.padding,i=this._style.currBitmapFont;return(t=i&&i.autoScaleSize?this._width*(i.fontSize/this.fontSize):this._width)<=0&&(t=this.wordWrap?100:a.gBrowser.width),t<=0&&(t=100),t-e[3]-e[1]}},{key:"getCharPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._isChanged&&a.gSysTimer.runCallLater(this,this.typeset);for(var i=0,s=this._lines,n=0,r=0,o=s.length;r<o;r++){if(t<(i+=s[r].length)){var l=r;break}n=i}var _=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;a.gBrowser.context.font=_;var u=this._getTextWidth(this._text.substring(n,t));return(e||new h.Point).setTo(this._startX+u-(this._clipPoint?this._clipPoint.x:0),this._startY+l*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))}},{key:"width",get:function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},set:function(t){t!=this._width&&(d(f(a.prototype),"set_width",this).call(this,t),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}},{key:"height",get:function(){return this._height?this._height:this.textHeight},set:function(t){t!=this._height&&(d(f(a.prototype),"set_height",this).call(this,t),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}},{key:"textWidth",get:function(){return this._isChanged&&a.gSysTimer.runCallLater(this,this.typeset),this._textWidth}},{key:"textHeight",get:function(){return this._isChanged&&a.gSysTimer.runCallLater(this,this.typeset),this._textHeight}},{key:"text",get:function(){return this._text||""},set:function(t){this.set_text(t)}},{key:"font",get:function(){return this._font},set:function(t){this._style.currBitmapFont&&(this._getTextStyle().currBitmapFont=null,this.scale(1,1)),a._bitmapFonts&&a._bitmapFonts[t]&&(this._getTextStyle().currBitmapFont=a._bitmapFonts[t]),this._font=t,this.isChanged=!0}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!=t&&(this._fontSize=t,this.isChanged=!0)}},{key:"bold",get:function(){return this._style.bold},set:function(t){this._getTextStyle().bold=t,this.isChanged=!0}},{key:"color",get:function(){return this._color},set:function(t){this.set_color(t)}},{key:"italic",get:function(){return this._style.italic},set:function(t){this._getTextStyle().italic=t,this.isChanged=!0}},{key:"align",get:function(){return this._style.align},set:function(t){this._getTextStyle().align=t,this.isChanged=!0}},{key:"valign",get:function(){return this._valign},set:function(t){this._valign=t,this.isChanged=!0}},{key:"wordWrap",get:function(){return this._style.wordWrap},set:function(t){this._getTextStyle().wordWrap=t,this.isChanged=!0}},{key:"leading",get:function(){return this._style.leading},set:function(t){this._getTextStyle().leading=t,this.isChanged=!0}},{key:"padding",get:function(){return this._style.padding},set:function(t){if(t instanceof String){var e,i,s;for(s=(e=t.split(",")).length;e.length<4;)e.push(0);for(i=0;i<s;i++)e[i]=parseFloat(e[i])||0;t=e}this._getTextStyle().padding=t,this.isChanged=!0}},{key:"bgColor",get:function(){return this._style.bgColor},set:function(t){this.set_bgColor(t)}},{key:"borderColor",get:function(){return this._style.borderColor},set:function(t){this._getTextStyle().borderColor=t,this._renderType|=e.SpriteConst.STYLE,this._setBorderStyleColor(0,0,this.width,this.height,t,1),this._setRenderType(this._renderType),this.isChanged=!0}},{key:"stroke",get:function(){return this._style.stroke},set:function(t){this._getTextStyle().stroke=t,this.isChanged=!0}},{key:"strokeColor",get:function(){return this._style.strokeColor},set:function(t){this._getTextStyle().strokeColor=t,this.isChanged=!0}},{key:"isChanged",set:function(t){this._isChanged!==t&&(this._isChanged=t,t&&a.gSysTimer.callLater(this,this.typeset))}},{key:"scrollX",set:function(t){if(!(this.overflow!=a.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=t>e?e:t,this._clipPoint.x=t,this._renderText()}},get:function(){return this._clipPoint?this._clipPoint.x:0}},{key:"scrollY",set:function(t){if(!(this.overflow!=a.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height;t=t>e?e:t,this._clipPoint.y=t,this._renderText()}},get:function(){return this._clipPoint?this._clipPoint.y:0}},{key:"maxScrollX",get:function(){return this.textWidth<this._width?0:this._textWidth-this._width}},{key:"maxScrollY",get:function(){return this.textHeight<this._height?0:this._textHeight-this._height}},{key:"lines",get:function(){return this._isChanged&&this.typeset(),this._lines}},{key:"underlineColor",get:function(){return this._style.underlineColor},set:function(t){this._getTextStyle().underlineColor=t,this._isChanged||this._renderText()}},{key:"underline",get:function(){return this._style.underline},set:function(t){this._getTextStyle().underline=t}},{key:"singleCharRender",set:function(t){this._singleCharRender=t},get:function(){return this._singleCharRender}}],[{key:"defaultFontStr",value:function(){return a.defaultFontSize+"px "+a.defaultFont}},{key:"registerBitmapFont",value:function(t,e){a._bitmapFonts||(a._bitmapFonts={}),a._bitmapFonts[t]=e}},{key:"unregisterBitmapFont",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(a._bitmapFonts&&a._bitmapFonts[t]){var i=a._bitmapFonts[t];e&&i.destroy(),delete a._bitmapFonts[t]}}}]),a}();exports.Text=x,x.gSysTimer=null,x.gBrowser=null,x.VISIBLE="visible",x.SCROLL="scroll",x.HIDDEN="hidden",x.defaultFontSize=12,x.defaultFont="Arial",x.isComplexText=!1,x.fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"},x._testWord="游",x.CharacterCache=!0,x.RightToLeft=!1;
},{"././Sprite":"LHsS","././SpriteConst":"3oZi","./css/TextStyle":"Awc/","../events/Event":"jK6U","../maths/Point":"ziZY","../maths/Rectangle":"iPyf","../utils/WordText":"RVK6"}],"pOAB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Browser=void 0;var n=require("./PlatformInfo");function e(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function i(n,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function o(n,e,o){return e&&i(n.prototype,e),o&&i(n,o),n}var t=function(){function i(){e(this,i)}return o(i,null,[{key:"__init__",value:function(){if(i._window)return i._window;var e=i._window=n.PlatformInfo.window=window,o=i._document=e.document,t=i.userAgent=e.navigator.userAgent;t.indexOf("MiniGame")>-1&&i.window.hasOwnProperty("wx")&&(i.gLaya.MiniAdpter?i.gLaya.MiniAdpter.enable():console.error("请先添加小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),t.indexOf("SwanGame")>-1&&(i.gLaya.BMiniAdapter?i.gLaya.BMiniAdapter.enable():console.error("请先添加百度小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),window.getApp instanceof Function&&(i.gLaya.KGMiniAdapter?i.gLaya.KGMiniAdapter.enable():console.error("请先添加小米小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),t.indexOf("OPPO")>-1&&t.indexOf("MiniGame")>-1&&(i.gLaya.QGMiniAdapter?i.gLaya.QGMiniAdapter.enable():console.error("请先添加OPPO小游戏适配库")),e.trace=console.log,e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(n){return e.setTimeout(n,1e3/60)};var a=o.body.style;a.margin=0,a.overflow="hidden",a["-webkit-user-select"]="none",a["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var r=o.getElementsByTagName("meta"),l=0,c=!1,d="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";l<r.length;){var f=r[l];if("viewport"==f.name){f.content=d,c=!0;break}l++}return c||((f=o.createElement("meta")).name="viewport",f.content=d,o.getElementsByTagName("head")[0].appendChild(f)),i.onMobile=n.PlatformInfo.onMobile=!!window.isConchApp||t.indexOf("Mobile")>-1,i.onIOS=n.PlatformInfo.onIOS=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),i.onIPhone=n.PlatformInfo.onIPhone=t.indexOf("iPhone")>-1,i.onMac=n.PlatformInfo.onMac=t.indexOf("Mac OS X")>-1,i.onIPad=n.PlatformInfo.onIPad=t.indexOf("iPad")>-1,i.onAndroid=n.PlatformInfo.onAndroid=t.indexOf("Android")>-1||t.indexOf("Adr")>-1,i.onWP=n.PlatformInfo.onWP=t.indexOf("Windows Phone")>-1,i.onQQBrowser=n.PlatformInfo.onQQBrowser=t.indexOf("QQBrowser")>-1,i.onMQQBrowser=n.PlatformInfo.onMQQBrowser=t.indexOf("MQQBrowser")>-1||t.indexOf("Mobile")>-1&&t.indexOf("QQ")>-1,i.onIE=n.PlatformInfo.onIE=!!e.ActiveXObject||"ActiveXObject"in e,i.onWeiXin=n.PlatformInfo.onWeiXin=t.indexOf("MicroMessenger")>-1,i.onSafari=n.PlatformInfo.onSafari=t.indexOf("Safari")>-1,i.onPC=n.PlatformInfo.onPC=!i.onMobile,i.onMiniGame=n.PlatformInfo.onMiniGame=t.indexOf("MiniGame")>-1,i.onBDMiniGame=n.PlatformInfo.onBDMiniGame=t.indexOf("SwanGame")>-1,i.onLayaRuntime=n.PlatformInfo.onLayaRuntime=!!i.window.conch,t.indexOf("OPPO")>-1&&t.indexOf("MiniGame")>-1&&(i.onQGMiniGame=!0,i.onMiniGame=!1),i.onLimixiu=n.PlatformInfo.onLimixiu=t.indexOf("limixiu")>-1,i.onKGMiniGame=n.PlatformInfo.onKGMiniGame=t.indexOf("QuickGame")>-1,n.PlatformInfo.onLayaRuntime=window.conch,e}},{key:"createElement",value:function(n){return i.__init__(),i._document.createElement(n)}},{key:"getElementById",value:function(n){return i.__init__(),i._document.getElementById(n)}},{key:"removeElement",value:function(n){n&&n.parentNode&&n.parentNode.removeChild(n)}},{key:"now",value:function(){return Date.now()}},{key:"clientWidth",get:function(){return i.__init__(),i._window.innerWidth||i._document.body.clientWidth}},{key:"clientHeight",get:function(){return i.__init__(),i._window.innerHeight||i._document.body.clientHeight||i._document.documentElement.clientHeight}},{key:"width",get:function(){return i.__init__(),(i.gStage&&i.gStage.canvasRotation?i.clientHeight:i.clientWidth)*i.pixelRatio}},{key:"height",get:function(){return i.__init__(),(i.gStage&&i.gStage.canvasRotation?i.clientWidth:i.clientHeight)*i.pixelRatio}},{key:"pixelRatio",get:function(){if(i._pixelRatio<0)if(i.__init__(),i.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1)i._pixelRatio=2;else{var n=i.context,e=n.backingStorePixelRatio||n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i._pixelRatio=(i._window.devicePixelRatio||1)/e,i._pixelRatio<1&&(i._pixelRatio=1)}return i._pixelRatio}},{key:"container",get:function(){return i._container||(i.__init__(),i._container=i.createElement("div"),i._container.id="layaContainer",i._document.body.appendChild(i._container)),i._container},set:function(n){i._container=n}},{key:"window",get:function(){return i._window||i.__init__()}},{key:"document",get:function(){return i.__init__(),i._document}}]),i}();exports.Browser=t,t.gLaya=null,t.gStage=null,t._pixelRatio=-1,t.mainCanvas=null,t.hanzi=new RegExp("^[一-龥]$"),t.fontMap=[],t.measureText=function(n,e){var i=t.hanzi.test(n);if(i&&t.fontMap[e])return t.fontMap[e];var o=t.context;o.font=e;var a=o.measureText(n);return i&&(t.fontMap[e]=a),a};
},{"./PlatformInfo":"HmZQ"}],"ReI4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Input=void 0;var t=require("././Text"),e=require("../events/Event"),n=require("../utils/Utils"),o=require("../utils/PlatformInfo"),i=require("../utils/Browser");function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?p(t):e}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=h(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function h(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var y=function(r){function l(){var n;return s(this,l),(n=u(this,f(l).call(this)))._multiline=!1,n._editable=!0,n._maxChars=1e5,n._type="text",n._prompt="",n._promptColor="#A9A9A9",n._originColor="#000000",n._content="",n._width=100,n._height=20,n.multiline=!1,n.overflow=t.Text.SCROLL,n.on(e.Event.MOUSE_DOWN,p(n),n._onMouseDown),n.on(e.Event.UNDISPLAY,p(n),n._onUnDisplay),n}return _(l,t.Text),a(l,[{key:"setSelection",value:function(t,e){this.focus=!0,l.inputElement.selectionStart=t,l.inputElement.selectionEnd=e}},{key:"_onUnDisplay",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.focus=!1}},{key:"_onMouseDown",value:function(t){this.focus=!0}},{key:"_syncInputTransform",value:function(){var t=this.nativeInput,e=n.Utils.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),i=this._width-this.padding[1]-this.padding[3],r=this._height-this.padding[0]-this.padding[2];o.PlatformInfo.onLayaRuntime?(t.setScale(e.scaleX,e.scaleY),t.setSize(i,r),t.setPos(e.x,e.y)):(l.inputContainer.style.transform=l.inputContainer.style.webkitTransform="scale("+e.scaleX+","+e.scaleY+") rotate("+l.gStage.canvasDegree+"deg)",t.style.width=i+"px",t.style.height=r+"px",l.inputContainer.style.left=e.x+"px",l.inputContainer.style.top=e.y+"px")}},{key:"select",value:function(){this.nativeInput.select()}},{key:"_setInputMethod",value:function(){l.input.parentElement&&l.inputContainer.removeChild(l.input),l.area.parentElement&&l.inputContainer.removeChild(l.area),l.inputElement=this._multiline?l.area:l.input,l.inputContainer.appendChild(l.inputElement),t.Text.RightToLeft&&(l.inputElement.style.direction="rtl")}},{key:"_focusIn",value:function(){l.isInputting=!0;var n=this.nativeInput;this._focus=!0;var i=n.style;i.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),n.readOnly=!this._editable,o.PlatformInfo.onLayaRuntime&&(n.setType(this._type),n.setForbidEdit(!this._editable)),n.maxLength=this._maxChars;this.padding;if(n.type=this._type,n.value=this._content,n.placeholder=this._prompt,l.gStage.off(e.Event.KEY_DOWN,this,this._onKeyDown),l.gStage.on(e.Event.KEY_DOWN,this,this._onKeyDown),l.gStage.focus=this,this.event(e.Event.FOCUS),o.PlatformInfo.onPC&&n.focus(),!(o.PlatformInfo.onMiniGame||o.PlatformInfo.onBDMiniGame||o.PlatformInfo.onQGMiniGame||o.PlatformInfo.onKGMiniGame)){this._text;this._text=null}this.typeset(),n.setColor(this._originColor),n.setFontSize(this.fontSize),n.setFontFace(o.PlatformInfo.onIPhone&&t.Text.fontFamilyMap[this.font]||this.font),o.PlatformInfo.onLayaRuntime&&n.setMultiAble&&n.setMultiAble(this._multiline),i.lineHeight=this.leading+this.fontSize+"px",i.fontStyle=this.italic?"italic":"normal",i.fontWeight=this.bold?"bold":"normal",i.textAlign=this.align,i.padding="0 0",this._syncInputTransform(),!o.PlatformInfo.onLayaRuntime&&o.PlatformInfo.onPC&&l.gSysTimer.frameLoop(1,this,this._syncInputTransform)}},{key:"_setPromptColor",value:function(){l.promptStyleDOM=document.getElementById("promptStyle"),l.promptStyleDOM||(l.promptStyleDOM=document.createElement("style"),l.promptStyleDOM.setAttribute("id","promptStyle"),document.head.appendChild(l.promptStyleDOM)),l.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"}},{key:"_focusOut",value:function(){l.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(c(f(l.prototype),"set_text",this).call(this,this._content),c(f(l.prototype),"set_color",this).call(this,this._originColor)):(c(f(l.prototype),"set_text",this).call(this,this._prompt),c(f(l.prototype),"set_color",this).call(this,this._promptColor)),l.gStage.off(e.Event.KEY_DOWN,this,this._onKeyDown),l.gStage.focus=null,this.event(e.Event.BLUR),this.event(e.Event.CHANGE),o.PlatformInfo.onLayaRuntime&&this.nativeInput.blur(),o.PlatformInfo.onPC&&l.gSysTimer.clear(this,this._syncInputTransform)}},{key:"_onKeyDown",value:function(t){13===t.keyCode&&(o.PlatformInfo.onMobile&&!this._multiline&&(this.focus=!1),this.event(e.Event.ENTER))}},{key:"changeText",value:function(t){this._content=t,this._focus?(this.nativeInput.value=t||"",this.event(e.Event.CHANGE)):c(f(l.prototype),"changeText",this).call(this,t)}},{key:"multiline",get:function(){return this._multiline},set:function(t){this._multiline=t,this.valign=t?"top":"middle"}},{key:"nativeInput",get:function(){return this._multiline?l.area:l.input}},{key:"focus",get:function(){return this._focus},set:function(t){var e=this.nativeInput;this._focus!==t&&(t?(e.target?e.target._focusOut():this._setInputMethod(),e.target=this,this._focusIn()):(e.target=null,this._focusOut(),document.body.scrollTop=0,e.blur(),o.PlatformInfo.onLayaRuntime?e.setPos(-1e4,-1e4):l.inputContainer.contains(e)&&l.inputContainer.removeChild(e)))}},{key:"text",set:function(t){c(f(l.prototype),"set_color",this).call(this,this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event(e.Event.CHANGE)):(this._multiline||(t=t.replace(/\r?\n/g,"")),this._content=t,t?c(f(l.prototype),"set_text",this).call(this,t):(c(f(l.prototype),"set_text",this).call(this,this._prompt),c(f(l.prototype),"set_color",this).call(this,this.promptColor)))},get:function(){return this._focus?this.nativeInput.value:this._content||""}},{key:"color",set:function(t){this._focus&&this.nativeInput.setColor(t),c(f(l.prototype),"set_color",this).call(this,this._content?t:this._promptColor),this._originColor=t}},{key:"bgColor",set:function(t){c(f(l.prototype),"set_bgColor",this).call(this,t),o.PlatformInfo.onLayaRuntime&&this.nativeInput.setBgColor(t)}},{key:"restrict",get:function(){return this._restrictPattern?this._restrictPattern.source:""},set:function(t){t?((t="[^"+t+"]").indexOf("^^")>-1&&(t=t.replace("^^","")),this._restrictPattern=new RegExp(t,"g")):this._restrictPattern=null}},{key:"editable",set:function(t){this._editable=t,o.PlatformInfo.onLayaRuntime&&l.input.setForbidEdit(!t)},get:function(){return this._editable}},{key:"maxChars",get:function(){return this._maxChars},set:function(t){t<=0&&(t=1e5),this._maxChars=t}},{key:"prompt",get:function(){return this._prompt},set:function(e){!this._text&&e&&c(f(l.prototype),"set_color",this).call(this,this._promptColor),this.promptColor=this._promptColor,this._text?c(f(l.prototype),"set_text",this).call(this,this._text==this._prompt?e:this._text):c(f(l.prototype),"set_text",this).call(this,e),this._prompt=t.Text.langPacks&&t.Text.langPacks[e]?t.Text.langPacks[e]:e}},{key:"promptColor",get:function(){return this._promptColor},set:function(t){this._promptColor=t,this._content||c(f(l.prototype),"set_color",this).call(this,t)}},{key:"type",get:function(){return this._type},set:function(t){this._getTextStyle().asPassword="password"===t,this._type=t}}],[{key:"__init__",value:function(){if(l._createInputElement(),o.PlatformInfo.onMobile){var t=!1;(o.PlatformInfo.onMiniGame||o.PlatformInfo.onBDMiniGame||o.PlatformInfo.onQGMiniGame||o.PlatformInfo.onKGMiniGame)&&(t=!0),this.gMainCanvas.addEventListener(l.IOS_IFRAME?t?"touchend":"click":"touchend",l._popupInputMethod)}}},{key:"_popupInputMethod",value:function(t){l.isInputting&&l.inputElement.focus()}},{key:"_createInputElement",value:function(){l._initInput(l.area=document.createElement("textarea")),l._initInput(l.input=document.createElement("input")),l.inputContainer=document.createElement("div"),l.inputContainer.style.position="absolute",l.inputContainer.style.zIndex=1e5,i.Browser.container.appendChild(l.inputContainer),l.inputContainer.setPos=function(t,e){l.inputContainer.style.left=t+"px",l.inputContainer.style.top=e+"px"}}},{key:"_initInput",value:function(t){var e=t.style;e.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",e.resize="none",e.backgroundColor="transparent",e.border="none",e.outline="none",e.zIndex=1,t.addEventListener("input",l._processInputting),t.addEventListener("mousemove",l._stopEvent),t.addEventListener("mousedown",l._stopEvent),t.addEventListener("touchmove",l._stopEvent)}},{key:"_processInputting",value:function(t){var n=l.inputElement.target;if(n){var o=l.inputElement.value;n._restrictPattern&&(o=o.replace(/\u2006|\x27/g,""),n._restrictPattern.test(o)&&(o=o.replace(n._restrictPattern,""),l.inputElement.value=o)),n._text=o,n.event(e.Event.INPUT)}}},{key:"_stopEvent",value:function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()}}]),l}();exports.Input=y,y.gMainCanvas=null,y.TYPE_TEXT="text",y.TYPE_PASSWORD="password",y.TYPE_EMAIL="email",y.TYPE_URL="url",y.TYPE_NUMBER="number",y.TYPE_RANGE="range",y.TYPE_DATE="date",y.TYPE_MONTH="month",y.TYPE_WEEK="week",y.TYPE_TIME="time",y.TYPE_DATE_TIME="datetime",y.TYPE_DATE_TIME_LOCAL="datetime-local",y.TYPE_SEARCH="search",y.gStage=null,y.gSysTime=null,y.IOS_IFRAME=o.PlatformInfo.onIOS&&o.PlatformInfo.window.top!=o.PlatformInfo.window.self,y.inputHeight=45,y.isInputting=!1;
},{"././Text":"fW8x","../events/Event":"jK6U","../utils/Utils":"kHKw","../utils/PlatformInfo":"HmZQ","../utils/Browser":"pOAB"}],"6mn6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TouchManager=void 0;var e=require("././Event"),t=require("../utils/Browser"),r=require("../utils/Pool");function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}var l=function(){function s(){n(this,s),this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._event=new e.Event,this._lastClickTime=0}return i(s,[{key:"_clearTempArrs",value:function(){s._oldArr.length=0,s._newArr.length=0,s._tEleArr.length=0}},{key:"getTouchFromArr",value:function(e,t){var r,n,s;for(n=t.length,r=0;r<n;r++)if((s=t[r]).id==e)return s;return null}},{key:"removeTouchFromArr",value:function(e,t){var r;for(r=t.length-1;r>=0;r--)t[r].id==e&&t.splice(r,1)}},{key:"createTouchO",value:function(e,t){var n;return(n=r.Pool.getItem("TouchData")||{}).id=t,n.tar=e,n}},{key:"onMouseDown",value:function(r,n){var i,l,h,o,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.enable&&(i=this.getTouchFromArr(n,this.preOvers),h=this.getEles(r,null,s._tEleArr),i?i.tar=r:(l=this.createTouchO(r,n),this.preOvers.push(l)),t.Browser.onMobile&&this.sendEvents(h,e.Event.MOUSE_OVER),o=u?this.preDowns:this.preRightDowns,(i=this.getTouchFromArr(n,o))?i.tar=r:(l=this.createTouchO(r,n),o.push(l)),this.sendEvents(h,u?e.Event.MOUSE_DOWN:e.Event.RIGHT_MOUSE_DOWN),this._clearTempArrs())}},{key:"sendEvents",value:function(e,t){var r,n,s;for(n=e.length,this._event._stoped=!1,s=e[0],r=0;r<n;r++){var i=e[r];if(i.destroyed)return;if(i.event(t,this._event.setTo(t,i,s)),this._event._stoped)break}}},{key:"getEles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(r?r.length=0:r=[];e&&e!=t;)r.push(e),e=e.parent;return r}},{key:"checkMouseOutAndOverOfMove",value:function(t,r){var n,i,l,h;arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r!=t)if(r.contains(t))i=this.getEles(t,r,s._tEleArr),this.sendEvents(i,e.Event.MOUSE_OVER);else if(t.contains(r))i=this.getEles(r,t,s._tEleArr),this.sendEvents(i,e.Event.MOUSE_OUT);else{var o,u,v;for((i=s._tEleArr).length=0,o=this.getEles(r,null,s._oldArr),u=this.getEles(t,null,s._newArr),h=o.length,l=0;l<h;l++){if(n=o[l],(v=u.indexOf(n))>=0){u.splice(v,u.length-v);break}i.push(n)}i.length>0&&this.sendEvents(i,e.Event.MOUSE_OUT),u.length>0&&this.sendEvents(u,e.Event.MOUSE_OVER)}}},{key:"onMouseMove",value:function(t,r){var n,i;this.enable&&((n=this.getTouchFromArr(r,this.preOvers))?(this.checkMouseOutAndOverOfMove(t,n.tar),n.tar=t,i=this.getEles(t,null,s._tEleArr)):(i=this.getEles(t,null,s._tEleArr),this.sendEvents(i,e.Event.MOUSE_OVER),this.preOvers.push(this.createTouchO(t,r))),this.sendEvents(i,e.Event.MOUSE_MOVE),this._clearTempArrs())}},{key:"getLastOvers",value:function(){return s._tEleArr.length=0,this.preOvers.length>0&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,s._tEleArr):(s._tEleArr.push(window.Laya.stage),s._tEleArr)}},{key:"stageMouseOut",value:function(){var t;t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(t,e.Event.MOUSE_OUT)}},{key:"onMouseUp",value:function(n,i){var l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.enable){var h,o,u,v,a,E,c,g,O=t.Browser.onMobile;if(o=this.getEles(n,null,s._tEleArr),this.sendEvents(o,l?e.Event.MOUSE_UP:e.Event.RIGHT_MOUSE_UP),g=l?this.preDowns:this.preRightDowns,h=this.getTouchFromArr(i,g)){var _,f=t.Browser.now();if(_=f-this._lastClickTime<300,this._lastClickTime=f,n==h.tar)c=o;else for(u=this.getEles(h.tar,null,s._oldArr),(c=s._newArr).length=0,a=u.length,v=0;v<a;v++)E=u[v],o.indexOf(E)>=0&&c.push(E);c.length>0&&this.sendEvents(c,l?e.Event.CLICK:e.Event.RIGHT_CLICK),l&&_&&this.sendEvents(c,e.Event.DOUBLE_CLICK),this.removeTouchFromArr(i,g),h.tar=null,r.Pool.recover("TouchData",h)}else;(h=this.getTouchFromArr(i,this.preOvers))&&O&&((c=this.getEles(h.tar,null,c))&&c.length>0&&this.sendEvents(c,e.Event.MOUSE_OUT),this.removeTouchFromArr(i,this.preOvers),h.tar=null,r.Pool.recover("TouchData",h)),this._clearTempArrs()}}}]),s}();exports.TouchManager=l,l.I=new l,l._oldArr=[],l._newArr=[],l._tEleArr=[];
},{"././Event":"jK6U","../utils/Browser":"pOAB","../utils/Pool":"Jkpb"}],"0uUh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MouseManager=void 0;var e=require("././Event"),t=require("././TouchManager"),s=require("../display/Input"),i=require("../display/Sprite"),n=require("../maths/Point"),o=require("../maths/Rectangle"),u=require("../utils/Browser");function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,s){return t&&r(e.prototype,t),s&&r(e,s),e}var c=function(){function i(){h(this,i),this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._event=new e.Event,this._captureSp=null,this._captureChain=[],this._captureExlusiveMode=!1,this._hitCaputreSp=!1,this._point=new n.Point,this._rect=new o.Rectangle,this._lastMoveTimer=0,this._prePoint=new n.Point,this._touchIDs={},this._curTouchID=NaN,this._id=1}return a(i,[{key:"__init__",value:function(e,t){this._stage=e;var n=this;t.oncontextmenu=function(e){if(i.enabled)return!1},t.addEventListener("mousedown",function(e){i.enabled&&(u.Browser.onIE||e.preventDefault(),n.mouseDownTime=u.Browser.now(),n.runEvent(e))}),t.addEventListener("mouseup",function(e){i.enabled&&(e.preventDefault(),n.mouseDownTime=-u.Browser.now(),n.runEvent(e))},!0),t.addEventListener("mousemove",function(e){if(i.enabled){e.preventDefault();var t=u.Browser.now();if(t-n._lastMoveTimer<10)return;n._lastMoveTimer=t,n.runEvent(e)}},!0),t.addEventListener("mouseout",function(e){i.enabled&&n.runEvent(e)}),t.addEventListener("mouseover",function(e){i.enabled&&n.runEvent(e)}),t.addEventListener("touchstart",function(e){i.enabled&&(i._isFirstTouch||s.Input.isInputting||e.preventDefault(),n.mouseDownTime=u.Browser.now(),n.runEvent(e))}),t.addEventListener("touchend",function(e){i.enabled?(i._isFirstTouch||s.Input.isInputting||e.preventDefault(),i._isFirstTouch=!1,n.mouseDownTime=-u.Browser.now(),n.runEvent(e)):n._curTouchID=NaN},!0),t.addEventListener("touchmove",function(e){i.enabled&&(e.preventDefault(),n.runEvent(e))},!0),t.addEventListener("touchcancel",function(e){i.enabled?(e.preventDefault(),n.runEvent(e)):n._curTouchID=NaN},!0),t.addEventListener("mousewheel",function(e){i.enabled&&n.runEvent(e)}),t.addEventListener("DOMMouseScroll",function(e){i.enabled&&n.runEvent(e)})}},{key:"initEvent",value:function(e){var s,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._event._stoped=!1,this._event.nativeEvent=i||e,this._target=null,this._point.setTo(e.pageX||e.clientX,e.pageY||e.clientY),this._stage._canvasTransform&&(this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y),this._event.touchId=e.identifier||0,this._tTouchID=this._event.touchId,(s=t.TouchManager.I._event)._stoped=!1,s.nativeEvent=this._event.nativeEvent,s.touchId=this._event.touchId}},{key:"checkMouseWheel",value:function(s){this._event.delta=s.wheelDelta?.025*s.wheelDelta:-s.detail;for(var i=t.TouchManager.I.getLastOvers(),n=0,o=i.length;n<o;n++){var u=i[n];u.event(e.Event.MOUSE_WHEEL,this._event.setTo(e.Event.MOUSE_WHEEL,u,this._target))}}},{key:"onMouseMove",value:function(e){t.TouchManager.I.onMouseMove(e,this._tTouchID)}},{key:"onMouseDown",value:function(e){var i=this._stage;if(s.Input.isInputting&&i.focus&&i.focus.focus&&!i.focus.contains(this._target)){var n=i.focus._tf||i.focus,o=e._tf||e;o instanceof s.Input&&o.multiline==n.multiline?n._focusOut():n.focus=!1}t.TouchManager.I.onMouseDown(e,this._tTouchID,this._isLeftMouse)}},{key:"onMouseUp",value:function(e){t.TouchManager.I.onMouseUp(e,this._tTouchID,this._isLeftMouse)}},{key:"check",value:function(e,t,s,i){this._point.setTo(t,s),e.fromParentPoint(this._point),t=this._point.x,s=this._point.y;var n=e._style.scrollRect;if(n&&(this._rect.setTo(n.x,n.y,n.width,n.height),!this._rect.contains(t,s)))return!1;if(!this.disableMouseEvent){if(e.hitTestPrior&&!e.mouseThrough&&!this.hitTest(e,t,s))return!1;for(var o=e._children.length-1;o>-1;o--){var u=e._children[o];if(!u.destroyed&&u._mouseState>1&&u._visible&&this.check(u,t,s,i))return!0}for(o=e._extUIChild.length-1;o>=0;o--){var h=e._extUIChild[o];if(!h.destroyed&&h._mouseState>1&&h._visible&&this.check(h,t,s,i))return!0}}var r=!(!e.hitTestPrior||e.mouseThrough||this.disableMouseEvent)||this.hitTest(e,t,s);return r?(this._target=e,i.call(this,e),this._target==this._hitCaputreSp&&(this._hitCaputreSp=!0)):i===this.onMouseUp&&e===this._stage&&(this._target=this._stage,i.call(this,this._target)),r}},{key:"hitTest",value:function(e,t,s){var i=!1;e.scrollRect&&(t-=e._style.scrollRect.x,s-=e._style.scrollRect.y);var n=e._style.hitArea;return n&&n._hit?n.contains(t,s):((e.width>0&&e.height>0||e.mouseThrough||n)&&(i=e.mouseThrough?e.getGraphicBounds().contains(t,s):(n||this._rect.setTo(0,0,e.width,e.height)).contains(t,s)),i)}},{key:"_checkAllBaseUI",value:function(e,t,s){var i=this.handleExclusiveCapture(this.mouseX,this.mouseY,s);return!!i||(i=this.check(this._stage,this.mouseX,this.mouseY,s),this.handleCapture(this.mouseX,this.mouseY,s)||i)}},{key:"check3DUI",value:function(e,t,s){for(var i=this._stage._3dUI,n=0,o=!1;n<i.length;n++){var u=i[n];this._stage._curUIBase=u,!u.destroyed&&u._mouseState>1&&u._visible&&(o=o||this.check(u,this.mouseX,this.mouseY,s))}return this._stage._curUIBase=this._stage,o}},{key:"handleExclusiveCapture",value:function(e,t,s){if(this._captureExlusiveMode&&this._captureSp&&this._captureChain.length>0){var i;this._point.setTo(e,t);for(var n=0;n<this._captureChain.length;n++)(i=this._captureChain[n]).fromParentPoint(this._point);return this._target=i,s.call(this,i),!0}return!1}},{key:"handleCapture",value:function(e,t,s){if(!this._hitCaputreSp&&this._captureSp&&this._captureChain.length>0){var i;this._point.setTo(e,t);for(var n=0;n<this._captureChain.length;n++)(i=this._captureChain[n]).fromParentPoint(this._point);return this._target=i,s.call(this,i),!0}return!1}},{key:"runEvent",value:function(s){var n,o,u;switch("mousemove"!==s.type&&(this._prePoint.x=this._prePoint.y=-1e6),s.type){case"mousedown":this._touchIDs[0]=this._id++,i._isTouchRespond?i._isTouchRespond=!1:(this._isLeftMouse=0===s.button,this.initEvent(s),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"mouseup":this._isLeftMouse=0===s.button,this.initEvent(s),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-s.clientX)+Math.abs(this._prePoint.y-s.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=s.clientX,this._prePoint.y=s.clientY,this.initEvent(s),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"touchstart":i._isTouchRespond=!0,this._isLeftMouse=!0;var h=s.changedTouches;for(n=0,o=h.length;n<o;n++)u=h[n],(i.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=u.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[u.identifier]=this._id++,this.initEvent(u,s),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"touchend":case"touchcancel":i._isTouchRespond=!0,this._isLeftMouse=!0;var r=s.changedTouches;for(n=0,o=r.length;n<o;n++){if(u=r[n],i.multiTouchEnabled||u.identifier==this._curTouchID)this._curTouchID=NaN,this.initEvent(u,s),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp)||this.onMouseUp(null)}break;case"touchmove":var a=s.changedTouches;for(n=0,o=a.length;n<o;n++)u=a[n],(i.multiTouchEnabled||u.identifier==this._curTouchID)&&(this.initEvent(u,s),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(s);break;case"mouseout":t.TouchManager.I.stageMouseOut();break;case"mouseover":this._stage.event(e.Event.MOUSE_OVER,this._event.setTo(e.Event.MOUSE_OVER,this._stage,this._stage))}}},{key:"setCapture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this._stage;this._captureSp=e,this._captureExlusiveMode=t,this._captureChain.length=0,this._captureChain.push(e);for(var i=e;i!=s&&i!=s._curUIBase&&(i=i.parent);)this._captureChain.splice(0,0,i)}},{key:"releaseCapture",value:function(){console.log("release capture"),this._captureSp=null}}]),i}();exports.MouseManager=c,c.instance=new c,c.enabled=!0,c.multiTouchEnabled=!0,c._isFirstTouch=!0,i.Sprite.gMouseMgr=c.instance;
},{"././Event":"jK6U","././TouchManager":"6mn6","../display/Input":"ReI4","../display/Sprite":"LHsS","../maths/Point":"ziZY","../maths/Rectangle":"iPyf","../utils/Browser":"pOAB"}],"IL6B":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.UtilsBase=void 0;var r=function(){function n(){e(this,n)}return t(n,null,[{key:"toRadian",value:function(e){return e*n._pi2}},{key:"toAngle",value:function(e){return e*n._pi}},{key:"toHexColor",value:function(e){if(e<0||isNaN(e))return null;for(var n=e.toString(16);n.length<6;)n="0"+n;return"#"+n}},{key:"getGID",value:function(){return n._gid++}},{key:"concatArray",value:function(e,n){if(!n)return e;if(!e)return n;var t,r=n.length;for(t=0;t<r;t++)e.push(n[t]);return e}},{key:"clearArray",value:function(e){return e?(e.length=0,e):e}},{key:"copyArray",value:function(e,n){if(e||(e=[]),!n)return e;e.length=n.length;var t,r=n.length;for(t=0;t<r;t++)e[t]=n[t];return e}},{key:"bind",value:function(e,n){return e.bind(n)}},{key:"transPointList",value:function(e,n,t){var r,i=e.length;for(r=0;r<i;r+=2)e[r]+=n,e[r+1]+=t}},{key:"parseInt",value:function(e){function n(n){return e.apply(this,arguments)}return n.toString=function(){return e.toString()},n}(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=parseInt(e,n);return isNaN(t)?0:t})},{key:"getFileExtension",value:function(e){n._extReg.lastIndex=e.lastIndexOf(".");var t=n._extReg.exec(e);return t&&t.length>1?t[1].toLowerCase():null}},{key:"getQueryString",value:function(e){if(!window.location||!window.location.search)return null;var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(n);return null!=t?unescape(t[2]):null}}]),n}();exports.UtilsBase=r,r._gid=1,r._pi=180/Math.PI,r._pi2=Math.PI/180,r._extReg=/\.(\w+)\??/g,r.parseXMLFromString=function(e){var n;if(e=e.replace(/>\s+</g,"><"),(n=(new DOMParser).parseFromString(e,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors")>-1)throw new Error(n.firstChild.firstChild.textContent);return n};
},{}],"FULD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Timer=void 0;var e=require("././UtilsBase"),t=require("././CallLater");function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function a(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}var i=function(){function l(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r(this,l),this.scale=1,this.currTimer=Date.now(),this.currFrame=0,this._delta=0,this._lastTimer=Date.now(),this._map=[],this._handlers=[],this._temp=[],this._count=0,e&&l.gSysTimer&&l.gSysTimer.frameLoop(1,this,this._update)}return a(l,[{key:"_update",value:function(){if(this.scale<=0)this._lastTimer=Date.now();else{var e=this.currFrame=this.currFrame+this.scale,t=Date.now();this._delta=(t-this._lastTimer)*this.scale;var r=this.currTimer=this.currTimer+this._delta;this._lastTimer=t;var l=this._handlers;this._count=0;for(var a=0,i=l.length;a<i;a++){var n=l[a];if(null!==n.method){var s=n.userFrame?e:r;if(s>=n.exeTime)if(n.repeat)if(n.jumpFrame)for(;s>=n.exeTime;)n.exeTime+=n.delay,n.run(!1);else n.exeTime+=n.delay,n.run(!1),s>n.exeTime&&(n.exeTime+=Math.ceil((s-n.exeTime)/n.delay)*n.delay);else n.run(!0)}else this._count++}(this._count>30||e%200==0)&&this._clearHandlers()}}},{key:"_clearHandlers",value:function(){for(var e=this._handlers,t=0,r=e.length;t<r;t++){var l=e[t];null!==l.method?this._temp.push(l):this._recoverHandler(l)}this._handlers=this._temp,e.length=0,this._temp=e}},{key:"_recoverHandler",value:function(e){this._map[e.key]==e&&(this._map[e.key]=null),e.clear(),l._pool.push(e)}},{key:"_create",value:function(e,t,r,a,i,s,u){if(!r)return i.apply(a,s),null;if(u){var h=this._getHandler(a,i);if(h)return h.repeat=t,h.userFrame=e,h.delay=r,h.caller=a,h.method=i,h.args=s,h.exeTime=r+(e?this.currFrame:this.currTimer+Date.now()-this._lastTimer),h}return(h=l._pool.length>0?l._pool.pop():new n).repeat=t,h.userFrame=e,h.delay=r,h.caller=a,h.method=i,h.args=s,h.exeTime=r+(e?this.currFrame:this.currTimer+Date.now()-this._lastTimer),this._indexHandler(h),this._handlers.push(h),h}},{key:"_indexHandler",value:function(t){var r=t.caller,a=t.method,i=r?r.$_GID||(r.$_GID=e.UtilsBase.getGID()):0,n=a.$_TID||(a.$_TID=1e5*l._mid++);t.key=i+n,this._map[t.key]=t}},{key:"once",value:function(e,t,r){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._create(!1,!1,e,t,r,l,a)}},{key:"loop",value:function(e,t,r){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=this._create(!1,!0,e,t,r,l,a);n&&(n.jumpFrame=i)}},{key:"frameOnce",value:function(e,t,r){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._create(!0,!1,e,t,r,l,a)}},{key:"frameLoop",value:function(e,t,r){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._create(!0,!0,e,t,r,l,a)}},{key:"toString",value:function(){return" handlers:"+this._handlers.length+" pool:"+l._pool.length}},{key:"clear",value:function(e,t){var r=this._getHandler(e,t);r&&(this._map[r.key]=null,r.key=0,r.clear())}},{key:"clearAll",value:function(e){if(e)for(var t=0,r=this._handlers.length;t<r;t++){var l=this._handlers[t];l.caller===e&&(this._map[l.key]=null,l.key=0,l.clear())}}},{key:"_getHandler",value:function(t,r){var a=t?t.$_GID||(t.$_GID=e.UtilsBase.getGID()):0,i=r.$_TID||(r.$_TID=1e5*l._mid++);return this._map[a+i]}},{key:"callLater",value:function(e,r){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.CallLater.I.callLater(e,r,l)}},{key:"runCallLater",value:function(e,r){t.CallLater.I.runCallLater(e,r)}},{key:"runTimer",value:function(e,t){var r=this._getHandler(e,t);r&&null!=r.method&&(this._map[r.key]=null,r.run(!0))}},{key:"pause",value:function(){this.scale=0}},{key:"resume",value:function(){this.scale=1}},{key:"delta",get:function(){return this._delta}}]),l}();exports.Timer=i,i.gSysTimer=null,i._pool=[],i._mid=1;var n=function(){function e(){r(this,e)}return a(e,[{key:"clear",value:function(){this.caller=null,this.method=null,this.args=null}},{key:"run",value:function(e){var t=this.caller;if(t&&t.destroyed)return this.clear();var r=this.method,l=this.args;e&&this.clear(),null!=r&&(l?r.apply(t,l):r.call(t))}}]),e}();
},{"././UtilsBase":"IL6B","././CallLater":"71DA"}],"71DA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CallLater=void 0;var e=require("././UtilsBase"),t=require("././Timer");function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var l=0;l<t.length;l++){var r=t[l];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,l){return t&&r(e.prototype,t),l&&r(e,l),e}var a=function(){function r(){l(this,r),this._pool=[],this._map=[],this._laters=[]}return n(r,[{key:"_update",value:function(){var e=this._laters,t=e.length;if(t>0){for(var l=0,r=t-1;l<=r;l++){var n=e[l];this._map[n.key]=null,null!==n.method&&(n.run(),n.clear()),this._pool.push(n),l===r&&(r=e.length-1)}e.length=0}}},{key:"_getHandler",value:function(l,r){var n=l?l.$_GID||(l.$_GID=e.UtilsBase.getGID()):0,a=r.$_TID||(r.$_TID=1e5*t.Timer._mid++);return this._map[n+a]}},{key:"callLater",value:function(e,t){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==this._getHandler(e,t)){if(this._pool.length)var r=this._pool.pop();else r=new i;r.caller=e,r.method=t,r.args=l;var n=e?e.$_GID:0,a=t.$_TID;r.key=n+a,this._map[r.key]=r,this._laters.push(r)}}},{key:"runCallLater",value:function(e,t){var l=this._getHandler(e,t);l&&null!=l.method&&(this._map[l.key]=null,l.run(),l.clear())}}]),r}();exports.CallLater=a,a.I=new a;var i=function(){function e(){l(this,e)}return n(e,[{key:"clear",value:function(){this.caller=null,this.method=null,this.args=null}},{key:"run",value:function(){var e=this.caller;if(e&&e.destroyed)return this.clear();var t=this.method,l=this.args;null!=t&&(l?t.apply(e,l):t.call(e))}}]),e}();
},{"././UtilsBase":"IL6B","././Timer":"FULD"}],"fnCT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RunDriver=void 0;var e=require("../webgl/WebGL");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=function e(){n(this,e)};exports.RunDriver=r,r.createShaderCondition=function(e){var n="(function() {return "+e+";})";return window.Laya._runScript(n)},r.changeWebGLSize=function(n,r){e.WebGL.onStageResize(n,r)};
},{"../webgl/WebGL":"RsJd"}],"N+WO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Stage=void 0;var e=require("././Sprite"),t=require("./../../Config"),i=require("././Input"),n=require("././SpriteConst"),r=require("../Const"),s=require("../events/Event"),a=require("../events/MouseManager"),o=require("../maths/Matrix"),l=require("../maths/Point"),u=require("../renders/Render"),h=require("../renders/RenderInfo"),c=require("../resource/Context"),_=require("../utils/Browser"),f=require("../utils/CallLater"),d=require("../utils/ColorUtils"),g=require("../utils/RunDriver"),m=require("../utils/VectorGraphManager"),v=require("../webgl/utils/RenderState2D"),S=require("../webgl/WebGLContext"),p=require("../utils/Stat");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t,i){return t&&y(e.prototype,t),i&&y(e,i),e}function R(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?w(e):t}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,i){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=M(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function M(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=A(e)););return e}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(c){function v(){var e;C(this,v),(e=R(this,A(v).call(this))).offset=new l.Point,e._frameRate="fast",e.designWidth=0,e.designHeight=0,e.canvasRotation=!1,e.canvasDegree=0,e.renderingEnabled=!0,e.screenAdaptationEnabled=!0,e._canvasTransform=new o.Matrix,e._screenMode="none",e._scaleMode="noscale",e._alignV="top",e._alignH="left",e._bgColor="black",e._mouseMoveTime=0,e._renderCount=0,e._safariOffsetY=0,e._frameStartTime=0,e._previousOrientation=_.Browser.window.orientation,e._wgColor=[0,0,0,1],e._scene3Ds=[],e._globalRepaintSet=!1,e._globalRepaintGet=!1,e._3dUI=[],e._curUIBase=null,e.useRetinalCanvas=!1,I(A(v.prototype),"set_transform",w(e)).call(w(e),e._createTransform()),e.mouseEnabled=!0,e.hitTestPrior=!0,e.autoSize=!1,e._setBit(r.Const.DISPLAYED_INSTAGE,!0),e._setBit(r.Const.ACTIVE_INHIERARCHY,!0),e._isFocused=!0,e._isVisibility=!0,e.useRetinalCanvas=t.Config.useRetinalCanvas;var n=_.Browser.window,a=w(e);n.addEventListener("focus",function(){this._isFocused=!0,a.event(s.Event.FOCUS),a.event(s.Event.FOCUS_CHANGE)}),n.addEventListener("blur",function(){this._isFocused=!1,a.event(s.Event.BLUR),a.event(s.Event.FOCUS_CHANGE),a._isInputting()&&(i.Input.inputElement.target.focus=!1)});var u="visibilityState",h="visibilitychange",c=n.document;return void 0!==c.hidden?(h="visibilitychange",u="visibilityState"):void 0!==c.mozHidden?(h="mozvisibilitychange",u="mozVisibilityState"):void 0!==c.msHidden?(h="msvisibilitychange",u="msVisibilityState"):void 0!==c.webkitHidden&&(h="webkitvisibilitychange",u="webkitVisibilityState"),n.document.addEventListener(h,function(){"hidden"==_.Browser.document[u]?(this._isVisibility=!1,a._isInputting()&&(i.Input.inputElement.target.focus=!1)):this._isVisibility=!0;this.renderingEnabled=this._isVisibility,a.event(s.Event.VISIBILITY_CHANGE)}),n.addEventListener("resize",function(){var e=_.Browser.window.orientation;null!=e&&e!=this._previousOrientation&&a._isInputting()&&(i.Input.inputElement.target.focus=!1),this._previousOrientation=e,a._isInputting()||(_.Browser.onSafari&&(a._safariOffsetY=(_.Browser.window.__innerHeight||_.Browser.document.body.clientHeight||_.Browser.document.documentElement.clientHeight)-_.Browser.window.innerHeight),a._resetCanvas())}),n.addEventListener("orientationchange",function(e){a._resetCanvas()}),e.on(s.Event.MOUSE_MOVE,w(e),e._onmouseMove),_.Browser.onMobile&&e.on(s.Event.MOUSE_DOWN,w(e),e._onmouseMove),e}return L(v,e.Sprite),b(v,[{key:"_isInputting",value:function(){return _.Browser.onMobile&&i.Input.isInputting}},{key:"_changeCanvasSize",value:function(){this.setScreenSize(_.Browser.clientWidth*_.Browser.pixelRatio,_.Browser.clientHeight*_.Browser.pixelRatio)}},{key:"_resetCanvas",value:function(){this.screenAdaptationEnabled&&this._changeCanvasSize()}},{key:"setScreenSize",value:function(e,t){var i=!1;if(this._screenMode!==v.SCREEN_NONE&&(i=(e/t<1?v.SCREEN_VERTICAL:v.SCREEN_HORIZONTAL)!==this._screenMode)){var r=t;t=e,e=r}this.canvasRotation=i;var a=u.Render._mainCanvas,o=a.source.style,l=this._canvasTransform.identity(),h=this._scaleMode,c=e/this.designWidth,f=t/this.designHeight,d=this.useRetinalCanvas?e:this.designWidth,m=this.useRetinalCanvas?t:this.designHeight,S=e,p=t,E=_.Browser.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,h){case v.SCALE_NOSCALE:c=f=1,S=this.designWidth,p=this.designHeight;break;case v.SCALE_SHOWALL:c=f=Math.min(c,f),d=S=Math.round(this.designWidth*c),m=p=Math.round(this.designHeight*f);break;case v.SCALE_NOBORDER:c=f=Math.max(c,f),S=Math.round(this.designWidth*c),p=Math.round(this.designHeight*f);break;case v.SCALE_FULL:c=f=1,this._width=d=e,this._height=m=t;break;case v.SCALE_FIXED_WIDTH:f=c,this._height=m=Math.round(t/c);break;case v.SCALE_FIXED_HEIGHT:c=f,this._width=d=Math.round(e/f);break;case v.SCALE_FIXED_AUTO:e/t<this.designWidth/this.designHeight?(f=c,this._height=m=Math.round(t/c)):(c=f,this._width=d=Math.round(e/f))}this.useRetinalCanvas&&(d=e,m=t),c*=this.scaleX,f*=this.scaleY,1===c&&1===f?this.transform.identity():(this.transform.a=this._formatData(c/(S/d)),this.transform.d=this._formatData(f/(p/m))),a.size(d,m),g.RunDriver.changeWebGLSize(d,m),l.scale(S/d/E,p/m/E),this._alignH===v.ALIGN_LEFT?this.offset.x=0:this._alignH===v.ALIGN_RIGHT?this.offset.x=e-S:this.offset.x=.5*(e-S)/E,this._alignV===v.ALIGN_TOP?this.offset.y=0:this._alignV===v.ALIGN_BOTTOM?this.offset.y=t-p:this.offset.y=.5*(t-p)/E,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),l.translate(this.offset.x,this.offset.y),this._safariOffsetY&&l.translate(0,this._safariOffsetY),this.canvasDegree=0,i&&(this._screenMode===v.SCREEN_HORIZONTAL?(l.rotate(Math.PI/2),l.translate(t/E,0),this.canvasDegree=90):(l.rotate(-Math.PI/2),l.translate(0,e/E),this.canvasDegree=-90)),l.a=this._formatData(l.a),l.d=this._formatData(l.d),l.tx=this._formatData(l.tx),l.ty=this._formatData(l.ty),I(A(v.prototype),"set_transform",this).call(this,this.transform),o.transformOrigin=o.webkitTransformOrigin=o.msTransformOrigin=o.mozTransformOrigin=o.oTransformOrigin="0px 0px 0px",o.transform=o.webkitTransform=o.msTransform=o.mozTransform=o.oTransform="matrix("+l.toString()+")",this._safariOffsetY&&l.translate(0,-this._safariOffsetY),l.translate(parseInt(o.left)||0,parseInt(o.top)||0),this.visible=!0,this._repaint|=n.SpriteConst.REPAINT_CACHE,this.event(s.Event.RESIZE)}},{key:"_formatData",value:function(e){return Math.abs(e)<1e-6?0:Math.abs(1-e)<.001?e>0?1:-1:e}},{key:"getMousePoint",value:function(){return l.Point.TEMP.setTo(this.mouseX,this.mouseY)}},{key:"repaint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.SpriteConst.REPAINT_CACHE;this._repaint|=e}},{key:"parentRepaint",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.SpriteConst.REPAINT_CACHE}},{key:"_loop",value:function(){return this._globalRepaintGet=this._globalRepaintSet,this._globalRepaintSet=!1,this.render(u.Render._context,0,0),!0}},{key:"getFrameTm",value:function(){return this._frameStartTime}},{key:"_onmouseMove",value:function(e){this._mouseMoveTime=_.Browser.now()}},{key:"getTimeFromFrameStart",value:function(){return _.Browser.now()-this._frameStartTime}},{key:"render",value:function(e,t,i){if(window.conch)this.renderToNative(e,t,i);else{if(v._dbgSprite.graphics.clear(),this._frameRate===v.FRAME_SLEEP){var n=_.Browser.now();if(!(n-this._frameStartTime>=1e3))return;this._frameStartTime=n}else{if(!this._visible)return this._renderCount++,void(this._renderCount%5==0&&(f.CallLater.I._update(),p.Stat.loopCount++,h.RenderInfo.loopCount=p.Stat.loopCount,this._updateTimers()));this._frameStartTime=_.Browser.now(),h.RenderInfo.loopStTm=this._frameStartTime}this._renderCount++;var r=(this._frameRate===v.FRAME_MOUSE?this._frameStartTime-this._mouseMoveTime<2e3?v.FRAME_FAST:v.FRAME_SLOW:this._frameRate)!==v.FRAME_SLOW,s=this._renderCount%2==0;if(p.Stat.renderSlow=!r,(r||s)&&(f.CallLater.I._update(),p.Stat.loopCount++,h.RenderInfo.loopCount=p.Stat.loopCount,this.renderingEnabled)){for(var a=0,o=this._scene3Ds.length;a<o;a++)this._scene3Ds[a]._update();e.clear(),I(A(v.prototype),"render",this).call(this,e,t,i),p.Stat._StatRender.renderNotCanvas(e,t,i)}v._dbgSprite.render(e,0,0),!r&&s||(this.renderingEnabled&&(v.clear(this._bgColor),e.flush(),m.VectorGraphManager.instance&&m.VectorGraphManager.getInstance().endDispose()),this._updateTimers())}}},{key:"renderToNative",value:function(e,t,i){if(this._renderCount++,this._visible){if(f.CallLater.I._update(),p.Stat.loopCount++,h.RenderInfo.loopCount=p.Stat.loopCount,this.renderingEnabled){for(var n=0,r=this._scene3Ds.length;n<r;n++)this._scene3Ds[n]._update();e.clear(),I(A(v.prototype),"render",this).call(this,e,t,i),p.Stat._StatRender.renderNotCanvas(e,t,i)}this.renderingEnabled&&(v.clear(this._bgColor),e.flush(),m.VectorGraphManager.instance&&m.VectorGraphManager.getInstance().endDispose()),this._updateTimers()}else this._renderCount%5==0&&(f.CallLater.I._update(),p.Stat.loopCount++,h.RenderInfo.loopCount=p.Stat.loopCount,this._updateTimers())}},{key:"_updateTimers",value:function(){var e=window.Laya;v.gSysTimer._update(),e.startTimer._update(),e.physicsTimer._update(),e.updateTimer._update(),e.lateTimer._update(),e.timer._update()}},{key:"_requestFullscreen",value:function(){var e=_.Browser.document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},{key:"_fullScreenChanged",value:function(){v.gStage.event(s.Event.FULL_SCREEN_CHANGE)}},{key:"exitFullscreen",value:function(){var e=_.Browser.document;e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}},{key:"isGlobalRepaint",value:function(){return this._globalRepaintGet}},{key:"setGlobalRepaint",value:function(){this._globalRepaintSet=!0}},{key:"add3DUI",value:function(e){var t=e.rootView;this._3dUI.indexOf(t)>=0||this._3dUI.push(t)}},{key:"remove3DUI",value:function(e){var t=e.rootView,i=this._3dUI.indexOf(t);return i>=0&&(this._3dUI.splice(i,1),!0)}},{key:"width",set:function(e){this.designWidth=e,I(A(v.prototype),"set_width",this).call(this,e),v.gSysTimer.callLater(this,this._changeCanvasSize)}},{key:"height",set:function(e){this.designHeight=e,I(A(v.prototype),"set_height",this).call(this,e),v.gSysTimer.callLater(this,this._changeCanvasSize)}},{key:"transform",get:function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||this._createTransform()}},{key:"isFocused",get:function(){return this._isFocused}},{key:"isVisibility",get:function(){return this._isVisibility}},{key:"scaleMode",get:function(){return this._scaleMode},set:function(e){this._scaleMode=e,v.gSysTimer.callLater(this,this._changeCanvasSize)}},{key:"alignH",get:function(){return this._alignH},set:function(e){this._alignH=e,v.gSysTimer.callLater(this,this._changeCanvasSize)}},{key:"alignV",get:function(){return this._alignV},set:function(e){this._alignV=e,v.gSysTimer.callLater(this,this._changeCanvasSize)}},{key:"bgColor",get:function(){return this._bgColor},set:function(e){this._bgColor=e,this._wgColor=e?d.ColorUtils.create(e).arrColor:null,_.Browser.onLimixiu?this._wgColor=d.ColorUtils.create(e).arrColor:u.Render.canvas.style.background=e||"none"}},{key:"mouseX",get:function(){return Math.round(a.MouseManager.instance.mouseX/this.clientScaleX)}},{key:"mouseY",get:function(){return Math.round(a.MouseManager.instance.mouseY/this.clientScaleY)}},{key:"clientScaleX",get:function(){return this._transform?this._transform.getScaleX():1}},{key:"clientScaleY",get:function(){return this._transform?this._transform.getScaleY():1}},{key:"screenMode",get:function(){return this._screenMode},set:function(e){this._screenMode=e}},{key:"visible",set:function(e){this.visible!==e&&(I(A(v.prototype),"set_visible",this).call(this,e),u.Render._mainCanvas.source.style.visibility=e?"visible":"hidden")}},{key:"fullScreenEnabled",set:function(e){var t=_.Browser.document,i=u.Render.canvas;e?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),t.addEventListener("fullscreenchange",this._fullScreenChanged),t.addEventListener("mozfullscreenchange",this._fullScreenChanged),t.addEventListener("webkitfullscreenchange",this._fullScreenChanged),t.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),t.removeEventListener("fullscreenchange",this._fullScreenChanged),t.removeEventListener("mozfullscreenchange",this._fullScreenChanged),t.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),t.removeEventListener("msfullscreenchange",this._fullScreenChanged))}},{key:"frameRate",get:function(){return u.Render.isConchApp?this._frameRateNative:this._frameRate},set:function(e){if(u.Render.isConchApp){var t=window.conch;switch(e){case v.FRAME_FAST:t.config.setLimitFPS(60);break;case v.FRAME_MOUSE:t.config.setMouseFrame(2e3);break;case v.FRAME_SLOW:t.config.setSlowFrame(!0);break;case v.FRAME_SLEEP:t.config.setLimitFPS(1)}this._frameRateNative=e}else this._frameRate=e}}]),v}();exports.Stage=O,O.gStage=null,O.gSysTimer=null,O.SCALE_NOSCALE="noscale",O.SCALE_EXACTFIT="exactfit",O.SCALE_SHOWALL="showall",O.SCALE_NOBORDER="noborder",O.SCALE_FULL="full",O.SCALE_FIXED_WIDTH="fixedwidth",O.SCALE_FIXED_HEIGHT="fixedheight",O.SCALE_FIXED_AUTO="fixedauto",O.ALIGN_LEFT="left",O.ALIGN_RIGHT="right",O.ALIGN_CENTER="center",O.ALIGN_TOP="top",O.ALIGN_MIDDLE="middle",O.ALIGN_BOTTOM="bottom",O.SCREEN_NONE="none",O.SCREEN_HORIZONTAL="horizontal",O.SCREEN_VERTICAL="vertical",O.FRAME_FAST="fast",O.FRAME_SLOW="slow",O.FRAME_MOUSE="mouse",O.FRAME_SLEEP="sleep",O._dbgSprite=new e.Sprite,O.clear=function(e){c.Context.set2DRenderConfig(),v.RenderState2D.worldScissorTest&&S.WebGLContext.mainContext.disable(S.WebGLContext.SCISSOR_TEST);var i=u.Render.context,n=0==i._submits._length||t.Config.preserveDrawingBuffer?d.ColorUtils.create(e).arrColor:window.Laya.stage._wgColor;n?i.clearBG(n[0],n[1],n[2],n[3]):i.clearBG(0,0,0,0),v.RenderState2D.clear()};
},{"././Sprite":"LHsS","./../../Config":"/R4M","././Input":"ReI4","././SpriteConst":"3oZi","../Const":"mW4A","../events/Event":"jK6U","../events/MouseManager":"0uUh","../maths/Matrix":"GG2z","../maths/Point":"ziZY","../renders/Render":"Gwgr","../renders/RenderInfo":"5Dwh","../resource/Context":"2BX4","../utils/Browser":"pOAB","../utils/CallLater":"71DA","../utils/ColorUtils":"iLoT","../utils/RunDriver":"fnCT","../utils/VectorGraphManager":"gHBw","../webgl/utils/RenderState2D":"k75q","../webgl/WebGLContext":"vf9T","../utils/Stat":"xuKH"}],"+bzw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KeyBoardManager=void 0;var e=require("././Event"),n=require("../utils/Browser");function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}var a=function(){function e(){t(this,e)}return o(e,null,[{key:"__init__",value:function(){e._addEvent("keydown"),e._addEvent("keypress"),e._addEvent("keyup")}},{key:"_addEvent",value:function(t){n.Browser.document.addEventListener(t,function(n){e._dispatch(n,t)},!0)}},{key:"_dispatch",value:function(n,t){if(e.enabled){e._event._stoped=!1,e._event.nativeEvent=n,e._event.keyCode=n.keyCode||n.which||n.charCode,"keydown"===t?e._pressKeys[e._event.keyCode]=!0:"keyup"===t&&(e._pressKeys[e._event.keyCode]=null);for(var r=window.Laya.stage,o=r.focus&&null!=r.focus.event&&r.focus.displayedInStage?r.focus:r,a=o;a;)a.event(t,e._event.setTo(t,a,o)),a=a.parent}}},{key:"hasKeyDown",value:function(n){return e._pressKeys[n]}}]),e}();exports.KeyBoardManager=a,a._pressKeys={},a.enabled=!0,a._event=new e.Event;
},{"././Event":"jK6U","../utils/Browser":"pOAB"}],"e7tp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SoundChannel=void 0;var e=require("../events/EventDispatcher");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function u(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?i(e):n}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(t){function o(){var e;return n(this,o),(e=u(this,c(o).apply(this,arguments))).isStopped=!1,e}return f(o,e.EventDispatcher),r(o,[{key:"play",value:function(){}},{key:"stop",value:function(){this.completeHandler&&this.completeHandler.run()}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"__runComplete",value:function(e){e&&e.run()}},{key:"volume",set:function(e){},get:function(){return 1}},{key:"position",get:function(){return 0}},{key:"duration",get:function(){return 0}}]),o}();exports.SoundChannel=a;
},{"../events/EventDispatcher":"IA8z"}],"9OTK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AudioSoundChannel=void 0;var e=require("../../events/Event"),t=require("../SoundChannel"),n=require("../SoundManager"),i=require("../../renders/Render"),o=require("../../utils/Browser");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function l(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=c(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(r){function a(e){var t;return u(this,a),(t=l(this,p(a).call(this)))._audio=null,t._onEnd=t.__onEnd.bind(d(t)),t._resumePlay=t.__resumePlay.bind(d(t)),e.addEventListener("ended",t._onEnd),t._audio=e,t}return f(a,t.SoundChannel),s(a,[{key:"__onEnd",value:function(t){if(1==this.loops)return this.completeHandler&&(window.Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(e.Event.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}},{key:"__resumePlay",value:function(){if(this._audio&&this._audio.removeEventListener("canplay",this._resumePlay),!this.isStopped)try{this._audio.currentTime=this.startTime,o.Browser.container.appendChild(this._audio),this._audio.play()}catch(t){this.event(e.Event.ERROR)}}},{key:"play",value:function(){this.isStopped=!1;try{this._audio.playbackRate=n.SoundManager.playbackRate,this._audio.currentTime=this.startTime}catch(e){return void this._audio.addEventListener("canplay",this._resumePlay)}n.SoundManager.addChannel(this),o.Browser.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()}},{key:"stop",value:function(){h(p(a.prototype),"stop",this).call(this),this.isStopped=!0,n.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&i.Render.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),o.Browser.removeElement(this._audio),this._audio=null)}},{key:"pause",value:function(){this.isStopped=!0,n.SoundManager.removeChannel(this),"pause"in this._audio&&this._audio.pause()}},{key:"resume",value:function(){this._audio&&(this.isStopped=!1,n.SoundManager.addChannel(this),"play"in this._audio&&this._audio.play())}},{key:"position",get:function(){return this._audio?this._audio.currentTime:0}},{key:"duration",get:function(){return this._audio?this._audio.duration:0}},{key:"volume",set:function(e){this._audio&&(this._audio.volume=e)},get:function(){return this._audio?this._audio.volume:1}}]),a}();exports.AudioSoundChannel=_;
},{"../../events/Event":"jK6U","../SoundChannel":"e7tp","../SoundManager":"8e3q","../../renders/Render":"Gwgr","../../utils/Browser":"pOAB"}],"iHsV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AudioSound=void 0;var e=require("././AudioSoundChannel"),t=require("../../events/Event"),r=require("../../events/EventDispatcher"),n=require("../SoundManager"),o=require("../../net/URL"),u=require("../../renders/Render"),i=require("../../utils/Browser"),a=require("../../utils/Pool");function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}function f(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(c){function l(){var e;return s(this,l),(e=f(this,p(l).apply(this,arguments))).loaded=!1,e}return v(l,r.EventDispatcher),d(l,[{key:"dispose",value:function(){var e=l._audioCache[this.url];a.Pool.clearBySign("audio:"+this.url),e&&(u.Render.isConchApp||(e.src=""),delete l._audioCache[this.url])}},{key:"load",value:function(e){var r;if(e=o.URL.formatURL(e),this.url=e,e==n.SoundManager._bgMusic?(l._initMusicAudio(),(r=l._musicAudio).src!=e&&(l._audioCache[r.src]=null,r=null)):r=l._audioCache[e],r&&r.readyState>=2)this.event(t.Event.COMPLETE);else{r||(e==n.SoundManager._bgMusic?(l._initMusicAudio(),r=l._musicAudio):r=i.Browser.createElement("audio"),l._audioCache[e]=r,r.src=e),r.addEventListener("canplaythrough",a),r.addEventListener("error",c);var u=this;this.audio=r,r.load?r.load():c()}function a(){s(),u.loaded=!0,u.event(t.Event.COMPLETE)}function c(){r.load=null,s(),u.event(t.Event.ERROR)}function s(){r.removeEventListener("canplaythrough",a),r.removeEventListener("error",c)}}},{key:"play",value:function(){var t,r,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.url)return null;if(!(t=this.url==n.SoundManager._bgMusic?l._musicAudio:l._audioCache[this.url]))return null;r=a.Pool.getItem("audio:"+this.url),u.Render.isConchApp?r||((r=i.Browser.createElement("audio")).src=this.url):this.url==n.SoundManager._bgMusic?(l._initMusicAudio(),(r=l._musicAudio).src=this.url):r=r||t.cloneNode(!0);var s=new e.AudioSoundChannel(r);return s.url=this.url,s.loops=c,s.startTime=o,s.play(),n.SoundManager.addChannel(s),s}},{key:"duration",get:function(){var e;return(e=l._audioCache[this.url])?e.duration:0}}],[{key:"_initMusicAudio",value:function(){l._musicAudio||(l._musicAudio||(l._musicAudio=i.Browser.createElement("audio")),u.Render.isConchApp||i.Browser.document.addEventListener("mousedown",l._makeMusicOK))}},{key:"_makeMusicOK",value:function(){i.Browser.document.removeEventListener("mousedown",l._makeMusicOK),l._musicAudio.src?l._musicAudio.play():(l._musicAudio.src="",l._musicAudio.load())}}]),l}();exports.AudioSound=_,_._audioCache={};
},{"././AudioSoundChannel":"9OTK","../../events/Event":"jK6U","../../events/EventDispatcher":"IA8z","../SoundManager":"8e3q","../../net/URL":"vU/V","../../renders/Render":"Gwgr","../../utils/Browser":"pOAB","../../utils/Pool":"Jkpb"}],"ZxAq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebAudioSoundChannel=void 0;var e=require("../../events/Event"),t=require("../SoundChannel"),n=require("../SoundManager"),i=require("../../utils/Browser"),r=require("../../utils/Utils"),o=require("./WebAudioSound");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?f(e):t}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=p(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function p(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(a){function s(){var e;return u(this,s),(e=c(this,d(s).call(this))).bufferSource=null,e._currentTime=0,e._volume=1,e._startTime=0,e._pauseTime=0,e.context=o.WebAudioSound.ctx,e._onPlayEnd=r.Utils.bind(e.__onPlayEnd,f(e)),e.context.createGain?e.gain=e.context.createGain():e.gain=e.context.createGainNode(),e}return y(s,t.SoundChannel),l(s,[{key:"play",value:function(){if(n.SoundManager.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var e=this.context,t=this.gain,r=e.createBufferSource();this.bufferSource=r,r.buffer=this.audioBuffer,r.connect(t),t&&t.disconnect(),t.connect(e.destination),r.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=i.Browser.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,s.SetTargetDelay):this.gain.gain.value=this._volume,0==this.loops&&(r.loop=!0),r.playbackRate.setTargetAtTime?r.playbackRate.setTargetAtTime(n.SoundManager.playbackRate,this.context.currentTime,s.SetTargetDelay):r.playbackRate.value=n.SoundManager.playbackRate,r.start(0,this.startTime),this._currentTime=0}}},{key:"__onPlayEnd",value:function(){if(1==this.loops)return this.completeHandler&&(window.Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(e.Event.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}},{key:"_clearBufferSource",value:function(){if(this.bufferSource){var e=this.bufferSource;e.stop?e.stop(0):e.noteOff(0),e.disconnect(0),e.onended=null,s._tryCleanFailed||this._tryClearBuffer(e),this.bufferSource=null}}},{key:"_tryClearBuffer",value:function(e){if(i.Browser.onMac)try{e.buffer=o.WebAudioSound._miniBuffer}catch(t){s._tryCleanFailed=!0}else try{e.buffer=null}catch(t){s._tryCleanFailed=!0}}},{key:"stop",value:function(){h(d(s.prototype),"stop",this).call(this),this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,n.SoundManager.removeChannel(this),this.completeHandler=null,n.SoundManager.autoReleaseSound&&n.SoundManager.disposeSoundLater(this.url)}},{key:"pause",value:function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,n.SoundManager.removeChannel(this),n.SoundManager.autoReleaseSound&&n.SoundManager.disposeSoundLater(this.url)}},{key:"resume",value:function(){this.startTime=this._pauseTime,this.play()}},{key:"position",get:function(){return this.bufferSource?(i.Browser.now()-this._startTime)/1e3+this.startTime:0}},{key:"duration",get:function(){return this.audioBuffer?this.audioBuffer.duration:0}},{key:"volume",set:function(e){this._volume=e,this.isStopped||(this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(e,this.context.currentTime,s.SetTargetDelay):this.gain.gain.value=e)},get:function(){return this._volume}}]),s}();exports.WebAudioSoundChannel=m,m._tryCleanFailed=!1,m.SetTargetDelay=.001;
},{"../../events/Event":"jK6U","../SoundChannel":"e7tp","../SoundManager":"8e3q","../../utils/Browser":"pOAB","../../utils/Utils":"kHKw","./WebAudioSound":"0TdE"}],"0TdE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebAudioSound=void 0;var e=require("././WebAudioSoundChannel"),t=require("../../events/Event"),o=require("../../events/EventDispatcher"),n=require("../SoundManager"),i=require("../../net/URL");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,o){return t&&d(e.prototype,t),o&&d(e,o),e}function s(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(u){function d(){var e;return r(this,d),(e=s(this,f(d).apply(this,arguments))).loaded=!1,e._disposed=!1,e}return c(d,o.EventDispatcher),a(d,[{key:"load",value:function(e){var t=this;if(e=i.URL.formatURL(e),this.url=e,this.audioBuffer=d._dataCache[e],this.audioBuffer)this._loaded(this.audioBuffer);else if(d.e.on("loaded:"+e,this,this._loaded),d.e.on("err:"+e,this,this._err),!d.__loadingSound[e]){d.__loadingSound[e]=!0;var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){t._disposed?t._removeLoadEvents():(t.data=o.response,d.buffs.push({buffer:t.data,url:t.url}),d.decode())},o.onerror=function(e){t._err()},o.send()}}},{key:"_err",value:function(){this._removeLoadEvents(),d.__loadingSound[this.url]=!1,this.event(t.Event.ERROR)}},{key:"_loaded",value:function(e){this._removeLoadEvents(),this._disposed||(this.audioBuffer=e,d._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event(t.Event.COMPLETE))}},{key:"_removeLoadEvents",value:function(){d.e.off("loaded:"+this.url,this,this._loaded),d.e.off("err:"+this.url,this,this._err)}},{key:"__playAfterLoaded",value:function(){if(this.__toPlays){var e,t,o,n;for(t=(o=this.__toPlays).length,e=0;e<t;e++)(n=o[e])[2]&&!n[2].isStopped&&this.play(n[0],n[1],n[2]);this.__toPlays.length=0}}},{key:"play",value:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return u=u||new e.WebAudioSoundChannel,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([o,i,u]),this.once(t.Event.COMPLETE,this,this.__playAfterLoaded),this.load(this.url)),u.url=this.url,u.loops=i,u.audioBuffer=this.audioBuffer,u.startTime=o,u.play(),n.SoundManager.addChannel(u),u}},{key:"dispose",value:function(){this._disposed=!0,delete d._dataCache[this.url],delete d.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]}},{key:"duration",get:function(){return this.audioBuffer?this.audioBuffer.duration:0}}],[{key:"decode",value:function(){d.buffs.length<=0||d.isDecoding||(d.isDecoding=!0,d.tInfo=d.buffs.shift(),d.ctx.decodeAudioData(d.tInfo.buffer,d._done,d._fail))}},{key:"_done",value:function(e){d.e.event("loaded:"+d.tInfo.url,e),d.isDecoding=!1,d.decode()}},{key:"_fail",value:function(){d.e.event("err:"+d.tInfo.url,null),d.isDecoding=!1,d.decode()}},{key:"_playEmptySound",value:function(){if(null!=d.ctx){var e=d.ctx.createBufferSource();e.buffer=d._miniBuffer,e.connect(d.ctx.destination),e.start(0,0,0)}}},{key:"_unlock",value:function(){d._unlocked||(d._playEmptySound(),"running"==d.ctx.state&&(window.document.removeEventListener("mousedown",d._unlock,!0),window.document.removeEventListener("touchend",d._unlock,!0),window.document.removeEventListener("touchstart",d._unlock,!0),d._unlocked=!0))}},{key:"initWebAudio",value:function(){"running"!=d.ctx.state&&(d._unlock(),window.document.addEventListener("mousedown",d._unlock,!0),window.document.addEventListener("touchend",d._unlock,!0),window.document.addEventListener("touchstart",d._unlock,!0))}}]),d}();exports.WebAudioSound=_,_._dataCache={},_.webAudioEnabled=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,_.ctx=_.webAudioEnabled?new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext):void 0,_.buffs=[],_.isDecoding=!1,_._miniBuffer=_.ctx.createBuffer(1,1,22050),_.e=new o.EventDispatcher,_._unlocked=!1,_.__loadingSound={};
},{"././WebAudioSoundChannel":"ZxAq","../../events/Event":"jK6U","../../events/EventDispatcher":"IA8z","../SoundManager":"8e3q","../../net/URL":"vU/V"}],"hGJ+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HttpRequest=void 0;var t=require("././URL"),e=require("../events/Event"),n=require("../events/EventDispatcher"),r=require("../utils/Utils");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function a(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?p(t):e}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(o){function i(){var t;return s(this,i),(t=a(this,l(i).apply(this,arguments)))._http=new XMLHttpRequest,t}return c(i,n.EventDispatcher),u(i,[{key:"send",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._responseType=o,this._data=null,this._url=e;var i=this,u=this._http;if(e=t.URL.getAdptedFilePath(e),u.open(r,e,!0),s)for(var a=0;a<s.length;a++)u.setRequestHeader(s[a++],s[a]);else window.conch||(!n||n instanceof String?u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):u.setRequestHeader("Content-Type","application/json"));u.responseType="arraybuffer"!==o?"text":"arraybuffer",u.onerror=function(t){i._onError(t)},u.onabort=function(t){i._onAbort(t)},u.onprogress=function(t){i._onProgress(t)},u.onload=function(t){i._onLoad(t)},u.send(n)}},{key:"_onProgress",value:function(t){t&&t.lengthComputable&&this.event(e.Event.PROGRESS,t.loaded/t.total)}},{key:"_onAbort",value:function(t){this.error("Request was aborted by user")}},{key:"_onError",value:function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)}},{key:"_onLoad",value:function(t){var e=this._http,n=void 0!==e.status?e.status:200;200===n||204===n||0===n?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)}},{key:"error",value:function(t){this.clear(),console.warn(this.url,t),this.event(e.Event.ERROR,t)}},{key:"complete",value:function(){this.clear();var t=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=r.Utils.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(n){t=!1,this.error(n.message)}t&&this.event(e.Event.COMPLETE,this._data instanceof Array?[this._data]:this._data)}},{key:"clear",value:function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null}},{key:"url",get:function(){return this._url}},{key:"data",get:function(){return this._data}},{key:"http",get:function(){return this._http}}]),i}();exports.HttpRequest=f;
},{"././URL":"vU/V","../events/Event":"jK6U","../events/EventDispatcher":"IA8z","../utils/Utils":"kHKw"}],"q7AZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WorkerLoader=void 0;var e=require("././Loader"),r=require("././URL"),t=require("../events/EventDispatcher"),o=require("../resource/HTMLCanvas"),n=require("../resource/Texture2D");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function i(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,r,t){return r&&i(e.prototype,r),t&&i(e,t),e}function c(e,r){return!r||"object"!==a(r)&&"function"!=typeof r?s(e):r}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&y(e,r)}function y(e,r){return(y=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}var d=function(a){function i(){var e;return u(this,i),(e=c(this,f(i).call(this))).worker=new Worker(i.workerPath),e.worker.onmessage=function(e){this.workerMessage(e.data)},e}return p(i,t.EventDispatcher),l(i,[{key:"workerMessage",value:function(e){if(e)switch(e.type){case"Image":this.imageLoaded(e);break;case"Disable":i.enable=!1}}},{key:"imageLoaded",value:function(e){if(e.dataType&&"imageBitmap"==e.dataType){var r=new o.HTMLCanvas(!0),t=r.source.getContext("2d");switch(e.dataType){case"imageBitmap":var a=e.imageBitmap;r.size(a.width,a.height),t.drawImage(a,0,0)}console.log("load:",e.url),r._setGPUMemory(0);var u=new n.Texture2D;u.loadImageSource(r.source),this.event(e.url,u)}else this.event(e.url,null)}},{key:"loadImage",value:function(e){this.worker.postMessage(e)}},{key:"_loadImage",value:function(e){var t=this;if(this._useWorkerLoader&&i._enable){e=r.URL.formatURL(e);var o=function(r){n(),r?t.onLoaded(r):i._preLoadFun.call(t,e)};i.I.on(e,t,o),i.I.loadImage(e)}else i._preLoadFun.call(t,e);function n(){i.I.off(e,t,o)}}}],[{key:"__init__",value:function(){return null==i._preLoadFun&&(!!Worker&&(i._preLoadFun=e.Loader.prototype._loadImage,e.Loader.prototype._loadImage=i.prototype._loadImage,i.I||(i.I=new i),!0))}},{key:"workerSupported",value:function(){return!!Worker}},{key:"enableWorkerLoader",value:function(){i._tryEnabled||(i.enable=!0,i._tryEnabled=!0)}},{key:"enable",set:function(e){i._enable!=e&&(i._enable=e,e&&null==i._preLoadFun&&(i._enable=i.__init__()))},get:function(){return i._enable}}]),i}();exports.WorkerLoader=d,d.workerPath="libs/workerloader.js",d._enable=!1,d._tryEnabled=!1;
},{"././Loader":"/MXX","././URL":"vU/V","../events/EventDispatcher":"IA8z","../resource/HTMLCanvas":"TY9w","../resource/Texture2D":"zb/G"}],"YZHQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TTFLoader=void 0;var t=require("././HttpRequest"),e=require("././Loader"),i=require("../events/Event"),n=require("../utils/PlatformInfo"),o=require("../utils/Browser");function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}var a=function(){function r(){s(this,r)}return h(r,[{key:"load",value:function(t){this._url=t;var e=t.split(".ttf")[0].split("/");this.fontName=e[e.length-1],n.PlatformInfo.onLayaRuntime?this._loadConch():window.FontFace?this._loadWithFontFace():this._loadWithCSS()}},{key:"_loadConch",value:function(){this._http=new t.HttpRequest,this._http.on(i.Event.ERROR,this,this._onErr),this._http.on(i.Event.COMPLETE,this,this._onHttpLoaded),this._http.send(this._url,null,"get",e.Loader.BUFFER)}},{key:"_onHttpLoaded",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.conchTextCanvas.setFontFaceFromBuffer(this.fontName,t),this._clearHttp(),this._complete()}},{key:"_clearHttp",value:function(){this._http&&(this._http.off(i.Event.ERROR,this,this._onErr),this._http.off(i.Event.COMPLETE,this,this._onHttpLoaded),this._http=null)}},{key:"_onErr",value:function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)}},{key:"_complete",value:function(){r.gSysTimer.clear(this,this._complete),r.gSysTimer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)}},{key:"_checkComplete",value:function(){o.Browser.measureText(r._testString,this._fontTxt).width!=this._txtWidth&&this._complete()}},{key:"_loadWithFontFace",value:function(){var t=new window.FontFace(this.fontName,"url('"+this._url+"')");document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()}),t.load()}},{key:"_createDiv",value:function(){this._div=document.createElement("div"),this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName,t.position="absolute",t.left="-100px",t.top="-100px",document.body.appendChild(this._div)}},{key:"_loadWithCSS",value:function(){var t=document.createElement("style");t.type="text/css",document.body.appendChild(t),t.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=o.Browser.measureText(r._testString,this._fontTxt).width;var e=this;t.onload=function(){r.gSysTimer.once(1e4,e,this._complete)},r.gSysTimer.loop(20,this,this._checkComplete),this._createDiv()}}]),r}();exports.TTFLoader=a,a.gSysTimer=null,a._testString="LayaTTFFont";
},{"././HttpRequest":"hGJ+","././Loader":"/MXX","../events/Event":"jK6U","../utils/PlatformInfo":"HmZQ","../utils/Browser":"pOAB"}],"EFl8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BitmapFont=void 0;var t=require("../maths/Rectangle"),e=require("../net/Loader"),a=require("../resource/Texture"),i=require("../utils/Handler");function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,a){return e&&r(t.prototype,e),a&&r(t,a),t}var h=function(){function r(){n(this,r),this._fontCharDic={},this._fontWidthMap={},this._maxWidth=0,this._spaceWidth=10,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}return o(r,[{key:"loadFont",value:function(t,a){(this._path=t,this._complete=a,t&&-1!==t.indexOf(".fnt"))?window.Laya.loader.load([{url:t,type:e.Loader.XML},{url:t.replace(".fnt",".png"),type:e.Loader.IMAGE}],i.Handler.create(this,this._onLoaded)):console.error('Bitmap font configuration information must be a ".fnt" file')}},{key:"_onLoaded",value:function(){this.parseFont(e.Loader.getRes(this._path),e.Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.run()}},{key:"parseFont",value:function(e,i){if(null!=e&&null!=i){this._texture=i;var n=e.getElementsByTagName("info");if(!n[0].getAttributeNode)return this.parseFont2(e,i);this.fontSize=parseInt(n[0].getAttributeNode("size").nodeValue);var r=n[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];var o=e.getElementsByTagName("char"),h=0;for(h=0;h<o.length;h++){var s=o[h],u=parseInt(s.getAttributeNode("id").nodeValue),d=parseInt(s.getAttributeNode("xoffset").nodeValue)/1,l=parseInt(s.getAttributeNode("yoffset").nodeValue)/1,p=parseInt(s.getAttributeNode("xadvance").nodeValue)/1,f=new t.Rectangle;f.x=parseInt(s.getAttributeNode("x").nodeValue),f.y=parseInt(s.getAttributeNode("y").nodeValue),f.width=parseInt(s.getAttributeNode("width").nodeValue),f.height=parseInt(s.getAttributeNode("height").nodeValue);var c=a.Texture.create(i,f.x,f.y,f.width,f.height,d,l);this._maxWidth=Math.max(this._maxWidth,p+this.letterSpacing),this._fontCharDic[u]=c,this._fontWidthMap[u]=p}}}},{key:"parseFont2",value:function(e,i){if(null!=e&&null!=i){this._texture=i;var n=e.getElementsByTagName("info");this.fontSize=parseInt(n[0].attributes.size.nodeValue);var r=n[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];var o=e.getElementsByTagName("char"),h=0;for(h=0;h<o.length;h++){var s=o[h].attributes,u=parseInt(s.id.nodeValue),d=parseInt(s.xoffset.nodeValue)/1,l=parseInt(s.yoffset.nodeValue)/1,p=parseInt(s.xadvance.nodeValue)/1,f=new t.Rectangle;f.x=parseInt(s.x.nodeValue),f.y=parseInt(s.y.nodeValue),f.width=parseInt(s.width.nodeValue),f.height=parseInt(s.height.nodeValue);var c=a.Texture.create(i,f.x,f.y,f.width,f.height,d,l);this._maxWidth=Math.max(this._maxWidth,p+this.letterSpacing),this._fontCharDic[u]=c,this._fontWidthMap[u]=p}}}},{key:"getCharTexture",value:function(t){return this._fontCharDic[t.charCodeAt(0)]}},{key:"destroy",value:function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null,this._complete=null,this._padding=null}}},{key:"setSpaceWidth",value:function(t){this._spaceWidth=t}},{key:"getCharWidth",value:function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "===t?this._spaceWidth+this.letterSpacing:0}},{key:"getTextWidth",value:function(t){for(var e=0,a=0,i=t.length;a<i;a++)e+=this.getCharWidth(t.charAt(a));return e}},{key:"getMaxWidth",value:function(){return this._maxWidth}},{key:"getMaxHeight",value:function(){return this.fontSize}},{key:"_drawText",value:function(t,e,a,i,n,r){var o,h=this.getTextWidth(t),s=0;"center"===n&&(s=(r-h)/2),"right"===n&&(s=r-h);for(var u=0,d=0,l=t.length;d<l;d++)(o=this.getCharTexture(t.charAt(d)))&&(e.graphics.drawImage(o,a+u+s,i),u+=this.getCharWidth(t.charAt(d)))}}]),r}();exports.BitmapFont=h;
},{"../maths/Rectangle":"iPyf","../net/Loader":"/MXX","../resource/Texture":"nP6w","../utils/Handler":"FZg7"}],"ip32":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Prefab=void 0;var r=function(){function n(){e(this,n)}return t(n,[{key:"create",value:function(){return this.json?window.Laya.SceneUtils.createByData(null,this.json):null}}]),n}();exports.Prefab=r;
},{}],"c9cC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Byte=void 0;var t=require("../maths/Matrix");function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function s(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}var r=function(){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e(this,i),this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this._resizeBuffer(this._allocated_)}return s(i,[{key:"_resizeBuffer",value:function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(i){throw"Invalid typed array length:"+t}}},{key:"getString",value:function(){return this.readString()}},{key:"readString",value:function(){return this._rUTF(this.getUint16())}},{key:"getFloat32Array",value:function(t,e){return this.readFloat32Array(t,e)}},{key:"readFloat32Array",value:function(t,e){var i=t+e;i=i>this._length?this._length:i;var s=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,s}},{key:"getUint8Array",value:function(t,e){return this.readUint8Array(t,e)}},{key:"readUint8Array",value:function(t,e){var i=t+e;i=i>this._length?this._length:i;var s=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,s}},{key:"getInt16Array",value:function(t,e){return this.readInt16Array(t,e)}},{key:"readInt16Array",value:function(t,e){var i=t+e;i=i>this._length?this._length:i;var s=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,s}},{key:"getFloat32",value:function(){return this.readFloat32()}},{key:"readFloat32",value:function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t}},{key:"getFloat64",value:function(){return this.readFloat64()}},{key:"readFloat64",value:function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t}},{key:"writeFloat32",value:function(t){this._ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4}},{key:"writeFloat64",value:function(t){this._ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8}},{key:"getInt32",value:function(){return this.readInt32()}},{key:"readInt32",value:function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t}},{key:"getUint32",value:function(){return this.readUint32()}},{key:"readUint32",value:function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t}},{key:"writeInt32",value:function(t){this._ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4}},{key:"writeUint32",value:function(t){this._ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4}},{key:"getInt16",value:function(){return this.readInt16()}},{key:"readInt16",value:function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t}},{key:"getUint16",value:function(){return this.readUint16()}},{key:"readUint16",value:function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t}},{key:"writeUint16",value:function(t){this._ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2}},{key:"writeInt16",value:function(t){this._ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2}},{key:"getUint8",value:function(){return this.readUint8()}},{key:"readUint8",value:function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]}},{key:"writeUint8",value:function(t){this._ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++}},{key:"_getUInt8",value:function(t){return this._readUInt8(t)}},{key:"_readUInt8",value:function(t){return this._d_.getUint8(t)}},{key:"_getUint16",value:function(t){return this._readUint16(t)}},{key:"_readUint16",value:function(t){return this._d_.getUint16(t,this._xd_)}},{key:"_getMatrix",value:function(){return this._readMatrix()}},{key:"_readMatrix",value:function(){return new t.Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())}},{key:"_rUTF",value:function(t){var e,i,s,r=this._pos_+t,_=String.fromCharCode,n=this._u8d_,h=[],o=0;for(h.length=1e3;this._pos_<r;)(e=n[this._pos_++])<128?0!=e&&(h[o++]=_(e)):e<224?h[o++]=_((63&e)<<6|127&n[this._pos_++]):e<240?(i=n[this._pos_++],h[o++]=_((31&e)<<12|(127&i)<<6|127&n[this._pos_++])):(i=n[this._pos_++],s=n[this._pos_++],h[o++]=_((15&e)<<18|(127&i)<<12|s<<6&127|127&n[this._pos_++])),0;return h.length=o,h.join("")}},{key:"getCustomString",value:function(t){return this.readCustomString(t)}},{key:"readCustomString",value:function(t){for(var e,i="",s=0,r=String.fromCharCode,_=this._u8d_;t>0;)if((e=_[this._pos_])<128)i+=r(e),this._pos_++,t--;else for(s=e-128,this._pos_++,t-=s;s>0;)e=_[this._pos_++],i+=r(_[this._pos_++]<<8|e),s--;return i}},{key:"clear",value:function(){this._pos_=0,this.length=0}},{key:"__getBuffer",value:function(){return this._d_.buffer}},{key:"writeUTFBytes",value:function(t){for(var e=0,i=(t+="").length;e<i;e++){var s=t.charCodeAt(e);s<=127?this.writeByte(s):s<=2047?(this._ensureWrite(this._pos_+2),this._u8d_.set([192|s>>6,128|63&s],this._pos_),this._pos_+=2):s<=65535?(this._ensureWrite(this._pos_+3),this._u8d_.set([224|s>>12,128|s>>6&63,128|63&s],this._pos_),this._pos_+=3):(this._ensureWrite(this._pos_+4),this._u8d_.set([240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s],this._pos_),this._pos_+=4)}}},{key:"writeUTFString",value:function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;this._d_.setUint16(e,i,this._xd_)}},{key:"readUTFString",value:function(){return this.readUTFBytes(this.getUint16())}},{key:"getUTFString",value:function(){return this.readUTFString()}},{key:"readUTFBytes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(0===t)return"";var e=this.bytesAvailable;if(t>e)throw"readUTFBytes error - Out of bounds";return t=t>0?t:e,this._rUTF(t)}},{key:"getUTFBytes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return this.readUTFBytes(t)}},{key:"writeByte",value:function(t){this._ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1}},{key:"readByte",value:function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)}},{key:"getByte",value:function(){return this.readByte()}},{key:"_ensureWrite",value:function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)}},{key:"writeArrayBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this._ensureWrite(this._pos_+i);var s=new Uint8Array(t);this._u8d_.set(s.subarray(e,e+i),this._pos_),this._pos_+=i}},{key:"readArrayBuffer",value:function(t){var e;return e=this._u8d_.buffer.slice(this._pos_,this._pos_+t),this._pos_=this._pos_+t,e}},{key:"buffer",get:function(){var t=this._d_.buffer;return t.byteLength===this._length?t:t.slice(0,this._length)}},{key:"endian",get:function(){return this._xd_?i.LITTLE_ENDIAN:i.BIG_ENDIAN},set:function(t){this._xd_=t===i.LITTLE_ENDIAN}},{key:"length",set:function(t){this._allocated_<t?this._resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this._resizeBuffer(this._allocated_=t),this._length=t},get:function(){return this._length}},{key:"pos",get:function(){return this._pos_},set:function(t){this._pos_=t}},{key:"bytesAvailable",get:function(){return this._length-this._pos_}}],[{key:"getSystemEndian",value:function(){if(!i._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,!0),i._sysEndian=256===new Int16Array(t)[0]?i.LITTLE_ENDIAN:i.BIG_ENDIAN}return i._sysEndian}}]),i}();exports.Byte=r,r.BIG_ENDIAN="bigEndian",r.LITTLE_ENDIAN="littleEndian",r._sysEndian=null;
},{"../maths/Matrix":"GG2z"}],"/MXX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Loader=void 0;var e=require("././HttpRequest"),t=require("././URL"),a=require("././WorkerLoader"),r=require("././TTFLoader"),o=require("./../display/BitmapFont"),s=require("../components/Prefab"),n=require("../display/Text"),i=require("../events/Event"),l=require("../events/EventDispatcher"),u=require("../media/SoundManager"),d=require("../resource/BaseTexture"),p=require("../resource/Texture"),h=require("../resource/Texture2D"),c=require("../utils/Browser"),f=require("../utils/Byte"),v=require("../utils/Handler"),m=require("../utils/Utils");function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,a){return t&&g(e.prototype,t),a&&g(e,a),e}function E(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A=function(R){function g(){var e;return _(this,g),(e=E(this,T(g).apply(this,arguments)))._customParse=!1,e}return x(g,l.EventDispatcher),L(g,[{key:"load",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e){if(g.setGroup(e,"666"),this._url=e,0===e.indexOf("data:image")?r=g.IMAGE:e=t.URL.formatURL(e),this._type=r||(r=g.getTypeFromUrl(this._url)),this._cache=o,this._useWorkerLoader=l,this._data=null,l&&a.WorkerLoader.enableWorkerLoader(),!n&&g.loadedMap[e])return this._data=g.loadedMap[e],this.event(i.Event.PROGRESS,1),void this.event(i.Event.COMPLETE,this._data);if(s&&g.setGroup(e,s),null!=g.parserMap[r])return this._customParse=!0,void(g.parserMap[r]instanceof v.Handler?g.parserMap[r].runWith(this):g.parserMap[r].call(null,this));switch(r){case g.IMAGE:case"htmlimage":case"nativeimage":this._loadImage(e);break;case g.SOUND:this._loadSound(e);break;case g.TTF:this._loadTTF(e);break;case g.ATLAS:case g.PREFAB:case g.PLF:this._loadHttpRequestWhat(e,g.JSON);break;case g.FONT:this._loadHttpRequestWhat(e,g.XML);break;case g.PLFB:this._loadHttpRequestWhat(e,g.BUFFER);break;default:this._loadHttpRequestWhat(e,r)}}else this.onLoaded(null)}},{key:"_loadHttpRequest",value:function(t,a,r,o,s,n,l,u){this._http||(this._http=new e.HttpRequest),this._http.on(i.Event.PROGRESS,s,n),this._http.on(i.Event.COMPLETE,r,o),this._http.on(i.Event.ERROR,l,u),this._http.send(t,null,"get",a)}},{key:"_loadHtmlImage",value:function(e,t,a,r,o){var s;function n(){var t=s;t.onload=null,t.onerror=null,delete g._imgCache[e]}(s=new c.Browser.window.Image).crossOrigin="",s.onload=function(){n(),a.call(t,s)},s.onerror=function(){n(),o.call(r)},s.src=e,g._imgCache[e]=s}},{key:"_loadHttpRequestWhat",value:function(e,t){g.preLoadedMap[e]?this.onLoaded(g.preLoadedMap[e]):this._loadHttpRequest(e,t,this,this.onLoaded,this,this.onProgress,this,this.onError)}},{key:"_loadTTF",value:function(e){e=t.URL.formatURL(e);var a=new r.TTFLoader;a.complete=v.Handler.create(this,this.onLoaded),a.load(e)}},{key:"_loadImage",value:function(e){var a,r=this;e=t.URL.formatURL(e);var o=function(){r.event(i.Event.ERROR,"Load image failed")};if("nativeimage"===this._type)a=function(e){r.onLoaded(e)},this._loadHtmlImage(e,this,a,this,o);else{var s=m.Utils.getFileExtension(e);"ktx"===s||"pvr"===s?(a=function(t){var a;switch(s){case"ktx":a=5;break;case"pvr":a=12}(t=new h.Texture2D(0,0,a,!1,!1)).wrapModeU=d.BaseTexture.WARPMODE_CLAMP,t.wrapModeV=d.BaseTexture.WARPMODE_CLAMP,t.setCompressData(this.imageData),t._setCreateURL(e),r.onLoaded(t)},this._loadHttpRequest(e,g.BUFFER,this,a,null,null,this,o)):(a=function(t){var a=new h.Texture2D(t.width,t.height,1,!1,!1);a.wrapModeU=d.BaseTexture.WARPMODE_CLAMP,a.wrapModeV=d.BaseTexture.WARPMODE_CLAMP,a.loadImageSource(t,!0),a._setCreateURL(e),r.onLoaded(this.finalImage)},this._loadHtmlImage(e,this,a,this,o))}}},{key:"_loadSound",value:function(e){var t=new u.SoundManager._soundClass,a=this;function r(){t.offAll()}t.on(i.Event.COMPLETE,this,function(){r(),a.onLoaded(t)}),t.on(i.Event.ERROR,this,function(){r(),t.dispose(),a.event(i.Event.ERROR,"Load sound failed")}),t.load(e)}},{key:"onProgress",value:function(e){this._type===g.ATLAS?this.event(i.Event.PROGRESS,.3*e):this.event(i.Event.PROGRESS,e)}},{key:"onError",value:function(e){this.event(i.Event.ERROR,e)}},{key:"onLoaded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this._type;if(a==g.PLFB)this.parsePLFBData(e),this.complete(e);else if(a==g.PLF)this.parsePLFData(e),this.complete(e);else if(a===g.IMAGE){var r=new p.Texture(e);r.url=this._url,this.complete(r)}else if(a===g.SOUND||"htmlimage"===a||"nativeimage"===a)this.complete(e);else if(a===g.ATLAS){if(!e.url&&!e._setContext){if(!this._data){if(this._data=e,e.meta&&e.meta.image){var l,u=e.meta.image.split(","),d=this._url.indexOf("/")>=0?"/":"\\",h=this._url.lastIndexOf(d),f=h>=0?this._url.substr(0,h+1):"";c.Browser.onAndroid&&e.meta.compressTextureAndroid&&(l=".ktx"),c.Browser.onIOS&&e.meta.compressTextureIOS&&(l=".pvr");for(var v=0,m=u.length;v<m;v++)u[v]=l?f+u[v].replace(".png",l):f+u[v]}else u=[this._url.replace(".json",".png")];u.reverse(),e.toLoads=u,e.pics=[]}return this.event(i.Event.PROGRESS,.3+1/u.length*.6),this._loadImage(u.pop())}if(this._data.pics.push(e),this._data.toLoads.length>0)return this.event(i.Event.PROGRESS,.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var R=this._data.frames,_=this._url.split("?")[0],L=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:_.substring(0,_.lastIndexOf("."))+"/",E=this._data.pics,y=t.URL.formatURL(this._url),T=g.atlasMap[y]||(g.atlasMap[y]=[]);T.dir=L;var x=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var M in x=parseFloat(this._data.meta.scale),R){var A,O=R[M],k=E[O.frame.idx?O.frame.idx:0],S=t.URL.formatURL(L+M);k.scaleRate=x,A=p.Texture._create(k,O.frame.x,O.frame.y,O.frame.w,O.frame.h,O.spriteSourceSize.x,O.spriteSourceSize.y,O.sourceSize.w,O.sourceSize.h,g.getRes(S)),g.cacheRes(S,A),A.url=S,T.push(S)}else for(M in R)k=E[(O=R[M]).frame.idx?O.frame.idx:0],S=t.URL.formatURL(L+M),A=p.Texture._create(k,O.frame.x,O.frame.y,O.frame.w,O.frame.h,O.spriteSourceSize.x,O.spriteSourceSize.y,O.sourceSize.w,O.sourceSize.h,g.getRes(S)),g.cacheRes(S,A),A.url=S,T.push(S);delete this._data.pics,this.complete(this._data)}else if(a===g.FONT){if(!e._source)return this._data=e,this.event(i.Event.PROGRESS,.5),this._loadImage(this._url.replace(".fnt",".png"));var w=new o.BitmapFont;w.parseFont(this._data,new p.Texture(e));var U=this._url.split(".fnt")[0].split("/"),P=U[U.length-1];n.Text.registerBitmapFont(P,w),this._data=w,this.complete(this._data)}else if(a===g.PREFAB){var b=new s.Prefab;b.json=e,this.complete(b)}else this.complete(e)}},{key:"parsePLFData",value:function(e){var a,r,o;for(a in e)switch(o=e[a],a){case"json":case"text":for(r in o)g.preLoadedMap[t.URL.formatURL(r)]=o[r];break;default:for(r in o)g.preLoadedMap[t.URL.formatURL(r)]=o[r]}}},{key:"parsePLFBData",value:function(e){var t,a,r;for(r=(t=new f.Byte(e)).getInt32(),a=0;a<r;a++)this.parseOnePLFBFile(t)}},{key:"parseOnePLFBFile",value:function(e){var a,r,o;r=e.getUTFString(),a=e.getInt32(),o=e.readArrayBuffer(a),g.preLoadedMap[t.URL.formatURL(r)]=o}},{key:"complete",value:function(e){this._data=e,this._customParse?this.event(i.Event.LOADED,e instanceof Array?[e]:e):(g._loaders.push(this),g._isWorking||g.checkNext())}},{key:"endLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this._data=e),this._cache&&g.cacheRes(this._url,this._data),this.event(i.Event.PROGRESS,1),this.event(i.Event.COMPLETE,this.data instanceof Array?[this.data]:this.data)}},{key:"url",get:function(){return this._url}},{key:"type",get:function(){return this._type}},{key:"cache",get:function(){return this._cache}},{key:"data",get:function(){return this._data}}],[{key:"getTypeFromUrl",value:function(e){var t=m.Utils.getFileExtension(e);return t?g.typeMap[t]:(console.warn("Not recognize the resources suffix",e),"text")}},{key:"checkNext",value:function(){g._isWorking=!0;for(var e=c.Browser.now();g._startIndex<g._loaders.length;)if(c.Browser.now(),g._loaders[g._startIndex].endLoad(),g._startIndex++,c.Browser.now()-e>g.maxTimeOut)return console.warn("loader callback cost a long time:"+(c.Browser.now()-e)+" url="+g._loaders[g._startIndex-1].url),void window.Laya.systemTimer.frameOnce(1,null,g.checkNext);g._loaders.length=0,g._startIndex=0,g._isWorking=!1}},{key:"clearRes",value:function(e){e=t.URL.formatURL(e);var a=g.getAtlas(e);if(a){for(var r=0,o=a.length;r<o;r++){var s=a[r],n=g.getRes(s);delete g.loadedMap[s],n&&n.destroy()}a.length=0,delete g.atlasMap[e],delete g.loadedMap[e]}else{var i=g.loadedMap[e];i&&(delete g.loadedMap[e],i instanceof p.Texture&&i.bitmap&&i.destroy())}}},{key:"clearTextureRes",value:function(e){e=t.URL.formatURL(e);var a=g.getAtlas(e);if(a&&a.length>0)a.forEach(function(e){var t=g.getRes(e);t instanceof p.Texture&&t.disposeBitmap()});else{var r=g.getRes(e);r instanceof p.Texture&&r.disposeBitmap()}}},{key:"getRes",value:function(e){return g.loadedMap[t.URL.formatURL(e)]}},{key:"getAtlas",value:function(e){return g.atlasMap[t.URL.formatURL(e)]}},{key:"cacheRes",value:function(e,a){e=t.URL.formatURL(e),null!=g.loadedMap[e]?console.warn("Resources already exist,is repeated loading:",e):g.loadedMap[e]=a}},{key:"setGroup",value:function(e,t){g.groupMap[t]||(g.groupMap[t]=[]),g.groupMap[t].push(e)}},{key:"clearResByGroup",value:function(e){if(g.groupMap[e]){var t,a=g.groupMap[e],r=a.length;for(t=0;t<r;t++)g.clearRes(a[t]);a.length=0}}}]),g}();exports.Loader=A,A.TEXT="text",A.JSON="json",A.PREFAB="prefab",A.XML="xml",A.BUFFER="arraybuffer",A.IMAGE="image",A.SOUND="sound",A.ATLAS="atlas",A.FONT="font",A.TTF="ttf",A.PLF="plf",A.PLFB="plfb",A.HIERARCHY="HIERARCHY",A.MESH="MESH",A.MATERIAL="MATERIAL",A.TEXTURE2D="TEXTURE2D",A.TEXTURECUBE="TEXTURECUBE",A.ANIMATIONCLIP="ANIMATIONCLIP",A.AVATAR="AVATAR",A.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA",A.TERRAINRES="TERRAIN",A.typeMap={ttf:"ttf",png:"image",jpg:"image",jpeg:"image",ktx:"image",pvr:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",plf:"plf",plfb:"plfb",scene:"json",ani:"json",sk:"arraybuffer"},A.parserMap={},A.maxTimeOut=100,A.groupMap={},A.loadedMap={},A.atlasMap={},A.preLoadedMap={},A._imgCache={},A._loaders=[],A._isWorking=!1,A._startIndex=0;
},{"././HttpRequest":"hGJ+","././URL":"vU/V","././WorkerLoader":"q7AZ","././TTFLoader":"YZHQ","./../display/BitmapFont":"EFl8","../components/Prefab":"ip32","../display/Text":"fW8x","../events/Event":"jK6U","../events/EventDispatcher":"IA8z","../media/SoundManager":"8e3q","../resource/BaseTexture":"M7il","../resource/Texture":"nP6w","../resource/Texture2D":"zb/G","../utils/Browser":"pOAB","../utils/Byte":"c9cC","../utils/Handler":"FZg7","../utils/Utils":"kHKw"}],"8e3q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SoundManager=void 0;var e=require("../events/Event"),n=require("./h5audio/AudioSound"),u=require("./webaudio/WebAudioSound"),o=require("../net/Loader"),i=require("../net/URL"),t=require("../utils/PlatformInfo"),l=require("../utils/Utils");function s(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function a(e,n){for(var u=0;u<n.length;u++){var o=n[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e,n,u){return n&&a(e.prototype,n),u&&a(e,u),e}var r=function(){function a(){s(this,a)}return c(a,null,[{key:"__init__",value:function(){var e=t.PlatformInfo.window,o=!!(e.AudioContext||e.webkitAudioContext||e.mozAudioContext);return o&&u.WebAudioSound.initWebAudio(),a._soundClass=o?u.WebAudioSound:n.AudioSound,n.AudioSound._initMusicAudio(),a._musicClass=n.AudioSound,o}},{key:"addChannel",value:function(e){a._channels.indexOf(e)>=0||a._channels.push(e)}},{key:"removeChannel",value:function(e){var n;for(n=a._channels.length-1;n>=0;n--)a._channels[n]==e&&a._channels.splice(n,1)}},{key:"disposeSoundLater",value:function(e){a._lastSoundUsedTimeDic[e]=t.PlatformInfo.now(),a._isCheckingDispose||(a._isCheckingDispose=!0,a.gTimer.loop(5e3,null,a._checkDisposeSound))}},{key:"_checkDisposeSound",value:function(){var e,n=t.PlatformInfo.now(),u=!1;for(e in a._lastSoundUsedTimeDic)n-a._lastSoundUsedTimeDic[e]>3e4?(delete a._lastSoundUsedTimeDic[e],a.disposeSoundIfNotUsed(e)):u=!0;u||(a._isCheckingDispose=!1,a.gTimer.clear(null,a._checkDisposeSound))}},{key:"disposeSoundIfNotUsed",value:function(e){var n;for(n=a._channels.length-1;n>=0;n--)if(a._channels[n].url==e)return;a.destroySound(e)}},{key:"_visibilityChange",value:function(){a.gStage.isVisibility?a._stageOnFocus():a._stageOnBlur()}},{key:"_stageOnBlur",value:function(){a._isActive=!1,a._musicChannel&&(a._musicChannel.isStopped||(a._blurPaused=!0,a._musicChannel.pause())),a.stopAllSound(),a.gStage.once(e.Event.MOUSE_DOWN,null,a._stageOnFocus)}},{key:"_recoverWebAudio",value:function(){u.WebAudioSound.ctx&&"running"!=u.WebAudioSound.ctx.state&&u.WebAudioSound.ctx.resume&&u.WebAudioSound.ctx.resume()}},{key:"_stageOnFocus",value:function(){a._isActive=!0,a._recoverWebAudio(),a.gStage.off(e.Event.MOUSE_DOWN,null,a._stageOnFocus),a._blurPaused&&a._musicChannel&&a._musicChannel.isStopped&&(a._blurPaused=!1,a._musicChannel.resume())}},{key:"playSound",value:function(e){var n,u,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!a._isActive||!e)return null;if(a._muted)return null;if(a._recoverWebAudio(),(e=i.URL.formatURL(e))==a._bgMusic){if(a._musicMuted)return null}else{if(t.PlatformInfo.onLayaRuntime){var _=l.Utils.getFileExtension(e);if("wav"!=_&&"ogg"!=_)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(a._soundMuted)return null}return t.PlatformInfo.onMiniGame||(n=a.gLoader.getRes(e)),r||(r=a._soundClass),n||((n=new r).load(e),t.PlatformInfo.onMiniGame||o.Loader.cacheRes(e,n)),(u=n.play(d,s))?(u.url=e,u.volume=e==a._bgMusic?a.musicVolume:a.soundVolume,u.completeHandler=c,u):null}},{key:"destroySound",value:function(e){var n=a.gLoader.getRes(e);n&&(o.Loader.clearRes(e),n.dispose())}},{key:"playMusic",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e=i.URL.formatURL(e),a._bgMusic=e,a._musicChannel&&a._musicChannel.stop(),a._musicChannel=a.playSound(e,n,u,a._musicClass,o)}},{key:"stopSound",value:function(e){var n,u;for(e=i.URL.formatURL(e),n=a._channels.length-1;n>=0;n--)(u=a._channels[n]).url==e&&u.stop()}},{key:"stopAll",value:function(){var e;for(a._bgMusic=null,e=a._channels.length-1;e>=0;e--)a._channels[e].stop()}},{key:"stopAllSound",value:function(){var e,n;for(e=a._channels.length-1;e>=0;e--)(n=a._channels[e]).url!=a._bgMusic&&n.stop()}},{key:"stopMusic",value:function(){a._musicChannel&&a._musicChannel.stop(),a._bgMusic=null}},{key:"setSoundVolume",value:function(e){var n,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(o)o=i.URL.formatURL(o),a._setVolume(o,e);else for(a.soundVolume=e,n=a._channels.length-1;n>=0;n--)(u=a._channels[n]).url!=a._bgMusic&&(u.volume=e)}},{key:"setMusicVolume",value:function(e){a.musicVolume=e,a._setVolume(a._bgMusic,e)}},{key:"_setVolume",value:function(e,n){var u,o;for(e=i.URL.formatURL(e),u=a._channels.length-1;u>=0;u--)(o=a._channels[u]).url==e&&(o.volume=n)}},{key:"autoStopMusic",set:function(n){a.gStage.off(e.Event.BLUR,null,a._stageOnBlur),a.gStage.off(e.Event.FOCUS,null,a._stageOnFocus),a.gStage.off(e.Event.VISIBILITY_CHANGE,null,a._visibilityChange),a._autoStopMusic=n,n&&(a.gStage.on(e.Event.BLUR,null,a._stageOnBlur),a.gStage.on(e.Event.FOCUS,null,a._stageOnFocus),a.gStage.on(e.Event.VISIBILITY_CHANGE,null,a._visibilityChange))},get:function(){return a._autoStopMusic}},{key:"muted",set:function(e){e!=a._muted&&(e&&a.stopAllSound(),a.musicMuted=e,a._muted=e)},get:function(){return a._muted}},{key:"soundMuted",set:function(e){a._soundMuted=e},get:function(){return a._soundMuted}},{key:"musicMuted",set:function(e){e!=a._musicMuted&&(e?(a._bgMusic&&a._musicChannel&&!a._musicChannel.isStopped?t.PlatformInfo.onLayaRuntime?a._musicChannel._audio&&(a._musicChannel._audio.muted=!0):a._musicChannel.pause():a._musicChannel=null,a._musicMuted=e):(a._musicMuted=e,a._bgMusic&&a._musicChannel&&(t.PlatformInfo.onLayaRuntime?a._musicChannel._audio&&(a._musicChannel._audio.muted=!1):a._musicChannel.resume())))},get:function(){return a._musicMuted}},{key:"useAudioMusic",get:function(){return a._useAudioMusic},set:function(e){a._useAudioMusic=e,a._musicClass=e?n.AudioSound:null}}]),a}();exports.SoundManager=r,r.gStage=null,r.gTimer=null,r.gLoader=null,r.musicVolume=1,r.soundVolume=1,r.playbackRate=1,r._useAudioMusic=!0,r._muted=!1,r._soundMuted=!1,r._musicMuted=!1,r._bgMusic=null,r._musicChannel=null,r._channels=[],r._blurPaused=!1,r._isActive=!0,r._lastSoundUsedTimeDic={},r._isCheckingDispose=!1,r.autoReleaseSound=!0;
},{"../events/Event":"jK6U","./h5audio/AudioSound":"iHsV","./webaudio/WebAudioSound":"0TdE","../net/Loader":"/MXX","../net/URL":"vU/V","../utils/PlatformInfo":"HmZQ","../utils/Utils":"kHKw"}],"Eah7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AtlasInfoManager=void 0;var e=require("././Loader"),n=require("../utils/Handler");function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var a=0;a<n.length;a++){var r=n[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,n,a){return n&&r(e.prototype,n),a&&r(e,a),e}var t=function(){function r(){a(this,r)}return o(r,null,[{key:"enable",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;window.Laya.loader.load(a,n.Handler.create(null,r._onInfoLoaded,[o]),null,e.Loader.JSON)}},{key:"_onInfoLoaded",value:function(e,n){var a,o,t,l,i;for(a in n)for(o=(t=n[a])[0],i=(t=t[1]).length,l=0;l<i;l++)r._fileLoadDic[o+t[l]]=a;e&&e.run()}},{key:"getFileLoadPath",value:function(e){return r._fileLoadDic[e]||e}}]),r}();exports.AtlasInfoManager=t,t._fileLoadDic={};
},{"././Loader":"/MXX","../utils/Handler":"FZg7"}],"rah/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LoaderManager=void 0;var e=require("././AtlasInfoManager"),t=require("../events/Event"),r=require("../events/EventDispatcher"),n=require("./Loader"),o=require("../resource/Resource"),a=require("../utils/Handler"),l=require("../utils/Utils");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(i){function u(){var e;s(this,u),(e=c(this,d(u).call(this))).retryNum=1,e.retryDelay=0,e.maxLoader=5,e._loaders=[],e._loaderCount=0,e._resInfos=[],e._infoPool=[],e._maxPriority=5,e._failRes={},e._statInfo={count:1,loaded:1};for(var t=0;t<e._maxPriority;t++)e._resInfos[t]=[];return e}return f(u,r.EventDispatcher),h(u,[{key:"getProgress",value:function(){return this._statInfo.loaded/this._statInfo.count}},{key:"resetProgress",value:function(){this._statInfo.count=this._statInfo.loaded=1}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,i=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];this._create(e,!0,t,r,n,o,a,l,i)}},{key:"_create",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(e instanceof Array){var h=!0,c=e,v=c.length,d=0;if(n)var f=a.Handler.create(n.caller,n.method,n.args,!1);for(var g=0;g<v;g++){var _=c[g];_ instanceof String&&(_=c[g]={url:_}),_.progress=0}for(g=0;g<v;g++){_=c[g];var y=n?a.Handler.create(null,function(e,t){e.progress=t;for(var r=0,n=0;n<v;n++){r+=c[n].progress}var o=r/v;f.runWith(o)},[_],!1):null,p=n||r?a.Handler.create(null,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;d++,e.progress=1,t||(h=!1),d===v&&r&&r.runWith(h)},[_]):null;this._createOne(_.url,t,p,y,_.type||o,_.constructParams||l,_.propertyParams||i,_.priority||s,u)}}else this._createOne(e,t,r,n,o,l,i,s,u)}},{key:"_createOne",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,d=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],f=this.getRes(e);if(f)!t&&f instanceof o.Resource&&f._addReference(),i&&i.runWith(1),r&&r.runWith(f);else{var g=l.Utils.getFileExtension(e);if(s||(s=u.createMap[g]?u.createMap[g][0]:null),!s)return void this.load(e,r,i,s,v,d);if(!n.Loader.parserMap[s])return void this.load(e,r,i,s,v,d);this._createLoad(e,a.Handler.create(null,function(n){n&&(!t&&n instanceof o.Resource&&n._addReference(),n._setCreateURL(e)),r&&r.runWith(n),u.gLoader.event(e)}),i,s,h,c,v,d,!0)}}},{key:"load",value:function(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(r instanceof Array)return this._loadAssets(r,o,a,l,i,s,h);var d=n.Loader.getRes(r);if(c||null==d){var f;f=r,(r=e.AtlasInfoManager.getFileLoadPath(r))!=f&&"nativeimage"!==l?l=n.Loader.ATLAS:f=null;var g=u._resMap[r];g?(o&&(f?o&&g._createListener(t.Event.COMPLETE,this,this._resInfoLoaded,[f,o],!1,!1):o&&g._createListener(t.Event.COMPLETE,o.caller,o.method,o.args,!1,!1)),a&&g._createListener(t.Event.PROGRESS,a.caller,a.method,a.args,!1,!1)):((g=this._infoPool.length?this._infoPool.pop():new y).url=r,g.type=l,g.cache=s,g.group=h,g.ignoreCache=c,g.useWorkerLoader=v,g.originalUrl=f,o&&g.on(t.Event.COMPLETE,o.caller,o.method,o.args),a&&g.on(t.Event.PROGRESS,a.caller,a.method,a.args),u._resMap[r]=g,i=i<this._maxPriority?i:this._maxPriority-1,this._resInfos[i].push(g),this._statInfo.count++,this.event(t.Event.PROGRESS,this.getProgress()),this._next())}else u.gSysTimer.frameOnce(1,null,function(){a&&a.runWith(1),o&&o.runWith(d instanceof Array?[d]:d),this._loaderCount||this.event(t.Event.COMPLETE)});return this}},{key:"_resInfoLoaded",value:function(e,t){t.runWith(n.Loader.getRes(e))}},{key:"_createLoad",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(e instanceof Array)return this._loadAssets(e,r,o,a,s,h);var v=n.Loader.getRes(e);if(null!=v)u.gSysTimer.frameOnce(1,null,function(){o&&o.runWith(1),r&&r.runWith(v),this._loaderCount||this.event(t.Event.COMPLETE)});else{var d=u._resMap[e];d?(r&&d._createListener(t.Event.COMPLETE,r.caller,r.method,r.args,!1,!1),o&&d._createListener(t.Event.PROGRESS,o.caller,o.method,o.args,!1,!1)):((d=this._infoPool.length?this._infoPool.pop():new y).url=e,d.type=a,d.cache=!1,d.ignoreCache=c,d.originalUrl=null,d.createCache=h,d.createConstructParams=l,d.createPropertyParams=i,r&&d.on(t.Event.COMPLETE,r.caller,r.method,r.args),o&&d.on(t.Event.PROGRESS,o.caller,o.method,o.args),u._resMap[e]=d,s=s<this._maxPriority?s:this._maxPriority-1,this._resInfos[s].push(d),this._statInfo.count++,this.event(t.Event.PROGRESS,this.getProgress()),this._next())}return this}},{key:"_next",value:function(){if(!(this._loaderCount>=this.maxLoader)){for(var e=0;e<this._maxPriority;e++)for(var r=this._resInfos[e];r.length>0;){var n=r.shift();if(n)return this._doLoad(n)}this._loaderCount||this.event(t.Event.COMPLETE)}}},{key:"_doLoad",value:function(e){this._loaderCount++;var r=this._loaders.length?this._loaders.pop():new n.Loader;r.on(t.Event.COMPLETE,null,a),r.on(t.Event.PROGRESS,null,function(r){e.event(t.Event.PROGRESS,r)}),r.on(t.Event.ERROR,null,function(e){a(null)});var o=this;function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r.offAll(),r._data=null,r._customParse=!1,o._loaders.push(r),o._endLoad(e,t instanceof Array?[t]:t),o._loaderCount--,o._next()}r._constructParams=e.createConstructParams,r._propertyParams=e.createPropertyParams,r._createCache=e.createCache,r.load(e.url,e.type,e.cache,e.group,e.ignoreCache,e.useWorkerLoader)}},{key:"_endLoad",value:function(e,r){var o=e.url;if(null==r){var a=this._failRes[o]||0;if(a<this.retryNum)return console.warn("[warn]Retry to load:",o),this._failRes[o]=a+1,void u.gSysTimer.once(this.retryDelay,this,this._addReTry,[e],!1);n.Loader.clearRes(o),console.warn("[error]Failed to load:",o),this.event(t.Event.ERROR,o)}this._failRes[o]&&(this._failRes[o]=0),delete u._resMap[o],e.originalUrl&&(r=n.Loader.getRes(e.originalUrl)),e.event(t.Event.COMPLETE,r),e.offAll(),this._infoPool.push(e),this._statInfo.loaded++,this.event(t.Event.PROGRESS,this.getProgress())}},{key:"_addReTry",value:function(e){this._resInfos[this._maxPriority-1].push(e),this._next()}},{key:"clearRes",value:function(e){n.Loader.clearRes(e)}},{key:"clearTextureRes",value:function(e){n.Loader.clearTextureRes(e)}},{key:"getRes",value:function(e){return n.Loader.getRes(e)}},{key:"cacheRes",value:function(e,t){n.Loader.cacheRes(e,t)}},{key:"setGroup",value:function(e,t){n.Loader.setGroup(e,t)}},{key:"clearResByGroup",value:function(e){n.Loader.clearResByGroup(e)}},{key:"clearUnLoaded",value:function(){for(var e=0;e<this._maxPriority;e++){for(var t=this._resInfos[e],r=t.length-1;r>-1;r--){var n=t[r];n&&(n.offAll(),this._infoPool.push(n))}t.length=0}this._loaderCount=0,u._resMap={}}},{key:"cancelLoadByUrls",value:function(e){if(e)for(var t=0,r=e.length;t<r;t++)this.cancelLoadByUrl(e[t])}},{key:"cancelLoadByUrl",value:function(e){for(var t=0;t<this._maxPriority;t++)for(var r=this._resInfos[t],n=r.length-1;n>-1;n--){var o=r[n];o&&o.url===e&&(r[n]=null,o.offAll(),this._infoPool.push(o))}u._resMap[e]&&delete u._resMap[e]}},{key:"_loadAssets",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=e.length,u=0,h=0,c=[],v=!0,d=0;d<s;d++){var f=e[d];f instanceof String&&(f={url:f,type:n,size:1,priority:o}),f.size||(f.size=1),f.progress=0,h+=f.size,c.push(f);var g=r?a.Handler.create(null,p,[f],!1):null,_=t||r?a.Handler.create(null,y,[f]):null;this.load(f.url,_,g,f.type,f.priority||1,l,f.group||i,!1,f.useWorkerLoader)}function y(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;u++,e.progress=1,r||(v=!1),u===s&&t&&t.runWith(v)}function p(e,t){if(null!=r){e.progress=t;for(var n=0,o=0;o<c.length;o++){var a=c[o];n+=a.size*a.progress}var l=n/h;r.runWith(l)}}return this}},{key:"decodeBitmaps",value:function(e){}},{key:"_decodeTexture",value:function(e,t){var r=e.bitmap;if(e&&r){var n=r.source||r.image;if(n&&n instanceof HTMLImageElement){t.drawImage(n,0,0,1,1);t.getImageData(0,0,1,1)}}}}],[{key:"cacheRes",value:function(e,t){n.Loader.cacheRes(e,t)}}]),u}();exports.LoaderManager=_,_.gLoader=null,_.gSysTimer=null,_._resMap={},_.createMap={atlas:[null,n.Loader.ATLAS]};var y=function(e){function t(){return s(this,t),c(this,d(t).apply(this,arguments))}return f(t,r.EventDispatcher),t}();
},{"././AtlasInfoManager":"Eah7","../events/Event":"jK6U","../events/EventDispatcher":"IA8z","./Loader":"/MXX","../resource/Resource":"M+wd","../utils/Handler":"FZg7","../utils/Utils":"kHKw"}],"PbXW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WeakObject=void 0;var e=require("././Browser"),t=require("././Utils");function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var i=!!WeakMap,o=function(){function r(){n(this,r),this._obj=r.supportWeakMap?new e.Browser.window.WeakMap:{},r.supportWeakMap||r._maps.push(this)}return a(r,[{key:"set",value:function(e,n){if(null!=e)if(r.supportWeakMap){var a=e;(e instanceof String||e instanceof Number)&&((a=r._keys[e])||(a=r._keys[e]={k:e})),this._obj.set(a,n)}else e instanceof String||e instanceof Number?this._obj[e]=n:(e.$_GID||(e.$_GID=t.Utils.getGID()),this._obj[e.$_GID]=n)}},{key:"get",value:function(e){if(null==e)return null;if(r.supportWeakMap){var t=e instanceof String||e instanceof Number?r._keys[e]:e;return t?this._obj.get(t):null}return e instanceof String||e instanceof Number?this._obj[e]:this._obj[e.$_GID]}},{key:"del",value:function(e){if(null!=e)if(r.supportWeakMap){var t=e instanceof String||e instanceof Number?r._keys[e]:e;if(!t)return;this._obj.delete(t)}else e instanceof String||e instanceof Number?delete this._obj[e]:delete this._obj[this._obj.$_GID]}},{key:"has",value:function(e){if(null==e)return!1;if(r.supportWeakMap){var t=e instanceof String||e instanceof Number?r._keys[e]:e;return this._obj.has(t)}return e instanceof String||e instanceof Number?null!=this._obj[e]:null!=this._obj[this._obj.$_GID]}}],[{key:"__init__",value:function(){r.supportWeakMap||window.Laya.systemTimer.loop(r.delInterval,null,r.clearCache)}},{key:"clearCache",value:function(){for(var e=0,t=r._maps.length;e<t;e++){r._maps[e]._obj={}}}}]),r}();exports.WeakObject=o,o.supportWeakMap=i,o.delInterval=6e5,o.I=new o,o._keys={},o._maps=[];
},{"././Browser":"pOAB","././Utils":"kHKw"}],"+KpL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayaGLRunner=void 0;var e=require("./LayaGL");function a(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function r(e,a){for(var r=0;r<a.length;r++){var n=a[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,a,n){return a&&r(e.prototype,a),n&&r(e,n),e}var t=function(){function r(){a(this,r)}return n(r,null,[{key:"uploadShaderUniforms",value:function(e,a,r,n){for(var t=r._data,u=a.getArrayData(),o=0,l=0,i=u.length;l<i;l++){var f=u[l];if(n||-1!==f.textureID){var c=t[f.dataOffset];null!=c&&(o+=f.fun.call(f.caller,f,c))}}return o}},{key:"uploadCustomUniform",value:function(e,a,r,n){var t=0,u=a[r];return u&&null!=n&&(t+=u.fun.call(u.caller,u,n)),t}},{key:"uploadShaderUniformsForNative",value:function(a,r,n){var t=e.LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_ID;n._runtimeCopyValues.length>0&&(t=e.LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_DATA);var u=n._data;return a.uploadShaderUniforms(r,u,t)}}]),r}();exports.LayaGLRunner=t;
},{"./LayaGL":"ezDE"}],"qqcC":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var s=0;s<t.length;s++){var o=t[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,s,o){return s&&t(e.prototype,s),o&&t(e,o),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalStorage=void 0;var o=function(){function t(){e(this,t)}return s(t,null,[{key:"__init__",value:function(){return t._baseClass||(t._baseClass=a,a.init()),a.items,t.items=t._baseClass.items,t.support=t._baseClass.support,t.support}},{key:"setItem",value:function(e,s){t._baseClass.setItem(e,s)}},{key:"getItem",value:function(e){return t._baseClass.getItem(e)}},{key:"setJSON",value:function(e,s){t._baseClass.setJSON(e,s)}},{key:"getJSON",value:function(e){return t._baseClass.getJSON(e)}},{key:"removeItem",value:function(e){t._baseClass.removeItem(e)}},{key:"clear",value:function(){t._baseClass.clear()}}]),t}();exports.LocalStorage=o,o.support=!1;var a=function(){function t(){e(this,t)}return s(t,null,[{key:"init",value:function(){try{t.support=!0,t.items=window.localStorage,t.setItem("laya","1"),t.removeItem("laya")}catch(e){t.support=!1}t.support||console.log("LocalStorage is not supprot or browser is private mode.")}},{key:"setItem",value:function(e,s){try{t.support&&t.items.setItem(e,s)}catch(o){console.warn("set localStorage failed",o)}}},{key:"getItem",value:function(e){return t.support?t.items.getItem(e):null}},{key:"setJSON",value:function(e,s){try{t.support&&t.items.setItem(e,JSON.stringify(s))}catch(o){console.warn("set localStorage failed",o)}}},{key:"getJSON",value:function(e){return JSON.parse(t.support?t.items.getItem(e):null)}},{key:"removeItem",value:function(e){t.support&&t.items.removeItem(e)}},{key:"clear",value:function(){t.support&&t.items.clear()}}]),t}();a.support=!1;
},{}],"4SqU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tween=void 0;var e=require("././Pool"),t=require("././Browser"),i=require("././Utils");function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}var n=function(){function s(){r(this,s),this.gid=0,this.repeat=1,this._count=0}return a(s,[{key:"to",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return this._create(e,t,i,r,s,a,n,!0,!1,!0)}},{key:"from",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return this._create(e,t,i,r,s,a,n,!1,!1,!0)}},{key:"_create",value:function(e,r,a,n,o,l,h,u,_,c){if(!e)throw new Error("Tween:target is null");this._target=e,this._duration=a,this._ease=n||r.ease||s.easeNone,this._complete=o||r.complete,this._delay=l,this._props=[],this._usedTimer=0,this._startTimer=t.Browser.now(),this._usedPool=_,this._delayParam=null,this.update=r.update;var v=e.$_GID||(e.$_GID=i.Utils.getGID());return s.tweenMap[v]?(h&&s.clearTween(e),s.tweenMap[v].push(this)):s.tweenMap[v]=[this],c?l<=0?this.firstStart(e,r,u):(this._delayParam=[e,r,u],s.gTimer.once(l,this,this.firstStart,this._delayParam)):this._initProps(e,r,u),this}},{key:"firstStart",value:function(e,t,i){this._delayParam=null,e.destroyed?this.clear():(this._initProps(e,t,i),this._beginLoop())}},{key:"_initProps",value:function(e,t,i){for(var r in t)if(e[r]instanceof Number){var s=i?e[r]:t[r],a=i?t[r]:e[r];this._props.push([r,s,a-s]),i||(e[r]=s)}}},{key:"_beginLoop",value:function(){s.gTimer.frameLoop(1,this,this._doEase)}},{key:"_doEase",value:function(){this._updateEase(t.Browser.now())}},{key:"_updateEase",value:function(e){var t=this._target;if(t){if(t.destroyed)return s.clearTween(t);var i=this._usedTimer=e-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();for(var r,a=i>0?this._ease(i,0,1,this._duration):0,n=this._props,o=n.length;r<o;r++){var l=n[r];t[l[0]]=l[1]+a*l[2]}this.update&&this.update.run()}}}},{key:"complete",value:function(){if(this._target){s.gTimer.runTimer(this,this.firstStart);for(var e,t=this._target,i=this._props,r=this._complete,a=i.length;e<a;e++){var n=i[e];t[n[0]]=n[1]+n[2]}this.update&&this.update.run(),this._count++,0!=this.repeat&&this._count>=this.repeat?(this.clear(),r&&r.run()):this.restart()}}},{key:"pause",value:function(){var e;s.gTimer.clear(this,this._beginLoop),s.gTimer.clear(this,this._doEase),s.gTimer.clear(this,this.firstStart),(e=t.Browser.now()-this._startTimer-this._delay)<0&&(this._usedTimer=e)}},{key:"setStartTime",value:function(e){this._startTimer=e}},{key:"clear",value:function(){this._target&&(this._remove(),this._clear())}},{key:"_clear",value:function(){this.pause(),s.gTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,e.Pool.recover("tween",this))}},{key:"recover",value:function(){this._usedPool=!0,this._clear()}},{key:"_remove",value:function(){var e=s.tweenMap[this._target.$_GID];if(e)for(var t,i=e.length;t<i;t++)if(e[t]===this){e.splice(t,1);break}}},{key:"restart",value:function(){if(this.pause(),this._usedTimer=0,this._startTimer=t.Browser.now(),this._delayParam)s.gTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var e,i=this._props,r=i.length;e<r;e++){var a=i[e];this._target[a[0]]=a[1]}s.gTimer.once(this._delay,this,this._beginLoop)}}},{key:"resume",value:function(){this._usedTimer>=this._duration||(this._startTimer=t.Browser.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?s.gTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())}},{key:"progress",set:function(e){var i=e*this._duration;this._startTimer=t.Browser.now()-this._delay-i}}],[{key:"to",value:function(t,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];return e.Pool.getItemByClass("tween",s)._create(t,i,r,a,n,o,l,!0,h,!0)}},{key:"from",value:function(t,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];return e.Pool.getItemByClass("tween",s)._create(t,i,r,a,n,o,l,!1,h,!0)}},{key:"clearAll",value:function(e){if(e&&e.$_GID){var t=s.tweenMap[e.$_GID];if(t){for(var i,r=t.length;i<r;i++)t[i]._clear();t.length=0}}}},{key:"clear",value:function(e){e.clear()}},{key:"clearTween",value:function(e){s.clearAll(e)}},{key:"easeNone",value:function(e,t,i,r){return i*e/r+t}}]),s}();exports.Tween=n,n.gTimer=null,n.tweenMap=[];
},{"././Pool":"Jkpb","././Browser":"pOAB","././Utils":"kHKw"}],"vih1":[function(require,module,exports) {
"use strict";function n(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function t(n,t){for(var e=0;e<t.length;e++){var u=t[e];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(n,u.key,u)}}function e(n,e,u){return e&&t(n.prototype,e),u&&t(n,u),n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Ease=void 0;var u=function(){function t(){n(this,t)}return e(t,null,[{key:"linearNone",value:function(n,t,e,u){return e*n/u+t}},{key:"linearIn",value:function(n,t,e,u){return e*n/u+t}},{key:"linearInOut",value:function(n,t,e,u){return e*n/u+t}},{key:"linearOut",value:function(n,t,e,u){return e*n/u+t}},{key:"bounceIn",value:function(n,e,u,r){return u-t.bounceOut(r-n,0,u,r)+e}},{key:"bounceInOut",value:function(n,e,u,r){return n<.5*r?.5*t.bounceIn(2*n,0,u,r)+e:.5*t.bounceOut(2*n-r,0,u,r)+.5*u+e}},{key:"bounceOut",value:function(n,t,e,u){return(n/=u)<1/2.75?e*(7.5625*n*n)+t:n<2/2.75?e*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?e*(7.5625*(n-=2.25/2.75)*n+.9375)+t:e*(7.5625*(n-=2.625/2.75)*n+.984375)+t}},{key:"backIn",value:function(n,t,e,u){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return e*(n/=u)*n*((r+1)*n-r)+t}},{key:"backInOut",value:function(n,t,e,u){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(n/=.5*u)<1?.5*e*(n*n*((1+(r*=1.525))*n-r))+t:e/2*((n-=2)*n*((1+(r*=1.525))*n+r)+2)+t}},{key:"backOut",value:function(n,t,e,u){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return e*((n=n/u-1)*n*((r+1)*n+r)+1)+t}},{key:"elasticIn",value:function(n,e,u,r){var a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return 0==n?e:1==(n/=r)?e+u:(i||(i=.3*r),!o||u>0&&o<u||u<0&&o<-u?(o=u,a=i/4):a=i/t.PI2*Math.asin(u/o),-o*Math.pow(2,10*(n-=1))*Math.sin((n*r-a)*t.PI2/i)+e)}},{key:"elasticInOut",value:function(n,e,u,r){var a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return 0==n?e:2==(n/=.5*r)?e+u:(i||(i=r*(.3*1.5)),!o||u>0&&o<u||u<0&&o<-u?(o=u,a=i/4):a=i/t.PI2*Math.asin(u/o),n<1?o*Math.pow(2,10*(n-=1))*Math.sin((n*r-a)*t.PI2/i)*-.5+e:o*Math.pow(2,-10*(n-=1))*Math.sin((n*r-a)*t.PI2/i)*.5+u+e)}},{key:"elasticOut",value:function(n,e,u,r){var a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return 0==n?e:1==(n/=r)?e+u:(i||(i=.3*r),!o||u>0&&o<u||u<0&&o<-u?(o=u,a=i/4):a=i/t.PI2*Math.asin(u/o),o*Math.pow(2,-10*n)*Math.sin((n*r-a)*t.PI2/i)+u+e)}},{key:"strongIn",value:function(n,t,e,u){return e*(n/=u)*n*n*n*n+t}},{key:"strongInOut",value:function(n,t,e,u){return(n/=.5*u)<1?.5*e*n*n*n*n*n+t:.5*e*((n-=2)*n*n*n*n+2)+t}},{key:"strongOut",value:function(n,t,e,u){return e*((n=n/u-1)*n*n*n*n+1)+t}},{key:"sineInOut",value:function(n,t,e,u){return.5*-e*(Math.cos(Math.PI*n/u)-1)+t}},{key:"sineIn",value:function(n,e,u,r){return-u*Math.cos(n/r*t.HALF_PI)+u+e}},{key:"sineOut",value:function(n,e,u,r){return u*Math.sin(n/r*t.HALF_PI)+e}},{key:"quintIn",value:function(n,t,e,u){return e*(n/=u)*n*n*n*n+t}},{key:"quintInOut",value:function(n,t,e,u){return(n/=.5*u)<1?.5*e*n*n*n*n*n+t:.5*e*((n-=2)*n*n*n*n+2)+t}},{key:"quintOut",value:function(n,t,e,u){return e*((n=n/u-1)*n*n*n*n+1)+t}},{key:"quartIn",value:function(n,t,e,u){return e*(n/=u)*n*n*n+t}},{key:"quartInOut",value:function(n,t,e,u){return(n/=.5*u)<1?.5*e*n*n*n*n+t:.5*-e*((n-=2)*n*n*n-2)+t}},{key:"quartOut",value:function(n,t,e,u){return-e*((n=n/u-1)*n*n*n-1)+t}},{key:"cubicIn",value:function(n,t,e,u){return e*(n/=u)*n*n+t}},{key:"cubicInOut",value:function(n,t,e,u){return(n/=.5*u)<1?.5*e*n*n*n+t:.5*e*((n-=2)*n*n+2)+t}},{key:"cubicOut",value:function(n,t,e,u){return e*((n=n/u-1)*n*n+1)+t}},{key:"quadIn",value:function(n,t,e,u){return e*(n/=u)*n+t}},{key:"quadInOut",value:function(n,t,e,u){return(n/=.5*u)<1?.5*e*n*n+t:.5*-e*(--n*(n-2)-1)+t}},{key:"quadOut",value:function(n,t,e,u){return-e*(n/=u)*(n-2)+t}},{key:"expoIn",value:function(n,t,e,u){return 0==n?t:e*Math.pow(2,10*(n/u-1))+t-.001*e}},{key:"expoInOut",value:function(n,t,e,u){return 0==n?t:n==u?t+e:(n/=.5*u)<1?.5*e*Math.pow(2,10*(n-1))+t:.5*e*(2-Math.pow(2,-10*--n))+t}},{key:"expoOut",value:function(n,t,e,u){return n==u?t+e:e*(1-Math.pow(2,-10*n/u))+t}},{key:"circIn",value:function(n,t,e,u){return-e*(Math.sqrt(1-(n/=u)*n)-1)+t}},{key:"circInOut",value:function(n,t,e,u){return(n/=.5*u)<1?.5*-e*(Math.sqrt(1-n*n)-1)+t:.5*e*(Math.sqrt(1-(n-=2)*n)+1)+t}},{key:"circOut",value:function(n,t,e,u){return e*Math.sqrt(1-(n=n/u-1)*n)+t}}]),t}();exports.Ease=u,u.HALF_PI=.5*Math.PI,u.PI2=2*Math.PI;
},{}],"hmHh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dragging=void 0;var t=require("././Tween"),e=require("././Ease"),s=require("././Handler"),i=require("../events/Event"),a=require("../events/MouseManager");function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e,s){return e&&r(t.prototype,e),s&&r(t,s),t}var o=function(){function r(){h(this,r),this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}return n(r,[{key:"start",value:function(t,e,s,a,h,n,o){var f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.92;this.clearTimer(),this.target=t,this.area=e,this.hasInertia=s,this.elasticDistance=e?a:0,this.elasticBackTime=h,this.data=n,this._disableMouseEvent=o,this.ratio=f,this._parent=t.parent,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,r.gStage.on(i.Event.MOUSE_UP,this,this.onStageMouseUp),r.gStage.on(i.Event.MOUSE_OUT,this,this.onStageMouseUp),r.gSysTimer.frameLoop(1,this,this.loop)}},{key:"clearTimer",value:function(){r.gSysTimer.clear(this,this.loop),r.gSysTimer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)}},{key:"stop",value:function(){this._dragging&&(a.MouseManager.instance.disableMouseEvent=!1,r.gStage.off(i.Event.MOUSE_UP,this,this.onStageMouseUp),r.gStage.off(i.Event.MOUSE_OUT,this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())}},{key:"loop",value:function(){var t=this._parent.getMousePoint(),e=t.x,s=t.y,h=e-this._lastX,n=s-this._lastY;if(this._clickOnly){if(!(Math.abs(h*r.gStage._canvasTransform.getScaleX())>1||Math.abs(n*r.gStage._canvasTransform.getScaleY())>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event(i.Event.DRAG_START,this.data),a.MouseManager.instance.disableMouseEvent=this._disableMouseEvent}else this._offsets.push(h,n);0===h&&0===n||(this._lastX=e,this._lastY=s,this.target.x+=h*this._elasticRateX,this.target.y+=n*this._elasticRateY,this.area&&this.checkArea(),this.target.event(i.Event.DRAG_MOVE,this.data))}},{key:"checkArea",value:function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target._x<this.area.x)var t=this.area.x-this.target._x;else t=this.target._x>this.area.x+this.area.width?this.target._x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target._y<this.area.y)var e=this.area.y-this.target.y;else e=this.target._y>this.area.y+this.area.height?this.target._y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}}},{key:"backToArea",value:function(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)}},{key:"onStageMouseUp",value:function(t){if(a.MouseManager.instance.disableMouseEvent=!1,r.gStage.off(i.Event.MOUSE_UP,this,this.onStageMouseUp),r.gStage.off(i.Event.MOUSE_OUT,this,this.onStageMouseUp),r.gSysTimer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,s=Math.min(e,6),h=this._offsets.length-s,n=e-1;n>h;n--)this._offsetY+=this._offsets[n--],this._offsetX+=this._offsets[n];this._offsetX=this._offsetX/s*2,this._offsetY=this._offsetY/s*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset),r.gSysTimer.frameLoop(1,this,this.tweenMove)}else this.elasticDistance>0?this.checkElastic():this.clear()}},{key:"checkElastic",value:function(){var i=NaN,a=NaN;if(this.target.x<this.area.x?i=this.area.x:this.target._x>this.area.x+this.area.width&&(i=this.area.x+this.area.width),this.target.y<this.area.y?a=this.area.y:this.target._y>this.area.y+this.area.height&&(a=this.area.y+this.area.height),isNaN(i)&&isNaN(a))this.clear();else{var h={};isNaN(i)||(h.x=i),isNaN(a)||(h.y=a),this._tween=t.Tween.to(this.target,h,this.elasticBackTime,e.Ease.sineOut,s.Handler.create(this,this.clear),0,!1,!1)}}},{key:"tweenMove",value:function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event(i.Event.DRAG_MOVE,this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(r.gSysTimer.clear(this,this.tweenMove),this.elasticDistance>0?this.checkElastic():this.clear())}},{key:"clear",value:function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event(i.Event.DRAG_END,this.data)}}}]),r}();exports.Dragging=o,o.gStage=null,o.gSysTimer=null;
},{"././Tween":"4SqU","././Ease":"vih1","././Handler":"FZg7","../events/Event":"jK6U","../events/MouseManager":"0uUh"}],"ByT8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Component=void 0;var e=require("../utils/Pool"),n=require("../utils/UtilsBase");function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}var s=function(){function i(){t(this,i),this._id=n.UtilsBase.getGID(),this._resetComp()}return o(i,[{key:"_isScript",value:function(){return!1}},{key:"_resetComp",value:function(){this._indexInList=-1,this._enabled=!0,this._awaked=!1,this.owner=null}},{key:"_getIndexInList",value:function(){return this._indexInList}},{key:"_setIndexInList",value:function(e){this._indexInList=e}},{key:"_onAdded",value:function(){}},{key:"_onAwake",value:function(){}},{key:"_onEnable",value:function(){}},{key:"_onDisable",value:function(){}},{key:"_onEnableInScene",value:function(){}},{key:"_onDisableInScene",value:function(){}},{key:"_onDestroy",value:function(){}},{key:"onReset",value:function(){}},{key:"_parse",value:function(e){}},{key:"_cloneTo",value:function(e){}},{key:"_setActive",value:function(e){e?(this._awaked||(this._awaked=!0,this._onAwake()),this._enabled&&this._onEnable()):this._enabled&&this._onDisable()}},{key:"_setActiveInScene",value:function(e){e?this._onEnableInScene():this._onDisableInScene()}},{key:"destroy",value:function(){this.owner&&this.owner._destroyComponent(this)}},{key:"_destroy",value:function(){this.owner.activeInHierarchy&&this._enabled&&(this._setActive(!1),this._isScript()&&this.onDisable()),this.owner._scene&&this._setActiveInScene(!1),this._onDestroy(),this._destroyed=!0,this.onReset!==i.prototype.onReset?(this.onReset(),this._resetComp(),e.Pool.recoverByClass(this)):this._resetComp()}},{key:"id",get:function(){return this._id}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.owner&&(e?this.owner.activeInHierarchy&&this._onEnable():this.owner.activeInHierarchy&&this._onDisable())}},{key:"isSingleton",get:function(){return!0}},{key:"destroyed",get:function(){return this._destroyed}}]),i}();exports.Component=s;
},{"../utils/Pool":"Jkpb","../utils/UtilsBase":"IL6B"}],"upCb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Script=void 0;var e=require("././Component"),t=require("../events/Event");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?s(e):t}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(n){function i(){return o(this,i),u(this,a(i).apply(this,arguments))}return l(i,e.Component),r(i,[{key:"_onAwake",value:function(){this.onAwake(),this.onStart!==i.prototype.onStart&&i.gStartTimer.callLater(this,this.onStart)}},{key:"_onEnable",value:function(){var e=i.prototype;this.onTriggerEnter!==e.onTriggerEnter&&this.owner.on(t.Event.TRIGGER_ENTER,this,this.onTriggerEnter),this.onTriggerStay!==e.onTriggerStay&&this.owner.on(t.Event.TRIGGER_STAY,this,this.onTriggerStay),this.onTriggerExit!==e.onTriggerExit&&this.owner.on(t.Event.TRIGGER_EXIT,this,this.onTriggerExit),this.onMouseDown!==e.onMouseDown&&this.owner.on(t.Event.MOUSE_DOWN,this,this.onMouseDown),this.onMouseUp!==e.onMouseUp&&this.owner.on(t.Event.MOUSE_UP,this,this.onMouseUp),this.onClick!==e.onClick&&this.owner.on(t.Event.CLICK,this,this.onClick),this.onStageMouseDown!==e.onStageMouseDown&&i.gStage.on(t.Event.MOUSE_DOWN,this,this.onStageMouseDown),this.onStageMouseUp!==e.onStageMouseUp&&i.gStage.on(t.Event.MOUSE_UP,this,this.onStageMouseUp),this.onStageClick!==e.onStageClick&&i.gStage.on(t.Event.CLICK,this,this.onStageClick),this.onStageMouseMove!==e.onStageMouseMove&&i.gStage.on(t.Event.MOUSE_MOVE,this,this.onStageMouseMove),this.onDoubleClick!==e.onDoubleClick&&this.owner.on(t.Event.DOUBLE_CLICK,this,this.onDoubleClick),this.onRightClick!==e.onRightClick&&this.owner.on(t.Event.RIGHT_CLICK,this,this.onRightClick),this.onMouseMove!==e.onMouseMove&&this.owner.on(t.Event.MOUSE_MOVE,this,this.onMouseMove),this.onMouseOver!==e.onMouseOver&&this.owner.on(t.Event.MOUSE_OVER,this,this.onMouseOver),this.onMouseOut!==e.onMouseOut&&this.owner.on(t.Event.MOUSE_OUT,this,this.onMouseOut),this.onKeyDown!==e.onKeyDown&&i.gStage.on(t.Event.KEY_DOWN,this,this.onKeyDown),this.onKeyPress!==e.onKeyPress&&i.gStage.on(t.Event.KEY_PRESS,this,this.onKeyPress),this.onKeyUp!==e.onKeyUp&&i.gStage.on(t.Event.KEY_UP,this,this.onKeyUp),this.onUpdate!==e.onUpdate&&i.gUpdateTimer.frameLoop(1,this,this.onUpdate),this.onLateUpdate!==e.onLateUpdate&&i.gLateTimer.frameLoop(1,this,this.onLateUpdate),this.onPreRender!==e.onPreRender&&i.gLateTimer.frameLoop(1,this,this.onPreRender)}},{key:"_onDisable",value:function(){this.owner.offAllCaller(this),i.gStage.offAllCaller(this),i.gStartTimer.clearAll(this),i.gUpdateTimer.clearAll(this),i.gLateTimer.clearAll(this)}},{key:"_isScript",value:function(){return!0}},{key:"_onDestroy",value:function(){this.onDestroy()}},{key:"onAwake",value:function(){}},{key:"onEnable",value:function(){}},{key:"onStart",value:function(){}},{key:"onTriggerEnter",value:function(e,t,n){}},{key:"onTriggerStay",value:function(e,t,n){}},{key:"onTriggerExit",value:function(e,t,n){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onClick",value:function(e){}},{key:"onStageMouseDown",value:function(e){}},{key:"onStageMouseUp",value:function(e){}},{key:"onStageClick",value:function(e){}},{key:"onStageMouseMove",value:function(e){}},{key:"onDoubleClick",value:function(e){}},{key:"onRightClick",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onMouseOver",value:function(e){}},{key:"onMouseOut",value:function(e){}},{key:"onKeyDown",value:function(e){}},{key:"onKeyPress",value:function(e){}},{key:"onKeyUp",value:function(e){}},{key:"onUpdate",value:function(){}},{key:"onLateUpdate",value:function(){}},{key:"onPreRender",value:function(){}},{key:"onPostRender",value:function(){}},{key:"onDisable",value:function(){}},{key:"onDestroy",value:function(){}},{key:"isSingleton",get:function(){return!1}}]),i}();exports.Script=c,c.gStartTimer=null,c.gUpdateTimer=null,c.gLateTimer=null,c.gStage=null;
},{"././Component":"ByT8","../events/Event":"jK6U"}],"24X+":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.IStatRender=void 0;var o=function(){function n(){e(this,n)}return t(n,[{key:"show",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"enable",value:function(){}},{key:"hide",value:function(){}},{key:"set_onclick",value:function(e){}},{key:"isCanvasRender",value:function(){return!0}},{key:"renderNotCanvas",value:function(e,n,t){}}]),n}();exports.IStatRender=o;
},{}],"xhOP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StatUI=void 0;var t=require("././IStatRender"),e=require("././Browser"),i=require("./../../Laya"),r=require("../display/Sprite"),a=require("../display/Text"),s=require("../renders/Render"),n=require("../resource/HTMLCanvas"),o=require("../resource/Resource"),h=require("./Stat");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function v(t,e,i){return e&&c(t.prototype,e),i&&c(t,i),t}function _(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?f(t):e}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function S(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var w=function(l){function c(){var t;return u(this,c),(t=_(this,p(c).apply(this,arguments)))._show=!1,t._useCanvas=!1,t._height=100,t._view=[],t}return S(c,t.IStatRender),v(c,[{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;h.Stat;e.Browser.onMiniGame||e.Browser.onLimixiu||s.Render.isConchApp||e.Browser.onBDMiniGame||e.Browser.onKGMiniGame||e.Browser.onQGMiniGame||(this._useCanvas=!0),this._show=!0,h.Stat._fpsData.length=60,this._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},this._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},this._view[2]={title:"RenderBatches",value:"renderBatches",color:"white",units:"int"},this._view[3]={title:"SavedRenderBatches",value:"savedRenderBatches",color:"white",units:"int"},this._view[4]={title:"CPUMemory",value:"cpuMemory",color:"yellow",units:"M"},this._view[5]={title:"GPUMemory",value:"gpuMemory",color:"yellow",units:"M"},this._view[6]={title:"Shader",value:"shaderCall",color:"white",units:"int"},s.Render.is3DMode?(this._view[0].title="FPS(3D)",this._view[7]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},this._view[8]={title:"FrustumCulling",value:"frustumCulling",color:"white",units:"int"},this._view[9]={title:"OctreeNodeCulling",value:"octreeNodeCulling",color:"white",units:"int"}):(this._view[0].title="FPS(WebGL)",this._view[7]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"}),this._useCanvas?this.createUIPre(t,i):this.createUI(t,i),this.enable()}},{key:"createUIPre",value:function(t,i){var r=e.Browser.pixelRatio;this._width=180*r,this._vx=120*r,this._height=r*(12*this._view.length+3*r)+4,c._fontSize=12*r;for(var a=0;a<this._view.length;a++)this._view[a].x=4,this._view[a].y=a*c._fontSize+2*r;this._canvas||(this._canvas=new n.HTMLCanvas(!0),this._canvas.size(this._width,this._height),this._ctx=this._canvas.getContext("2d"),this._ctx.textBaseline="top",this._ctx.font=c._fontSize+"px Arial",this._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+t+"px;top:"+i+"px;width:"+this._width/r+"px;height:"+this._height/r+"px;"),e.Browser.onKGMiniGame||e.Browser.container.appendChild(this._canvas.source),this._first=!0,this.loop(),this._first=!1}},{key:"createUI",value:function(t,i){var s=this._sp,n=e.Browser.pixelRatio;s||(s=new r.Sprite,this._leftText=new a.Text,this._leftText.pos(5,5),this._leftText.color="#ffffff",s.addChild(this._leftText),this._txt=new a.Text,this._txt.pos(80*n,5),this._txt.color="#ffffff",s.addChild(this._txt),this._sp=s),s.pos(t,i);for(var o="",h=0;h<this._view.length;h++){o+=this._view[h].title+"\n"}this._leftText.text=o;var l=138*n,u=n*(12*this._view.length+3*n)+4;this._txt.fontSize=c._fontSize*n,this._leftText.fontSize=c._fontSize*n,s.size(l,u),s.graphics.clear(),s.graphics.alpha(.5),s.graphics.drawRect(0,0,l,u,"#999999"),s.graphics.alpha(2),this.loop()}},{key:"enable",value:function(){i.Laya.systemTimer.frameLoop(1,this,this.loop)}},{key:"hide",value:function(){this._show=!1,i.Laya.systemTimer.clear(this,this.loop),this._canvas&&e.Browser.removeElement(this._canvas.source)}},{key:"set_onclick",value:function(t){this._sp&&this._sp.on("click",this._sp,t),this._canvas&&(this._canvas.source.onclick=t,this._canvas.source.style.pointerEvents="")}},{key:"loop",value:function(){h.Stat._count++;var t=e.Browser.now();if(!(t-h.Stat._timer<1e3)){var i=h.Stat._count;if(h.Stat.FPS=Math.round(1e3*i/(t-h.Stat._timer)),this._show){h.Stat.trianglesFaces=Math.round(h.Stat.trianglesFaces/i),this._useCanvas?h.Stat.renderBatches=Math.round(h.Stat.renderBatches/i):h.Stat.renderBatches=Math.round(h.Stat.renderBatches/i)-1,h.Stat.savedRenderBatches=Math.round(h.Stat.savedRenderBatches/i),h.Stat.shaderCall=Math.round(h.Stat.shaderCall/i),h.Stat.spriteRenderUseCacheCount=Math.round(h.Stat.spriteRenderUseCacheCount/i),h.Stat.canvasNormal=Math.round(h.Stat.canvasNormal/i),h.Stat.canvasBitmap=Math.round(h.Stat.canvasBitmap/i),h.Stat.canvasReCache=Math.ceil(h.Stat.canvasReCache/i),h.Stat.frustumCulling=Math.round(h.Stat.frustumCulling/i),h.Stat.octreeNodeCulling=Math.round(h.Stat.octreeNodeCulling/i);var r=h.Stat.FPS>0?Math.floor(1e3/h.Stat.FPS).toString():" ";h.Stat._fpsStr=h.Stat.FPS+(h.Stat.renderSlow?" slow":"")+" "+r,this._useCanvas?h.Stat._spriteStr=h.Stat.spriteCount-1+(h.Stat.spriteRenderUseCacheCount?"/"+h.Stat.spriteRenderUseCacheCount:""):h.Stat._spriteStr=h.Stat.spriteCount-4+(h.Stat.spriteRenderUseCacheCount?"/"+h.Stat.spriteRenderUseCacheCount:""),h.Stat._canvasStr=h.Stat.canvasReCache+"/"+h.Stat.canvasNormal+"/"+h.Stat.canvasBitmap,h.Stat.cpuMemory=o.Resource.cpuMemory,h.Stat.gpuMemory=o.Resource.gpuMemory,this._useCanvas?this.renderInfoPre():this.renderInfo(),h.Stat.clear()}h.Stat._count=0,h.Stat._timer=t}}},{key:"renderInfoPre",value:function(){var t,e,i=0;if(this._canvas){var r=this._ctx;for(r.clearRect(this._first?0:this._vx,0,this._width,this._height),i=0;i<this._view.length;i++)t=this._view[i],this._first&&(r.fillStyle="white",r.fillText(t.title,t.x,t.y)),r.fillStyle=t.color,e=h.Stat[t.value],"M"==t.units&&(e=Math.floor(e/1048576*100)/100+" M"),r.fillText(e+"",t.x+this._vx,t.y)}}},{key:"renderInfo",value:function(){for(var t="",e=0;e<this._view.length;e++){var i=this._view[e],r=h.Stat[i.value];"M"==i.units&&(r=Math.floor(r/1048576*100)/100+" M"),"K"==i.units&&(r=Math.floor(r/1024*100)/100+" K"),t+=r+"\n"}this._txt.text=t}},{key:"isCanvasRender",value:function(){return this._useCanvas}},{key:"renderNotCanvas",value:function(t,e,i){this._show&&this._sp&&this._sp.render(t,0,0)}}]),c}();exports.StatUI=w,w._fontSize=12;
},{"././IStatRender":"24X+","././Browser":"pOAB","./../../Laya":"akmp","../display/Sprite":"LHsS","../display/Text":"fW8x","../renders/Render":"Gwgr","../resource/HTMLCanvas":"TY9w","../resource/Resource":"M+wd","./Stat":"xuKH"}],"rIqI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureSV=void 0;var e=require("././Value2D"),t=require("../../../WebGL"),r=require("../ShaderDefines2D");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function l(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(n){function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return o(this,u),(e=l(this,f(u).call(this,r.ShaderDefines2D.TEXTURE2D,t))).strength=0,e.blurInfo=null,e.colorMat=null,e.colorAlpha=null,e._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2],e}return a(u,e.Value2D),i(u,[{key:"clear",value:function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(t.WebGL.shaderHighPrecision?r.ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION:0)}}]),u}();exports.TextureSV=p;
},{"././Value2D":"cqLV","../../../WebGL":"RsJd","../ShaderDefines2D":"el31"}],"4rFI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrimitiveSV=void 0;var t=require("././Value2D"),e=require("../ShaderDefines2D");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?i(t):e}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=function(o){function i(t){var o;return r(this,i),(o=n(this,u(i).call(this,e.ShaderDefines2D.PRIMITIVE,0)))._attribLocation=["position",0,"attribColor",1],o}return c(i,t.Value2D),i}();exports.PrimitiveSV=s;
},{"././Value2D":"cqLV","../ShaderDefines2D":"el31"}],"aY/o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SkinSV=void 0;var t=require("../ShaderDefines2D"),e=require("../value/Value2D"),o=require("../../../WebGLContext"),r=require("../../../utils/CONST3D2D");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?f(t):e}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var p=function(n){function f(e){var n;i(this,f),(n=u(this,c(f).call(this,t.ShaderDefines2D.SKINMESH,0))).offsetX=300,n.offsetY=0;var s=8*r.CONST3D2D.BYTES_PE;return n.position=[2,o.WebGLContext.FLOAT,!1,s,0],n.texcoord=[2,o.WebGLContext.FLOAT,!1,s,2*r.CONST3D2D.BYTES_PE],n.color=[4,o.WebGLContext.FLOAT,!1,s,4*r.CONST3D2D.BYTES_PE],n}return s(f,e.Value2D),f}();exports.SkinSV=p;
},{"../ShaderDefines2D":"el31","../value/Value2D":"cqLV","../../../WebGLContext":"vf9T","../../../utils/CONST3D2D":"IFWI"}],"akmp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Laya=void 0;var e=require("./laya/display/Input"),r=require("./laya/display/Sprite"),a=require("./laya/display/Stage"),t=require("./laya/events/KeyBoardManager"),n=require("./laya/events/MouseManager"),i=require("./laya/media/SoundManager"),o=require("./laya/net/LoaderManager"),s=require("./laya/net/URL"),u=require("./laya/renders/Render"),l=require("./laya/renders/RenderSprite"),d=require("./laya/resource/Texture2D"),g=require("./laya/utils/Browser"),y=require("./laya/utils/CacheManger"),c=require("./laya/utils/Timer"),T=require("./laya/webgl/WebGL"),w=require("./laya/display/Node"),m=require("./laya/display/Text"),p=require("./laya/events/Event"),S=require("./laya/utils/WeakObject"),_=require("./laya/resource/Texture"),f=require("./laya/resource/HTMLCanvas"),v=require("./laya/resource/RenderTexture2D"),L=require("./laya/layagl/LayaGLRunner"),b=require("./laya/webgl/WebGLContext"),h=require("./laya/webgl/shader/Shader"),x=require("./laya/webgl/utils/RenderState2D"),q=require("./laya/resource/Context"),C=require("./laya/utils/ColorUtils"),R=require("./laya/layagl/LayaGL"),D=require("./laya/utils/Utils"),B=require("./laya/net/Loader"),M=require("./laya/resource/Resource"),G=require("./laya/net/TTFLoader"),U=require("./laya/utils/PlatformInfo"),E=require("./laya/net/LocalStorage"),I=require("./laya/display/Graphics"),P=require("./laya/utils/Tween"),W=require("./laya/utils/Dragging"),k=require("./laya/components/Script"),V=require("./laya/utils/Stat"),N=require("./laya/utils/StatUI"),F=require("./laya/webgl/shader/d2/value/Value2D"),A=require("./laya/webgl/shader/d2/ShaderDefines2D"),O=require("./laya/webgl/shader/d2/value/TextureSV"),H=require("./laya/webgl/shader/d2/value/PrimitiveSV"),j=require("./laya/webgl/shader/d2/skinAnishader/SkinSV"),X=require("./laya/webgl/text/TextRender");function K(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function z(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function J(e,r,a){return r&&z(e.prototype,r),a&&z(e,a),e}var Q=function(){function X(){K(this,X)}return J(X,null,[{key:"init",value:function(r,v){if(!X._isinit){X._isinit=!0,ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=X._arrayBufferSlice);var L=window._layalibs;if(L){L.sort(function(e,r){return e.i-r.i});for(var b=0;b<L.length;b++)L[b].f(window,window.document,X)}g.Browser.gLaya=X,g.Browser.__init__();var h=g.Browser.mainCanvas=new f.HTMLCanvas(!0),x=h.source.style;x.position="absolute",x.top=x.left="0px",x.background="#000000",g.Browser.onKGMiniGame||g.Browser.container.appendChild(h.source),g.Browser.canvas=new f.HTMLCanvas(!0),g.Browser.context=g.Browser.canvas.getContext("2d"),U.PlatformInfo.supportWebAudio=g.Browser.supportWebAudio=i.SoundManager.__init__(),g.Browser.supportLocalStorage=U.PlatformInfo.supportLocalStorage=E.LocalStorage.__init__(),X.systemTimer=new c.Timer(!1),c.Timer.gSysTimer=X.systemTimer,X.startTimer=new c.Timer(!1),X.physicsTimer=new c.Timer(!1),X.updateTimer=new c.Timer(!1),X.lateTimer=new c.Timer(!1),X.timer=new c.Timer(!1),k.Script.gStartTimer=X.startTimer,k.Script.gUpdateTimer=X.updateTimer,k.Script.gLateTimer=X.lateTimer,X.loader=new o.LoaderManager,o.LoaderManager.gLoader=X.loader,d.Texture2D.gLoaderMgr=X.loader,d.Texture2D.gLoaderType=B.Loader,I.Graphics.gLoader=B.Loader,d.Texture2D.gBrowser=g.Browser,q.Context.gSysTimer=X.systemTimer,e.Input.gSysTimer=X.systemTimer,M.Resource.gLoader=B.Loader,G.TTFLoader.gSysTimer=X.systemTimer,o.LoaderManager.gSysTimer=X.systemTimer,P.Tween.gTimer=X.timer,S.WeakObject.__init__(),T.WebGL.inner_enable();for(var C=arguments.length,R=new Array(C>2?C-2:0),K=2;K<C;K++)R[K-2]=arguments[K];for(var z=0,J=R.length;z<J;z++)R[z]&&R[z].enable&&R[z].enable();return u.Render.isConchApp&&X.enableNative(),y.CacheManger.beginCheck(),X._currentStage=X.stage=new a.Stage,a.Stage.gStage=X.stage,a.Stage.gSysTimer=X.systemTimer,g.Browser.gStage=X.stage,D.Utils.gStage=X.stage,e.Input.gStage=X.stage,s.URL.rootPath=s.URL._basePath=s.URL._getUrlPath(),u.Render.gStage=X.stage,X.render=new u.Render(0,0,g.Browser.mainCanvas),X.stage.size(r,v),window.stage=X.stage,i.SoundManager.gLoader=X.loader,i.SoundManager.gTimer=X.timer,i.SoundManager.gStage=X.stage,W.Dragging.gStage=X.stage,W.Dragging.gSysTimer=X.systemTimer,w.Node.gTimer=X.timer,w.Node.gStage=X.stage,m.Text.gSysTimer=X.systemTimer,m.Text.gBrowser=g.Browser,p.Event.gStage=X.stage,_.Texture.gLoader=X.loader,_.Texture.gContext=q.Context,e.Input.gMainCanvas=u.Render.canvas,l.RenderSprite.__init__(),t.KeyBoardManager.__init__(),n.MouseManager.instance.__init__(X.stage,u.Render.canvas),e.Input.__init__(),i.SoundManager.autoStopMusic=!0,V.Stat._StatRender=new N.StatUI,F.Value2D._initone(A.ShaderDefines2D.TEXTURE2D,O.TextureSV),F.Value2D._initone(A.ShaderDefines2D.TEXTURE2D|A.ShaderDefines2D.FILTERGLOW,O.TextureSV),F.Value2D._initone(A.ShaderDefines2D.PRIMITIVE,H.PrimitiveSV),F.Value2D._initone(A.ShaderDefines2D.SKINMESH,j.SkinSV),u.Render.canvas}}},{key:"_arrayBufferSlice",value:function(e,r){var a=new Uint8Array(this,e,r-e),t=new Uint8Array(a.length);return t.set(a),t.buffer}},{key:"_runScript",value:function(e){return g.Browser.window[X._evcode](e)}},{key:"enableDebugPanel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"libs/laya.debugtool.js";if(X.DebugPanel)X.DebugPanel.enable();else{var r=g.Browser.createElement("script");r.onload=function(){X.DebugPanel.enable()},r.src=e,g.Browser.document.body.appendChild(r)}}},{key:"enableNative",value:function(){X.isNativeRender_enable||(X.isNativeRender_enable=!0,b.WebGLContext.__init_native(),h.Shader.prototype.uploadTexture2D=function(e){var r=b.WebGLContext;r.bindTexture(b.WebGLContext.mainContext,r.TEXTURE_2D,e)},x.RenderState2D.width=g.Browser.window.innerWidth,x.RenderState2D.height=g.Browser.window.innerHeight,g.Browser.measureText=function(e,r){return window.conchTextCanvas.font=r,window.conchTextCanvas.measureText(e)},a.Stage.clear=function(e){q.Context.set2DRenderConfig();var r=C.ColorUtils.create(e).arrColor,a=R.LayaGL.instance;r&&a.clearColor(r[0],r[1],r[2],r[3]),a.clear(b.WebGLContext.COLOR_BUFFER_BIT|b.WebGLContext.DEPTH_BUFFER_BIT|b.WebGLContext.STENCIL_BUFFER_BIT),x.RenderState2D.clear()},r.Sprite.drawToCanvas=r.Sprite.drawToTexture=function(e,r,a,t,n,i){n-=e.x,i-=e.y,n|=0,i|=0,a|=0,t|=0;var o=new f.HTMLCanvas(!1),s=o.getContext("2d");return o.size(a,t),s.asBitmap=!0,s._targets.start(),l.RenderSprite.renders[r]._fun(e,s,n,i),s.flush(),s._targets.end(),s._targets.restore(),o},Object.defineProperty(v.RenderTexture2D.prototype,"uv",{get:function(){return this._uv},set:function(e){this._uv=e}}),f.HTMLCanvas.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=v.RenderTexture2D.flipyuv,this._texture.bitmap=this._texture),this._texture},u.Render.supportWebGLPlusRendering&&(L.LayaGLRunner.uploadShaderUniforms=L.LayaGLRunner.uploadShaderUniformsForNative,window.CommandEncoder=window.GLCommandEncoder,window.LayaGL=window.LayaGLContext))}},{key:"alertGlobalError",set:function(e){var r=0;g.Browser.window.onerror=e?function(e,a,t,n,i){r++<5&&i&&this.alert("出错啦，请把此信息截图给研发商\n"+e+"\n"+i.stack)}:null}}]),X}();function Y(e){Q[e.name]=e}exports.Laya=Q,Q.stage=null,Q.systemTimer=null,Q.startTimer=null,Q.physicsTimer=null,Q.updateTimer=null,Q.lateTimer=null,Q.timer=null,Q.loader=null,Q.version="2.1.0beta",Q._isinit=!1,Q.isWXOpenDataContext=!1,Q.isWXPosMsg=!1,Q._evcode="eval",Q.isNativeRender_enable=!1,window.Laya=Q,Y(X.TextRender);
},{"./laya/display/Input":"ReI4","./laya/display/Sprite":"LHsS","./laya/display/Stage":"N+WO","./laya/events/KeyBoardManager":"+bzw","./laya/events/MouseManager":"0uUh","./laya/media/SoundManager":"8e3q","./laya/net/LoaderManager":"rah/","./laya/net/URL":"vU/V","./laya/renders/Render":"Gwgr","./laya/renders/RenderSprite":"FG7q","./laya/resource/Texture2D":"zb/G","./laya/utils/Browser":"pOAB","./laya/utils/CacheManger":"EApa","./laya/utils/Timer":"FULD","./laya/webgl/WebGL":"RsJd","./laya/display/Node":"9izd","./laya/display/Text":"fW8x","./laya/events/Event":"jK6U","./laya/utils/WeakObject":"PbXW","./laya/resource/Texture":"nP6w","./laya/resource/HTMLCanvas":"TY9w","./laya/resource/RenderTexture2D":"pIGp","./laya/layagl/LayaGLRunner":"+KpL","./laya/webgl/WebGLContext":"vf9T","./laya/webgl/shader/Shader":"PB8V","./laya/webgl/utils/RenderState2D":"k75q","./laya/resource/Context":"2BX4","./laya/utils/ColorUtils":"iLoT","./laya/layagl/LayaGL":"ezDE","./laya/utils/Utils":"kHKw","./laya/net/Loader":"/MXX","./laya/resource/Resource":"M+wd","./laya/net/TTFLoader":"YZHQ","./laya/utils/PlatformInfo":"HmZQ","./laya/net/LocalStorage":"qqcC","./laya/display/Graphics":"9Gi9","./laya/utils/Tween":"4SqU","./laya/utils/Dragging":"hmHh","./laya/components/Script":"upCb","./laya/utils/Stat":"xuKH","./laya/utils/StatUI":"xhOP","./laya/webgl/shader/d2/value/Value2D":"cqLV","./laya/webgl/shader/d2/ShaderDefines2D":"el31","./laya/webgl/shader/d2/value/TextureSV":"rIqI","./laya/webgl/shader/d2/value/PrimitiveSV":"4rFI","./laya/webgl/shader/d2/skinAnishader/SkinSV":"aY/o","./laya/webgl/text/TextRender":"LV+0"}],"SrNS":[function(require,module,exports) {
"use strict";var a=require("../core/laya/display/Sprite"),e=require("../core/Laya"),r=require("../core/laya/display/Text");function t(){var r=new a.Sprite;e.Laya.stage.addChild(r),r.graphics.drawRect(0,0,100,100,"red")}function i(){var a=new r.Text;a.fontSize=30,a.text="g",a.color="red",a.pos(100,100),e.Laya.stage.addChild(a)}function d(){var r=new a.Sprite;r.graphics.drawTexture(e.Laya.loader.getRes("./res/monkey.png"),100,100),e.Laya.stage.addChild(r)}e.Laya.init(1280,720),e.Laya.stage.bgColor="gray",e.Laya.loader.load("./res/monkey.png"),i();
},{"../core/laya/display/Sprite":"LHsS","../core/Laya":"akmp","../core/laya/display/Text":"fW8x"}]},{},["SrNS"], null)
//# sourceMappingURL=/bundle.js.map